(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[179],{476:(Mp,kc,Rc)=>{"use strict";function $n(e){return"function"==typeof e}function Au(e){const n=e(s=>{Error.call(s),s.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const Sp=Au(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((s,l)=>`${l+1}) ${s.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function p(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class Yn{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const d of n)d.remove(this);else n.remove(this);const{initialTeardown:s}=this;if($n(s))try{s()}catch(d){t=d instanceof Sp?d.errors:[d]}const{_teardowns:l}=this;if(l){this._teardowns=null;for(const d of l)try{Je(d)}catch(y){t=null!=t?t:[],y instanceof Sp?t=[...t,...y.errors]:t.push(y)}}if(t)throw new Sp(t)}}add(t){var n;if(t&&t!==this)if(this.closed)Je(t);else{if(t instanceof Yn){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=null!==(n=this._teardowns)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&p(n,t)}remove(t){const{_teardowns:n}=this;n&&p(n,t),t instanceof Yn&&t._removeParent(this)}}Yn.EMPTY=(()=>{const e=new Yn;return e.closed=!0,e})();const qo=Yn.EMPTY;function pi(e){return e instanceof Yn||e&&"closed"in e&&$n(e.remove)&&$n(e.add)&&$n(e.unsubscribe)}function Je(e){$n(e)?e():e.unsubscribe()}const wt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Pe={setTimeout(...e){const{delegate:t}=Pe;return((null==t?void 0:t.setTimeout)||setTimeout)(...e)},clearTimeout(e){const{delegate:t}=Pe;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Ai(e){Pe.setTimeout(()=>{const{onUnhandledError:t}=wt;if(!t)throw e;t(e)})}function Ln(){}const Il=so("C",void 0,void 0);function so(e,t,n){return{kind:e,value:t,error:n}}let Tr=null;function Zo(e){if(wt.useDeprecatedSynchronousErrorHandling){const t=!Tr;if(t&&(Tr={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:s}=Tr;if(Tr=null,n)throw s}}else e()}class Wo extends Yn{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,pi(t)&&t.add(this)):this.destination=kl}static create(t,n,s){return new xs(t,n,s)}next(t){this.isStopped?ao(function Al(e){return so("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?ao(function fi(e){return so("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?ao(Il,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class xs extends Wo{constructor(t,n,s){let l;if(super(),$n(t))l=t;else if(t){let d;({next:l,error:n,complete:s}=t),this&&wt.useDeprecatedNextContext?(d=Object.create(t),d.unsubscribe=()=>this.unsubscribe()):d=t,l=null==l?void 0:l.bind(d),n=null==n?void 0:n.bind(d),s=null==s?void 0:s.bind(d)}this.destination={next:l?Xo(l):Ln,error:Xo(null!=n?n:Pl),complete:s?Xo(s):Ln}}}function Xo(e,t){return(...n)=>{try{e(...n)}catch(s){wt.useDeprecatedSynchronousErrorHandling?function To(e){wt.useDeprecatedSynchronousErrorHandling&&Tr&&(Tr.errorThrown=!0,Tr.error=e)}(s):Ai(s)}}}function Pl(e){throw e}function ao(e,t){const{onStoppedNotification:n}=wt;n&&Pe.setTimeout(()=>n(e,t))}const kl={closed:!0,next:Ln,error:Pl,complete:Ln},bs="function"==typeof Symbol&&Symbol.observable||"@@observable";function $i(e){return e}let sn=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const s=new e;return s.source=this,s.operator=n,s}subscribe(n,s,l){const d=function Ua(e){return e&&e instanceof Wo||function Do(e){return e&&$n(e.next)&&$n(e.error)&&$n(e.complete)}(e)&&pi(e)}(n)?n:new xs(n,s,l);return Zo(()=>{const{operator:y,source:w}=this;d.add(y?y.call(d,w):w?this._subscribe(d):this._trySubscribe(d))}),d}_trySubscribe(n){try{return this._subscribe(n)}catch(s){n.error(s)}}forEach(n,s){return new(s=Xs(s))((l,d)=>{const y=new xs({next:w=>{try{n(w)}catch(D){d(D),y.unsubscribe()}},error:d,complete:l});this.subscribe(y)})}_subscribe(n){var s;return null===(s=this.source)||void 0===s?void 0:s.subscribe(n)}[bs](){return this}pipe(...n){return function lo(e){return 0===e.length?$i:1===e.length?e[0]:function(n){return e.reduce((s,l)=>l(s),n)}}(n)(this)}toPromise(n){return new(n=Xs(n))((s,l)=>{let d;this.subscribe(y=>d=y,y=>l(y),()=>s(d))})}}return e.create=t=>new e(t),e})();function Xs(e){var t;return null!==(t=null!=e?e:wt.Promise)&&void 0!==t?t:Promise}const Xt=Au(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Gi=(()=>{class e extends sn{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const s=new ws(this,this);return s.operator=n,s}_throwIfClosed(){if(this.closed)throw new Xt}next(n){Zo(()=>{if(this._throwIfClosed(),!this.isStopped){const s=this.observers.slice();for(const l of s)l.next(n)}})}error(n){Zo(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:s}=this;for(;s.length;)s.shift().error(n)}})}complete(){Zo(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:s,isStopped:l,observers:d}=this;return s||l?qo:(d.push(n),new Yn(()=>p(d,n)))}_checkFinalizedStatuses(n){const{hasError:s,thrownError:l,isStopped:d}=this;s?n.error(l):d&&n.complete()}asObservable(){const n=new sn;return n.source=this,n}}return e.create=(t,n)=>new ws(t,n),e})();class ws extends Gi{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,s;null===(s=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===s||s.call(n,t)}error(t){var n,s;null===(s=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===s||s.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,s;return null!==(s=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==s?s:qo}}function Es(e){return $n(null==e?void 0:e.lift)}function _r(e){return t=>{if(Es(t))return t.lift(function(n){try{return e(n,this)}catch(s){this.error(s)}});throw new TypeError("Unable to lift unknown Observable type")}}class Jn extends Wo{constructor(t,n,s,l,d){super(t),this.onFinalize=d,this._next=n?function(y){try{n(y)}catch(w){t.error(w)}}:super._next,this._error=l?function(y){try{l(y)}catch(w){t.error(w)}finally{this.unsubscribe()}}:super._error,this._complete=s?function(){try{s()}catch(y){t.error(y)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}function Gt(e,t){return _r((n,s)=>{let l=0;n.subscribe(new Jn(s,d=>{s.next(e.call(t,d,l++))}))})}function Hi(e){return this instanceof Hi?(this.v=e,this):new Hi(e)}function Xn(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,s=n.apply(e,t||[]),d=[];return l={},y("next"),y("throw"),y("return"),l[Symbol.asyncIterator]=function(){return this},l;function y(Y){s[Y]&&(l[Y]=function(te){return new Promise(function(ge,Ie){d.push([Y,te,ge,Ie])>1||w(Y,te)})})}function w(Y,te){try{!function D(Y){Y.value instanceof Hi?Promise.resolve(Y.value.v).then(A,F):j(d[0][2],Y)}(s[Y](te))}catch(ge){j(d[0][3],ge)}}function A(Y){w("next",Y)}function F(Y){w("throw",Y)}function j(Y,te){Y(te),d.shift(),d.length&&w(d[0][0],d[0][1])}}function Ol(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function $a(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],s=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n);function s(d){n[d]=e[d]&&function(y){return new Promise(function(w,D){!function l(d,y,w,D){Promise.resolve(D).then(function(A){d({value:A,done:w})},y)}(w,D,(y=e[d](y)).done,y.value)})}}}const Qs=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function ki(e){return $n(null==e?void 0:e.then)}function Bl(e){return $n(e[bs])}function zn(e){return Symbol.asyncIterator&&$n(null==e?void 0:e[Symbol.asyncIterator])}function Ri(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const co=function Ha(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function ea(e){return $n(null==e?void 0:e[co])}function Ts(e){return Xn(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:s,done:l}=yield Hi(n.read());if(l)return yield Hi(void 0);yield yield Hi(s)}}finally{n.releaseLock()}})}function Mo(e){return $n(null==e?void 0:e.getReader)}function yr(e){if(e instanceof sn)return e;if(null!=e){if(Bl(e))return function Ds(e){return new sn(t=>{const n=e[bs]();if($n(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Qs(e))return function So(e){return new sn(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(ki(e))return function qa(e){return new sn(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,Ai)})}(e);if(zn(e))return K(e);if(ea(e))return function Li(e){return new sn(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Mo(e))return function O(e){return K(Ts(e))}(e)}throw Ri(e)}function K(e){return new sn(t=>{(function U(e,t){var n,s,l,d;return function Pi(e,t,n,s){return new(n||(n=Promise))(function(d,y){function w(F){try{A(s.next(F))}catch(j){y(j)}}function D(F){try{A(s.throw(F))}catch(j){y(j)}}function A(F){F.done?d(F.value):function l(d){return d instanceof n?d:new n(function(y){y(d)})}(F.value).then(w,D)}A((s=s.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=Ol(e);!(s=yield n.next()).done;)if(t.next(s.value),t.closed)return}catch(y){l={error:y}}finally{try{s&&!s.done&&(d=n.return)&&(yield d.call(n))}finally{if(l)throw l.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function X(e,t,n,s=0,l=!1){const d=t.schedule(function(){n(),l?e.add(this.schedule(null,s)):this.unsubscribe()},s);if(e.add(d),!l)return d}function se(e,t,n=1/0){return $n(t)?se((s,l)=>Gt((d,y)=>t(s,d,l,y))(yr(e(s,l))),n):("number"==typeof t&&(n=t),_r((s,l)=>function Q(e,t,n,s,l,d,y,w){const D=[];let A=0,F=0,j=!1;const Y=()=>{j&&!D.length&&!A&&t.complete()},te=Ie=>A<s?ge(Ie):D.push(Ie),ge=Ie=>{d&&t.next(Ie),A++;let Ve=!1;yr(n(Ie,F++)).subscribe(new Jn(t,$e=>{null==l||l($e),d?te($e):t.next($e)},()=>{Ve=!0},void 0,()=>{if(Ve)try{for(A--;D.length&&A<s;){const $e=D.shift();y?X(t,y,()=>ge($e)):ge($e)}Y()}catch($e){t.error($e)}}))};return e.subscribe(new Jn(t,te,()=>{j=!0,Y()})),()=>{null==w||w()}}(s,l,e,n)))}function me(e=1/0){return se($i,e)}const de=new sn(e=>e.complete());function Ae(e){return e[e.length-1]}function ot(e){return function Me(e){return e&&$n(e.schedule)}(Ae(e))?e.pop():void 0}function pt(e,t=0){return _r((n,s)=>{n.subscribe(new Jn(s,l=>X(s,e,()=>s.next(l),t),()=>X(s,e,()=>s.complete(),t),l=>X(s,e,()=>s.error(l),t)))})}function mt(e,t=0){return _r((n,s)=>{s.add(e.schedule(()=>n.subscribe(s),t))})}function kn(e,t){if(!e)throw new Error("Iterable cannot be null");return new sn(n=>{X(n,t,()=>{const s=e[Symbol.asyncIterator]();X(n,t,()=>{s.next().then(l=>{l.done?n.complete():n.next(l.value)})},0,!0)})})}function hn(e,t){return t?function Ko(e,t){if(null!=e){if(Bl(e))return function Lt(e,t){return yr(e).pipe(mt(t),pt(t))}(e,t);if(Qs(e))return function On(e,t){return new sn(n=>{let s=0;return t.schedule(function(){s===e.length?n.complete():(n.next(e[s++]),n.closed||this.schedule())})})}(e,t);if(ki(e))return function Sn(e,t){return yr(e).pipe(mt(t),pt(t))}(e,t);if(zn(e))return kn(e,t);if(ea(e))return function Tn(e,t){return new sn(n=>{let s;return X(n,t,()=>{s=e[co](),X(n,t,()=>{let l,d;try{({value:l,done:d}=s.next())}catch(y){return void n.error(y)}d?n.complete():n.next(l)},0,!0)}),()=>$n(null==s?void 0:s.return)&&s.return()})}(e,t);if(Mo(e))return function Ms(e,t){return kn(Ts(e),t)}(e,t)}throw Ri(e)}(e,t):yr(e)}function ta(e){return e<=0?()=>de:_r((t,n)=>{let s=0;t.subscribe(new Jn(n,l=>{++s<=e&&(n.next(l),e<=s&&n.complete())}))})}function Nl(e,t,...n){return!0===t?(e(),null):!1===t?null:t(...n).pipe(ta(1)).subscribe(()=>e())}function yn(e){for(let t in e)if(e[t]===yn)return t;throw Error("Could not find renamed property on target object.")}function fn(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(fn).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function Za(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const jl=yn({__forward_ref__:yn});function Vl(e){return e.__forward_ref__=Vl,e.toString=function(){return fn(this())},e}function vt(e){return function Wa(e){return"function"==typeof e&&e.hasOwnProperty(jl)&&e.__forward_ref__===Vl}(e)?e():e}class vn extends Error{constructor(t,n){super(function Bc(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,n)),this.code=t}}function Et(e){return"string"==typeof e?e:null==e?"":String(e)}function cr(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Et(e)}function na(e,t){const n=t?` in ${t}`:"";throw new vn(-201,`No provider for ${cr(e)} found${n}`)}function xt(e,t){null==e&&function ct(e,t,n,s){throw new Error(`ASSERTION ERROR: ${e}`+(null==s?"":` [Expected=> ${n} ${s} ${t} <=Actual]`))}(t,e,null,"!=")}function Tt(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function mi(e){return{providers:e.providers||[],imports:e.imports||[]}}function gi(e){return Bn(e,Qo)||Bn(e,oa)}function Bn(e,t){return e.hasOwnProperty(t)?e[t]:null}function Hl(e){return e&&(e.hasOwnProperty(Ps)||e.hasOwnProperty(Qt))?e[Ps]:null}const Qo=yn({\u0275prov:yn}),Ps=yn({\u0275inj:yn}),oa=yn({ngInjectableDef:yn}),Qt=yn({ngInjectorDef:yn});var Mt=(()=>((Mt=Mt||{})[Mt.Default=0]="Default",Mt[Mt.Host=1]="Host",Mt[Mt.Self=2]="Self",Mt[Mt.SkipSelf=4]="SkipSelf",Mt[Mt.Optional=8]="Optional",Mt))();let ql;function vr(e){const t=ql;return ql=e,t}function Fu(e,t,n){const s=gi(e);return s&&"root"==s.providedIn?void 0===s.value?s.value=s.factory():s.value:n&Mt.Optional?null:void 0!==t?t:void na(fn(e),"Injector")}function In(e){return{toString:e}.toString()}var Qr=(()=>((Qr=Qr||{})[Qr.OnPush=0]="OnPush",Qr[Qr.Default=1]="Default",Qr))(),Oi=(()=>{return(e=Oi||(Oi={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",Oi;var e})();const Zi="undefined"!=typeof globalThis&&globalThis,Po="undefined"!=typeof window&&window,aa="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Kt=Zi||"undefined"!=typeof global&&global||Po||aa,Dr={},xn=[],uo=yn({\u0275cmp:yn}),Xa=yn({\u0275dir:yn}),la=yn({\u0275pipe:yn}),Bu=yn({\u0275mod:yn}),ko=yn({\u0275fac:yn}),ca=yn({__NG_ELEMENT_ID__:yn});let Qh=0;function Fi(e){return In(()=>{const n={},s={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===Qr.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||xn,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||Oi.Emulated,id:"c",styles:e.styles||xn,_:null,setInput:null,schemas:e.schemas||null,tView:null},l=e.directives,d=e.features,y=e.pipes;return s.id+=Qh++,s.inputs=ju(e.inputs,n),s.outputs=ju(e.outputs),d&&d.forEach(w=>w(s)),s.directiveDefs=l?()=>("function"==typeof l?l():l).map(Nu):null,s.pipeDefs=y?()=>("function"==typeof y?y():y).map(ed):null,s})}function Nu(e){return rr(e)||function Wi(e){return e[Xa]||null}(e)}function ed(e){return function ho(e){return e[la]||null}(e)}const Nc={};function Ro(e){return In(()=>{const t={type:e.type,bootstrap:e.bootstrap||xn,declarations:e.declarations||xn,imports:e.imports||xn,exports:e.exports||xn,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(Nc[e.id]=e.type),t})}function ju(e,t){if(null==e)return Dr;const n={};for(const s in e)if(e.hasOwnProperty(s)){let l=e[s],d=l;Array.isArray(l)&&(d=l[1],l=l[0]),n[l]=s,t&&(t[l]=d)}return n}const zr=Fi;function nr(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,onDestroy:e.type.prototype.ngOnDestroy||null}}function rr(e){return e[uo]||null}function ei(e,t){const n=e[Bu]||null;if(!n&&!0===t)throw new Error(`Type ${fn(e)} does not have '\u0275mod' property.`);return n}function Bi(e){return Array.isArray(e)&&"object"==typeof e[1]}function Mr(e){return Array.isArray(e)&&!0===e[1]}function ma(e){return 0!=(8&e.flags)}function Zl(e){return 2==(2&e.flags)}function ga(e){return 1==(1&e.flags)}function Sr(e){return null!==e.template}function nd(e){return 0!=(512&e[2])}function zo(e,t){return e.hasOwnProperty(ko)?e[ko]:null}class Np{constructor(t,n,s){this.previousValue=t,this.currentValue=n,this.firstChange=s}isFirstChange(){return this.firstChange}}function cd(e){return e.type.prototype.ngOnChanges&&(e.setInput=Ja),Zu}function Zu(){const e=el(this),t=null==e?void 0:e.current;if(t){const n=e.previous;if(n===Dr)e.previous=t;else for(let s in t)n[s]=t[s];e.current=null,this.ngOnChanges(t)}}function Ja(e,t,n,s){const l=el(e)||function Wu(e,t){return e[Qa]=t}(e,{previous:Dr,current:null}),d=l.current||(l.current={}),y=l.previous,w=this.declaredInputs[n],D=y[w];d[w]=new Np(D&&D.currentValue,t,y===Dr),e[s]=t}const Qa="__ngSimpleChanges__";function el(e){return e[Qa]||null}let Xl;function Un(e){return!!e.listen}const Yu={createRenderer:(e,t)=>function nl(){return void 0!==Xl?Xl:"undefined"!=typeof document?document:void 0}()};function hr(e){for(;Array.isArray(e);)e=e[0];return e}function xi(e,t){return hr(t[e.index])}function Zc(e,t){return e.data[t]}function ni(e,t){const n=t[e];return Bi(n)?n:n[0]}function va(e){return 128==(128&e[2])}function is(e,t){return null==t?null:e[t]}function il(e){e[18]=0}function Fs(e,t){e[5]+=t;let n=e,s=e[3];for(;null!==s&&(1===t&&1===n[5]||-1===t&&0===n[5]);)s[5]+=t,n=s,s=s[3]}const Ct={lFrame:B(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Wc(){return Ct.bindingsEnabled}function Ne(){return Ct.lFrame.lView}function on(){return Ct.lFrame.tView}function Hn(){let e=xa();for(;null!==e&&64===e.type;)e=e.parent;return e}function xa(){return Ct.lFrame.currentTNode}function Ki(e,t){const n=Ct.lFrame;n.currentTNode=e,n.isParent=t}function rh(){return Ct.lFrame.isParent}function zs(){return Ct.isInCheckNoChangesMode}function os(e){Ct.isInCheckNoChangesMode=e}function wa(){return Ct.lFrame.bindingIndex++}function o(e,t){const n=Ct.lFrame;n.bindingIndex=n.bindingRootIndex=e,g(t)}function g(e){Ct.lFrame.currentDirectiveIndex=e}function C(e){Ct.lFrame.currentQueryIndex=e}function M(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function k(e,t,n){if(n&Mt.SkipSelf){let l=t,d=e;for(;!(l=l.parent,null!==l||n&Mt.Host||(l=M(d),null===l||(d=d[15],10&l.type))););if(null===l)return!1;t=l,e=d}const s=Ct.lFrame=L();return s.currentTNode=t,s.lView=e,!0}function R(e){const t=L(),n=e[1];Ct.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function L(){const e=Ct.lFrame,t=null===e?null:e.child;return null===t?B(e):t}function B(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function V(){const e=Ct.lFrame;return Ct.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Z=V;function H(){const e=V();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function G(){return Ct.lFrame.selectedIndex}function re(e){Ct.lFrame.selectedIndex=e}function ee(){const e=Ct.lFrame;return Zc(e.tView,e.selectedIndex)}function Oe(e,t){for(let n=t.directiveStart,s=t.directiveEnd;n<s;n++){const d=e.data[n].type.prototype,{ngAfterContentInit:y,ngAfterContentChecked:w,ngAfterViewInit:D,ngAfterViewChecked:A,ngOnDestroy:F}=d;y&&(e.contentHooks||(e.contentHooks=[])).push(-n,y),w&&((e.contentHooks||(e.contentHooks=[])).push(n,w),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,w)),D&&(e.viewHooks||(e.viewHooks=[])).push(-n,D),A&&((e.viewHooks||(e.viewHooks=[])).push(n,A),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,A)),null!=F&&(e.destroyHooks||(e.destroyHooks=[])).push(n,F)}}function Le(e,t,n){ke(e,t,3,n)}function be(e,t,n,s){(3&e[2])===n&&ke(e,t,n,s)}function ve(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function ke(e,t,n,s){const d=null!=s?s:-1,y=t.length-1;let w=0;for(let D=void 0!==s?65535&e[18]:0;D<y;D++)if("number"==typeof t[D+1]){if(w=t[D],null!=s&&w>=s)break}else t[D]<0&&(e[18]+=65536),(w<d||-1==d)&&(Se(e,n,t,D),e[18]=(4294901760&e[18])+D+2),D++}function Se(e,t,n,s){const l=n[s]<0,d=n[s+1],w=e[l?-n[s]:n[s]];if(l){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{d.call(w)}finally{}}}else try{d.call(w)}finally{}}class dt{constructor(t,n,s){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=s}}function Mn(e,t,n){const s=Un(e);let l=0;for(;l<n.length;){const d=n[l];if("number"==typeof d){if(0!==d)break;l++;const y=n[l++],w=n[l++],D=n[l++];s?e.setAttribute(t,w,D,y):t.setAttributeNS(y,w,D)}else{const y=d,w=n[++l];Gr(y)?s&&e.setProperty(t,y,w):s?e.setAttribute(t,y,w):t.setAttribute(y,w),l++}}return l}function or(e){return 3===e||4===e||6===e}function Gr(e){return 64===e.charCodeAt(0)}function ii(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let s=0;s<t.length;s++){const l=t[s];"number"==typeof l?n=l:0===n||Yi(e,n,l,null,-1===n||2===n?t[++s]:null)}}return e}function Yi(e,t,n,s,l){let d=0,y=e.length;if(-1===t)y=-1;else for(;d<e.length;){const w=e[d++];if("number"==typeof w){if(w===t){y=-1;break}if(w>t){y=d-1;break}}}for(;d<e.length;){const w=e[d];if("number"==typeof w)break;if(w===n){if(null===s)return void(null!==l&&(e[d+1]=l));if(s===e[d+1])return void(e[d+2]=l)}d++,null!==s&&d++,null!==l&&d++}-1!==y&&(e.splice(y,0,t),d=y+1),e.splice(d++,0,n),null!==s&&e.splice(d++,0,s),null!==l&&e.splice(d++,0,l)}function Ht(e){return-1!==e}function gt(e){return 32767&e}function Pn(e,t){let n=function jt(e){return e>>16}(e),s=t;for(;n>0;)s=s[15],n--;return s}let oi=!0;function wn(e){const t=oi;return oi=e,t}let Ea=0;function ht(e,t){const n=ss(e,t);if(-1!==n)return n;const s=t[1];s.firstCreatePass&&(e.injectorIndex=t.length,dr(s.data,e),dr(t,null),dr(s.blueprint,null));const l=mo(e,t),d=e.injectorIndex;if(Ht(l)){const y=gt(l),w=Pn(l,t),D=w[1].data;for(let A=0;A<8;A++)t[d+A]=w[y+A]|D[y+A]}return t[d+8]=l,d}function dr(e,t){e.push(0,0,0,0,0,0,0,0,t)}function ss(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function mo(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,s=null,l=t;for(;null!==l;){const d=l[1],y=d.type;if(s=2===y?d.declTNode:1===y?l[6]:null,null===s)return-1;if(n++,l=l[15],-1!==s.injectorIndex)return s.injectorIndex|n<<16}return-1}function pr(e,t,n){!function it(e,t,n){let s;"string"==typeof n?s=n.charCodeAt(0)||0:n.hasOwnProperty(ca)&&(s=n[ca]),null==s&&(s=n[ca]=Ea++);const l=255&s;t.data[e+(l>>5)]|=1<<l}(e,t,n)}function Nm(e,t,n){if(n&Mt.Optional)return e;na(t,"NodeInjector")}function Yc(e,t,n,s){if(n&Mt.Optional&&void 0===s&&(s=null),0==(n&(Mt.Self|Mt.Host))){const l=e[9],d=vr(void 0);try{return l?l.get(t,s,n&Mt.Optional):Fu(t,s,n&Mt.Optional)}finally{vr(d)}}return Nm(s,t,n)}function Qn(e,t,n,s=Mt.Default,l){if(null!==e){const d=function Qc(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(ca)?e[ca]:void 0;return"number"==typeof t?t>=0?255&t:Um:t}(n);if("function"==typeof d){if(!k(t,e,s))return s&Mt.Host?Nm(l,n,s):Yc(t,n,s,l);try{const y=d(s);if(null!=y||s&Mt.Optional)return y;na(n)}finally{Z()}}else if("number"==typeof d){let y=null,w=ss(e,t),D=-1,A=s&Mt.Host?t[16][6]:null;for((-1===w||s&Mt.SkipSelf)&&(D=-1===w?mo(e,t):t[w+8],-1!==D&&ih(s,!1)?(y=t[1],w=gt(D),t=Pn(D,t)):w=-1);-1!==w;){const F=t[1];if(Ta(d,w,F.data)){const j=Jc(w,t,n,y,s,A);if(j!==jn)return j}D=t[w+8],-1!==D&&ih(s,t[1].data[w+8]===A)&&Ta(d,w,t)?(y=F,w=gt(D),t=Pn(D,t)):w=-1}}}return Yc(t,n,s,l)}const jn={};function Um(){return new sl(Hn(),Ne())}function Jc(e,t,n,s,l,d){const y=t[1],w=y.data[e+8],F=function Ca(e,t,n,s,l){const d=e.providerIndexes,y=t.data,w=1048575&d,D=e.directiveStart,F=d>>20,Y=l?w+F:e.directiveEnd;for(let te=s?w:w+F;te<Y;te++){const ge=y[te];if(te<D&&n===ge||te>=D&&ge.type===n)return te}if(l){const te=y[D];if(te&&Sr(te)&&te.type===n)return D}return null}(w,y,n,null==s?Zl(w)&&oi:s!=y&&0!=(3&w.type),l&Mt.Host&&d===w);return null!==F?Yl(t,y,F,w):jn}function Yl(e,t,n,s){let l=e[n];const d=t.data;if(function At(e){return e instanceof dt}(l)){const y=l;y.resolving&&function $l(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new vn(-200,`Circular dependency in DI detected for ${e}${n}`)}(cr(d[n]));const w=wn(y.canSeeViewProviders);y.resolving=!0;const D=y.injectImpl?vr(y.injectImpl):null;k(e,s,Mt.Default);try{l=e[n]=y.factory(void 0,d,e,s),t.firstCreatePass&&n>=s.directiveStart&&function qe(e,t,n){const{ngOnChanges:s,ngOnInit:l,ngDoCheck:d}=t.type.prototype;if(s){const y=cd(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,y),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,y)}l&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,l),d&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,d),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,d))}(n,d[n],t)}finally{null!==D&&vr(D),wn(w),y.resolving=!1,Z()}}return l}function Ta(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function ih(e,t){return!(e&Mt.Self||e&Mt.Host&&t)}class sl{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,s){return Qn(this._tNode,this._lView,t,s,n)}}const cl="__parameters__";function Da(e,t,n){return In(()=>{const s=function sh(e){return function(...n){if(e){const s=e(...n);for(const l in s)this[l]=s[l]}}}(t);function l(...d){if(this instanceof l)return s.apply(this,d),this;const y=new l(...d);return w.annotation=y,w;function w(D,A,F){const j=D.hasOwnProperty(cl)?D[cl]:Object.defineProperty(D,cl,{value:[]})[cl];for(;j.length<=F;)j.push(null);return(j[F]=j[F]||[]).push(y),D}}return n&&(l.prototype=Object.create(n.prototype)),l.prototype.ngMetadataName=e,l.annotationCls=l,l})}class en{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=Tt({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}toString(){return`InjectionToken ${this._desc}`}}const ul=new en("AnalyzeForEntryComponents");function as(e,t){e.forEach(n=>Array.isArray(n)?as(n,t):t(n))}function Hm(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function md(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}const _o={},Sa="__NG_DI_FLAG__",_d="ngTempTokenPath",fy=/\n/gm,Wp="__source",yd=yn({provide:String,useValue:yn});let Ui;function Zm(e){const t=Ui;return Ui=e,t}function gy(e,t=Mt.Default){if(void 0===Ui)throw new vn(203,"");return null===Ui?Fu(e,void 0,t):Ui.get(e,t&Mt.Optional?null:void 0,t)}function et(e,t=Mt.Default){return(function St(){return ql}()||gy)(vt(e),t)}function vd(e){const t=[];for(let n=0;n<e.length;n++){const s=vt(e[n]);if(Array.isArray(s)){if(0===s.length)throw new vn(900,"");let l,d=Mt.Default;for(let y=0;y<s.length;y++){const w=s[y],D=Wm(w);"number"==typeof D?-1===D?l=w.token:d|=D:l=w}t.push(et(l,d))}else t.push(et(s))}return t}function an(e,t){return e[Sa]=t,e.prototype[Sa]=t,e}function Wm(e){return e[Sa]}const Ns=an(Da("Inject",e=>({token:e})),-1),Pr=an(Da("Optional"),8),ai=an(Da("SkipSelf"),4);let bd,wd;function tc(e){var t;return(null===(t=function uh(){if(void 0===bd&&(bd=null,Kt.trustedTypes))try{bd=Kt.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch(e){}return bd}())||void 0===t?void 0:t.createHTML(e))||e}function Qp(e){var t;return(null===(t=function hl(){if(void 0===wd&&(wd=null,Kt.trustedTypes))try{wd=Kt.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch(e){}return wd}())||void 0===t?void 0:t.createScriptURL(e))||e}class nc{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class vy extends nc{getTypeName(){return"HTML"}}class ef extends nc{getTypeName(){return"Style"}}class hs extends nc{getTypeName(){return"Script"}}class ng extends nc{getTypeName(){return"URL"}}class xy extends nc{getTypeName(){return"ResourceURL"}}function eo(e){return e instanceof nc?e.changingThisBreaksApplicationSecurity:e}function js(e,t){const n=rg(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===t}function rg(e){return e instanceof nc&&e.getTypeName()||null}class by{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const n=(new window.DOMParser).parseFromString(tc(t),"text/html").body;return null===n?this.inertDocumentHelper.getInertBodyElement(t):(n.removeChild(n.firstChild),n)}catch(n){return null}}}class rf{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const n=this.inertDocument.createElement("html");this.inertDocument.appendChild(n);const s=this.inertDocument.createElement("body");n.appendChild(s)}}getInertBodyElement(t){const n=this.inertDocument.createElement("template");if("content"in n)return n.innerHTML=tc(t),n;const s=this.inertDocument.createElement("body");return s.innerHTML=tc(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(s),s}stripCustomNsAttrs(t){const n=t.attributes;for(let l=n.length-1;0<l;l--){const y=n.item(l).name;("xmlns:ns1"===y||0===y.indexOf("ns1:"))&&t.removeAttribute(y)}let s=t.firstChild;for(;s;)s.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(s),s=s.nextSibling}}const Ey=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Ed=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function dh(e){return(e=String(e)).match(Ey)||e.match(Ed)?e:"unsafe:"+e}function ph(e){return(e=String(e)).split(",").map(t=>dh(t.trim())).join(", ")}function ds(e){const t={};for(const n of e.split(","))t[n]=!0;return t}function Bo(...e){const t={};for(const n of e)for(const s in n)n.hasOwnProperty(s)&&(t[s]=!0);return t}const cu=ds("area,br,col,hr,img,wbr"),sg=ds("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),ag=ds("rp,rt"),of=Bo(cu,Bo(sg,ds("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Bo(ag,ds("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Bo(ag,sg)),sf=ds("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),fh=ds("srcset"),lg=Bo(sf,fh,ds("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),ds("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),sr=ds("script,style,template");class Cd{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let n=t.firstChild,s=!0;for(;n;)if(n.nodeType===Node.ELEMENT_NODE?s=this.startElement(n):n.nodeType===Node.TEXT_NODE?this.chars(n.nodeValue):this.sanitizedSomething=!0,s&&n.firstChild)n=n.firstChild;else for(;n;){n.nodeType===Node.ELEMENT_NODE&&this.endElement(n);let l=this.checkClobberedElement(n,n.nextSibling);if(l){n=l;break}n=this.checkClobberedElement(n,n.parentNode)}return this.buf.join("")}startElement(t){const n=t.nodeName.toLowerCase();if(!of.hasOwnProperty(n))return this.sanitizedSomething=!0,!sr.hasOwnProperty(n);this.buf.push("<"),this.buf.push(n);const s=t.attributes;for(let l=0;l<s.length;l++){const d=s.item(l),y=d.name,w=y.toLowerCase();if(!lg.hasOwnProperty(w)){this.sanitizedSomething=!0;continue}let D=d.value;sf[w]&&(D=dh(D)),fh[w]&&(D=ph(D)),this.buf.push(" ",y,'="',gh(D),'"')}return this.buf.push(">"),!0}endElement(t){const n=t.nodeName.toLowerCase();of.hasOwnProperty(n)&&!cu.hasOwnProperty(n)&&(this.buf.push("</"),this.buf.push(n),this.buf.push(">"))}chars(t){this.buf.push(gh(t))}checkClobberedElement(t,n){if(n&&(t.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return n}}const cg=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Td=/([^\#-~ |!])/g;function gh(e){return e.replace(/&/g,"&amp;").replace(cg,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(Td,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let pl;function af(e,t){let n=null;try{pl=pl||function to(e){const t=new rf(e);return function wy(){try{return!!(new window.DOMParser).parseFromString(tc(""),"text/html")}catch(e){return!1}}()?new by(t):t}(e);let s=t?String(t):"";n=pl.getInertBodyElement(s);let l=5,d=s;do{if(0===l)throw new Error("Failed to sanitize html because the input is unstable");l--,s=d,d=n.innerHTML,n=pl.getInertBodyElement(s)}while(s!==d);return tc((new Cd).sanitizeChildren(Dd(n)||n))}finally{if(n){const s=Dd(n)||n;for(;s.firstChild;)s.removeChild(s.firstChild)}}}function Dd(e){return"content"in e&&function _h(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var Fn=(()=>((Fn=Fn||{})[Fn.NONE=0]="NONE",Fn[Fn.HTML=1]="HTML",Fn[Fn.STYLE=2]="STYLE",Fn[Fn.SCRIPT=3]="SCRIPT",Fn[Fn.URL=4]="URL",Fn[Fn.RESOURCE_URL=5]="RESOURCE_URL",Fn))();function yh(e){const t=vh();return t?t.sanitize(Fn.URL,e)||"":js(e,"URL")?eo(e):dh(Et(e))}function rc(e){const t=vh();if(t)return Qp(t.sanitize(Fn.RESOURCE_URL,e)||"");if(js(e,"ResourceURL"))return Qp(eo(e));throw new vn(904,"")}function vh(){const e=Ne();return e&&e[12]}const ff="__ngContext__";function wr(e,t){e[ff]=t}function mf(e){const t=function xh(e){return e[ff]||null}(e);return t?Array.isArray(t)?t:t.lView:null}function ic(e){return e.ngOriginalError}function _g(e,...t){e.error(...t)}class uu{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t),s=function gg(e){return e&&e.ngErrorLogger||_g}(t);s(this._console,"ERROR",t),n&&s(this._console,"ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&ic(t);for(;n&&ic(n);)n=ic(n);return n||null}}const gf=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Kt))();function ps(e){return e instanceof Function?e():e}var wi=(()=>((wi=wi||{})[wi.Important=1]="Important",wi[wi.DashCase=2]="DashCase",wi))();function _f(e,t){return undefined(e,t)}function Eh(e){const t=e[3];return Mr(t)?t[3]:t}function Sd(e){return En(e[13])}function oc(e){return En(e[4])}function En(e){for(;null!==e&&!Mr(e);)e=e[4];return e}function sc(e,t,n,s,l){if(null!=s){let d,y=!1;Mr(s)?d=s:Bi(s)&&(y=!0,s=s[0]);const w=hr(s);0===e&&null!==n?null==l?Pd(t,n,w):ac(t,n,w,l||null,!0):1===e&&null!==n?ac(t,n,w,l||null,!0):2===e?function Fd(e,t,n){const s=Ei(e,t);s&&function Ig(e,t,n,s){Un(e)?e.removeChild(t,n,s):t.removeChild(n)}(e,s,t,n)}(t,w,y):3===e&&t.destroyNode(w),null!=d&&function Ia(e,t,n,s,l){const d=n[7];d!==hr(n)&&sc(t,e,s,d,l);for(let w=10;w<n.length;w++){const D=n[w];gu(D[1],D,e,t,s,d)}}(t,e,d,n,l)}}function Ad(e,t,n){if(Un(e))return e.createElement(t,n);{const s=null!==n?function ns(e){const t=e.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(n):null;return null===s?e.createElement(t):e.createElementNS(s,t)}}function Cg(e,t){const n=e[9],s=n.indexOf(t),l=t[3];1024&t[2]&&(t[2]&=-1025,Fs(l,-1)),n.splice(s,1)}function vf(e,t){if(e.length<=10)return;const n=10+t,s=e[n];if(s){const l=s[17];null!==l&&l!==e&&Cg(l,s),t>0&&(e[n-1][4]=s[4]);const d=md(e,10+t);!function jy(e,t){gu(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(s[1],s);const y=d[19];null!==y&&y.detachView(d[1]),s[3]=null,s[4]=null,s[2]&=-129}return s}function Tg(e,t){if(!(256&t[2])){const n=t[11];Un(n)&&n.destroyNode&&gu(e,t,n,3,null,null),function Gy(e){let t=e[13];if(!t)return fu(e[1],e);for(;t;){let n=null;if(Bi(t))n=t[13];else{const s=t[10];s&&(n=s)}if(!n){for(;t&&!t[4]&&t!==e;)Bi(t)&&fu(t[1],t),t=t[3];null===t&&(t=e),Bi(t)&&fu(t[1],t),n=t&&t[4]}t=n}}(t)}}function fu(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function Dg(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let s=0;s<n.length;s+=2){const l=t[n[s]];if(!(l instanceof dt)){const d=n[s+1];if(Array.isArray(d))for(let y=0;y<d.length;y+=2){const w=l[d[y]],D=d[y+1];try{D.call(w)}finally{}}else try{d.call(l)}finally{}}}}(e,t),function mu(e,t){const n=e.cleanup,s=t[7];let l=-1;if(null!==n)for(let d=0;d<n.length-1;d+=2)if("string"==typeof n[d]){const y=n[d+1],w="function"==typeof y?y(t):hr(t[y]),D=s[l=n[d+2]],A=n[d+3];"boolean"==typeof A?w.removeEventListener(n[d],D,A):A>=0?s[l=A]():s[l=-A].unsubscribe(),d+=2}else{const y=s[l=n[d+1]];n[d].call(y)}if(null!==s){for(let d=l+1;d<s.length;d++)s[d]();t[7]=null}}(e,t),1===t[1].type&&Un(t[11])&&t[11].destroy();const n=t[17];if(null!==n&&Mr(t[3])){n!==t[3]&&Cg(n,t);const s=t[19];null!==s&&s.detachView(e)}}}function Mg(e,t,n){return function Sg(e,t,n){let s=t;for(;null!==s&&40&s.type;)s=(t=s).parent;if(null===s)return n[0];if(2&s.flags){const l=e.data[s.directiveStart].encapsulation;if(l===Oi.None||l===Oi.Emulated)return null}return xi(s,n)}(e,t.parent,n)}function ac(e,t,n,s,l){Un(e)?e.insertBefore(t,n,s,l):t.insertBefore(n,s,l)}function Pd(e,t,n){Un(e)?e.appendChild(t,n):t.appendChild(n)}function kd(e,t,n,s,l){null!==s?ac(e,t,n,s,l):Pd(e,t,n)}function Ei(e,t){return Un(e)?e.parentNode(t):t.parentNode}let Th=function Rd(e,t,n){return 40&e.type?xi(e,n):null};function Dh(e,t,n,s){const l=Mg(e,s,t),d=t[11],w=function lc(e,t,n){return Th(e,t,n)}(s.parent||t[6],s,t);if(null!=l)if(Array.isArray(n))for(let D=0;D<n.length;D++)kd(d,l,n[D],w,!1);else kd(d,l,n,w,!1)}function Ld(e,t){if(null!==t){const n=t.type;if(3&n)return xi(t,e);if(4&n)return Od(-1,e[t.index]);if(8&n){const s=t.child;if(null!==s)return Ld(e,s);{const l=e[t.index];return Mr(l)?Od(-1,l):hr(l)}}if(32&n)return _f(t,e)()||hr(e[t.index]);{const s=wf(e,t);return null!==s?Array.isArray(s)?s[0]:Ld(Eh(e[16]),s):Ld(e,t.next)}}return null}function wf(e,t){return null!==t?e[16][6].projection[t.projection]:null}function Od(e,t){const n=10+e+1;if(n<t.length){const s=t[n],l=s[1].firstChild;if(null!==l)return Ld(s,l)}return t[7]}function Mh(e,t,n,s,l,d,y){for(;null!=n;){const w=s[n.index],D=n.type;if(y&&0===t&&(w&&wr(hr(w),s),n.flags|=4),64!=(64&n.flags))if(8&D)Mh(e,t,n.child,s,l,d,!1),sc(t,e,l,w,d);else if(32&D){const A=_f(n,s);let F;for(;F=A();)sc(t,e,l,F,d);sc(t,e,l,w,d)}else 16&D?Ef(e,t,s,n,l,d):sc(t,e,l,w,d);n=y?n.projectionNext:n.next}}function gu(e,t,n,s,l,d){Mh(n,s,e.firstChild,t,l,d,!1)}function Ef(e,t,n,s,l,d){const y=n[16],D=y[6].projection[s.projection];if(Array.isArray(D))for(let A=0;A<D.length;A++)sc(t,e,l,D[A],d);else Mh(e,t,D,y[3],l,d,!0)}function Cf(e,t,n){Un(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function zd(e,t,n){Un(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}function Tf(e,t,n){let s=e.length;for(;;){const l=e.indexOf(t,n);if(-1===l)return l;if(0===l||e.charCodeAt(l-1)<=32){const d=t.length;if(l+d===s||e.charCodeAt(l+d)<=32)return l}n=l+1}}const Pg="ng-template";function kg(e,t,n){let s=0;for(;s<e.length;){let l=e[s++];if(n&&"class"===l){if(l=e[s],-1!==Tf(l.toLowerCase(),t,0))return!0}else if(1===l){for(;s<e.length&&"string"==typeof(l=e[s++]);)if(l.toLowerCase()===t)return!0;return!1}}return!1}function Df(e){return 4===e.type&&e.value!==Pg}function Sh(e,t,n){return t===(4!==e.type||n?e.value:Pg)}function Rg(e,t,n){let s=4;const l=e.attrs||[],d=function Bd(e){for(let t=0;t<e.length;t++)if(or(e[t]))return t;return e.length}(l);let y=!1;for(let w=0;w<t.length;w++){const D=t[w];if("number"!=typeof D){if(!y)if(4&s){if(s=2|1&s,""!==D&&!Sh(e,D,n)||""===D&&1===t.length){if(No(s))return!1;y=!0}}else{const A=8&s?D:t[++w];if(8&s&&null!==e.attrs){if(!kg(e.attrs,A,n)){if(No(s))return!1;y=!0}continue}const j=Mf(8&s?"class":D,l,Df(e),n);if(-1===j){if(No(s))return!1;y=!0;continue}if(""!==A){let Y;Y=j>d?"":l[j+1].toLowerCase();const te=8&s?Y:null;if(te&&-1!==Tf(te,A,0)||2&s&&A!==Y){if(No(s))return!1;y=!0}}}}else{if(!y&&!No(s)&&!No(D))return!1;if(y&&No(D))continue;y=!1,s=D|1&s}}return No(s)||y}function No(e){return 0==(1&e)}function Mf(e,t,n,s){if(null===t)return-1;let l=0;if(s||!n){let d=!1;for(;l<t.length;){const y=t[l];if(y===e)return l;if(3===y||6===y)d=!0;else{if(1===y||2===y){let w=t[++l];for(;"string"==typeof w;)w=t[++l];continue}if(4===y)break;if(0===y){l+=4;continue}}l+=d?1:2}return-1}return function Og(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const s=e[n];if("number"==typeof s)return-1;if(s===t)return n;n++}return-1}(t,e)}function cc(e,t,n=!1){for(let s=0;s<t.length;s++)if(Rg(e,t[s],n))return!0;return!1}function Ih(e,t){return e?":not("+t.trim()+")":t}function Wy(e){let t=e[0],n=1,s=2,l="",d=!1;for(;n<e.length;){let y=e[n];if("string"==typeof y)if(2&s){const w=e[++n];l+="["+y+(w.length>0?'="'+w+'"':"")+"]"}else 8&s?l+="."+y:4&s&&(l+=" "+y);else""!==l&&!No(y)&&(t+=Ih(d,l),l=""),s=y,d=d||!No(s);n++}return""!==l&&(t+=Ih(d,l)),t}const kt={};function gl(e){uc(on(),Ne(),G()+e,zs())}function uc(e,t,n,s){if(!s)if(3==(3&t[2])){const d=e.preOrderCheckHooks;null!==d&&Le(t,d,n)}else{const d=e.preOrderHooks;null!==d&&be(t,d,0,n)}re(n)}function Bf(e,t){const n=e.contentQueries;if(null!==n)for(let s=0;s<n.length;s+=2){const l=n[s],d=n[s+1];if(-1!==d){const y=e.data[d];C(l),y.contentQueries(2,t[d],d)}}}function vu(e,t,n,s,l,d,y,w,D,A){const F=t.blueprint.slice();return F[0]=l,F[2]=140|s,il(F),F[3]=F[15]=e,F[8]=n,F[10]=y||e&&e[10],F[11]=w||e&&e[11],F[12]=D||e&&e[12]||null,F[9]=A||e&&e[9]||null,F[6]=d,F[16]=2==t.type?e[16]:F,F}function fc(e,t,n,s,l){let d=e.data[t];if(null===d)d=function Zd(e,t,n,s,l){const d=xa(),y=rh(),D=e.data[t]=function jo(e,t,n,s,l,d){return{type:n,index:s,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:l,attrs:d,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,y?d:d&&d.parent,n,t,s,l);return null===e.firstChild&&(e.firstChild=D),null!==d&&(y?null==d.child&&null!==D.parent&&(d.child=D):null===d.next&&(d.next=D)),D}(e,t,n,s,l),function Bs(){return Ct.lFrame.inI18n}()&&(d.flags|=64);else if(64&d.type){d.type=n,d.value=s,d.attrs=l;const y=function Kl(){const e=Ct.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();d.injectorIndex=null===y?-1:y.injectorIndex}return Ki(d,!0),d}function mc(e,t,n,s){if(0===n)return-1;const l=t.length;for(let d=0;d<n;d++)t.push(s),e.blueprint.push(s),e.data.push(null);return l}function xu(e,t,n){R(t);try{const s=e.viewQuery;null!==s&&Jf(1,s,n);const l=e.template;null!==l&&Nf(e,t,l,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Bf(e,t),e.staticViewQueries&&Jf(2,e.viewQuery,n);const d=e.components;null!==d&&function Gg(e,t){for(let n=0;n<t.length;n++)Fh(e,t[n])}(t,d)}catch(s){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),s}finally{t[2]&=-5,H()}}function gc(e,t,n,s){const l=t[2];if(256==(256&l))return;R(t);const d=zs();try{il(t),function ba(e){return Ct.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&Nf(e,t,n,2,s);const y=3==(3&l);if(!d)if(y){const A=e.preOrderCheckHooks;null!==A&&Le(t,A,null)}else{const A=e.preOrderHooks;null!==A&&be(t,A,0,null),ve(t,0)}if(function cv(e){for(let t=Sd(e);null!==t;t=oc(t)){if(!t[2])continue;const n=t[9];for(let s=0;s<n.length;s++){const l=n[s],d=l[3];0==(1024&l[2])&&Fs(d,1),l[2]|=1024}}}(t),function Qg(e){for(let t=Sd(e);null!==t;t=oc(t))for(let n=10;n<t.length;n++){const s=t[n],l=s[1];va(s)&&gc(l,s,l.template,s[8])}}(t),null!==e.contentQueries&&Bf(e,t),!d)if(y){const A=e.contentCheckHooks;null!==A&&Le(t,A)}else{const A=e.contentHooks;null!==A&&be(t,A,1),ve(t,1)}!function $g(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let s=0;s<n.length;s++){const l=n[s];if(l<0)re(~l);else{const d=l,y=n[++s],w=n[++s];o(y,d),w(2,t[d])}}}finally{re(-1)}}(e,t);const w=e.components;null!==w&&function iv(e,t){for(let n=0;n<t.length;n++)_c(e,t[n])}(t,w);const D=e.viewQuery;if(null!==D&&Jf(2,D,s),!d)if(y){const A=e.viewCheckHooks;null!==A&&Le(t,A)}else{const A=e.viewHooks;null!==A&&be(t,A,2),ve(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),d||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,Fs(t[3],-1))}finally{H()}}function yl(e,t,n,s){const l=t[10],d=!zs(),y=function Ju(e){return 4==(4&e[2])}(t);try{d&&!y&&l.begin&&l.begin(),y&&xu(e,t,s),gc(e,t,n,s)}finally{d&&!y&&l.end&&l.end()}}function Nf(e,t,n,s,l){const d=G(),y=2&s;try{re(-1),y&&t.length>20&&uc(e,t,20,zs()),n(s,l)}finally{re(d)}}function jf(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=Oh(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function Oh(e,t,n,s,l,d,y,w,D,A){const F=20+s,j=F+l,Y=function Wd(e,t){const n=[];for(let s=0;s<t;s++)n.push(s<e?null:kt);return n}(F,j),te="function"==typeof A?A():A;return Y[1]={type:e,blueprint:Y,template:n,queries:null,viewQuery:w,declTNode:t,data:Y.slice().fill(null,F),bindingStartIndex:F,expandoStartIndex:j,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof d?d():d,pipeRegistry:"function"==typeof y?y():y,firstChild:null,schemas:D,consts:te,incompleteFirstPass:!1}}function ms(e,t,n){for(let s in e)if(e.hasOwnProperty(s)){const l=e[s];(n=null===n?{}:n).hasOwnProperty(s)?n[s].push(t,l):n[s]=[t,l]}return n}function kr(e,t,n,s,l,d,y,w){const D=xi(t,n);let F,A=t.inputs;!w&&null!=A&&(F=A[s])?(a(e,n,F,s,l),Zl(t)&&function Xd(e,t){const n=ni(t,e);16&n[2]||(n[2]|=64)}(n,t.index)):3&t.type&&(s=function $s(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(s),l=null!=y?y(l,t.value||"",s):l,Un(d)?d.setProperty(D,s,l):Gr(s)||(D.setProperty?D.setProperty(s,l):D[s]=l))}function xl(e,t,n,s,l,d){const y=d.hostBindings;if(y){let w=e.hostBindingOpCodes;null===w&&(w=e.hostBindingOpCodes=[]);const D=~t.index;(function $f(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(w)!=D&&w.push(D),w.push(s,l,y)}}function Xg(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function Gf(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function Qd(e,t,n){if(n){if(t.exportAs)for(let s=0;s<t.exportAs.length;s++)n[t.exportAs[s]]=e;Sr(t)&&(n[""]=e)}}function qf(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function Zf(e,t,n,s,l){e.data[s]=l;const d=l.factory||(l.factory=zo(l.type)),y=new dt(d,Sr(l),null);e.blueprint[s]=y,n[s]=y,xl(e,t,0,s,mc(e,n,l.hostVars,kt),l)}function Kg(e,t,n){const s=xi(t,e),l=jf(n),d=e[10],y=wl(e,vu(e,l,null,n.onPush?64:16,s,t,d,d.createRenderer(s,n),null,null));e[t.index]=y}function Yg(e,t,n,s,l,d){const y=d[t];if(null!==y){const w=s.setInput;for(let D=0;D<y.length;){const A=y[D++],F=y[D++],j=y[D++];null!==w?s.setInput(n,j,A,F):n[F]=j}}}function lv(e,t){let n=null,s=0;for(;s<t.length;){const l=t[s];if(0!==l)if(5!==l){if("number"==typeof l)break;e.hasOwnProperty(l)&&(null===n&&(n=[]),n.push(l,e[l],t[s+1])),s+=2}else s+=2;else s+=4}return n}function _c(e,t){const n=ni(t,e);if(va(n)){const s=n[1];80&n[2]?gc(s,n,s.template,n[8]):n[5]>0&&Xf(n)}}function Xf(e){for(let s=Sd(e);null!==s;s=oc(s))for(let l=10;l<s.length;l++){const d=s[l];if(1024&d[2]){const y=d[1];gc(y,d,y.template,d[8])}else d[5]>0&&Xf(d)}const n=e[1].components;if(null!==n)for(let s=0;s<n.length;s++){const l=ni(n[s],e);va(l)&&l[5]>0&&Xf(l)}}function Fh(e,t){const n=ni(t,e),s=n[1];(function zh(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(s,n),xu(s,n,n[8])}function wl(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function yc(e){for(;e;){e[2]|=64;const t=Eh(e);if(nd(e)&&!t)return e;e=t}return null}function Yf(e,t,n){const s=t[10];s.begin&&s.begin();try{gc(e,t,e.template,n)}catch(l){throw r(t,l),l}finally{s.end&&s.end()}}function vc(e){!function Kf(e){for(let t=0;t<e.components.length;t++){const n=e.components[t],s=mf(n),l=s[1];yl(l,s,l.template,n)}}(e[8])}function Jf(e,t,n){C(0),t(e,n)}const dv=(()=>Promise.resolve(null))();function Qf(e){return e[7]||(e[7]=[])}function em(e){return e.cleanup||(e.cleanup=[])}function r(e,t){const n=e[9],s=n?n.get(uu,null):null;s&&s.handleError(t)}function a(e,t,n,s,l){for(let d=0;d<n.length;){const y=n[d++],w=n[d++],D=t[y],A=e.data[y];null!==A.setInput?A.setInput(D,l,s,w):D[w]=l}}function c(e,t,n){const s=function ya(e,t){return hr(t[e])}(t,e);!function Vs(e,t,n){Un(e)?e.setValue(t,n):t.textContent=n}(e[11],s,n)}function h(e,t,n){let s=n?e.styles:null,l=n?e.classes:null,d=0;if(null!==t)for(let y=0;y<t.length;y++){const w=t[y];"number"==typeof w?d=w:1==d?l=Za(l,w):2==d&&(s=Za(s,w+": "+t[++y]+";"))}n?e.styles=s:e.stylesWithoutHost=s,n?e.classes=l:e.classesWithoutHost=l}const E=new en("INJECTOR",-1);class T{get(t,n=_o){if(n===_o){const s=new Error(`NullInjectorError: No provider for ${fn(t)}!`);throw s.name="NullInjectorError",s}return n}}const S=new en("Set Injector scope."),I={},P={};let z;function N(){return void 0===z&&(z=new T),z}function $(e,t=null,n=null,s){const l=q(e,t,n,s);return l._resolveInjectorDefTypes(),l}function q(e,t=null,n=null,s){return new J(e,n,t||N(),s)}class J{constructor(t,n,s,l=null){this.parent=s,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const d=[];n&&as(n,w=>this.processProvider(w,t,n)),as([t],w=>this.processInjectorType(w,[],d)),this.records.set(E,pe(void 0,this));const y=this.records.get(S);this.scope=null!=y?y.value:null,this.source=l||("object"==typeof t?null:fn(t))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(t=>t.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(t,n=_o,s=Mt.Default){this.assertNotDestroyed();const l=Zm(this),d=vr(void 0);try{if(!(s&Mt.SkipSelf)){let w=this.records.get(t);if(void 0===w){const D=function Re(e){return"function"==typeof e||"object"==typeof e&&e instanceof en}(t)&&gi(t);w=D&&this.injectableDefInScope(D)?pe(oe(t),I):null,this.records.set(t,w)}if(null!=w)return this.hydrate(t,w)}return(s&Mt.Self?N():this.parent).get(t,n=s&Mt.Optional&&n===_o?null:n)}catch(y){if("NullInjectorError"===y.name){if((y[_d]=y[_d]||[]).unshift(fn(t)),l)throw y;return function Xm(e,t,n,s){const l=e[_d];throw t[Wp]&&l.unshift(t[Wp]),e.message=function iu(e,t,n,s=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;let l=fn(t);if(Array.isArray(t))l=t.map(fn).join(" -> ");else if("object"==typeof t){let d=[];for(let y in t)if(t.hasOwnProperty(y)){let w=t[y];d.push(y+":"+("string"==typeof w?JSON.stringify(w):fn(w)))}l=`{${d.join(", ")}}`}return`${n}${s?"("+s+")":""}[${l}]: ${e.replace(fy,"\n  ")}`}("\n"+e.message,l,n,s),e.ngTokenPath=l,e[_d]=null,e}(y,t,"R3InjectorError",this.source)}throw y}finally{vr(d),Zm(l)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(t=>this.get(t))}toString(){const t=[];return this.records.forEach((s,l)=>t.push(fn(l))),`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new vn(205,"")}processInjectorType(t,n,s){if(!(t=vt(t)))return!1;let l=Hl(t);const d=null==l&&t.ngModule||void 0,y=void 0===d?t:d,w=-1!==s.indexOf(y);if(void 0!==d&&(l=Hl(d)),null==l)return!1;if(null!=l.imports&&!w){let F;s.push(y);try{as(l.imports,j=>{this.processInjectorType(j,n,s)&&(void 0===F&&(F=[]),F.push(j))})}finally{}if(void 0!==F)for(let j=0;j<F.length;j++){const{ngModule:Y,providers:te}=F[j];as(te,ge=>this.processProvider(ge,Y,te||xn))}}this.injectorDefTypes.add(y);const D=zo(y)||(()=>new y);this.records.set(y,pe(D,I));const A=l.providers;if(null!=A&&!w){const F=t;as(A,j=>this.processProvider(j,F,A))}return void 0!==d&&void 0!==t.providers}processProvider(t,n,s){let l=Ue(t=vt(t))?t:vt(t&&t.provide);const d=function he(e,t,n){return Te(e)?pe(void 0,e.useValue):pe(function fe(e,t,n){let s;if(Ue(e)){const l=vt(e);return zo(l)||oe(l)}if(Te(e))s=()=>vt(e.useValue);else if(function Ze(e){return!(!e||!e.useFactory)}(e))s=()=>e.useFactory(...vd(e.deps||[]));else if(function we(e){return!(!e||!e.useExisting)}(e))s=()=>et(vt(e.useExisting));else{const l=vt(e&&(e.useClass||e.provide));if(!function Ge(e){return!!e.deps}(e))return zo(l)||oe(l);s=()=>new l(...vd(e.deps))}return s}(e),I)}(t);if(Ue(t)||!0!==t.multi)this.records.get(l);else{let y=this.records.get(l);y||(y=pe(void 0,I,!0),y.factory=()=>vd(y.multi),this.records.set(l,y)),l=t,y.multi.push(t)}this.records.set(l,d)}hydrate(t,n){return n.value===I&&(n.value=P,n.value=n.factory()),"object"==typeof n.value&&n.value&&function Ke(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this.onDestroy.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=vt(t.providedIn);return"string"==typeof n?"any"===n||n===this.scope:this.injectorDefTypes.has(n)}}function oe(e){const t=gi(e),n=null!==t?t.factory:zo(e);if(null!==n)return n;if(e instanceof en)throw new vn(204,"");if(e instanceof Function)return function ce(e){const t=e.length;if(t>0)throw function nu(e,t){const n=[];for(let s=0;s<e;s++)n.push(t);return n}(t,"?"),new vn(204,"");const n=function kp(e){const t=e&&(e[Qo]||e[oa]);if(t){const n=function _i(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new vn(204,"")}function pe(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function Te(e){return null!==e&&"object"==typeof e&&yd in e}function Ue(e){return"function"==typeof e}let We=(()=>{class e{static create(n,s){var l;if(Array.isArray(n))return $({name:""},s,n,"");{const d=null!==(l=n.name)&&void 0!==l?l:"";return $({name:d},n.parent,n.providers,d)}}}return e.THROW_IF_NOT_FOUND=_o,e.NULL=new T,e.\u0275prov=Tt({token:e,providedIn:"any",factory:()=>et(E)}),e.__NG_ELEMENT_ID__=-1,e})();function Vn(e,t){Oe(mf(e)[1],Hn())}let Uh=null;function xc(){if(!Uh){const e=Kt.Symbol;if(e&&e.iterator)Uh=e.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let n=0;n<t.length;++n){const s=t[n];"entries"!==s&&"size"!==s&&Map.prototype[s]===Map.prototype.entries&&(Uh=s)}}}return Uh}function bc(e){return!!np(e)&&(Array.isArray(e)||!(e instanceof Map)&&xc()in e)}function np(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function lr(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function El(e,t,n,s){return lr(e,wa(),n)?t+Et(n)+s:kt}function _t(e,t=Mt.Default){const n=Ne();return null===n?et(e,t):Qn(Hn(),n,vt(e),t)}function _v(){throw new Error("invalid")}function yv(e,t,n){const s=Ne();return lr(s,wa(),t)&&kr(on(),ee(),s,e,t,s[11],n,!1),yv}function vv(e,t,n,s,l){const y=l?"class":"style";a(e,n,t.inputs[y],y,s)}function ze(e,t,n,s){const l=Ne(),d=on(),y=20+e,w=l[11],D=l[y]=Ad(w,t,function xe(){return Ct.lFrame.currentNamespace}()),A=d.firstCreatePass?function pT(e,t,n,s,l,d,y){const w=t.consts,A=fc(t,e,2,l,is(w,d));return function Yd(e,t,n,s){let l=!1;if(Wc()){const d=function Jd(e,t,n){const s=e.directiveRegistry;let l=null;if(s)for(let d=0;d<s.length;d++){const y=s[d];cc(n,y.selectors,!1)&&(l||(l=[]),pr(ht(n,t),e,y.type),Sr(y)?(Gf(e,n),l.unshift(y)):l.push(y))}return l}(e,t,n),y=null===s?null:{"":-1};if(null!==d){l=!0,qf(n,e.data.length,d.length);for(let F=0;F<d.length;F++){const j=d[F];j.providersResolver&&j.providersResolver(j)}let w=!1,D=!1,A=mc(e,t,d.length,null);for(let F=0;F<d.length;F++){const j=d[F];n.mergedAttrs=ii(n.mergedAttrs,j.hostAttrs),Zf(e,n,t,A,j),Qd(A,j,y),null!==j.contentQueries&&(n.flags|=8),(null!==j.hostBindings||null!==j.hostAttrs||0!==j.hostVars)&&(n.flags|=128);const Y=j.type.prototype;!w&&(Y.ngOnChanges||Y.ngOnInit||Y.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),w=!0),!D&&(Y.ngOnChanges||Y.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),D=!0),A++}!function vl(e,t){const s=t.directiveEnd,l=e.data,d=t.attrs,y=[];let w=null,D=null;for(let A=t.directiveStart;A<s;A++){const F=l[A],j=F.inputs,Y=null===d||Df(t)?null:lv(j,d);y.push(Y),w=ms(j,A,w),D=ms(F.outputs,A,D)}null!==w&&(w.hasOwnProperty("class")&&(t.flags|=16),w.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=y,t.inputs=w,t.outputs=D}(e,n)}y&&function Hf(e,t,n){if(t){const s=e.localNames=[];for(let l=0;l<t.length;l+=2){const d=n[t[l+1]];if(null==d)throw new vn(-301,`Export of name '${t[l+1]}' not found!`);s.push(t[l],d)}}}(n,s,y)}return n.mergedAttrs=ii(n.mergedAttrs,n.attrs),l}(t,n,A,is(w,y)),null!==A.attrs&&h(A,A.attrs,!1),null!==A.mergedAttrs&&h(A,A.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,A),A}(y,d,l,0,t,n,s):d.data[y];Ki(A,!0);const F=A.mergedAttrs;null!==F&&Mn(w,D,F);const j=A.classes;null!==j&&zd(w,D,j);const Y=A.styles;null!==Y&&Cf(w,D,Y),64!=(64&A.flags)&&Dh(d,l,D,A),0===function Qu(){return Ct.lFrame.elementDepthCount}()&&wr(D,l),function eh(){Ct.lFrame.elementDepthCount++}(),ga(A)&&(function Uf(e,t,n){!Wc()||(function no(e,t,n,s){const l=n.directiveStart,d=n.directiveEnd;e.firstCreatePass||ht(n,t),wr(s,t);const y=n.initialInputs;for(let w=l;w<d;w++){const D=e.data[w],A=Sr(D);A&&Kg(t,n,D);const F=Yl(t,e,w,n);wr(F,t),null!==y&&Yg(0,w-l,F,D,0,y),A&&(ni(n.index,t)[8]=F)}}(e,t,n,xi(n,t)),128==(128&n.flags)&&function ro(e,t,n){const s=n.directiveStart,l=n.directiveEnd,y=n.index,w=function u(){return Ct.lFrame.currentDirectiveIndex}();try{re(y);for(let D=s;D<l;D++){const A=e.data[D],F=t[D];g(D),(null!==A.hostBindings||0!==A.hostVars||null!==A.hostAttrs)&&Xg(A,F)}}finally{re(-1),g(w)}}(e,t,n))}(d,l,A),function Lh(e,t,n){if(ma(t)){const l=t.directiveEnd;for(let d=t.directiveStart;d<l;d++){const y=e.data[d];y.contentQueries&&y.contentQueries(1,n[d],d)}}}(d,A,l)),null!==s&&function Pa(e,t,n=xi){const s=t.localNames;if(null!==s){let l=t.index+1;for(let d=0;d<s.length;d+=2){const y=s[d+1],w=-1===y?n(t,e):e[y];e[l++]=w}}}(l,A)}function Be(){let e=Hn();rh()?function Xc(){Ct.lFrame.isParent=!1}():(e=e.parent,Ki(e,!1));const t=e;!function th(){Ct.lFrame.elementDepthCount--}();const n=on();n.firstCreatePass&&(Oe(n,e),ma(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function mn(e){return 0!=(16&e.flags)}(t)&&vv(n,t,Ne(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Dn(e){return 0!=(32&e.flags)}(t)&&vv(n,t,Ne(),t.stylesWithoutHost,!1)}function Yt(e,t,n,s){ze(e,t,n,s),Be()}function r_(e){return!!e&&"function"==typeof e.then}const Kx=function Xx(e){return!!e&&"function"==typeof e.subscribe};function Xr(e,t,n,s){const l=Ne(),d=on(),y=Hn();return function Jx(e,t,n,s,l,d,y,w){const D=ga(s),F=e.firstCreatePass&&em(e),j=t[8],Y=Qf(t);let te=!0;if(3&s.type||w){const Ve=xi(s,t),$e=w?w(Ve):Ve,Ce=Y.length,at=w?st=>w(hr(st[s.index])):s.index;if(Un(n)){let st=null;if(!w&&D&&(st=function _T(e,t,n,s){const l=e.cleanup;if(null!=l)for(let d=0;d<l.length-1;d+=2){const y=l[d];if(y===n&&l[d+1]===s){const w=t[7],D=l[d+2];return w.length>D?w[D]:null}"string"==typeof y&&(d+=2)}return null}(e,t,l,s.index)),null!==st)(st.__ngLastListenerFn__||st).__ngNextListenerFn__=d,st.__ngLastListenerFn__=d,te=!1;else{d=xv(s,t,j,d,!1);const pn=n.listen($e,l,d);Y.push(d,pn),F&&F.push(l,at,Ce,Ce+1)}}else d=xv(s,t,j,d,!0),$e.addEventListener(l,d,y),Y.push(d),F&&F.push(l,at,Ce,y)}else d=xv(s,t,j,d,!1);const ge=s.outputs;let Ie;if(te&&null!==ge&&(Ie=ge[l])){const Ve=Ie.length;if(Ve)for(let $e=0;$e<Ve;$e+=2){const Co=t[Ie[$e]][Ie[$e+1]].subscribe(d),Pc=Y.length;Y.push(d,Co),F&&F.push(l,s.index,Pc,-(Pc+1))}}}(d,l,l[11],y,e,t,!!n,s),Xr}function Qx(e,t,n,s){try{return!1!==n(s)}catch(l){return r(e,l),!1}}function xv(e,t,n,s,l){return function d(y){if(y===Function)return s;const w=2&e.flags?ni(e.index,t):t;0==(32&t[2])&&yc(w);let D=Qx(t,0,s,y),A=d.__ngNextListenerFn__;for(;A;)D=Qx(t,0,A,y)&&D,A=A.__ngNextListenerFn__;return l&&!1===D&&(y.preventDefault(),y.returnValue=!1),D}}function i_(e,t,n,s,l){const d=Ne(),y=El(d,t,n,s);return y!==kt&&kr(on(),ee(),d,e,y,d[11],l,!1),i_}function Rt(e,t=""){const n=Ne(),s=on(),l=e+20,d=s.firstCreatePass?fc(s,l,1,t,null):s.data[l],y=n[l]=function Id(e,t){return Un(e)?e.createText(t):e.createTextNode(t)}(n[11],t);Dh(s,n,y,d),Ki(d,!1)}function hp(e){return s_("",e,""),hp}function s_(e,t,n){const s=Ne(),l=El(s,e,t,n);return l!==kt&&c(s,G(),l),s_}const jh=void 0;var oD=["en",[["a","p"],["AM","PM"],jh],[["AM","PM"],jh,jh],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],jh,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],jh,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",jh,"{1} 'at' {0}",jh],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function iD(e){const n=Math.floor(Math.abs(e)),s=e.toString().replace(/^[^.]*\.?/,"").length;return 1===n&&0===s?1:5}];let dp={};function G1(e){return e in dp||(dp[e]=Kt.ng&&Kt.ng.common&&Kt.ng.common.locales&&Kt.ng.common.locales[e]),dp[e]}var lt=(()=>((lt=lt||{})[lt.LocaleId=0]="LocaleId",lt[lt.DayPeriodsFormat=1]="DayPeriodsFormat",lt[lt.DayPeriodsStandalone=2]="DayPeriodsStandalone",lt[lt.DaysFormat=3]="DaysFormat",lt[lt.DaysStandalone=4]="DaysStandalone",lt[lt.MonthsFormat=5]="MonthsFormat",lt[lt.MonthsStandalone=6]="MonthsStandalone",lt[lt.Eras=7]="Eras",lt[lt.FirstDayOfWeek=8]="FirstDayOfWeek",lt[lt.WeekendRange=9]="WeekendRange",lt[lt.DateFormat=10]="DateFormat",lt[lt.TimeFormat=11]="TimeFormat",lt[lt.DateTimeFormat=12]="DateTimeFormat",lt[lt.NumberSymbols=13]="NumberSymbols",lt[lt.NumberFormats=14]="NumberFormats",lt[lt.CurrencyCode=15]="CurrencyCode",lt[lt.CurrencySymbol=16]="CurrencySymbol",lt[lt.CurrencyName=17]="CurrencyName",lt[lt.Currencies=18]="Currencies",lt[lt.Directionality=19]="Directionality",lt[lt.PluralCase=20]="PluralCase",lt[lt.ExtraData=21]="ExtraData",lt))();const a_="en-US";let H1=a_;class gb{}class lM{resolveComponentFactory(t){throw function aM(e){const t=Error(`No component factory found for ${fn(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(t)}}let fp=(()=>{class e{}return e.NULL=new lM,e})();function cM(){return mp(Hn(),Ne())}function mp(e,t){return new wu(xi(e,t))}let wu=(()=>{class e{constructor(n){this.nativeElement=n}}return e.__NG_ELEMENT_ID__=cM,e})();class yb{}let pM=(()=>{class e{}return e.\u0275prov=Tt({token:e,providedIn:"root",factory:()=>null}),e})();class p_{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const fM=new p_("13.2.0"),Sv={};function f_(e,t,n,s,l=!1){for(;null!==n;){const d=t[n.index];if(null!==d&&s.push(hr(d)),Mr(d))for(let w=10;w<d.length;w++){const D=d[w],A=D[1].firstChild;null!==A&&f_(D[1],D,A,s)}const y=n.type;if(8&y)f_(e,t,n.child,s);else if(32&y){const w=_f(n,t);let D;for(;D=w();)s.push(D)}else if(16&y){const w=wf(t,n);if(Array.isArray(w))s.push(...w);else{const D=Eh(t[16]);f_(D[1],D,w,s,!0)}}n=l?n.projectionNext:n.next}return s}class am{constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,n=t[1];return f_(n,t,n.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(Mr(t)){const n=t[8],s=n?n.indexOf(this):-1;s>-1&&(vf(t,s),md(n,s))}this._attachedToViewContainer=!1}Tg(this._lView[1],this._lView)}onDestroy(t){!function qg(e,t,n,s){const l=Qf(t);null===n?l.push(s):(l.push(n),e.firstCreatePass&&em(e).push(s,l.length-1))}(this._lView[1],this._lView,null,t)}markForCheck(){yc(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Yf(this._lView[1],this._lView,this.context)}checkNoChanges(){!function tp(e,t,n){os(!0);try{Yf(e,t,n)}finally{os(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new vn(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function $y(e,t){gu(e,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new vn(902,"");this._appRef=t}}class mM extends am{constructor(t){super(t),this._view=t}detectChanges(){vc(this._view)}checkNoChanges(){!function uv(e){os(!0);try{vc(e)}finally{os(!1)}}(this._view)}get context(){return null}}class vb extends fp{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=rr(t);return new Iv(n,this.ngModule)}}function xb(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}const _M=new en("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>gf});class Iv extends gb{constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function Xy(e){return e.map(Wy).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return xb(this.componentDef.inputs)}get outputs(){return xb(this.componentDef.outputs)}create(t,n,s,l){const d=(l=l||this.ngModule)?function yM(e,t){return{get:(n,s,l)=>{const d=e.get(n,Sv,l);return d!==Sv||s===Sv?d:t.get(n,s,l)}}}(t,l.injector):t,y=d.get(yb,Yu),w=d.get(pM,null),D=y.createRenderer(null,this.componentDef),A=this.componentDef.selectors[0][0]||"div",F=s?function Hg(e,t,n){if(Un(e))return e.selectRootElement(t,n===Oi.ShadowDom);let s="string"==typeof t?e.querySelector(t):t;return s.textContent="",s}(D,s,this.componentDef.encapsulation):Ad(y.createRenderer(null,this.componentDef),A,function gM(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(A)),j=this.componentDef.onPush?576:528,Y=function Er(e,t){return{components:[],scheduler:e||gf,clean:dv,playerHandler:t||null,flags:0}}(),te=Oh(0,null,null,1,0,null,null,null,null,null),ge=vu(null,te,Y,j,null,null,y,D,w,d);let Ie,Ve;R(ge);try{const $e=function Rr(e,t,n,s,l,d){const y=n[1];n[20]=e;const D=fc(y,20,2,"#host",null),A=D.mergedAttrs=t.hostAttrs;null!==A&&(h(D,A,!0),null!==e&&(Mn(l,e,A),null!==D.classes&&zd(l,e,D.classes),null!==D.styles&&Cf(l,e,D.styles)));const F=s.createRenderer(e,t),j=vu(n,jf(t),null,t.onPush?64:16,n[20],D,s,F,d||null,null);return y.firstCreatePass&&(pr(ht(D,n),y,t.type),Gf(y,D),qf(D,n.length,1)),wl(n,j),n[20]=j}(F,this.componentDef,ge,y,D);if(F)if(s)Mn(D,F,["ng-version",fM.full]);else{const{attrs:Ce,classes:at}=function Ky(e){const t=[],n=[];let s=1,l=2;for(;s<e.length;){let d=e[s];if("string"==typeof d)2===l?""!==d&&t.push(d,e[++s]):8===l&&n.push(d);else{if(!No(l))break;l=d}s++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);Ce&&Mn(D,F,Ce),at&&at.length>0&&zd(D,F,at.join(" "))}if(Ve=Zc(te,20),void 0!==n){const Ce=Ve.projection=[];for(let at=0;at<this.ngContentSelectors.length;at++){const st=n[at];Ce.push(null!=st?Array.from(st):null)}}Ie=function bn(e,t,n,s,l){const d=n[1],y=function av(e,t,n){const s=Hn();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),Zf(e,s,t,mc(e,t,1,null),n));const l=Yl(t,e,s.directiveStart,s);wr(l,t);const d=xi(s,t);return d&&wr(d,t),l}(d,n,t);if(s.components.push(y),e[8]=y,l&&l.forEach(D=>D(y,t)),t.contentQueries){const D=Hn();t.contentQueries(1,y,D.directiveStart)}const w=Hn();return!d.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(re(w.index),xl(n[1],w,0,w.directiveStart,w.directiveEnd,t),Xg(t,y)),y}($e,this.componentDef,ge,Y,[Vn]),xu(te,ge,null)}finally{H()}return new xM(this.componentType,Ie,mp(Ve,ge),ge,Ve)}}class xM extends class sM{}{constructor(t,n,s,l,d){super(),this.location=s,this._rootLView=l,this._tNode=d,this.instance=n,this.hostView=this.changeDetectorRef=new mM(l),this.componentType=t}get injector(){return new sl(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}class Cc{}class bb{}const gp=new Map;class Cb extends Cc{constructor(t,n){super(),this._parent=n,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new vb(this);const s=ei(t);this._bootstrapComponents=ps(s.bootstrap),this._r3Injector=q(t,n,[{provide:Cc,useValue:this},{provide:fp,useValue:this.componentFactoryResolver}],fn(t)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(t)}get(t,n=We.THROW_IF_NOT_FOUND,s=Mt.Default){return t===We||t===Cc||t===E?this:this._r3Injector.get(t,n,s)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class Av extends bb{constructor(t){super(),this.moduleType=t,null!==ei(t)&&function wM(e){const t=new Set;!function n(s){const l=ei(s,!0),d=l.id;null!==d&&(function wb(e,t,n){if(t&&t!==n)throw new Error(`Duplicate module registered for ${e} - ${fn(t)} vs ${fn(t.name)}`)}(d,gp.get(d),s),gp.set(d,s));const y=ps(l.imports);for(const w of y)t.has(w)||(t.add(w),n(w))}(e)}(t)}create(t){return new Cb(this.moduleType,t)}}function Tb(e,t,n,s,l,d){const y=t+n;return lr(e,y,l)?function $o(e,t,n){return e[t]=n}(e,y+1,d?s.call(d,l):s(l)):function lm(e,t){const n=e[t];return n===kt?void 0:n}(e,y+1)}function Pb(e,t,n){const s=e+20,l=Ne(),d=function rs(e,t){return e[t]}(l,s);return function cm(e,t){return e[1].data[t].pure}(l,s)?Tb(l,function br(){const e=Ct.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}(),t,d.transform,n,d):d.transform(n)}function Pv(e){return t=>{setTimeout(e,void 0,t)}}const bo=class BM extends Gi{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,s){var l,d,y;let w=t,D=n||(()=>null),A=s;if(t&&"object"==typeof t){const j=t;w=null===(l=j.next)||void 0===l?void 0:l.bind(j),D=null===(d=j.error)||void 0===d?void 0:d.bind(j),A=null===(y=j.complete)||void 0===y?void 0:y.bind(j)}this.__isAsync&&(D=Pv(D),w&&(w=Pv(w)),A&&(A=Pv(A)));const F=super.subscribe({next:w,error:D,complete:A});return t instanceof Yn&&t.add(F),F}};Symbol;let Oa=(()=>{class e{}return e.__NG_ELEMENT_ID__=$M,e})();function $M(){return function Lb(e,t){let n;const s=t[e.index];if(Mr(s))n=s;else{let l;if(8&e.type)l=hr(s);else{const d=t[11];l=d.createComment("");const y=xi(e,t);ac(d,Ei(d,y),l,function Ch(e,t){return Un(e)?e.nextSibling(t):t.nextSibling}(d,y),!1)}t[e.index]=n=function Wf(e,t,n,s){return new Array(e,!0,!1,t,null,0,s,n,null,null)}(s,t,l,e),wl(t,n)}return new kb(n,e,t)}(Hn(),Ne())}const GM=Oa,kb=class extends GM{constructor(t,n,s){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=s}get element(){return mp(this._hostTNode,this._hostLView)}get injector(){return new sl(this._hostTNode,this._hostLView)}get parentInjector(){const t=mo(this._hostTNode,this._hostLView);if(Ht(t)){const n=Pn(t,this._hostLView),s=gt(t);return new sl(n[1].data[s+8],n)}return new sl(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=Rb(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,n,s){const l=t.createEmbeddedView(n||{});return this.insert(l,s),l}createComponent(t,n,s,l,d){const y=t&&!function tu(e){return"function"==typeof e}(t);let w;if(y)w=n;else{const j=n||{};w=j.index,s=j.injector,l=j.projectableNodes,d=j.ngModuleRef}const D=y?t:new Iv(rr(t)),A=s||this.parentInjector;if(!d&&null==D.ngModule&&A){const j=A.get(Cc,null);j&&(d=j)}const F=D.create(A,l,void 0,d);return this.insert(F.hostView,w),F}insert(t,n){const s=t._lView,l=s[1];if(function dd(e){return Mr(e[3])}(s)){const F=this.indexOf(t);if(-1!==F)this.detach(F);else{const j=s[3],Y=new kb(j,j[6],j[3]);Y.detach(Y.indexOf(t))}}const d=this._adjustIndex(n),y=this._lContainer;!function Hy(e,t,n,s){const l=10+s,d=n.length;s>0&&(n[l-1][4]=t),s<d-10?(t[4]=n[l],Hm(n,10+s,t)):(n.push(t),t[4]=null),t[3]=n;const y=t[17];null!==y&&n!==y&&function qy(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(y,t);const w=t[19];null!==w&&w.insertView(e),t[2]|=128}(l,s,y,d);const w=Od(d,y),D=s[11],A=Ei(D,y[7]);return null!==A&&function Vy(e,t,n,s,l,d){s[0]=l,s[6]=t,gu(e,s,n,1,l,d)}(l,y[6],D,s,A,w),t.attachToViewContainerRef(),Hm(Rv(y),d,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=Rb(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),s=vf(this._lContainer,n);s&&(md(Rv(this._lContainer),n),Tg(s[1],s))}detach(t){const n=this._adjustIndex(t,-1),s=vf(this._lContainer,n);return s&&null!=md(Rv(this._lContainer),n)?new am(s):null}_adjustIndex(t,n=0){return null==t?this.length+n:t}};function Rb(e){return e[8]}function Rv(e){return e[8]||(e[8]=[])}function y_(...e){}const v_=new en("Application Initializer");let yp=(()=>{class e{constructor(n){this.appInits=n,this.resolve=y_,this.reject=y_,this.initialized=!1,this.done=!1,this.donePromise=new Promise((s,l)=>{this.resolve=s,this.reject=l})}runInitializers(){if(this.initialized)return;const n=[],s=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let l=0;l<this.appInits.length;l++){const d=this.appInits[l]();if(r_(d))n.push(d);else if(Kx(d)){const y=new Promise((w,D)=>{d.subscribe({complete:w,error:D})});n.push(y)}}Promise.all(n).then(()=>{s()}).catch(l=>{this.reject(l)}),0===n.length&&s(),this.initialized=!0}}return e.\u0275fac=function(n){return new(n||e)(et(v_,8))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();const hm=new en("AppId"),yS={provide:hm,useFactory:function _S(){return`${Zv()}${Zv()}${Zv()}`},deps:[]};function Zv(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const nw=new en("Platform Initializer"),x_=new en("Platform ID"),rw=new en("appBootstrapListener");let iw=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();const Eu=new en("LocaleId"),ow=new en("DefaultCurrencyCode");class vS{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let b_=(()=>{class e{compileModuleSync(n){return new Av(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const s=this.compileModuleSync(n),d=ps(ei(n).declarations).reduce((y,w)=>{const D=rr(w);return D&&y.push(new Iv(D)),y},[]);return new vS(s,d)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();const bS=(()=>Promise.resolve(0))();function Wv(e){"undefined"==typeof Zone?bS.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class hi{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:s=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new bo(!1),this.onMicrotaskEmpty=new bo(!1),this.onStable=new bo(!1),this.onError=new bo(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const l=this;l._nesting=0,l._outer=l._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(l._inner=l._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(l._inner=l._inner.fork(Zone.longStackTraceZoneSpec)),l.shouldCoalesceEventChangeDetection=!s&&n,l.shouldCoalesceRunChangeDetection=s,l.lastRequestAnimationFrameId=-1,l.nativeRequestAnimationFrame=function wS(){let e=Kt.requestAnimationFrame,t=Kt.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const s=t[Zone.__symbol__("OriginalDelegate")];s&&(t=s)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function TS(e){const t=()=>{!function CS(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Kt,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,Kv(e),e.isCheckStableRunning=!0,Xv(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),Kv(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,s,l,d,y,w)=>{try{return sw(e),n.invokeTask(l,d,y,w)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===d.type||e.shouldCoalesceRunChangeDetection)&&t(),aw(e)}},onInvoke:(n,s,l,d,y,w,D)=>{try{return sw(e),n.invoke(l,d,y,w,D)}finally{e.shouldCoalesceRunChangeDetection&&t(),aw(e)}},onHasTask:(n,s,l,d)=>{n.hasTask(l,d),s===l&&("microTask"==d.change?(e._hasPendingMicrotasks=d.microTask,Kv(e),Xv(e)):"macroTask"==d.change&&(e.hasPendingMacrotasks=d.macroTask))},onHandleError:(n,s,l,d)=>(n.handleError(l,d),e.runOutsideAngular(()=>e.onError.emit(d)),!1)})}(l)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!hi.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(hi.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,n,s){return this._inner.run(t,n,s)}runTask(t,n,s,l){const d=this._inner,y=d.scheduleEventTask("NgZoneEvent: "+l,t,ES,y_,y_);try{return d.runTask(y,n,s)}finally{d.cancelTask(y)}}runGuarded(t,n,s){return this._inner.runGuarded(t,n,s)}runOutsideAngular(t){return this._outer.run(t)}}const ES={};function Xv(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Kv(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function sw(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function aw(e){e._nesting--,Xv(e)}class DS{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new bo,this.onMicrotaskEmpty=new bo,this.onStable=new bo,this.onError=new bo}run(t,n,s){return t.apply(n,s)}runGuarded(t,n,s){return t.apply(n,s)}runOutsideAngular(t){return t()}runTask(t,n,s,l){return t.apply(n,s)}}let Yv=(()=>{class e{constructor(n){this._ngZone=n,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{hi.assertNotInAngularZone(),Wv(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Wv(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(s=>!s.updateCb||!s.updateCb(n)||(clearTimeout(s.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,s,l){let d=-1;s&&s>0&&(d=setTimeout(()=>{this._callbacks=this._callbacks.filter(y=>y.timeoutId!==d),n(this._didWork,this.getPendingTasks())},s)),this._callbacks.push({doneCb:n,timeoutId:d,updateCb:l})}whenStable(n,s,l){if(l&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,s,l),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(n,s,l){return[]}}return e.\u0275fac=function(n){return new(n||e)(et(hi))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})(),lw=(()=>{class e{constructor(){this._applications=new Map,Jv.addToWindow(this)}registerApplication(n,s){this._applications.set(n,s)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,s=!0){return Jv.findTestabilityInTree(this,n,s)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();class MS{addToWindow(t){}findTestabilityInTree(t,n,s){return null}}let Fa,Jv=new MS;const cw=new en("AllowMultipleToken");class uw{constructor(t,n){this.name=t,this.token=n}}function hw(e,t,n=[]){const s=`Platform: ${t}`,l=new en(s);return(d=[])=>{let y=dw();if(!y||y.injector.get(cw,!1))if(e)e(n.concat(d).concat({provide:l,useValue:!0}));else{const w=n.concat(d).concat({provide:l,useValue:!0},{provide:S,useValue:"platform"});!function PS(e){if(Fa&&!Fa.destroyed&&!Fa.injector.get(cw,!1))throw new vn(400,"");Fa=e.get(pw);const t=e.get(nw,null);t&&t.forEach(n=>n())}(We.create({providers:w,name:s}))}return function kS(e){const t=dw();if(!t)throw new vn(401,"");return t}()}}function dw(){return Fa&&!Fa.destroyed?Fa:null}let pw=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,s){const w=function RS(e,t){let n;return n="noop"===e?new DS:("zone.js"===e?void 0:e)||new hi({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)}),n}(s?s.ngZone:void 0,{ngZoneEventCoalescing:s&&s.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:s&&s.ngZoneRunCoalescing||!1}),D=[{provide:hi,useValue:w}];return w.run(()=>{const A=We.create({providers:D,parent:this.injector,name:n.moduleType.name}),F=n.create(A),j=F.injector.get(uu,null);if(!j)throw new vn(402,"");return w.runOutsideAngular(()=>{const Y=w.onError.subscribe({next:te=>{j.handleError(te)}});F.onDestroy(()=>{Qv(this._modules,F),Y.unsubscribe()})}),function LS(e,t,n){try{const s=n();return r_(s)?s.catch(l=>{throw t.runOutsideAngular(()=>e.handleError(l)),l}):s}catch(s){throw t.runOutsideAngular(()=>e.handleError(s)),s}}(j,w,()=>{const Y=F.injector.get(yp);return Y.runInitializers(),Y.donePromise.then(()=>(function uD(e){xt(e,"Expected localeId to be defined"),"string"==typeof e&&(H1=e.toLowerCase().replace(/_/g,"-"))}(F.injector.get(Eu,a_)||a_),this._moduleDoBootstrap(F),F))})})}bootstrapModule(n,s=[]){const l=fw({},s);return function IS(e,t,n){const s=new Av(n);return Promise.resolve(s)}(0,0,n).then(d=>this.bootstrapModuleFactory(d,l))}_moduleDoBootstrap(n){const s=n.injector.get(dm);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(l=>s.bootstrap(l));else{if(!n.instance.ngDoBootstrap)throw new vn(403,"");n.instance.ngDoBootstrap(s)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new vn(404,"");this._modules.slice().forEach(n=>n.destroy()),this._destroyListeners.forEach(n=>n()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(n){return new(n||e)(et(We))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();function fw(e,t){return Array.isArray(t)?t.reduce(fw,e):Object.assign(Object.assign({},e),t)}let dm=(()=>{class e{constructor(n,s,l,d,y){this._zone=n,this._injector=s,this._exceptionHandler=l,this._componentFactoryResolver=d,this._initStatus=y,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const w=new sn(A=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{A.next(this._stable),A.complete()})}),D=new sn(A=>{let F;this._zone.runOutsideAngular(()=>{F=this._zone.onStable.subscribe(()=>{hi.assertNotInAngularZone(),Wv(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,A.next(!0))})})});const j=this._zone.onUnstable.subscribe(()=>{hi.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{A.next(!1)}))});return()=>{F.unsubscribe(),j.unsubscribe()}});this.isStable=function Io(...e){const t=ot(e),n=function ft(e,t){return"number"==typeof Ae(e)?e.pop():t}(e,1/0),s=e;return s.length?1===s.length?yr(s[0]):me(n)(hn(s,t)):de}(w,D.pipe(function Jh(e={}){const{connector:t=(()=>new Gi),resetOnError:n=!0,resetOnComplete:s=!0,resetOnRefCountZero:l=!0}=e;return d=>{let y=null,w=null,D=null,A=0,F=!1,j=!1;const Y=()=>{null==w||w.unsubscribe(),w=null},te=()=>{Y(),y=D=null,F=j=!1},ge=()=>{const Ie=y;te(),null==Ie||Ie.unsubscribe()};return _r((Ie,Ve)=>{A++,!j&&!F&&Y();const $e=D=null!=D?D:t();Ve.add(()=>{A--,0===A&&!j&&!F&&(w=Nl(ge,l))}),$e.subscribe(Ve),y||(y=new xs({next:Ce=>$e.next(Ce),error:Ce=>{j=!0,Y(),w=Nl(te,n,Ce),$e.error(Ce)},complete:()=>{F=!0,Y(),w=Nl(te,s),$e.complete()}}),hn(Ie).subscribe(y))})(d)}}()))}bootstrap(n,s){if(!this._initStatus.done)throw new vn(405,"");let l;l=n instanceof gb?n:this._componentFactoryResolver.resolveComponentFactory(n),this.componentTypes.push(l.componentType);const d=function AS(e){return e.isBoundToModule}(l)?void 0:this._injector.get(Cc),w=l.create(We.NULL,[],s||l.selector,d),D=w.location.nativeElement,A=w.injector.get(Yv,null),F=A&&w.injector.get(lw);return A&&F&&F.registerApplication(D,A),w.onDestroy(()=>{this.detachView(w.hostView),Qv(this.components,w),F&&F.unregisterApplication(D)}),this._loadComponent(w),w}tick(){if(this._runningTick)throw new vn(101,"");try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const s=n;this._views.push(s),s.attachToAppRef(this)}detachView(n){const s=n;Qv(this._views,s),s.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(rw,[]).concat(this._bootstrapListeners).forEach(l=>l(n))}ngOnDestroy(){this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return e.\u0275fac=function(n){return new(n||e)(et(hi),et(We),et(uu),et(fp),et(yp))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();function Qv(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}let gw=!0,e0=(()=>{class e{}return e.__NG_ELEMENT_ID__=zS,e})();function zS(e){return function BS(e,t,n){if(Zl(e)&&!n){const s=ni(e.index,t);return new am(s,s)}return 47&e.type?new am(t[16],t):null}(Hn(),Ne(),16==(16&e))}class Ew{constructor(){}supports(t){return bc(t)}create(t){return new GS(t)}}const $S=(e,t)=>t;class GS{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||$S}forEachItem(t){let n;for(n=this._itHead;null!==n;n=n._next)t(n)}forEachOperation(t){let n=this._itHead,s=this._removalsHead,l=0,d=null;for(;n||s;){const y=!s||n&&n.currentIndex<Tw(s,l,d)?n:s,w=Tw(y,l,d),D=y.currentIndex;if(y===s)l--,s=s._nextRemoved;else if(n=n._next,null==y.previousIndex)l++;else{d||(d=[]);const A=w-l,F=D-l;if(A!=F){for(let Y=0;Y<A;Y++){const te=Y<d.length?d[Y]:d[Y]=0,ge=te+Y;F<=ge&&ge<A&&(d[Y]=te+1)}d[y.previousIndex]=F-A}}w!==D&&t(y,w,D)}}forEachPreviousItem(t){let n;for(n=this._previousItHead;null!==n;n=n._nextPrevious)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachMovedItem(t){let n;for(n=this._movesHead;null!==n;n=n._nextMoved)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}forEachIdentityChange(t){let n;for(n=this._identityChangesHead;null!==n;n=n._nextIdentityChange)t(n)}diff(t){if(null==t&&(t=[]),!bc(t))throw new vn(900,"");return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let l,d,y,n=this._itHead,s=!1;if(Array.isArray(t)){this.length=t.length;for(let w=0;w<this.length;w++)d=t[w],y=this._trackByFn(w,d),null!==n&&Object.is(n.trackById,y)?(s&&(n=this._verifyReinsertion(n,d,y,w)),Object.is(n.item,d)||this._addIdentityChange(n,d)):(n=this._mismatch(n,d,y,w),s=!0),n=n._next}else l=0,function Gs(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[xc()]();let s;for(;!(s=n.next()).done;)t(s.value)}}(t,w=>{y=this._trackByFn(l,w),null!==n&&Object.is(n.trackById,y)?(s&&(n=this._verifyReinsertion(n,w,y,l)),Object.is(n.item,w)||this._addIdentityChange(n,w)):(n=this._mismatch(n,w,y,l),s=!0),n=n._next,l++}),this.length=l;return this._truncate(n),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,n,s,l){let d;return null===t?d=this._itTail:(d=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(s,null))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._reinsertAfter(t,d,l)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(s,l))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._moveAfter(t,d,l)):t=this._addAfter(new HS(n,s),d,l),t}_verifyReinsertion(t,n,s,l){let d=null===this._unlinkedRecords?null:this._unlinkedRecords.get(s,null);return null!==d?t=this._reinsertAfter(d,t._prev,l):t.currentIndex!=l&&(t.currentIndex=l,this._addToMoves(t,l)),t}_truncate(t){for(;null!==t;){const n=t._next;this._addToRemovals(this._unlink(t)),t=n}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,n,s){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const l=t._prevRemoved,d=t._nextRemoved;return null===l?this._removalsHead=d:l._nextRemoved=d,null===d?this._removalsTail=l:d._prevRemoved=l,this._insertAfter(t,n,s),this._addToMoves(t,s),t}_moveAfter(t,n,s){return this._unlink(t),this._insertAfter(t,n,s),this._addToMoves(t,s),t}_addAfter(t,n,s){return this._insertAfter(t,n,s),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,n,s){const l=null===n?this._itHead:n._next;return t._next=l,t._prev=n,null===l?this._itTail=t:l._prev=t,null===n?this._itHead=t:n._next=t,null===this._linkedRecords&&(this._linkedRecords=new Cw),this._linkedRecords.put(t),t.currentIndex=s,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const n=t._prev,s=t._next;return null===n?this._itHead=s:n._next=s,null===s?this._itTail=n:s._prev=n,t}_addToMoves(t,n){return t.previousIndex===n||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Cw),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,n){return t.item=n,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class HS{constructor(t,n){this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class qS{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,n){let s;for(s=this._head;null!==s;s=s._nextDup)if((null===n||n<=s.currentIndex)&&Object.is(s.trackById,t))return s;return null}remove(t){const n=t._prevDup,s=t._nextDup;return null===n?this._head=s:n._nextDup=s,null===s?this._tail=n:s._prevDup=n,null===this._head}}class Cw{constructor(){this.map=new Map}put(t){const n=t.trackById;let s=this.map.get(n);s||(s=new qS,this.map.set(n,s)),s.add(t)}get(t,n){const l=this.map.get(t);return l?l.get(t,n):null}remove(t){const n=t.trackById;return this.map.get(n).remove(t)&&this.map.delete(n),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Tw(e,t,n){const s=e.previousIndex;if(null===s)return s;let l=0;return n&&s<n.length&&(l=n[s]),s+t+l}class Dw{constructor(){}supports(t){return t instanceof Map||np(t)}create(){return new ZS}}class ZS{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let n;for(n=this._mapHead;null!==n;n=n._next)t(n)}forEachPreviousItem(t){let n;for(n=this._previousMapHead;null!==n;n=n._nextPrevious)t(n)}forEachChangedItem(t){let n;for(n=this._changesHead;null!==n;n=n._nextChanged)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}diff(t){if(t){if(!(t instanceof Map||np(t)))throw new vn(900,"")}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let n=this._mapHead;if(this._appendAfter=null,this._forEach(t,(s,l)=>{if(n&&n.key===l)this._maybeAddToChanges(n,s),this._appendAfter=n,n=n._next;else{const d=this._getOrCreateRecordForKey(l,s);n=this._insertBeforeOrAppend(n,d)}}),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(let s=n;null!==s;s=s._nextRemoved)s===this._mapHead&&(this._mapHead=null),this._records.delete(s.key),s._nextRemoved=s._next,s.previousValue=s.currentValue,s.currentValue=null,s._prev=null,s._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,n){if(t){const s=t._prev;return n._next=t,n._prev=s,t._prev=n,s&&(s._next=n),t===this._mapHead&&(this._mapHead=n),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=n,n._prev=this._appendAfter):this._mapHead=n,this._appendAfter=n,null}_getOrCreateRecordForKey(t,n){if(this._records.has(t)){const l=this._records.get(t);this._maybeAddToChanges(l,n);const d=l._prev,y=l._next;return d&&(d._next=y),y&&(y._prev=d),l._next=null,l._prev=null,l}const s=new WS(t);return this._records.set(t,s),s.currentValue=n,this._addToAdditions(s),s}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,n){Object.is(n,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=n,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,n){t instanceof Map?t.forEach(n):Object.keys(t).forEach(s=>n(t[s],s))}}class WS{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Mw(){return new pm([new Ew])}let pm=(()=>{class e{constructor(n){this.factories=n}static create(n,s){if(null!=s){const l=s.factories.slice();n=n.concat(l)}return new e(n)}static extend(n){return{provide:e,useFactory:s=>e.create(n,s||Mw()),deps:[[e,new ai,new Pr]]}}find(n){const s=this.factories.find(l=>l.supports(n));if(null!=s)return s;throw new vn(901,"")}}return e.\u0275prov=Tt({token:e,providedIn:"root",factory:Mw}),e})();function Sw(){return new vp([new Dw])}let vp=(()=>{class e{constructor(n){this.factories=n}static create(n,s){if(s){const l=s.factories.slice();n=n.concat(l)}return new e(n)}static extend(n){return{provide:e,useFactory:s=>e.create(n,s||Sw()),deps:[[e,new ai,new Pr]]}}find(n){const s=this.factories.find(d=>d.supports(n));if(s)return s;throw new vn(901,"")}}return e.\u0275prov=Tt({token:e,providedIn:"root",factory:Sw}),e})();const XS=[new Dw],YS=new pm([new Ew]),JS=new vp(XS),QS=hw(null,"core",[{provide:x_,useValue:"unknown"},{provide:pw,deps:[We]},{provide:lw,deps:[]},{provide:iw,deps:[]}]),iI=[{provide:dm,useClass:dm,deps:[hi,We,uu,fp,yp]},{provide:_M,deps:[hi],useFactory:function oI(e){let t=[];return e.onStable.subscribe(()=>{for(;t.length;)t.pop()()}),function(n){t.push(n)}}},{provide:yp,useClass:yp,deps:[[new Pr,v_]]},{provide:b_,useClass:b_,deps:[]},yS,{provide:pm,useFactory:function eI(){return YS},deps:[]},{provide:vp,useFactory:function tI(){return JS},deps:[]},{provide:Eu,useFactory:function nI(e){return e||function rI(){return"undefined"!=typeof $localize&&$localize.locale||a_}()},deps:[[new Ns(Eu),new Pr,new ai]]},{provide:ow,useValue:"USD"}];let sI=(()=>{class e{constructor(n){}}return e.\u0275fac=function(n){return new(n||e)(et(dm))},e.\u0275mod=Ro({type:e}),e.\u0275inj=mi({providers:iI}),e})(),E_=null;function Cu(){return E_}const Eo=new en("DocumentToken");let $h=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Tt({token:e,factory:function(){return function uI(){return et(Iw)}()},providedIn:"platform"}),e})();const hI=new en("Location Initialized");let Iw=(()=>{class e extends $h{constructor(n){super(),this._doc=n,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Cu().getBaseHref(this._doc)}onPopState(n){const s=Cu().getGlobalEventTarget(this._doc,"window");return s.addEventListener("popstate",n,!1),()=>s.removeEventListener("popstate",n)}onHashChange(n){const s=Cu().getGlobalEventTarget(this._doc,"window");return s.addEventListener("hashchange",n,!1),()=>s.removeEventListener("hashchange",n)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(n){this.location.pathname=n}pushState(n,s,l){Aw()?this._history.pushState(n,s,l):this.location.hash=l}replaceState(n,s,l){Aw()?this._history.replaceState(n,s,l):this.location.hash=l}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return e.\u0275fac=function(n){return new(n||e)(et(Eo))},e.\u0275prov=Tt({token:e,factory:function(){return function dI(){return new Iw(et(Eo))}()},providedIn:"platform"}),e})();function Aw(){return!!window.history.pushState}function s0(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function Pw(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Dc(e){return e&&"?"!==e[0]?"?"+e:e}let xp=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Tt({token:e,factory:function(){return function pI(e){const t=et(Eo).location;return new kw(et($h),t&&t.origin||"")}()},providedIn:"root"}),e})();const a0=new en("appBaseHref");let kw=(()=>{class e extends xp{constructor(n,s){if(super(),this._platformLocation=n,this._removeListenerFns=[],null==s&&(s=this._platformLocation.getBaseHrefFromDOM()),null==s)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=s}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return s0(this._baseHref,n)}path(n=!1){const s=this._platformLocation.pathname+Dc(this._platformLocation.search),l=this._platformLocation.hash;return l&&n?`${s}${l}`:s}pushState(n,s,l,d){const y=this.prepareExternalUrl(l+Dc(d));this._platformLocation.pushState(n,s,y)}replaceState(n,s,l,d){const y=this.prepareExternalUrl(l+Dc(d));this._platformLocation.replaceState(n,s,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var s,l;null===(l=(s=this._platformLocation).historyGo)||void 0===l||l.call(s,n)}}return e.\u0275fac=function(n){return new(n||e)(et($h),et(a0,8))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})(),fI=(()=>{class e extends xp{constructor(n,s){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=s&&(this._baseHref=s)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let s=this._platformLocation.hash;return null==s&&(s="#"),s.length>0?s.substring(1):s}prepareExternalUrl(n){const s=s0(this._baseHref,n);return s.length>0?"#"+s:s}pushState(n,s,l,d){let y=this.prepareExternalUrl(l+Dc(d));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.pushState(n,s,y)}replaceState(n,s,l,d){let y=this.prepareExternalUrl(l+Dc(d));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.replaceState(n,s,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var s,l;null===(l=(s=this._platformLocation).historyGo)||void 0===l||l.call(s,n)}}return e.\u0275fac=function(n){return new(n||e)(et($h),et(a0,8))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})(),l0=(()=>{class e{constructor(n,s){this._subject=new bo,this._urlChangeListeners=[],this._platformStrategy=n;const l=this._platformStrategy.getBaseHref();this._platformLocation=s,this._baseHref=Pw(Rw(l)),this._platformStrategy.onPopState(d=>{this._subject.emit({url:this.path(!0),pop:!0,state:d.state,type:d.type})})}path(n=!1){return this.normalize(this._platformStrategy.path(n))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(n,s=""){return this.path()==this.normalize(n+Dc(s))}normalize(n){return e.stripTrailingSlash(function gI(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,Rw(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._platformStrategy.prepareExternalUrl(n)}go(n,s="",l=null){this._platformStrategy.pushState(l,"",n,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Dc(s)),l)}replaceState(n,s="",l=null){this._platformStrategy.replaceState(l,"",n,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Dc(s)),l)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(n=0){var s,l;null===(l=(s=this._platformStrategy).historyGo)||void 0===l||l.call(s,n)}onUrlChange(n){this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(s=>{this._notifyUrlChangeListeners(s.url,s.state)}))}_notifyUrlChangeListeners(n="",s){this._urlChangeListeners.forEach(l=>l(n,s))}subscribe(n,s,l){return this._subject.subscribe({next:n,error:s,complete:l})}}return e.normalizeQueryParams=Dc,e.joinWithSlash=s0,e.stripTrailingSlash=Pw,e.\u0275fac=function(n){return new(n||e)(et(xp),et($h))},e.\u0275prov=Tt({token:e,factory:function(){return function mI(){return new l0(et(xp),et($h))}()},providedIn:"root"}),e})();function Rw(e){return e.replace(/\/index.html$/,"")}var Kr=(()=>((Kr=Kr||{})[Kr.Zero=0]="Zero",Kr[Kr.One=1]="One",Kr[Kr.Two=2]="Two",Kr[Kr.Few=3]="Few",Kr[Kr.Many=4]="Many",Kr[Kr.Other=5]="Other",Kr))();const EI=function $1(e){return function xo(e){const t=function sD(e){return e.toLowerCase().replace(/_/g,"-")}(e);let n=G1(t);if(n)return n;const s=t.split("-")[0];if(n=G1(s),n)return n;if("en"===s)return oD;throw new Error(`Missing locale data for the locale "${e}".`)}(e)[lt.PluralCase]};class R_{}let JI=(()=>{class e extends R_{constructor(n){super(),this.locale=n}getPluralCategory(n,s){switch(EI(s||this.locale)(n)){case Kr.Zero:return"zero";case Kr.One:return"one";case Kr.Two:return"two";case Kr.Few:return"few";case Kr.Many:return"many";default:return"other"}}}return e.\u0275fac=function(n){return new(n||e)(et(Eu))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();function Vw(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const s=n.indexOf("="),[l,d]=-1==s?[n,""]:[n.slice(0,s),n.slice(s+1)];if(l.trim()===t)return decodeURIComponent(d)}return null}let P2=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ro({type:e}),e.\u0275inj=mi({providers:[{provide:R_,useClass:JI}]}),e})();let O2=(()=>{class e{}return e.\u0275prov=Tt({token:e,providedIn:"root",factory:()=>new F2(et(Eo),window)}),e})();class F2{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const n=function z2(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const s=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let l=s.currentNode;for(;l;){const d=l.shadowRoot;if(d){const y=d.getElementById(t)||d.querySelector(`[name="${t}"]`);if(y)return y}l=s.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=t)}}scrollToElement(t){const n=t.getBoundingClientRect(),s=n.left+this.window.pageXOffset,l=n.top+this.window.pageYOffset,d=this.offset();this.window.scrollTo(s-d[0],l-d[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=Ww(this.window.history)||Ww(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function Ww(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class Xw{}class b0 extends class B2 extends class cI{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function lI(e){E_||(E_=e)}(new b0)}onAndCancel(t,n,s){return t.addEventListener(n,s,!1),()=>{t.removeEventListener(n,s,!1)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function N2(){return gm=gm||document.querySelector("base"),gm?gm.getAttribute("href"):null}();return null==n?null:function U2(e){L_=L_||document.createElement("a"),L_.setAttribute("href",e);const t=L_.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){gm=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return Vw(document.cookie,t)}}let L_,gm=null;const Kw=new en("TRANSITION_ID"),V2=[{provide:v_,useFactory:function j2(e,t,n){return()=>{n.get(yp).donePromise.then(()=>{const s=Cu(),l=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let d=0;d<l.length;d++)s.remove(l[d])})}},deps:[Kw,Eo,We],multi:!0}];class w0{static init(){!function SS(e){Jv=e}(new w0)}addToWindow(t){Kt.getAngularTestability=(s,l=!0)=>{const d=t.findTestabilityInTree(s,l);if(null==d)throw new Error("Could not find testability for element.");return d},Kt.getAllAngularTestabilities=()=>t.getAllTestabilities(),Kt.getAllAngularRootElements=()=>t.getAllRootElements(),Kt.frameworkStabilizers||(Kt.frameworkStabilizers=[]),Kt.frameworkStabilizers.push(s=>{const l=Kt.getAllAngularTestabilities();let d=l.length,y=!1;const w=function(D){y=y||D,d--,0==d&&s(y)};l.forEach(function(D){D.whenStable(w)})})}findTestabilityInTree(t,n,s){if(null==n)return null;const l=t.getTestability(n);return null!=l?l:s?Cu().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null}}let $2=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();const O_=new en("EventManagerPlugins");let F_=(()=>{class e{constructor(n,s){this._zone=s,this._eventNameToPlugin=new Map,n.forEach(l=>l.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,s,l){return this._findPluginFor(s).addEventListener(n,s,l)}addGlobalEventListener(n,s,l){return this._findPluginFor(s).addGlobalEventListener(n,s,l)}getZone(){return this._zone}_findPluginFor(n){const s=this._eventNameToPlugin.get(n);if(s)return s;const l=this._plugins;for(let d=0;d<l.length;d++){const y=l[d];if(y.supports(n))return this._eventNameToPlugin.set(n,y),y}throw new Error(`No event manager plugin found for event ${n}`)}}return e.\u0275fac=function(n){return new(n||e)(et(O_),et(hi))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();class Yw{constructor(t){this._doc=t}addGlobalEventListener(t,n,s){const l=Cu().getGlobalEventTarget(this._doc,t);if(!l)throw new Error(`Unsupported event target ${l} for event ${n}`);return this.addEventListener(l,n,s)}}let Jw=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(n){const s=new Set;n.forEach(l=>{this._stylesSet.has(l)||(this._stylesSet.add(l),s.add(l))}),this.onStylesAdded(s)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})(),_m=(()=>{class e extends Jw{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,s,l){n.forEach(d=>{const y=this._doc.createElement("style");y.textContent=d,l.push(s.appendChild(y))})}addHost(n){const s=[];this._addStylesToHost(this._stylesSet,n,s),this._hostNodes.set(n,s)}removeHost(n){const s=this._hostNodes.get(n);s&&s.forEach(Qw),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((s,l)=>{this._addStylesToHost(n,l,s)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach(Qw))}}return e.\u0275fac=function(n){return new(n||e)(et(Eo))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();function Qw(e){Cu().remove(e)}const E0={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},C0=/%COMP%/g;function z_(e,t,n){for(let s=0;s<t.length;s++){let l=t[s];Array.isArray(l)?z_(e,l,n):(l=l.replace(C0,e),n.push(l))}return n}function nE(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let T0=(()=>{class e{constructor(n,s,l){this.eventManager=n,this.sharedStylesHost=s,this.appId=l,this.rendererByCompId=new Map,this.defaultRenderer=new D0(n)}createRenderer(n,s){if(!n||!s)return this.defaultRenderer;switch(s.encapsulation){case Oi.Emulated:{let l=this.rendererByCompId.get(s.id);return l||(l=new X2(this.eventManager,this.sharedStylesHost,s,this.appId),this.rendererByCompId.set(s.id,l)),l.applyToHost(n),l}case 1:case Oi.ShadowDom:return new K2(this.eventManager,this.sharedStylesHost,n,s);default:if(!this.rendererByCompId.has(s.id)){const l=z_(s.id,s.styles,[]);this.sharedStylesHost.addStyles(l),this.rendererByCompId.set(s.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(n){return new(n||e)(et(F_),et(_m),et(hm))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();class D0{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?document.createElementNS(E0[n],t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,n){t.appendChild(n)}insertBefore(t,n,s){t&&t.insertBefore(n,s)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let s="string"==typeof t?document.querySelector(t):t;if(!s)throw new Error(`The selector "${t}" did not match any elements`);return n||(s.textContent=""),s}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,s,l){if(l){n=l+":"+n;const d=E0[l];d?t.setAttributeNS(d,n,s):t.setAttribute(n,s)}else t.setAttribute(n,s)}removeAttribute(t,n,s){if(s){const l=E0[s];l?t.removeAttributeNS(l,n):t.removeAttribute(`${s}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,s,l){l&(wi.DashCase|wi.Important)?t.style.setProperty(n,s,l&wi.Important?"important":""):t.style[n]=s}removeStyle(t,n,s){s&wi.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,s){t[n]=s}setValue(t,n){t.nodeValue=n}listen(t,n,s){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,n,nE(s)):this.eventManager.addEventListener(t,n,nE(s))}}class X2 extends D0{constructor(t,n,s,l){super(t),this.component=s;const d=z_(l+"-"+s.id,s.styles,[]);n.addStyles(d),this.contentAttr=function q2(e){return"_ngcontent-%COMP%".replace(C0,e)}(l+"-"+s.id),this.hostAttr=function Z2(e){return"_nghost-%COMP%".replace(C0,e)}(l+"-"+s.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,n){const s=super.createElement(t,n);return super.setAttribute(s,this.contentAttr,""),s}}class K2 extends D0{constructor(t,n,s,l){super(t),this.sharedStylesHost=n,this.hostEl=s,this.shadowRoot=s.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const d=z_(l.id,l.styles,[]);for(let y=0;y<d.length;y++){const w=document.createElement("style");w.textContent=d[y],this.shadowRoot.appendChild(w)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,s){return super.insertBefore(this.nodeOrShadowRoot(t),n,s)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let Y2=(()=>{class e extends Yw{constructor(n){super(n)}supports(n){return!0}addEventListener(n,s,l){return n.addEventListener(s,l,!1),()=>this.removeEventListener(n,s,l)}removeEventListener(n,s,l){return n.removeEventListener(s,l)}}return e.\u0275fac=function(n){return new(n||e)(et(Eo))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();const iE=["alt","control","meta","shift"],Q2={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},oE={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},eA={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let tA=(()=>{class e extends Yw{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,s,l){const d=e.parseEventName(s),y=e.eventCallback(d.fullKey,l,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Cu().onAndCancel(n,d.domEventName,y))}static parseEventName(n){const s=n.toLowerCase().split("."),l=s.shift();if(0===s.length||"keydown"!==l&&"keyup"!==l)return null;const d=e._normalizeKey(s.pop());let y="";if(iE.forEach(D=>{const A=s.indexOf(D);A>-1&&(s.splice(A,1),y+=D+".")}),y+=d,0!=s.length||0===d.length)return null;const w={};return w.domEventName=l,w.fullKey=y,w}static getEventFullKey(n){let s="",l=function nA(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&oE.hasOwnProperty(t)&&(t=oE[t]))}return Q2[t]||t}(n);return l=l.toLowerCase()," "===l?l="space":"."===l&&(l="dot"),iE.forEach(d=>{d!=l&&eA[d](n)&&(s+=d+".")}),s+=l,s}static eventCallback(n,s,l){return d=>{e.getEventFullKey(d)===n&&l.runGuarded(()=>s(d))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return e.\u0275fac=function(n){return new(n||e)(et(Eo))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();const sA=hw(QS,"browser",[{provide:x_,useValue:"browser"},{provide:nw,useValue:function rA(){b0.makeCurrent(),w0.init()},multi:!0},{provide:Eo,useFactory:function oA(){return function qc(e){Xl=e}(document),document},deps:[]}]),aA=[{provide:S,useValue:"root"},{provide:uu,useFactory:function iA(){return new uu},deps:[]},{provide:O_,useClass:Y2,multi:!0,deps:[Eo,hi,x_]},{provide:O_,useClass:tA,multi:!0,deps:[Eo]},{provide:T0,useClass:T0,deps:[F_,_m,hm]},{provide:yb,useExisting:T0},{provide:Jw,useExisting:_m},{provide:_m,useClass:_m,deps:[Eo]},{provide:Yv,useClass:Yv,deps:[hi]},{provide:F_,useClass:F_,deps:[O_,hi]},{provide:Xw,useClass:$2,deps:[]}];let lA=(()=>{class e{constructor(n){if(n)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(n){return{ngModule:e,providers:[{provide:hm,useValue:n.appId},{provide:Kw,useExisting:hm},V2]}}}return e.\u0275fac=function(n){return new(n||e)(et(e,12))},e.\u0275mod=Ro({type:e}),e.\u0275inj=mi({providers:aA,imports:[P2,sI]}),e})();"undefined"!=typeof window&&window;let lE=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Tt({token:e,factory:function(n){let s=null;return s=n?new(n||e):et(cE),s},providedIn:"root"}),e})(),cE=(()=>{class e extends lE{constructor(n){super(),this._doc=n}sanitize(n,s){if(null==s)return null;switch(n){case Fn.NONE:return s;case Fn.HTML:return js(s,"HTML")?eo(s):af(this._doc,String(s)).toString();case Fn.STYLE:return js(s,"Style")?eo(s):s;case Fn.SCRIPT:if(js(s,"Script"))return eo(s);throw new Error("unsafe value used in a script context");case Fn.URL:return rg(s),js(s,"URL")?eo(s):dh(String(s));case Fn.RESOURCE_URL:if(js(s,"ResourceURL"))return eo(s);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${n} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(n){return function ig(e){return new vy(e)}(n)}bypassSecurityTrustStyle(n){return function tf(e){return new ef(e)}(n)}bypassSecurityTrustScript(n){return function og(e){return new hs(e)}(n)}bypassSecurityTrustUrl(n){return function nf(e){return new ng(e)}(n)}bypassSecurityTrustResourceUrl(n){return function dl(e){return new xy(e)}(n)}}return e.\u0275fac=function(n){return new(n||e)(et(Eo))},e.\u0275prov=Tt({token:e,factory:function(n){let s=null;return s=n?new n:function yA(e){return new cE(e.get(Eo))}(et(We)),s},providedIn:"root"}),e})();function Wt(...e){return hn(e,ot(e))}class Na extends Gi{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:s}=this;if(t)throw n;return this._throwIfClosed(),s}next(t){super.next(this._value=t)}}const{isArray:vA}=Array,{getPrototypeOf:xA,prototype:bA,keys:wA}=Object;const{isArray:TA}=Array;function IA(...e){const t=ot(e),n=function Fe(e){return $n(Ae(e))?e.pop():void 0}(e),{args:s,keys:l}=function EA(e){if(1===e.length){const t=e[0];if(vA(t))return{args:t,keys:null};if(function CA(e){return e&&"object"==typeof e&&xA(e)===bA}(t)){const n=wA(t);return{args:n.map(s=>t[s]),keys:n}}}return{args:e,keys:null}}(e);if(0===s.length)return hn([],t);const d=new sn(function AA(e,t,n=$i){return s=>{uE(t,()=>{const{length:l}=e,d=new Array(l);let y=l,w=l;for(let D=0;D<l;D++)uE(t,()=>{const A=hn(e[D],t);let F=!1;A.subscribe(new Jn(s,j=>{d[D]=j,F||(F=!0,w--),w||s.next(n(d.slice()))},()=>{--y||s.complete()}))},s)},s)}}(s,t,l?y=>function SA(e,t){return e.reduce((n,s,l)=>(n[s]=t[l],n),{})}(l,y):$i));return n?d.pipe(function MA(e){return Gt(t=>function DA(e,t){return TA(t)?e(...t):e(t)}(e,t))}(n)):d}function uE(e,t,n){e?X(n,e,t):t()}const B_=Au(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function S0(...e){return function PA(){return me(1)}()(hn(e,ot(e)))}function hE(e){return new sn(t=>{yr(e()).subscribe(t)})}function dE(){return _r((e,t)=>{let n=null;e._refCount++;const s=new Jn(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const l=e._connection,d=n;n=null,l&&(!d||l===d)&&l.unsubscribe(),t.unsubscribe()});e.subscribe(s),s.closed||(n=e.connect())})}class kA extends sn{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,Es(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,null==t||t.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Yn;const n=this.getSubject();t.add(this.source.subscribe(new Jn(n,void 0,()=>{this._teardown(),n.complete()},s=>{this._teardown(),n.error(s)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Yn.EMPTY)}return t}refCount(){return dE()(this)}}function Gh(e,t){return _r((n,s)=>{let l=null,d=0,y=!1;const w=()=>y&&!l&&s.complete();n.subscribe(new Jn(s,D=>{null==l||l.unsubscribe();let A=0;const F=d++;yr(e(D,F)).subscribe(l=new Jn(s,j=>s.next(t?t(D,j,F,A++):j),()=>{l=null,w()}))},()=>{y=!0,w()}))})}function LA(e,t,n,s,l){return(d,y)=>{let w=n,D=t,A=0;d.subscribe(new Jn(y,F=>{const j=A++;D=w?e(D,F,j):(w=!0,F),s&&y.next(D)},l&&(()=>{w&&y.next(D),y.complete()})))}}function pE(e,t){return _r(LA(e,t,arguments.length>=2,!0))}function Hh(e,t){return _r((n,s)=>{let l=0;n.subscribe(new Jn(s,d=>e.call(t,d,l++)&&s.next(d)))})}function Du(e){return _r((t,n)=>{let d,s=null,l=!1;s=t.subscribe(new Jn(n,void 0,void 0,y=>{d=yr(e(y,Du(e)(t))),s?(s.unsubscribe(),s=null,d.subscribe(n)):l=!0})),l&&(s.unsubscribe(),s=null,d.subscribe(n))})}function bp(e,t){return $n(t)?se(e,t,1):se(e,1)}function I0(e){return e<=0?()=>de:_r((t,n)=>{let s=[];t.subscribe(new Jn(n,l=>{s.push(l),e<s.length&&s.shift()},()=>{for(const l of s)n.next(l);n.complete()},void 0,()=>{s=null}))})}function fE(e=OA){return _r((t,n)=>{let s=!1;t.subscribe(new Jn(n,l=>{s=!0,n.next(l)},()=>s?n.complete():n.error(e())))})}function OA(){return new B_}function mE(e){return _r((t,n)=>{let s=!1;t.subscribe(new Jn(n,l=>{s=!0,n.next(l)},()=>{s||n.next(e),n.complete()}))})}function wp(e,t){const n=arguments.length>=2;return s=>s.pipe(e?Hh((l,d)=>e(l,d,s)):$i,ta(1),n?mE(t):fE(()=>new B_))}function ys(e,t,n){const s=$n(e)||t||n?{next:e,error:t,complete:n}:e;return s?_r((l,d)=>{var y;null===(y=s.subscribe)||void 0===y||y.call(s);let w=!0;l.subscribe(new Jn(d,D=>{var A;null===(A=s.next)||void 0===A||A.call(s,D),d.next(D)},()=>{var D;w=!1,null===(D=s.complete)||void 0===D||D.call(s),d.complete()},D=>{var A;w=!1,null===(A=s.error)||void 0===A||A.call(s,D),d.error(D)},()=>{var D,A;w&&(null===(D=s.unsubscribe)||void 0===D||D.call(s)),null===(A=s.finalize)||void 0===A||A.call(s)}))}):$i}class Sc{constructor(t,n){this.id=t,this.url=n}}class A0 extends Sc{constructor(t,n,s="imperative",l=null){super(t,n),this.navigationTrigger=s,this.restoredState=l}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class ym extends Sc{constructor(t,n,s){super(t,n),this.urlAfterRedirects=s}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class gE extends Sc{constructor(t,n,s){super(t,n),this.reason=s}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class BA extends Sc{constructor(t,n,s){super(t,n),this.error=s}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class NA extends Sc{constructor(t,n,s,l){super(t,n),this.urlAfterRedirects=s,this.state=l}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class UA extends Sc{constructor(t,n,s,l){super(t,n),this.urlAfterRedirects=s,this.state=l}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class jA extends Sc{constructor(t,n,s,l,d){super(t,n),this.urlAfterRedirects=s,this.state=l,this.shouldActivate=d}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class VA extends Sc{constructor(t,n,s,l){super(t,n),this.urlAfterRedirects=s,this.state=l}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class $A extends Sc{constructor(t,n,s,l){super(t,n),this.urlAfterRedirects=s,this.state=l}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _E{constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class yE{constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class GA{constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class HA{constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class qA{constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ZA{constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class vE{constructor(t,n,s){this.routerEvent=t,this.position=n,this.anchor=s}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const un="primary";class WA{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function Ep(e){return new WA(e)}const xE="ngNavigationCancelingError";function P0(e){const t=Error("NavigationCancelingError: "+e);return t[xE]=!0,t}function KA(e,t,n){const s=n.path.split("/");if(s.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||s.length<e.length))return null;const l={};for(let d=0;d<s.length;d++){const y=s[d],w=e[d];if(y.startsWith(":"))l[y.substring(1)]=w;else if(y!==w.path)return null}return{consumed:e.slice(0,s.length),posParams:l}}function Dl(e,t){const n=e?Object.keys(e):void 0,s=t?Object.keys(t):void 0;if(!n||!s||n.length!=s.length)return!1;let l;for(let d=0;d<n.length;d++)if(l=n[d],!bE(e[l],t[l]))return!1;return!0}function bE(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),s=[...t].sort();return n.every((l,d)=>s[d]===l)}return e===t}function wE(e){return Array.prototype.concat.apply([],e)}function EE(e){return e.length>0?e[e.length-1]:null}function Vi(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function Ml(e){return Kx(e)?e:r_(e)?hn(Promise.resolve(e)):Wt(e)}const QA={exact:function DE(e,t,n){if(!Zh(e.segments,t.segments)||!N_(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const s in t.children)if(!e.children[s]||!DE(e.children[s],t.children[s],n))return!1;return!0},subset:ME},CE={exact:function eP(e,t){return Dl(e,t)},subset:function tP(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>bE(e[n],t[n]))},ignored:()=>!0};function TE(e,t,n){return QA[n.paths](e.root,t.root,n.matrixParams)&&CE[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function ME(e,t,n){return SE(e,t,t.segments,n)}function SE(e,t,n,s){if(e.segments.length>n.length){const l=e.segments.slice(0,n.length);return!(!Zh(l,n)||t.hasChildren()||!N_(l,n,s))}if(e.segments.length===n.length){if(!Zh(e.segments,n)||!N_(e.segments,n,s))return!1;for(const l in t.children)if(!e.children[l]||!ME(e.children[l],t.children[l],s))return!1;return!0}{const l=n.slice(0,e.segments.length),d=n.slice(e.segments.length);return!!(Zh(e.segments,l)&&N_(e.segments,l,s)&&e.children[un])&&SE(e.children[un],t,d,s)}}function N_(e,t,n){return t.every((s,l)=>CE[n](e[l].parameters,s.parameters))}class qh{constructor(t,n,s){this.root=t,this.queryParams=n,this.fragment=s}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ep(this.queryParams)),this._queryParamMap}toString(){return iP.serialize(this)}}class gn{constructor(t,n){this.segments=t,this.children=n,this.parent=null,Vi(n,(s,l)=>s.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return U_(this)}}class vm{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=Ep(this.parameters)),this._parameterMap}toString(){return RE(this)}}function Zh(e,t){return e.length===t.length&&e.every((n,s)=>n.path===t[s].path)}class IE{}class AE{parse(t){const n=new pP(t);return new qh(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${xm(t.root,!0)}`,s=function aP(e){const t=Object.keys(e).map(n=>{const s=e[n];return Array.isArray(s)?s.map(l=>`${j_(n)}=${j_(l)}`).join("&"):`${j_(n)}=${j_(s)}`}).filter(n=>!!n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${s}${"string"==typeof t.fragment?`#${function oP(e){return encodeURI(e)}(t.fragment)}`:""}`}}const iP=new AE;function U_(e){return e.segments.map(t=>RE(t)).join("/")}function xm(e,t){if(!e.hasChildren())return U_(e);if(t){const n=e.children[un]?xm(e.children[un],!1):"",s=[];return Vi(e.children,(l,d)=>{d!==un&&s.push(`${d}:${xm(l,!1)}`)}),s.length>0?`${n}(${s.join("//")})`:n}{const n=function rP(e,t){let n=[];return Vi(e.children,(s,l)=>{l===un&&(n=n.concat(t(s,l)))}),Vi(e.children,(s,l)=>{l!==un&&(n=n.concat(t(s,l)))}),n}(e,(s,l)=>l===un?[xm(e.children[un],!1)]:[`${l}:${xm(s,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[un]?`${U_(e)}/${n[0]}`:`${U_(e)}/(${n.join("//")})`}}function PE(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function j_(e){return PE(e).replace(/%3B/gi,";")}function k0(e){return PE(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function V_(e){return decodeURIComponent(e)}function kE(e){return V_(e.replace(/\+/g,"%20"))}function RE(e){return`${k0(e.path)}${function sP(e){return Object.keys(e).map(t=>`;${k0(t)}=${k0(e[t])}`).join("")}(e.parameters)}`}const lP=/^[^\/()?;=#]+/;function $_(e){const t=e.match(lP);return t?t[0]:""}const cP=/^[^=?&#]+/,hP=/^[^&#]+/;class pP{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new gn([],{}):new gn([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let s={};return this.peekStartsWith("(")&&(s=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(s[un]=new gn(t,n)),s}parseSegment(){const t=$_(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(t),new vm(V_(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=$_(this.remaining);if(!n)return;this.capture(n);let s="";if(this.consumeOptional("=")){const l=$_(this.remaining);l&&(s=l,this.capture(s))}t[V_(n)]=V_(s)}parseQueryParam(t){const n=function uP(e){const t=e.match(cP);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let s="";if(this.consumeOptional("=")){const y=function dP(e){const t=e.match(hP);return t?t[0]:""}(this.remaining);y&&(s=y,this.capture(s))}const l=kE(n),d=kE(s);if(t.hasOwnProperty(l)){let y=t[l];Array.isArray(y)||(y=[y],t[l]=y),y.push(d)}else t[l]=d}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const s=$_(this.remaining),l=this.remaining[s.length];if("/"!==l&&")"!==l&&";"!==l)throw new Error(`Cannot parse url '${this.url}'`);let d;s.indexOf(":")>-1?(d=s.substr(0,s.indexOf(":")),this.capture(d),this.capture(":")):t&&(d=un);const y=this.parseChildren();n[d]=1===Object.keys(y).length?y[un]:new gn([],y),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Error(`Expected "${t}".`)}}class LE{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=R0(t,this._root);return n?n.children.map(s=>s.value):[]}firstChild(t){const n=R0(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=L0(t,this._root);return n.length<2?[]:n[n.length-2].children.map(l=>l.value).filter(l=>l!==t)}pathFromRoot(t){return L0(t,this._root).map(n=>n.value)}}function R0(e,t){if(e===t.value)return t;for(const n of t.children){const s=R0(e,n);if(s)return s}return null}function L0(e,t){if(e===t.value)return[t];for(const n of t.children){const s=L0(e,n);if(s.length)return s.unshift(t),s}return[]}class Ic{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function Cp(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class OE extends LE{constructor(t,n){super(t),this.snapshot=n,O0(this,t)}toString(){return this.snapshot.toString()}}function FE(e,t){const n=function fP(e,t){const y=new G_([],{},{},"",{},un,t,null,e.root,-1,{});return new BE("",new Ic(y,[]))}(e,t),s=new Na([new vm("",{})]),l=new Na({}),d=new Na({}),y=new Na({}),w=new Na(""),D=new Tp(s,l,y,w,d,un,t,n.root);return D.snapshot=n.root,new OE(new Ic(D,[]),n)}class Tp{constructor(t,n,s,l,d,y,w,D){this.url=t,this.params=n,this.queryParams=s,this.fragment=l,this.data=d,this.outlet=y,this.component=w,this._futureSnapshot=D}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Gt(t=>Ep(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Gt(t=>Ep(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function zE(e,t="emptyOnly"){const n=e.pathFromRoot;let s=0;if("always"!==t)for(s=n.length-1;s>=1;){const l=n[s],d=n[s-1];if(l.routeConfig&&""===l.routeConfig.path)s--;else{if(d.component)break;s--}}return function mP(e){return e.reduce((t,n)=>({params:Object.assign(Object.assign({},t.params),n.params),data:Object.assign(Object.assign({},t.data),n.data),resolve:Object.assign(Object.assign({},t.resolve),n._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(s))}class G_{constructor(t,n,s,l,d,y,w,D,A,F,j){this.url=t,this.params=n,this.queryParams=s,this.fragment=l,this.data=d,this.outlet=y,this.component=w,this.routeConfig=D,this._urlSegment=A,this._lastPathIndex=F,this._resolve=j}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Ep(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Ep(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(s=>s.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class BE extends LE{constructor(t,n){super(n),this.url=t,O0(this,n)}toString(){return NE(this._root)}}function O0(e,t){t.value._routerState=e,t.children.forEach(n=>O0(e,n))}function NE(e){const t=e.children.length>0?` { ${e.children.map(NE).join(", ")} } `:"";return`${e.value}${t}`}function F0(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Dl(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),Dl(t.params,n.params)||e.params.next(n.params),function YA(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Dl(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),Dl(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function z0(e,t){const n=Dl(e.params,t.params)&&function nP(e,t){return Zh(e,t)&&e.every((n,s)=>Dl(n.parameters,t[s].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||z0(e.parent,t.parent))}function bm(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const s=n.value;s._futureSnapshot=t.value;const l=function _P(e,t,n){return t.children.map(s=>{for(const l of n.children)if(e.shouldReuseRoute(s.value,l.value.snapshot))return bm(e,s,l);return bm(e,s)})}(e,t,n);return new Ic(s,l)}{if(e.shouldAttach(t.value)){const d=e.retrieve(t.value);if(null!==d){const y=d.route;return y.value._futureSnapshot=t.value,y.children=t.children.map(w=>bm(e,w)),y}}const s=function yP(e){return new Tp(new Na(e.url),new Na(e.params),new Na(e.queryParams),new Na(e.fragment),new Na(e.data),e.outlet,e.component,e)}(t.value),l=t.children.map(d=>bm(e,d));return new Ic(s,l)}}function H_(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function wm(e){return"object"==typeof e&&null!=e&&e.outlets}function B0(e,t,n,s,l){let d={};return s&&Vi(s,(y,w)=>{d[w]=Array.isArray(y)?y.map(D=>`${D}`):`${y}`}),new qh(n.root===e?t:UE(n.root,e,t),d,l)}function UE(e,t,n){const s={};return Vi(e.children,(l,d)=>{s[d]=l===t?n:UE(l,t,n)}),new gn(e.segments,s)}class jE{constructor(t,n,s){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=s,t&&s.length>0&&H_(s[0]))throw new Error("Root segment cannot have matrix parameters");const l=s.find(wm);if(l&&l!==EE(s))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class N0{constructor(t,n,s){this.segmentGroup=t,this.processChildren=n,this.index=s}}function VE(e,t,n){if(e||(e=new gn([],{})),0===e.segments.length&&e.hasChildren())return q_(e,t,n);const s=function CP(e,t,n){let s=0,l=t;const d={match:!1,pathIndex:0,commandIndex:0};for(;l<e.segments.length;){if(s>=n.length)return d;const y=e.segments[l],w=n[s];if(wm(w))break;const D=`${w}`,A=s<n.length-1?n[s+1]:null;if(l>0&&void 0===D)break;if(D&&A&&"object"==typeof A&&void 0===A.outlets){if(!GE(D,A,y))return d;s+=2}else{if(!GE(D,{},y))return d;s++}l++}return{match:!0,pathIndex:l,commandIndex:s}}(e,t,n),l=n.slice(s.commandIndex);if(s.match&&s.pathIndex<e.segments.length){const d=new gn(e.segments.slice(0,s.pathIndex),{});return d.children[un]=new gn(e.segments.slice(s.pathIndex),e.children),q_(d,0,l)}return s.match&&0===l.length?new gn(e.segments,{}):s.match&&!e.hasChildren()?U0(e,t,n):s.match?q_(e,0,l):U0(e,t,n)}function q_(e,t,n){if(0===n.length)return new gn(e.segments,{});{const s=function EP(e){return wm(e[0])?e[0].outlets:{[un]:e}}(n),l={};return Vi(s,(d,y)=>{"string"==typeof d&&(d=[d]),null!==d&&(l[y]=VE(e.children[y],t,d))}),Vi(e.children,(d,y)=>{void 0===s[y]&&(l[y]=d)}),new gn(e.segments,l)}}function U0(e,t,n){const s=e.segments.slice(0,t);let l=0;for(;l<n.length;){const d=n[l];if(wm(d)){const D=TP(d.outlets);return new gn(s,D)}if(0===l&&H_(n[0])){s.push(new vm(e.segments[t].path,$E(n[0]))),l++;continue}const y=wm(d)?d.outlets[un]:`${d}`,w=l<n.length-1?n[l+1]:null;y&&w&&H_(w)?(s.push(new vm(y,$E(w))),l+=2):(s.push(new vm(y,{})),l++)}return new gn(s,{})}function TP(e){const t={};return Vi(e,(n,s)=>{"string"==typeof n&&(n=[n]),null!==n&&(t[s]=U0(new gn([],{}),0,n))}),t}function $E(e){const t={};return Vi(e,(n,s)=>t[s]=`${n}`),t}function GE(e,t,n){return e==n.path&&Dl(t,n.parameters)}class MP{constructor(t,n,s,l){this.routeReuseStrategy=t,this.futureState=n,this.currState=s,this.forwardEvent=l}activate(t){const n=this.futureState._root,s=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,s,t),F0(this.futureState.root),this.activateChildRoutes(n,s,t)}deactivateChildRoutes(t,n,s){const l=Cp(n);t.children.forEach(d=>{const y=d.value.outlet;this.deactivateRoutes(d,l[y],s),delete l[y]}),Vi(l,(d,y)=>{this.deactivateRouteAndItsChildren(d,s)})}deactivateRoutes(t,n,s){const l=t.value,d=n?n.value:null;if(l===d)if(l.component){const y=s.getContext(l.outlet);y&&this.deactivateChildRoutes(t,n,y.children)}else this.deactivateChildRoutes(t,n,s);else d&&this.deactivateRouteAndItsChildren(n,s)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const s=n.getContext(t.value.outlet),l=s&&t.value.component?s.children:n,d=Cp(t);for(const y of Object.keys(d))this.deactivateRouteAndItsChildren(d[y],l);if(s&&s.outlet){const y=s.outlet.detach(),w=s.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:y,route:t,contexts:w})}}deactivateRouteAndOutlet(t,n){const s=n.getContext(t.value.outlet),l=s&&t.value.component?s.children:n,d=Cp(t);for(const y of Object.keys(d))this.deactivateRouteAndItsChildren(d[y],l);s&&s.outlet&&(s.outlet.deactivate(),s.children.onOutletDeactivated(),s.attachRef=null,s.resolver=null,s.route=null)}activateChildRoutes(t,n,s){const l=Cp(n);t.children.forEach(d=>{this.activateRoutes(d,l[d.value.outlet],s),this.forwardEvent(new ZA(d.value.snapshot))}),t.children.length&&this.forwardEvent(new HA(t.value.snapshot))}activateRoutes(t,n,s){const l=t.value,d=n?n.value:null;if(F0(l),l===d)if(l.component){const y=s.getOrCreateContext(l.outlet);this.activateChildRoutes(t,n,y.children)}else this.activateChildRoutes(t,n,s);else if(l.component){const y=s.getOrCreateContext(l.outlet);if(this.routeReuseStrategy.shouldAttach(l.snapshot)){const w=this.routeReuseStrategy.retrieve(l.snapshot);this.routeReuseStrategy.store(l.snapshot,null),y.children.onOutletReAttached(w.contexts),y.attachRef=w.componentRef,y.route=w.route.value,y.outlet&&y.outlet.attach(w.componentRef,w.route.value),F0(w.route.value),this.activateChildRoutes(t,null,y.children)}else{const w=function SP(e){for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(l.snapshot),D=w?w.module.componentFactoryResolver:null;y.attachRef=null,y.route=l,y.resolver=D,y.outlet&&y.outlet.activateWith(l,D),this.activateChildRoutes(t,null,y.children)}}else this.activateChildRoutes(t,null,s)}}class j0{constructor(t,n){this.routes=t,this.module=n}}function Mu(e){return"function"==typeof e}function Wh(e){return e instanceof qh}const Em=Symbol("INITIAL_VALUE");function Cm(){return Gh(e=>IA(e.map(t=>t.pipe(ta(1),function RA(...e){const t=ot(e);return _r((n,s)=>{(t?S0(e,n,t):S0(e,n)).subscribe(s)})}(Em)))).pipe(pE((t,n)=>{let s=!1;return n.reduce((l,d,y)=>l!==Em?l:(d===Em&&(s=!0),s||!1!==d&&y!==n.length-1&&!Wh(d)?l:d),t)},Em),Hh(t=>t!==Em),Gt(t=>Wh(t)?t:!0===t),ta(1)))}class LP{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Tm,this.attachRef=null}}class Tm{constructor(){this.contexts=new Map}onChildOutletCreated(t,n){const s=this.getOrCreateContext(t);s.outlet=n,this.contexts.set(t,s)}onChildOutletDestroyed(t){const n=this.getContext(t);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let n=this.getContext(t);return n||(n=new LP,this.contexts.set(t,n)),n}getContext(t){return this.contexts.get(t)||null}}let HE=(()=>{class e{constructor(n,s,l,d,y){this.parentContexts=n,this.location=s,this.resolver=l,this.changeDetector=y,this.activated=null,this._activatedRoute=null,this.activateEvents=new bo,this.deactivateEvents=new bo,this.attachEvents=new bo,this.detachEvents=new bo,this.name=d||un,n.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const n=this.parentContexts.getContext(this.name);n&&n.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,s){this.activated=n,this._activatedRoute=s,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,s){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=n;const y=(s=s||this.resolver).resolveComponentFactory(n._futureSnapshot.routeConfig.component),w=this.parentContexts.getOrCreateContext(this.name).children,D=new OP(n,w,this.location.injector);this.activated=this.location.createComponent(y,this.location.length,D),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(n){return new(n||e)(_t(Tm),_t(Oa),_t(fp),function al(e){return function Bm(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const s=n.length;let l=0;for(;l<s;){const d=n[l];if(or(d))break;if(0===d)l+=2;else if("number"==typeof d)for(l++;l<s&&"string"==typeof n[l];)l++;else{if(d===t)return n[l+1];l+=2}}}return null}(Hn(),e)}("name"),_t(e0))},e.\u0275dir=zr({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),e})();class OP{constructor(t,n,s){this.route=t,this.childContexts=n,this.parent=s}get(t,n){return t===Tp?this.route:t===Tm?this.childContexts:this.parent.get(t,n)}}let qE=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Fi({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(n,s){1&n&&Yt(0,"router-outlet")},directives:[HE],encapsulation:2}),e})();function ZE(e,t=""){for(let n=0;n<e.length;n++){const s=e[n];FP(s,zP(t,s))}}function FP(e,t){e.children&&ZE(e.children,t)}function zP(e,t){return t?e||t.path?e&&!t.path?`${e}/`:!e&&t.path?t.path:`${e}/${t.path}`:"":e}function V0(e){const t=e.children&&e.children.map(V0),n=t?Object.assign(Object.assign({},e),{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&n.outlet!==un&&(n.component=qE),n}function Ws(e){return e.outlet||un}function WE(e,t){const n=e.filter(s=>Ws(s)===t);return n.push(...e.filter(s=>Ws(s)!==t)),n}const XE={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function Z_(e,t,n){var s;if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?Object.assign({},XE):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const d=(t.matcher||KA)(n,e,t);if(!d)return Object.assign({},XE);const y={};Vi(d.posParams,(D,A)=>{y[A]=D.path});const w=d.consumed.length>0?Object.assign(Object.assign({},y),d.consumed[d.consumed.length-1].parameters):y;return{matched:!0,consumedSegments:d.consumed,lastChild:d.consumed.length,parameters:w,positionalParamSegments:null!==(s=d.posParams)&&void 0!==s?s:{}}}function W_(e,t,n,s,l="corrected"){if(n.length>0&&function UP(e,t,n){return n.some(s=>X_(e,t,s)&&Ws(s)!==un)}(e,n,s)){const y=new gn(t,function NP(e,t,n,s){const l={};l[un]=s,s._sourceSegment=e,s._segmentIndexShift=t.length;for(const d of n)if(""===d.path&&Ws(d)!==un){const y=new gn([],{});y._sourceSegment=e,y._segmentIndexShift=t.length,l[Ws(d)]=y}return l}(e,t,s,new gn(n,e.children)));return y._sourceSegment=e,y._segmentIndexShift=t.length,{segmentGroup:y,slicedSegments:[]}}if(0===n.length&&function jP(e,t,n){return n.some(s=>X_(e,t,s))}(e,n,s)){const y=new gn(e.segments,function BP(e,t,n,s,l,d){const y={};for(const w of s)if(X_(e,n,w)&&!l[Ws(w)]){const D=new gn([],{});D._sourceSegment=e,D._segmentIndexShift="legacy"===d?e.segments.length:t.length,y[Ws(w)]=D}return Object.assign(Object.assign({},l),y)}(e,t,n,s,e.children,l));return y._sourceSegment=e,y._segmentIndexShift=t.length,{segmentGroup:y,slicedSegments:n}}const d=new gn(e.segments,e.children);return d._sourceSegment=e,d._segmentIndexShift=t.length,{segmentGroup:d,slicedSegments:n}}function X_(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function KE(e,t,n,s){return!!(Ws(e)===s||s!==un&&X_(t,n,e))&&("**"===e.path||Z_(t,e,n).matched)}function YE(e,t,n){return 0===t.length&&!e.children[n]}class Dm{constructor(t){this.segmentGroup=t||null}}class JE{constructor(t){this.urlTree=t}}function K_(e){return new sn(t=>t.error(new Dm(e)))}function QE(e){return new sn(t=>t.error(new JE(e)))}function VP(e){return new sn(t=>t.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${e}'`)))}class HP{constructor(t,n,s,l,d){this.configLoader=n,this.urlSerializer=s,this.urlTree=l,this.config=d,this.allowRedirects=!0,this.ngModule=t.get(Cc)}apply(){const t=W_(this.urlTree.root,[],[],this.config).segmentGroup,n=new gn(t.segments,t.children);return this.expandSegmentGroup(this.ngModule,this.config,n,un).pipe(Gt(d=>this.createUrlTree($0(d),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Du(d=>{if(d instanceof JE)return this.allowRedirects=!1,this.match(d.urlTree);throw d instanceof Dm?this.noMatchError(d):d}))}match(t){return this.expandSegmentGroup(this.ngModule,this.config,t.root,un).pipe(Gt(l=>this.createUrlTree($0(l),t.queryParams,t.fragment))).pipe(Du(l=>{throw l instanceof Dm?this.noMatchError(l):l}))}noMatchError(t){return new Error(`Cannot match any routes. URL Segment: '${t.segmentGroup}'`)}createUrlTree(t,n,s){const l=t.segments.length>0?new gn([],{[un]:t}):t;return new qh(l,n,s)}expandSegmentGroup(t,n,s,l){return 0===s.segments.length&&s.hasChildren()?this.expandChildren(t,n,s).pipe(Gt(d=>new gn([],d))):this.expandSegment(t,s,n,s.segments,l,!0)}expandChildren(t,n,s){const l=[];for(const d of Object.keys(s.children))"primary"===d?l.unshift(d):l.push(d);return hn(l).pipe(bp(d=>{const y=s.children[d],w=WE(n,d);return this.expandSegmentGroup(t,w,y,d).pipe(Gt(D=>({segment:D,outlet:d})))}),pE((d,y)=>(d[y.outlet]=y.segment,d),{}),function FA(e,t){const n=arguments.length>=2;return s=>s.pipe(e?Hh((l,d)=>e(l,d,s)):$i,I0(1),n?mE(t):fE(()=>new B_))}())}expandSegment(t,n,s,l,d,y){return hn(s).pipe(bp(w=>this.expandSegmentAgainstRoute(t,n,s,w,l,d,y).pipe(Du(A=>{if(A instanceof Dm)return Wt(null);throw A}))),wp(w=>!!w),Du((w,D)=>{if(w instanceof B_||"EmptyError"===w.name){if(YE(n,l,d))return Wt(new gn([],{}));throw new Dm(n)}throw w}))}expandSegmentAgainstRoute(t,n,s,l,d,y,w){return KE(l,n,d,y)?void 0===l.redirectTo?this.matchSegmentAgainstRoute(t,n,l,d,y):w&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,n,s,l,d,y):K_(n):K_(n)}expandSegmentAgainstRouteUsingRedirect(t,n,s,l,d,y){return"**"===l.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,s,l,y):this.expandRegularSegmentAgainstRouteUsingRedirect(t,n,s,l,d,y)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,s,l){const d=this.applyRedirectCommands([],s.redirectTo,{});return s.redirectTo.startsWith("/")?QE(d):this.lineralizeSegments(s,d).pipe(se(y=>{const w=new gn(y,{});return this.expandSegment(t,w,n,y,l,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,n,s,l,d,y){const{matched:w,consumedSegments:D,lastChild:A,positionalParamSegments:F}=Z_(n,l,d);if(!w)return K_(n);const j=this.applyRedirectCommands(D,l.redirectTo,F);return l.redirectTo.startsWith("/")?QE(j):this.lineralizeSegments(l,j).pipe(se(Y=>this.expandSegment(t,n,s,Y.concat(d.slice(A)),y,!1)))}matchSegmentAgainstRoute(t,n,s,l,d){if("**"===s.path)return s.loadChildren?(s._loadedConfig?Wt(s._loadedConfig):this.configLoader.load(t.injector,s)).pipe(Gt(Y=>(s._loadedConfig=Y,new gn(l,{})))):Wt(new gn(l,{}));const{matched:y,consumedSegments:w,lastChild:D}=Z_(n,s,l);if(!y)return K_(n);const A=l.slice(D);return this.getChildConfig(t,s,l).pipe(se(j=>{const Y=j.module,te=j.routes,{segmentGroup:ge,slicedSegments:Ie}=W_(n,w,A,te),Ve=new gn(ge.segments,ge.children);if(0===Ie.length&&Ve.hasChildren())return this.expandChildren(Y,te,Ve).pipe(Gt(st=>new gn(w,st)));if(0===te.length&&0===Ie.length)return Wt(new gn(w,{}));const $e=Ws(s)===d;return this.expandSegment(Y,Ve,te,Ie,$e?un:d,!0).pipe(Gt(at=>new gn(w.concat(at.segments),at.children)))}))}getChildConfig(t,n,s){return n.children?Wt(new j0(n.children,t)):n.loadChildren?void 0!==n._loadedConfig?Wt(n._loadedConfig):this.runCanLoadGuards(t.injector,n,s).pipe(se(l=>l?this.configLoader.load(t.injector,n).pipe(Gt(d=>(n._loadedConfig=d,d))):function $P(e){return new sn(t=>t.error(P0(`Cannot load children because the guard of the route "path: '${e.path}'" returned false`)))}(n))):Wt(new j0([],t))}runCanLoadGuards(t,n,s){const l=n.canLoad;return l&&0!==l.length?Wt(l.map(y=>{const w=t.get(y);let D;if(function AP(e){return e&&Mu(e.canLoad)}(w))D=w.canLoad(n,s);else{if(!Mu(w))throw new Error("Invalid CanLoad guard");D=w(n,s)}return Ml(D)})).pipe(Cm(),ys(y=>{if(!Wh(y))return;const w=P0(`Redirecting to "${this.urlSerializer.serialize(y)}"`);throw w.url=y,w}),Gt(y=>!0===y)):Wt(!0)}lineralizeSegments(t,n){let s=[],l=n.root;for(;;){if(s=s.concat(l.segments),0===l.numberOfChildren)return Wt(s);if(l.numberOfChildren>1||!l.children[un])return VP(t.redirectTo);l=l.children[un]}}applyRedirectCommands(t,n,s){return this.applyRedirectCreatreUrlTree(n,this.urlSerializer.parse(n),t,s)}applyRedirectCreatreUrlTree(t,n,s,l){const d=this.createSegmentGroup(t,n.root,s,l);return new qh(d,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const s={};return Vi(t,(l,d)=>{if("string"==typeof l&&l.startsWith(":")){const w=l.substring(1);s[d]=n[w]}else s[d]=l}),s}createSegmentGroup(t,n,s,l){const d=this.createSegments(t,n.segments,s,l);let y={};return Vi(n.children,(w,D)=>{y[D]=this.createSegmentGroup(t,w,s,l)}),new gn(d,y)}createSegments(t,n,s,l){return n.map(d=>d.path.startsWith(":")?this.findPosParam(t,d,l):this.findOrReturn(d,s))}findPosParam(t,n,s){const l=s[n.path.substring(1)];if(!l)throw new Error(`Cannot redirect to '${t}'. Cannot find '${n.path}'.`);return l}findOrReturn(t,n){let s=0;for(const l of n){if(l.path===t.path)return n.splice(s),l;s++}return t}}function $0(e){const t={};for(const s of Object.keys(e.children)){const d=$0(e.children[s]);(d.segments.length>0||d.hasChildren())&&(t[s]=d)}return function qP(e){if(1===e.numberOfChildren&&e.children[un]){const t=e.children[un];return new gn(e.segments.concat(t.segments),t.children)}return e}(new gn(e.segments,t))}class eC{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class Y_{constructor(t,n){this.component=t,this.route=n}}function WP(e,t,n){const s=e._root;return Mm(s,t?t._root:null,n,[s.value])}function J_(e,t,n){const s=function KP(e){if(!e)return null;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(t);return(s?s.module.injector:n).get(e)}function Mm(e,t,n,s,l={canDeactivateChecks:[],canActivateChecks:[]}){const d=Cp(t);return e.children.forEach(y=>{(function YP(e,t,n,s,l={canDeactivateChecks:[],canActivateChecks:[]}){const d=e.value,y=t?t.value:null,w=n?n.getContext(e.value.outlet):null;if(y&&d.routeConfig===y.routeConfig){const D=function JP(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!Zh(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Zh(e.url,t.url)||!Dl(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!z0(e,t)||!Dl(e.queryParams,t.queryParams);default:return!z0(e,t)}}(y,d,d.routeConfig.runGuardsAndResolvers);D?l.canActivateChecks.push(new eC(s)):(d.data=y.data,d._resolvedData=y._resolvedData),Mm(e,t,d.component?w?w.children:null:n,s,l),D&&w&&w.outlet&&w.outlet.isActivated&&l.canDeactivateChecks.push(new Y_(w.outlet.component,y))}else y&&Sm(t,w,l),l.canActivateChecks.push(new eC(s)),Mm(e,null,d.component?w?w.children:null:n,s,l)})(y,d[y.value.outlet],n,s.concat([y.value]),l),delete d[y.value.outlet]}),Vi(d,(y,w)=>Sm(y,n.getContext(w),l)),l}function Sm(e,t,n){const s=Cp(e),l=e.value;Vi(s,(d,y)=>{Sm(d,l.component?t?t.children.getContext(y):null:t,n)}),n.canDeactivateChecks.push(new Y_(l.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,l))}class ak{}function tC(e){return new sn(t=>t.error(e))}class ck{constructor(t,n,s,l,d,y){this.rootComponentType=t,this.config=n,this.urlTree=s,this.url=l,this.paramsInheritanceStrategy=d,this.relativeLinkResolution=y}recognize(){const t=W_(this.urlTree.root,[],[],this.config.filter(y=>void 0===y.redirectTo),this.relativeLinkResolution).segmentGroup,n=this.processSegmentGroup(this.config,t,un);if(null===n)return null;const s=new G_([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},un,this.rootComponentType,null,this.urlTree.root,-1,{}),l=new Ic(s,n),d=new BE(this.url,l);return this.inheritParamsAndData(d._root),d}inheritParamsAndData(t){const n=t.value,s=zE(n,this.paramsInheritanceStrategy);n.params=Object.freeze(s.params),n.data=Object.freeze(s.data),t.children.forEach(l=>this.inheritParamsAndData(l))}processSegmentGroup(t,n,s){return 0===n.segments.length&&n.hasChildren()?this.processChildren(t,n):this.processSegment(t,n,n.segments,s)}processChildren(t,n){const s=[];for(const d of Object.keys(n.children)){const y=n.children[d],w=WE(t,d),D=this.processSegmentGroup(w,y,d);if(null===D)return null;s.push(...D)}const l=nC(s);return function uk(e){e.sort((t,n)=>t.value.outlet===un?-1:n.value.outlet===un?1:t.value.outlet.localeCompare(n.value.outlet))}(l),l}processSegment(t,n,s,l){for(const d of t){const y=this.processSegmentAgainstRoute(d,n,s,l);if(null!==y)return y}return YE(n,s,l)?[]:null}processSegmentAgainstRoute(t,n,s,l){if(t.redirectTo||!KE(t,n,s,l))return null;let d,y=[],w=[];if("**"===t.path){const te=s.length>0?EE(s).parameters:{};d=new G_(s,te,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,oC(t),Ws(t),t.component,t,rC(n),iC(n)+s.length,sC(t))}else{const te=Z_(n,t,s);if(!te.matched)return null;y=te.consumedSegments,w=s.slice(te.lastChild),d=new G_(y,te.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,oC(t),Ws(t),t.component,t,rC(n),iC(n)+y.length,sC(t))}const D=function hk(e){return e.children?e.children:e.loadChildren?e._loadedConfig.routes:[]}(t),{segmentGroup:A,slicedSegments:F}=W_(n,y,w,D.filter(te=>void 0===te.redirectTo),this.relativeLinkResolution);if(0===F.length&&A.hasChildren()){const te=this.processChildren(D,A);return null===te?null:[new Ic(d,te)]}if(0===D.length&&0===F.length)return[new Ic(d,[])];const j=Ws(t)===l,Y=this.processSegment(D,A,F,j?un:l);return null===Y?null:[new Ic(d,Y)]}}function dk(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function nC(e){const t=[],n=new Set;for(const s of e){if(!dk(s)){t.push(s);continue}const l=t.find(d=>s.value.routeConfig===d.value.routeConfig);void 0!==l?(l.children.push(...s.children),n.add(l)):t.push(s)}for(const s of n){const l=nC(s.children);t.push(new Ic(s.value,l))}return t.filter(s=>!n.has(s))}function rC(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function iC(e){let t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift?t._segmentIndexShift:0;return n-1}function oC(e){return e.data||{}}function sC(e){return e.resolve||{}}function aC(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function G0(e){return Gh(t=>{const n=e(t);return n?hn(n).pipe(Gt(()=>t)):Wt(t)})}class xk extends class vk{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}{}const H0=new en("ROUTES");class lC{constructor(t,n,s,l){this.injector=t,this.compiler=n,this.onLoadStartListener=s,this.onLoadEndListener=l}load(t,n){if(n._loader$)return n._loader$;this.onLoadStartListener&&this.onLoadStartListener(n);const l=this.loadModuleFactory(n.loadChildren).pipe(Gt(d=>{this.onLoadEndListener&&this.onLoadEndListener(n);const y=d.create(t);return new j0(wE(y.injector.get(H0,void 0,Mt.Self|Mt.Optional)).map(V0),y)}),Du(d=>{throw n._loader$=void 0,d}));return n._loader$=new kA(l,()=>new Gi).pipe(dE()),n._loader$}loadModuleFactory(t){return Ml(t()).pipe(se(n=>n instanceof bb?Wt(n):hn(this.compiler.compileModuleAsync(n))))}}class wk{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,n){return t}}function Ek(e){throw e}function Ck(e,t,n){return t.parse("/")}function cC(e,t){return Wt(null)}const Tk={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Dk={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let vs=(()=>{class e{constructor(n,s,l,d,y,w,D){this.rootComponentType=n,this.urlSerializer=s,this.rootContexts=l,this.location=d,this.config=D,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Gi,this.errorHandler=Ek,this.malformedUriErrorHandler=Ck,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:cC,afterPreactivation:cC},this.urlHandlingStrategy=new wk,this.routeReuseStrategy=new xk,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=y.get(Cc),this.console=y.get(iw);const j=y.get(hi);this.isNgZoneEnabled=j instanceof hi&&hi.isInAngularZone(),this.resetConfig(D),this.currentUrlTree=function JA(){return new qh(new gn([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new lC(y,w,Y=>this.triggerEvent(new _E(Y)),Y=>this.triggerEvent(new yE(Y))),this.routerState=FE(this.currentUrlTree,this.rootComponentType),this.transitions=new Na({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var n;return null===(n=this.location.getState())||void 0===n?void 0:n.\u0275routerPageId}setupNavigations(n){const s=this.events;return n.pipe(Hh(l=>0!==l.id),Gt(l=>Object.assign(Object.assign({},l),{extractedUrl:this.urlHandlingStrategy.extract(l.rawUrl)})),Gh(l=>{let d=!1,y=!1;return Wt(l).pipe(ys(w=>{this.currentNavigation={id:w.id,initialUrl:w.currentRawUrl,extractedUrl:w.extractedUrl,trigger:w.source,extras:w.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Gh(w=>{const D=this.browserUrlTree.toString(),A=!this.navigated||w.extractedUrl.toString()!==D||D!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||A)&&this.urlHandlingStrategy.shouldProcessUrl(w.rawUrl))return Q_(w.source)&&(this.browserUrlTree=w.extractedUrl),Wt(w).pipe(Gh(j=>{const Y=this.transitions.getValue();return s.next(new A0(j.id,this.serializeUrl(j.extractedUrl),j.source,j.restoredState)),Y!==this.transitions.getValue()?de:Promise.resolve(j)}),function ZP(e,t,n,s){return Gh(l=>function GP(e,t,n,s,l){return new HP(e,t,n,s,l).apply()}(e,t,n,l.extractedUrl,s).pipe(Gt(d=>Object.assign(Object.assign({},l),{urlAfterRedirects:d}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),ys(j=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:j.urlAfterRedirects})}),function pk(e,t,n,s,l){return se(d=>function lk(e,t,n,s,l="emptyOnly",d="legacy"){try{const y=new ck(e,t,n,s,l,d).recognize();return null===y?tC(new ak):Wt(y)}catch(y){return tC(y)}}(e,t,d.urlAfterRedirects,n(d.urlAfterRedirects),s,l).pipe(Gt(y=>Object.assign(Object.assign({},d),{targetSnapshot:y}))))}(this.rootComponentType,this.config,j=>this.serializeUrl(j),this.paramsInheritanceStrategy,this.relativeLinkResolution),ys(j=>{if("eager"===this.urlUpdateStrategy){if(!j.extras.skipLocationChange){const te=this.urlHandlingStrategy.merge(j.urlAfterRedirects,j.rawUrl);this.setBrowserUrl(te,j)}this.browserUrlTree=j.urlAfterRedirects}const Y=new NA(j.id,this.serializeUrl(j.extractedUrl),this.serializeUrl(j.urlAfterRedirects),j.targetSnapshot);s.next(Y)}));if(A&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:Y,extractedUrl:te,source:ge,restoredState:Ie,extras:Ve}=w,$e=new A0(Y,this.serializeUrl(te),ge,Ie);s.next($e);const Ce=FE(te,this.rootComponentType).snapshot;return Wt(Object.assign(Object.assign({},w),{targetSnapshot:Ce,urlAfterRedirects:te,extras:Object.assign(Object.assign({},Ve),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=w.rawUrl,w.resolve(null),de}),G0(w=>{const{targetSnapshot:D,id:A,extractedUrl:F,rawUrl:j,extras:{skipLocationChange:Y,replaceUrl:te}}=w;return this.hooks.beforePreactivation(D,{navigationId:A,appliedUrlTree:F,rawUrlTree:j,skipLocationChange:!!Y,replaceUrl:!!te})}),ys(w=>{const D=new UA(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot);this.triggerEvent(D)}),Gt(w=>Object.assign(Object.assign({},w),{guards:WP(w.targetSnapshot,w.currentSnapshot,this.rootContexts)})),function QP(e,t){return se(n=>{const{targetSnapshot:s,currentSnapshot:l,guards:{canActivateChecks:d,canDeactivateChecks:y}}=n;return 0===y.length&&0===d.length?Wt(Object.assign(Object.assign({},n),{guardsResult:!0})):function ek(e,t,n,s){return hn(e).pipe(se(l=>function sk(e,t,n,s,l){const d=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return d&&0!==d.length?Wt(d.map(w=>{const D=J_(w,t,l);let A;if(function RP(e){return e&&Mu(e.canDeactivate)}(D))A=Ml(D.canDeactivate(e,t,n,s));else{if(!Mu(D))throw new Error("Invalid CanDeactivate guard");A=Ml(D(e,t,n,s))}return A.pipe(wp())})).pipe(Cm()):Wt(!0)}(l.component,l.route,n,t,s)),wp(l=>!0!==l,!0))}(y,s,l,e).pipe(se(w=>w&&function IP(e){return"boolean"==typeof e}(w)?function tk(e,t,n,s){return hn(t).pipe(bp(l=>S0(function rk(e,t){return null!==e&&t&&t(new GA(e)),Wt(!0)}(l.route.parent,s),function nk(e,t){return null!==e&&t&&t(new qA(e)),Wt(!0)}(l.route,s),function ok(e,t,n){const s=t[t.length-1],d=t.slice(0,t.length-1).reverse().map(y=>function XP(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(y)).filter(y=>null!==y).map(y=>hE(()=>Wt(y.guards.map(D=>{const A=J_(D,y.node,n);let F;if(function kP(e){return e&&Mu(e.canActivateChild)}(A))F=Ml(A.canActivateChild(s,e));else{if(!Mu(A))throw new Error("Invalid CanActivateChild guard");F=Ml(A(s,e))}return F.pipe(wp())})).pipe(Cm())));return Wt(d).pipe(Cm())}(e,l.path,n),function ik(e,t,n){const s=t.routeConfig?t.routeConfig.canActivate:null;if(!s||0===s.length)return Wt(!0);const l=s.map(d=>hE(()=>{const y=J_(d,t,n);let w;if(function PP(e){return e&&Mu(e.canActivate)}(y))w=Ml(y.canActivate(t,e));else{if(!Mu(y))throw new Error("Invalid CanActivate guard");w=Ml(y(t,e))}return w.pipe(wp())}));return Wt(l).pipe(Cm())}(e,l.route,n))),wp(l=>!0!==l,!0))}(s,d,e,t):Wt(w)),Gt(w=>Object.assign(Object.assign({},n),{guardsResult:w})))})}(this.ngModule.injector,w=>this.triggerEvent(w)),ys(w=>{if(Wh(w.guardsResult)){const A=P0(`Redirecting to "${this.serializeUrl(w.guardsResult)}"`);throw A.url=w.guardsResult,A}const D=new jA(w.id,this.serializeUrl(w.extractedUrl),this.serializeUrl(w.urlAfterRedirects),w.targetSnapshot,!!w.guardsResult);this.triggerEvent(D)}),Hh(w=>!!w.guardsResult||(this.restoreHistory(w),this.cancelNavigationTransition(w,""),!1)),G0(w=>{if(w.guards.canActivateChecks.length)return Wt(w).pipe(ys(D=>{const A=new VA(D.id,this.serializeUrl(D.extractedUrl),this.serializeUrl(D.urlAfterRedirects),D.targetSnapshot);this.triggerEvent(A)}),Gh(D=>{let A=!1;return Wt(D).pipe(function fk(e,t){return se(n=>{const{targetSnapshot:s,guards:{canActivateChecks:l}}=n;if(!l.length)return Wt(n);let d=0;return hn(l).pipe(bp(y=>function mk(e,t,n,s){return function gk(e,t,n,s){const l=aC(e);if(0===l.length)return Wt({});const d={};return hn(l).pipe(se(y=>function _k(e,t,n,s){const l=J_(e,t,s);return Ml(l.resolve?l.resolve(t,n):l(t,n))}(e[y],t,n,s).pipe(ys(w=>{d[y]=w}))),I0(1),se(()=>aC(d).length===l.length?Wt(d):de))}(e._resolve,e,t,s).pipe(Gt(d=>(e._resolvedData=d,e.data=Object.assign(Object.assign({},e.data),zE(e,n).resolve),null)))}(y.route,s,e,t)),ys(()=>d++),I0(1),se(y=>d===l.length?Wt(n):de))})}(this.paramsInheritanceStrategy,this.ngModule.injector),ys({next:()=>A=!0,complete:()=>{A||(this.restoreHistory(D),this.cancelNavigationTransition(D,"At least one route resolver didn't emit any value."))}}))}),ys(D=>{const A=new $A(D.id,this.serializeUrl(D.extractedUrl),this.serializeUrl(D.urlAfterRedirects),D.targetSnapshot);this.triggerEvent(A)}))}),G0(w=>{const{targetSnapshot:D,id:A,extractedUrl:F,rawUrl:j,extras:{skipLocationChange:Y,replaceUrl:te}}=w;return this.hooks.afterPreactivation(D,{navigationId:A,appliedUrlTree:F,rawUrlTree:j,skipLocationChange:!!Y,replaceUrl:!!te})}),Gt(w=>{const D=function gP(e,t,n){const s=bm(e,t._root,n?n._root:void 0);return new OE(s,t)}(this.routeReuseStrategy,w.targetSnapshot,w.currentRouterState);return Object.assign(Object.assign({},w),{targetRouterState:D})}),ys(w=>{this.currentUrlTree=w.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(w.urlAfterRedirects,w.rawUrl),this.routerState=w.targetRouterState,"deferred"===this.urlUpdateStrategy&&(w.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,w),this.browserUrlTree=w.urlAfterRedirects)}),((e,t,n)=>Gt(s=>(new MP(t,s.targetRouterState,s.currentRouterState,n).activate(e),s)))(this.rootContexts,this.routeReuseStrategy,w=>this.triggerEvent(w)),ys({next(){d=!0},complete(){d=!0}}),function zA(e){return _r((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}(()=>{var w;d||y||this.cancelNavigationTransition(l,`Navigation ID ${l.id} is not equal to the current navigation id ${this.navigationId}`),(null===(w=this.currentNavigation)||void 0===w?void 0:w.id)===l.id&&(this.currentNavigation=null)}),Du(w=>{if(y=!0,function XA(e){return e&&e[xE]}(w)){const D=Wh(w.url);D||(this.navigated=!0,this.restoreHistory(l,!0));const A=new gE(l.id,this.serializeUrl(l.extractedUrl),w.message);s.next(A),D?setTimeout(()=>{const F=this.urlHandlingStrategy.merge(w.url,this.rawUrlTree),j={skipLocationChange:l.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Q_(l.source)};this.scheduleNavigation(F,"imperative",null,j,{resolve:l.resolve,reject:l.reject,promise:l.promise})},0):l.resolve(!1)}else{this.restoreHistory(l,!0);const D=new BA(l.id,this.serializeUrl(l.extractedUrl),w);s.next(D);try{l.resolve(this.errorHandler(w))}catch(A){l.reject(A)}}return de}))}))}resetRootComponentType(n){this.rootComponentType=n,this.routerState.root.component=this.rootComponentType}setTransition(n){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),n))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const s="popstate"===n.type?"popstate":"hashchange";"popstate"===s&&setTimeout(()=>{var l;const d={replaceUrl:!0},y=(null===(l=n.state)||void 0===l?void 0:l.navigationId)?n.state:null;if(y){const D=Object.assign({},y);delete D.navigationId,delete D.\u0275routerPageId,0!==Object.keys(D).length&&(d.state=D)}const w=this.parseUrl(n.url);this.scheduleNavigation(w,s,y,d)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(n){this.events.next(n)}resetConfig(n){ZE(n),this.config=n.map(V0),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,s={}){const{relativeTo:l,queryParams:d,fragment:y,queryParamsHandling:w,preserveFragment:D}=s,A=l||this.routerState.root,F=D?this.currentUrlTree.fragment:y;let j=null;switch(w){case"merge":j=Object.assign(Object.assign({},this.currentUrlTree.queryParams),d);break;case"preserve":j=this.currentUrlTree.queryParams;break;default:j=d||null}return null!==j&&(j=this.removeEmptyProps(j)),function vP(e,t,n,s,l){if(0===n.length)return B0(t.root,t.root,t,s,l);const d=function xP(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new jE(!0,0,e);let t=0,n=!1;const s=e.reduce((l,d,y)=>{if("object"==typeof d&&null!=d){if(d.outlets){const w={};return Vi(d.outlets,(D,A)=>{w[A]="string"==typeof D?D.split("/"):D}),[...l,{outlets:w}]}if(d.segmentPath)return[...l,d.segmentPath]}return"string"!=typeof d?[...l,d]:0===y?(d.split("/").forEach((w,D)=>{0==D&&"."===w||(0==D&&""===w?n=!0:".."===w?t++:""!=w&&l.push(w))}),l):[...l,d]},[]);return new jE(n,t,s)}(n);if(d.toRoot())return B0(t.root,new gn([],{}),t,s,l);const y=function bP(e,t,n){if(e.isAbsolute)return new N0(t.root,!0,0);if(-1===n.snapshot._lastPathIndex){const d=n.snapshot._urlSegment;return new N0(d,d===t.root,0)}const s=H_(e.commands[0])?0:1;return function wP(e,t,n){let s=e,l=t,d=n;for(;d>l;){if(d-=l,s=s.parent,!s)throw new Error("Invalid number of '../'");l=s.segments.length}return new N0(s,!1,l-d)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+s,e.numberOfDoubleDots)}(d,t,e),w=y.processChildren?q_(y.segmentGroup,y.index,d.commands):VE(y.segmentGroup,y.index,d.commands);return B0(y.segmentGroup,w,t,s,l)}(A,this.currentUrlTree,n,j,null!=F?F:null)}navigateByUrl(n,s={skipLocationChange:!1}){const l=Wh(n)?n:this.parseUrl(n),d=this.urlHandlingStrategy.merge(l,this.rawUrlTree);return this.scheduleNavigation(d,"imperative",null,s)}navigate(n,s={skipLocationChange:!1}){return function Mk(e){for(let t=0;t<e.length;t++){const n=e[t];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${t}`)}}(n),this.navigateByUrl(this.createUrlTree(n,s),s)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let s;try{s=this.urlSerializer.parse(n)}catch(l){s=this.malformedUriErrorHandler(l,this.urlSerializer,n)}return s}isActive(n,s){let l;if(l=!0===s?Object.assign({},Tk):!1===s?Object.assign({},Dk):s,Wh(n))return TE(this.currentUrlTree,n,l);const d=this.parseUrl(n);return TE(this.currentUrlTree,d,l)}removeEmptyProps(n){return Object.keys(n).reduce((s,l)=>{const d=n[l];return null!=d&&(s[l]=d),s},{})}processNavigations(){this.navigations.subscribe(n=>{this.navigated=!0,this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId,this.events.next(new ym(n.id,this.serializeUrl(n.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,n.resolve(!0)},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}scheduleNavigation(n,s,l,d,y){var w,D,A;if(this.disposed)return Promise.resolve(!1);const F=this.transitions.value,j=Q_(s)&&F&&!Q_(F.source),Y=F.rawUrl.toString()===n.toString(),te=F.id===(null===(w=this.currentNavigation)||void 0===w?void 0:w.id);if(j&&Y&&te)return Promise.resolve(!0);let Ie,Ve,$e;y?(Ie=y.resolve,Ve=y.reject,$e=y.promise):$e=new Promise((st,pn)=>{Ie=st,Ve=pn});const Ce=++this.navigationId;let at;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(l=this.location.getState()),at=l&&l.\u0275routerPageId?l.\u0275routerPageId:d.replaceUrl||d.skipLocationChange?null!==(D=this.browserPageId)&&void 0!==D?D:0:(null!==(A=this.browserPageId)&&void 0!==A?A:0)+1):at=0,this.setTransition({id:Ce,targetPageId:at,source:s,restoredState:l,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:n,extras:d,resolve:Ie,reject:Ve,promise:$e,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),$e.catch(st=>Promise.reject(st))}setBrowserUrl(n,s){const l=this.urlSerializer.serialize(n),d=Object.assign(Object.assign({},s.extras.state),this.generateNgRouterState(s.id,s.targetPageId));this.location.isCurrentPathEqualTo(l)||s.extras.replaceUrl?this.location.replaceState(l,"",d):this.location.go(l,"",d)}restoreHistory(n,s=!1){var l,d;if("computed"===this.canceledNavigationResolution){const y=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(l=this.currentNavigation)||void 0===l?void 0:l.finalUrl)||0===y?this.currentUrlTree===(null===(d=this.currentNavigation)||void 0===d?void 0:d.finalUrl)&&0===y&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(y)}else"replace"===this.canceledNavigationResolution&&(s&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(n,s){const l=new gE(n.id,this.serializeUrl(n.extractedUrl),s);this.triggerEvent(l),n.resolve(!1)}generateNgRouterState(n,s){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:s}:{navigationId:n}}}return e.\u0275fac=function(n){_v()},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();function Q_(e){return"imperative"!==e}class uC{}class hC{preload(t,n){return Wt(null)}}let dC=(()=>{class e{constructor(n,s,l,d){this.router=n,this.injector=l,this.preloadingStrategy=d,this.loader=new lC(l,s,D=>n.triggerEvent(new _E(D)),D=>n.triggerEvent(new yE(D)))}setUpPreloading(){this.subscription=this.router.events.pipe(Hh(n=>n instanceof ym),bp(()=>this.preload())).subscribe(()=>{})}preload(){const n=this.injector.get(Cc);return this.processRoutes(n,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,s){const l=[];for(const d of s)if(d.loadChildren&&!d.canLoad&&d._loadedConfig){const y=d._loadedConfig;l.push(this.processRoutes(y.module,y.routes))}else d.loadChildren&&!d.canLoad?l.push(this.preloadConfig(n,d)):d.children&&l.push(this.processRoutes(n,d.children));return hn(l).pipe(me(),Gt(d=>{}))}preloadConfig(n,s){return this.preloadingStrategy.preload(s,()=>(s._loadedConfig?Wt(s._loadedConfig):this.loader.load(n.injector,s)).pipe(se(d=>(s._loadedConfig=d,this.processRoutes(d.module,d.routes)))))}}return e.\u0275fac=function(n){return new(n||e)(et(vs),et(b_),et(We),et(uC))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})(),W0=(()=>{class e{constructor(n,s,l={}){this.router=n,this.viewportScroller=s,this.options=l,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},l.scrollPositionRestoration=l.scrollPositionRestoration||"disabled",l.anchorScrolling=l.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(n=>{n instanceof A0?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof ym&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.router.parseUrl(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(n=>{n instanceof vE&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,s){this.router.triggerEvent(new vE(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,s))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return e.\u0275fac=function(n){_v()},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();const Xh=new en("ROUTER_CONFIGURATION"),pC=new en("ROUTER_FORROOT_GUARD"),Pk=[l0,{provide:IE,useClass:AE},{provide:vs,useFactory:function Fk(e,t,n,s,l,d,y={},w,D){const A=new vs(null,e,t,n,s,l,wE(d));return w&&(A.urlHandlingStrategy=w),D&&(A.routeReuseStrategy=D),function zk(e,t){e.errorHandler&&(t.errorHandler=e.errorHandler),e.malformedUriErrorHandler&&(t.malformedUriErrorHandler=e.malformedUriErrorHandler),e.onSameUrlNavigation&&(t.onSameUrlNavigation=e.onSameUrlNavigation),e.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=e.paramsInheritanceStrategy),e.relativeLinkResolution&&(t.relativeLinkResolution=e.relativeLinkResolution),e.urlUpdateStrategy&&(t.urlUpdateStrategy=e.urlUpdateStrategy),e.canceledNavigationResolution&&(t.canceledNavigationResolution=e.canceledNavigationResolution)}(y,A),y.enableTracing&&A.events.subscribe(F=>{var j,Y;null===(j=console.group)||void 0===j||j.call(console,`Router Event: ${F.constructor.name}`),console.log(F.toString()),console.log(F),null===(Y=console.groupEnd)||void 0===Y||Y.call(console)}),A},deps:[IE,Tm,l0,We,b_,H0,Xh,[class bk{},new Pr],[class yk{},new Pr]]},Tm,{provide:Tp,useFactory:function Bk(e){return e.routerState.root},deps:[vs]},dC,hC,class Ak{preload(t,n){return n().pipe(Du(()=>Wt(null)))}},{provide:Xh,useValue:{enableTracing:!1}}];function kk(){return new uw("Router",vs)}let fC=(()=>{class e{constructor(n,s){}static forRoot(n,s){return{ngModule:e,providers:[Pk,mC(n),{provide:pC,useFactory:Ok,deps:[[vs,new Pr,new ai]]},{provide:Xh,useValue:s||{}},{provide:xp,useFactory:Lk,deps:[$h,[new Ns(a0),new Pr],Xh]},{provide:W0,useFactory:Rk,deps:[vs,O2,Xh]},{provide:uC,useExisting:s&&s.preloadingStrategy?s.preloadingStrategy:hC},{provide:uw,multi:!0,useFactory:kk},[X0,{provide:v_,multi:!0,useFactory:Nk,deps:[X0]},{provide:gC,useFactory:Uk,deps:[X0]},{provide:rw,multi:!0,useExisting:gC}]]}}static forChild(n){return{ngModule:e,providers:[mC(n)]}}}return e.\u0275fac=function(n){return new(n||e)(et(pC,8),et(vs,8))},e.\u0275mod=Ro({type:e}),e.\u0275inj=mi({}),e})();function Rk(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new W0(e,t,n)}function Lk(e,t,n={}){return n.useHash?new fI(e,t):new kw(e,t)}function Ok(e){return"guarded"}function mC(e){return[{provide:ul,multi:!0,useValue:e},{provide:H0,multi:!0,useValue:e}]}let X0=(()=>{class e{constructor(n){this.injector=n,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Gi}appInitializer(){return this.injector.get(hI,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let s=null;const l=new Promise(w=>s=w),d=this.injector.get(vs),y=this.injector.get(Xh);return"disabled"===y.initialNavigation?(d.setUpLocationChangeListener(),s(!0)):"enabled"===y.initialNavigation||"enabledBlocking"===y.initialNavigation?(d.hooks.afterPreactivation=()=>this.initNavigation?Wt(null):(this.initNavigation=!0,s(!0),this.resultOfPreactivationDone),d.initialNavigation()):s(!0),l})}bootstrapListener(n){const s=this.injector.get(Xh),l=this.injector.get(dC),d=this.injector.get(W0),y=this.injector.get(vs),w=this.injector.get(dm);n===w.components[0]&&(("enabledNonBlocking"===s.initialNavigation||void 0===s.initialNavigation)&&y.initialNavigation(),l.setUpPreloading(),d.init(),y.resetRootComponentType(w.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return e.\u0275fac=function(n){return new(n||e)(et(We))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();function Nk(e){return e.appInitializer.bind(e)}function Uk(e){return e.bootstrapListener.bind(e)}const gC=new en("Router Initializer"),Vk=[];let $k=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ro({type:e}),e.\u0275inj=mi({imports:[[fC.forRoot(Vk)],fC]}),e})(),Gk=(()=>{class e{constructor(){}hideAPropos(){console.log("Test HideAPropos"),document.getElementById("apropos").classList.remove("active-categorie"),document.getElementById("apropos").classList.add("inactive-categorie"),document.getElementById("btn-apropos").classList.remove("text-selected")}hideAProposMobile(){console.log("Test HideAProposMobile"),document.getElementById("apropos").classList.remove("active-categorie"),document.getElementById("apropos").classList.add("inactive-categorie"),document.getElementById("btn-apropos").classList.remove("text-selected"),document.getElementById("sidebar").classList.remove("inactive"),document.getElementById("sidebar").classList.add("active")}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Fi({type:e,selectors:[["app-apropos"]],decls:71,vars:0,consts:[["id","apropos",1,"inactive-categorie"],[1,"recentre"],["id","close-btn-apropos",1,"close-btn",3,"click"],["id","close-btn-apropos",1,"close-btn-mobile",3,"click"],["src","../../../img/icon-twitter-hov.png","alt","icon twitter",2,"display","none"],["src","../../../img/icon-instagram-hov1.png","alt","icon instagram",2,"display","none"],["src","../../../img/icon-linkedin-hov.png","alt","icon linkedin",2,"display","none"],[1,"titre"],[1,"description"],[1,"span"],[1,"titre1"],[1,"centred","equipe"],[1,"container-box"],[1,"containter-content"],[1,"pp","clement"],[1,"container-nom"],[1,"container-desc"],[1,"container-reseaux"],["target","_blank","href","https://www.instagram.com/cleementcoomte/"],[1,"instagram","box-reseaux"],["target","_blank","href","https://twitter.com/clementcoomte/"],[1,"twitter","box-reseaux"],["target","_blank","href","https://www.linkedin.com/in/cl%C3%A9ment-comte-2445851a4/"],[1,"linkedin","box-reseaux"],[1,"pp","louis"],["target","_blank","href","https://www.instagram.com/ronteahri/"],["target","_blank","href","https://www.twitter.com/ronteahri/"],["target","_blank","href","https://fr.linkedin.com/in/louis-georget/"],[1,"pp","nathan"],["target","_blank","href","https://www.instagram.com/nathlabbe72/"],["target","_blank","href","https://www.linkedin.com/in/nathan-labb%C3%A9-058407200/"],[1,"pp","romain"],["target","_blank","href","https://www.instagram.com/romainlaval2/"],["target","_blank","href","https://www.twitter.com/lavalromain1/"],["target","_blank","href","https://fr.linkedin.com/in/romain-laval-7195b7201/"]],template:function(n,s){1&n&&(ze(0,"div",0),ze(1,"div",1),ze(2,"div",2),Xr("click",function(){return s.hideAPropos()}),Be(),ze(3,"div",3),Xr("click",function(){return s.hideAProposMobile()}),Be(),Yt(4,"img",4),Yt(5,"img",5),Yt(6,"img",6),ze(7,"div",7),Rt(8,"\xc0 PROPOS"),Be(),ze(9,"p",8),ze(10,"span",9),Rt(11,"RadarABeats"),Be(),Rt(12," est un projet d'\xe9tude de 3\xe8me ann\xe9e de licence informatique de l'Universit\xe9 du Mans, d\xe9velopp\xe9 par Cl\xe9ment, Louis, Nathan et Romain... Le projet consiste \xe0 d\xe9velopper une application web avec comme contrainte l'utilisation de diff\xe9rentes APIs. "),Be(),ze(13,"div",10),Rt(14,"\xc9QUIPE"),Be(),Yt(15,"hr"),ze(16,"div",11),ze(17,"div",12),ze(18,"div",13),Yt(19,"div",14),ze(20,"p",15),Rt(21,"Cl\xe9ment C."),Be(),ze(22,"p",16),Rt(23," Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam aliquam dui a aliquam gravida. "),Be(),ze(24,"div",17),ze(25,"a",18),Yt(26,"div",19),Be(),ze(27,"a",20),Yt(28,"div",21),Be(),ze(29,"a",22),Yt(30,"div",23),Be(),Be(),Be(),Be(),ze(31,"div",12),ze(32,"div",13),Yt(33,"div",24),ze(34,"p",15),Rt(35,"Louis G."),Be(),ze(36,"p",16),Rt(37," Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam aliquam dui a aliquam gravida. "),Be(),ze(38,"div",17),ze(39,"a",25),Yt(40,"div",19),Be(),ze(41,"a",26),Yt(42,"div",21),Be(),ze(43,"a",27),Yt(44,"div",23),Be(),Be(),Be(),Be(),ze(45,"div",12),ze(46,"div",13),Yt(47,"div",28),ze(48,"p",15),Rt(49,"Nathan L."),Be(),ze(50,"p",16),Rt(51," Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam aliquam dui a aliquam gravida. "),Be(),ze(52,"div",17),ze(53,"a",29),Yt(54,"div",19),Be(),ze(55,"a",30),Yt(56,"div",23),Be(),Be(),Be(),Be(),ze(57,"div",12),ze(58,"div",13),Yt(59,"div",31),ze(60,"p",15),Rt(61,"Romain L."),Be(),ze(62,"p",16),Rt(63," Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam aliquam dui a aliquam gravida. "),Be(),ze(64,"div",17),ze(65,"a",32),Yt(66,"div",19),Be(),ze(67,"a",33),Yt(68,"div",21),Be(),ze(69,"a",34),Yt(70,"div",23),Be(),Be(),Be(),Be(),Be(),Be(),Be())},styles:["#apropos[_ngcontent-%COMP%]{background:#1C1C1C;color:#e5e4e4;position:absolute;z-index:4000;width:100%;height:100%;transition:.3s;overflow:hidden}.close-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938105617694982154/Cross.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;top:5%;left:95%;margin-bottom:-1%;padding:0;transition:.3s}.close-btn-mobile[_ngcontent-%COMP%]{display:none}.close-btn[_ngcontent-%COMP%]:hover{cursor:pointer}.titre[_ngcontent-%COMP%]{color:#ccc610;font-size:34px;font-weight:600;margin:3% 3% -.5% 23%}.titre1[_ngcontent-%COMP%]{color:#e5e4e4;font-size:28px;font-weight:600;margin:3% 3% -.5% 23%}.pp[_ngcontent-%COMP%]{width:150px;height:150px;margin-left:50%;transform:translate(-51%)}.louis[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/948197446662651924/Louis.png);background-repeat:no-repeat;background-size:cover}.romain[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/948197447283400744/Romain.png);background-repeat:no-repeat;background-size:cover}.nathan[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/948197447006552064/Nathan.png);background-repeat:no-repeat;background-size:cover}.clement[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/948197446226440202/Clement.png);background-repeat:no-repeat;background-size:cover}.container-box[_ngcontent-%COMP%]{width:17%;height:52vh;margin:1%;text-align:center;align-items:center;justify-content:center;display:flex}.container-desc[_ngcontent-%COMP%]{max-width:90%;margin-left:5%}.equipe[_ngcontent-%COMP%]{margin-left:10%}span[_ngcontent-%COMP%]{color:#a91917}.description[_ngcontent-%COMP%]{max-width:70%;margin-left:23%}hr[_ngcontent-%COMP%]{background:#666;max-width:35%;height:1.5px;margin-left:23%;border:none}.container-nom[_ngcontent-%COMP%]{color:#e5e4e4;font-size:18px;font-weight:600}.box-reseaux[_ngcontent-%COMP%]{width:20px;height:20px;display:inline-block;margin:10% 2%}.container-box[_ngcontent-%COMP%]   .instagram[_ngcontent-%COMP%]{background:url(icon-instagram.a9c1761e45ddd1fd.png);background-repeat:no-repeat;background-size:cover}.container-box[_ngcontent-%COMP%]   .instagram[_ngcontent-%COMP%]:hover{background:url(icon-instagram-hov1.3fbea02fe0a8d35d.png);background-repeat:no-repeat;background-size:cover}.container-box[_ngcontent-%COMP%]   .twitter[_ngcontent-%COMP%]{background:url(icon-twitter.a751fa6dee33f089.png);background-repeat:no-repeat;background-size:cover}.container-box[_ngcontent-%COMP%]   .twitter[_ngcontent-%COMP%]:hover{background:url(icon-twitter-hov.7dc9d96b617ae2f8.png);background-repeat:no-repeat;background-size:cover}.container-box[_ngcontent-%COMP%]   .linkedin[_ngcontent-%COMP%]{background:url(icon-linkedin.e11b4441009b4a79.png);background-repeat:no-repeat;background-size:cover}.container-box[_ngcontent-%COMP%]   .linkedin[_ngcontent-%COMP%]:hover{background:url(icon-linkedin-hov.321d516008b43430.png);background-repeat:no-repeat;background-size:cover}.container-reseaux[_ngcontent-%COMP%]{align-items:center;text-align:center}.recentre[_ngcontent-%COMP%]{margin-left:0;margin-top:0}@media screen and (max-width: 415px){#apropos[_ngcontent-%COMP%]{background:#1C1C1C;color:#e5e4e4;position:absolute;z-index:9000;width:100%;height:100%;transition:.3s;overflow:auto;overflow-x:hidden;display:block}.close-btn[_ngcontent-%COMP%]{display:none}.close-btn-mobile[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938105617694982154/Cross.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;top:5%;left:50%;transform:translate(-50%);margin-bottom:15%;padding:0;transition:.3s;display:block}.close-btn-mobile[_ngcontent-%COMP%]:hover{cursor:pointer}.titre[_ngcontent-%COMP%]{color:#ccc610;font-size:28px;font-weight:600;margin:3% 0 -.5%;text-align:center}.titre1[_ngcontent-%COMP%]{color:#e5e4e4;font-size:24px;font-weight:600;margin:10% 0 -.5%;text-align:center}p[_ngcontent-%COMP%]{font-size:12px;line-height:18px;text-align:center;text-justify:auto;width:100%}.description[_ngcontent-%COMP%]{margin-left:50%;transform:translate(-50%)}hr[_ngcontent-%COMP%]{background:#666;max-width:35%;height:1.5px;margin-left:50%;transform:translate(-50%);border:none}.pp[_ngcontent-%COMP%]{width:100px;height:100px;margin-left:50%}.equipe[_ngcontent-%COMP%]{display:inline-table;margin-left:22%}.container-box[_ngcontent-%COMP%]{width:55%;height:42vh;text-align:center;align-items:center;justify-content:center;display:flex}}@media screen and (min-width: 415px) and (max-width: 1440px){#apropos[_ngcontent-%COMP%]{background:#1C1C1C;color:#e5e4e4;position:absolute;z-index:9000;width:100%;height:100%;transition:.3s;overflow:auto;overflow-x:hidden;display:block}.recentre[_ngcontent-%COMP%]{margin-left:-25%;margin-top:3%}}"]}),e})(),Hk=(()=>{class e{constructor(){}hideContacter(){console.log("Test HideContacter"),document.getElementById("contacter").classList.remove("active-categorie"),document.getElementById("contacter").classList.add("inactive-categorie"),document.getElementById("btn-contacter").classList.remove("text-selected")}hideContacterMobile(){console.log("Test HideContacterMobile"),document.getElementById("contacter").classList.remove("active-categorie"),document.getElementById("contacter").classList.add("inactive-categorie"),document.getElementById("btn-contacter").classList.remove("text-selected"),document.getElementById("sidebar").classList.remove("inactive"),document.getElementById("sidebar").classList.add("active")}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Fi({type:e,selectors:[["app-contacter"]],decls:66,vars:0,consts:[["id","contacter",1,"inactive-categorie"],[1,"recentre"],["id","close-btn-contacter",1,"close-btn",3,"click"],["id","close-btn-contacter",1,"close-btn-mobile",3,"click"],[1,"titre"],[1,"pc"],[1,"titre1"],[1,"api"],[1,"inline"],["target","_blank","href","https://docs.mapbox.com/mapbox-gl-js/guides/",1,"inline"],["target","_blank","href","https://developer.spotify.com/documentation/web-api/",1,"inline"],["target","_blank","href","https://musicbrainz.org/doc/MusicBrainz_API",1,"inline"],[1,"mobile"],["target","_blank","href","https://github.com/ClemStun/RadarABeats"],["target","_blank","href","https://docs.google.com/document/d/10omYw_GEmSiN0buHzrdkx3ZbJLzE2Ju_tHPQURK_E3Q/edit?usp=sharing"],["target","_blank","href","https://www.paypal.me/pokecog/"],["type","image","src","https://cdn.discordapp.com/attachments/520318904170709023/948137880239374356/donate.png","border","0","name","submit","title","Business is business - Paypal","alt","Donate with PayPal button",1,"paypal"]],template:function(n,s){1&n&&(ze(0,"div",0),ze(1,"div",1),ze(2,"div",2),Xr("click",function(){return s.hideContacter()}),Be(),ze(3,"div",3),Xr("click",function(){return s.hideContacterMobile()}),Be(),ze(4,"div",4),Rt(5,"RESSOURCES"),Be(),ze(6,"div",5),ze(7,"div",6),Rt(8,"APIs"),Be(),ze(9,"div",7),ze(10,"p",8),Rt(11,"Mapbox : "),ze(12,"a",9),Rt(13,"https://docs.mapbox.com/mapbox-gl-js/guides/"),Be(),Be(),Be(),ze(14,"div",7),ze(15,"p",8),Rt(16,"Spotify : "),ze(17,"a",10),Rt(18,"https://developer.spotify.com/documentation/web-api/"),Be(),Be(),Be(),ze(19,"div",7),ze(20,"p",8),Rt(21,"MusicBrainz : "),ze(22,"a",11),Rt(23,"https://musicbrainz.org/doc/MusicBrainz_API"),Be(),Be(),Be(),Be(),ze(24,"div",12),ze(25,"div",6),Rt(26,"APIs"),Be(),ze(27,"div",7),ze(28,"p",8),ze(29,"a",9),Rt(30,"Mapbox"),Be(),Be(),Be(),ze(31,"div",7),ze(32,"p",8),ze(33,"a",10),Rt(34,"Spotify"),Be(),Be(),Be(),ze(35,"div",7),ze(36,"p",8),ze(37,"a",11),Rt(38,"MusicBrainz"),Be(),Be(),Be(),Be(),ze(39,"div",5),ze(40,"div",6),Rt(41,"GitHub"),Be(),ze(42,"p",7),ze(43,"a",13),Rt(44,"https://github.com/ClemStun/RadarABeats"),Be(),Be(),ze(45,"div",6),Rt(46,"Cahier des charges"),Be(),ze(47,"p",7),ze(48,"a",14),Rt(49,"https://docs.google.com/document/d/10omYw_GEmSiN0buHzrdkx3ZbJLzE2Ju_tHPQURK_E3Q/edit?usp=sharing"),Be(),Be(),Be(),ze(50,"div",12),ze(51,"div",6),Rt(52,"GitHub"),Be(),ze(53,"p",7),ze(54,"a",13),Rt(55,"GitHub"),Be(),Be(),ze(56,"div",6),Rt(57,"Cahier des charges"),Be(),ze(58,"p",7),ze(59,"a",14),Rt(60,"Cahier des charges"),Be(),Be(),Be(),Yt(61,"br"),Yt(62,"br"),Yt(63,"br"),ze(64,"a",15),Yt(65,"input",16),Be(),Be(),Be())},styles:["#contacter[_ngcontent-%COMP%]{background:#1C1C1C;color:#e5e4e4;position:absolute;z-index:4000;width:100%;height:100%;transition:.3s;overflow:hidden}.close-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938105617694982154/Cross.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;top:5%;left:95%;margin-bottom:-1%;padding:0;transition:.3s}.close-btn[_ngcontent-%COMP%]:hover{cursor:pointer}.close-btn-mobile[_ngcontent-%COMP%]{display:none}.titre[_ngcontent-%COMP%]{color:#ccc610;font-size:34px;font-weight:600;margin:3% 3% -.5% 23%}.titre1[_ngcontent-%COMP%]{color:#e5e4e4;font-size:28px;font-weight:600;margin:3% 3% -.5% 23%}.paypal[_ngcontent-%COMP%]{margin-left:23%}.contacter-btn[_ngcontent-%COMP%]{text-align:center}.p-contacter-btn[_ngcontent-%COMP%]{font-size:24px;color:#e5e4e4;background:#333333}.api[_ngcontent-%COMP%]{margin-left:23%;margin-bottom:-.8%}.inline[_ngcontent-%COMP%]{display:inline-block}.api[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#a91917}.api[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:focus{color:#a91917}.mobile[_ngcontent-%COMP%]{display:none}.recentre[_ngcontent-%COMP%]{margin-left:0;margin-top:0}@media screen and (max-width: 415px){.close-btn-mobile[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938105617694982154/Cross.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;top:5%;left:50%;transform:translate(-50%);margin-bottom:15%;padding:0;transition:.3s;display:block}.close-btn-mobile[_ngcontent-%COMP%]:hover{cursor:pointer}.close-btn[_ngcontent-%COMP%]{display:none}.titre[_ngcontent-%COMP%]{color:#ccc610;font-size:28px;font-weight:600;margin:3% 0 -.5%;text-align:center}.titre1[_ngcontent-%COMP%]{color:#e5e4e4;font-size:24px;font-weight:600;margin:3% 0 -.5%;text-align:center}.paypal[_ngcontent-%COMP%]{margin-left:50%;transform:translate(-50%);width:45%}.contacter-btn[_ngcontent-%COMP%]{text-align:center}.p-contacter-btn[_ngcontent-%COMP%]{font-size:24px;color:#e5e4e4;background:#333333}.api[_ngcontent-%COMP%]{text-align:center;margin-left:0;margin-bottom:-.8%}p[_ngcontent-%COMP%]{font-size:12px}.mobile[_ngcontent-%COMP%]{display:block}.pc[_ngcontent-%COMP%]{display:none}}@media screen and (min-width: 415px) and (max-width: 1440px){#contacter[_ngcontent-%COMP%]{background:#1C1C1C;color:#e5e4e4;position:absolute;z-index:9000;width:100%;height:100%;transition:.3s;overflow:hidden}.recentre[_ngcontent-%COMP%]{margin-left:-25%;margin-top:3%}}"]}),e})();function _C(e,t,n,s,l,d,y){try{var w=e[d](y),D=w.value}catch(A){return void n(A)}w.done?t(D):Promise.resolve(D).then(s,l)}function Im(e){return function(){var t=this,n=arguments;return new Promise(function(s,l){var d=e.apply(t,n);function y(D){_C(d,s,l,y,w,"next",D)}function w(D){_C(d,s,l,y,w,"throw",D)}y(void 0)})}}const Am_mapbox_token="pk.eyJ1Ijoic3R1biIsImEiOiJja3lqejNqb3YycmQwMnhwYmUycmdtcWs2In0.akBRqOKrLPCiZE6_CGIOFA",Am_youtube_token="AIzaSyCpj0jsX9HH0jJC2lWCLP1fkvG2tgmuQaI";var ey=Rc(898),yC=Object.prototype.toString;function Kh(e){return"[object Object]"===yC.call(e)}function Pm(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Object.create(null);return e.forEach(function(s){s&&Object.keys(s).forEach(function(l){var d=s[l];n[l]=Kh(d)?Kh(n[l])?Pm(n[l],d):Pm(d):d})}),n}var K0=function(e,t){return(K0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var l in s)s.hasOwnProperty(l)&&(n[l]=s[l])})(e,t)},tR=function(e){function t(n,s,l,d,y){var w=e.call(this,n)||this;return w.config=s,w.code=l,w.request=d,w.response=y,w.isAxiosError=!0,Object.setPrototypeOf(w,t.prototype),w}return function eR(e,t){function n(){this.constructor=e}K0(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t}(Error);function Y0(e,t,n,s,l){return new tR(e,t,n,s,l)}function vC(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%23/gi,"#").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var J0=document.createElement("a"),xC=bC(window.location.href);function bC(e){return J0.setAttribute("href",e),{protocol:J0.protocol,host:J0.host}}function aR(e){return new Promise(function(t,n){var s=e.data,l=void 0===s?null:s,d=e.url,y=e.method,w=void 0===y?"get":y,D=e.headers,A=void 0===D?{}:D,F=e.responseType,j=e.timeout,Y=e.cancelToken,te=e.withCredentials,ge=e.xsrfCookieName,Ie=e.xsrfHeaderName,Ve=e.onDownloadProgress,$e=e.onUploadProgress,Ce=e.auth,at=e.validateStatus,st=new XMLHttpRequest;st.open(w.toLocaleUpperCase(),d,!0),function pn(){F&&(st.responseType=F),j&&(st.timeout=j),te&&(st.withCredentials=te)}(),function Co(){st.onreadystatechange=function(){if(4===st.readyState&&0!==st.status){var Sl=function Jk(e){var t=Object.create(null);return e&&e.split("\r\n").forEach(function(n){var s=n.split(":"),l=s[0],d=s.slice(1);if(l=l.trim().toLowerCase()){var y=d.join(":").trim();t[l]=y}}),t}(st.getAllResponseHeaders());!function Lm(oo){!at||at(oo.status)?t(oo):n(Y0("Request failed with status code "+oo.status,e,null,st,oo))}({data:"text"!==F?st.response:st.responseText,status:st.status,statusText:st.statusText,headers:Sl,config:e,request:st})}},st.onerror=function(){n(Y0("Network Error",e,null,st))},st.ontimeout=function(){n(Y0("Timeout of "+j+" ms exceeded",e,"ECONNABORTED",st))},Ve&&(st.onprogress=Ve),$e&&(st.upload.onprogress=$e)}(),function Pc(){if(function Zk(e){return void 0!==e&&e instanceof FormData}(l)&&delete A["Content-Type"],(te||function oR(e){var t=bC(e);return t.protocol===xC.protocol&&t.host===xC.host}(d))&&ge){var oo=function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null}(ge);oo&&Ie&&(A[Ie]=oo)}Ce&&(A.Authorization="Basic "+btoa(Ce.username+":"+Ce.password)),Object.keys(A).forEach(function(Sl){null===l&&"content-type"===Sl.toLocaleLowerCase()?delete A[Sl]:st.setRequestHeader(Sl,A[Sl])})}(),function Rm(){Y&&Y.promise.then(function(oo){st.abort(),n(oo)}).catch(function(){})}(),st.send(l)})}function wC(e,t,n){return n&&(Array.isArray(n)||(n=[n]),n.forEach(function(s){e=s(e,t)})),e}function lR(e){return function uR(e){e.cancelToken&&e.cancelToken.throwIfRequested()}(e),function cR(e){e.url=EC(e),e.data=wC(e.data,e.headers,e.transformRequest),e.headers=function Qk(e,t){return e?(e=Pm(e.common,e[t],e),["delete","get","head","options","post","put","patch","common"].forEach(function(s){delete e[s]}),e):e}(e.headers,e.method)}(e),aR(e).then(function(t){return CC(t)},function(t){return t&&t.response&&(t.response=CC(t.response)),Promise.reject(t)})}function EC(e){var t=e.url,n=e.params,s=e.paramsSerializer,l=e.baseURL;return l&&!function rR(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}(t)&&(t=function iR(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(l,t)),function nR(e,t,n){if(!t)return e;var s;if(n)s=n(t);else if(function Wk(e){return void 0!==e&&e instanceof URLSearchParams}(t))s=t.toString();else{var l=[];Object.keys(t).forEach(function(y){var w=t[y];if(null!=w){var D=[];Array.isArray(w)?(D=w,y+="[]"):D=[w],D.forEach(function(A){!function qk(e){return"[object Date]"===yC.call(e)}(A)?Kh(A)&&(A=JSON.stringify(A)):A=A.toISOString(),l.push(vC(y)+"="+vC(A))})}}),s=l.join("&")}if(s){var d=e.indexOf("#");-1!==d&&(e=e.slice(0,d)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}(t,n,s)}function CC(e){return e.data=wC(e.data,e.headers,e.config.transformResponse),e}var TC=function(){function e(){this.interceptors=[]}return e.prototype.use=function(t,n){return this.interceptors.push({resolved:t,rejected:n}),this.interceptors.length-1},e.prototype.forEach=function(t){this.interceptors.forEach(function(n){null!=n&&t(n)})},e.prototype.eject=function(t){this.interceptors[t]&&(this.interceptors[t]=null)},e}(),Q0=Object.create(null);function hR(e,t){return void 0!==t?t:e}function dR(e,t){if(void 0!==t)return t}function pR(e,t){return Kh(t)?Pm(e,t):void 0!==t?t:Kh(e)?Pm(e):void 0!==e?e:void 0}function ex(e,t){t||(t={});var n=Object.create(null);for(var s in t)l(s);for(var s in e)t[s]||l(s);function l(d){n[d]=(Q0[d]||hR)(e[d],t[d])}return n}["url","params","data"].forEach(function(e){Q0[e]=dR}),["headers","auth"].forEach(function(e){Q0[e]=pR});var tx=function(){function e(t){this.defaults=t,this.interceptors={request:new TC,response:new TC}}return e.prototype.request=function(t,n){"string"==typeof t?(n||(n={}),n.url=t):n=t,(n=ex(this.defaults,n)).method=n.method.toLowerCase();var s=[{resolved:lR,rejected:void 0}];this.interceptors.request.forEach(function(D){s.unshift(D)}),this.interceptors.response.forEach(function(D){s.push(D)});for(var l=Promise.resolve(n);s.length;){var d=s.shift();l=l.then(d.resolved,d.rejected)}return l},e.prototype.get=function(t,n){return this._requestMethodWithoutData("get",t,n)},e.prototype.delete=function(t,n){return this._requestMethodWithoutData("delete",t,n)},e.prototype.head=function(t,n){return this._requestMethodWithoutData("head",t,n)},e.prototype.options=function(t,n){return this._requestMethodWithoutData("options",t,n)},e.prototype.post=function(t,n,s){return this._requestMethodWithData("post",t,n,s)},e.prototype.put=function(t,n,s){return this._requestMethodWithData("put",t,n,s)},e.prototype.patch=function(t,n,s){return this._requestMethodWithData("patch",t,n,s)},e.prototype.getUri=function(t){return EC(t=ex(this.defaults,t))},e.prototype._requestMethodWithoutData=function(t,n,s){return this.request(Object.assign(s||{},{method:t,url:n}))},e.prototype._requestMethodWithData=function(t,n,s,l){return this.request(Object.assign(l||{},{method:t,url:n,data:s}))},e}(),ty={method:"get",timeout:0,headers:{common:{Accept:"application/json, text/plain, /*/"}},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",transformRequest:[function(e,t){return function Yk(e,t){return function Kk(e,t){!e||Object.keys(e).forEach(function(n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=e[n],delete e[n])})}(e,"Content-Type"),Kh(t)&&e&&!e["Content-Type"]&&(e["Content-Type"]="application/json;charset=utf-8"),e}(t,e),function gR(e){return Kh(e)?JSON.stringify(e):e}(e)}],transformResponse:[function(e){return function _R(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(t){}return e}(e)}],validateStatus:function(e){return e>=200&&e<300}};["delete","get","head","options"].forEach(function(e){ty.headers[e]={}}),["post","put","patch"].forEach(function(e){ty.headers[e]={"Content-Type":"application/x-www-form-urlencoded"}});var nx=function e(t){this.message=t},bR=function(){function e(t){var s,n=this;this.promise=new Promise(function(l){s=l}),t(function(l){n.reason||(n.reason=new nx(l),s(n.reason))})}return e.prototype.throwIfRequested=function(){if(this.reason)throw console.log(1),this.reason},e.source=function(){var t,n=new e(function(s){t=s});return{cancel:t,token:n}},e}();function DC(e){var t=new tx(e),n=tx.prototype.request.bind(t);return function Xk(e,t){for(var n in t)e[n]=t[n]}(n,t),n}var Su=DC(ty);Su.create=function(t){return DC(ex(ty,t))},Su.CancelToken=bR,Su.Cancel=nx,Su.isCancel=function xR(e){return e instanceof nx},Su.all=function(t){return Promise.all(t)},Su.spread=function(t){return function(s){return t.apply(null,s)}},Su.Axios=tx;const MC=Su;let SC=(()=>{class e{constructor(){}getDistrict(n,s){return Im(function*(){let l,d;return l="https://api.mapbox.com/geocoding/v5/mapbox.places/"+n+","+s+".json?types=region&access_token="+Am_mapbox_token,d="",yield MC.get(l).then(y=>{d=y.data.features[0].text}).catch(y=>{console.log(y)}),d})()}getPlace(n,s){var l=this;return Im(function*(){let d,y,w;return d="https://api.mapbox.com/geocoding/v5/mapbox.places/"+n+","+s+".json?types=place&access_token="+Am_mapbox_token,w=[],yield MC.get(d).then(D=>{y=D.data.features[0].place_name,w=y.split(", ")}).catch(D=>{console.log(D)}),l.musicTileComp.showMenu(),w})()}setComp(n){this.musicTileComp=n}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Tt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class IC{}class AC{}class Ac{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(n=>{const s=n.indexOf(":");if(s>0){const l=n.slice(0,s),d=l.toLowerCase(),y=n.slice(s+1).trim();this.maybeSetNormalizedName(l,d),this.headers.has(d)?this.headers.get(d).push(y):this.headers.set(d,[y])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(n=>{let s=t[n];const l=n.toLowerCase();"string"==typeof s&&(s=[s]),s.length>0&&(this.headers.set(l,s),this.maybeSetNormalizedName(n,l))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const n=this.headers.get(t.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,n){return this.clone({name:t,value:n,op:"a"})}set(t,n){return this.clone({name:t,value:n,op:"s"})}delete(t,n){return this.clone({name:t,value:n,op:"d"})}maybeSetNormalizedName(t,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,t)}init(){this.lazyInit&&(this.lazyInit instanceof Ac?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(n=>{this.headers.set(n,t.headers.get(n)),this.normalizedNames.set(n,t.normalizedNames.get(n))})}clone(t){const n=new Ac;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof Ac?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([t]),n}applyUpdate(t){const n=t.name.toLowerCase();switch(t.op){case"a":case"s":let s=t.value;if("string"==typeof s&&(s=[s]),0===s.length)return;this.maybeSetNormalizedName(t.name,n);const l=("a"===t.op?this.headers.get(n):void 0)||[];l.push(...s),this.headers.set(n,l);break;case"d":const d=t.value;if(d){let y=this.headers.get(n);if(!y)return;y=y.filter(w=>-1===d.indexOf(w)),0===y.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,y)}else this.headers.delete(n),this.normalizedNames.delete(n)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>t(this.normalizedNames.get(n),this.headers.get(n)))}}class wR{encodeKey(t){return PC(t)}encodeValue(t){return PC(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const CR=/%(\d[a-f0-9])/gi,TR={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function PC(e){return encodeURIComponent(e).replace(CR,(t,n)=>{var s;return null!==(s=TR[n])&&void 0!==s?s:t})}function kC(e){return`${e}`}class Iu{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new wR,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function ER(e,t){const n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(l=>{const d=l.indexOf("="),[y,w]=-1==d?[t.decodeKey(l),""]:[t.decodeKey(l.slice(0,d)),t.decodeValue(l.slice(d+1))],D=n.get(y)||[];D.push(w),n.set(y,D)}),n}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(n=>{const s=t.fromObject[n];this.map.set(n,Array.isArray(s)?s:[s])})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const n=this.map.get(t);return n?n[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,n){return this.clone({param:t,value:n,op:"a"})}appendAll(t){const n=[];return Object.keys(t).forEach(s=>{const l=t[s];Array.isArray(l)?l.forEach(d=>{n.push({param:s,value:d,op:"a"})}):n.push({param:s,value:l,op:"a"})}),this.clone(n)}set(t,n){return this.clone({param:t,value:n,op:"s"})}delete(t,n){return this.clone({param:t,value:n,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const n=this.encoder.encodeKey(t);return this.map.get(t).map(s=>n+"="+this.encoder.encodeValue(s)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const n=new Iu({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(t),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const n=("a"===t.op?this.map.get(t.param):void 0)||[];n.push(kC(t.value)),this.map.set(t.param,n);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let s=this.map.get(t.param)||[];const l=s.indexOf(kC(t.value));-1!==l&&s.splice(l,1),s.length>0?this.map.set(t.param,s):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class DR{constructor(){this.map=new Map}set(t,n){return this.map.set(t,n),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function RC(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function LC(e){return"undefined"!=typeof Blob&&e instanceof Blob}function OC(e){return"undefined"!=typeof FormData&&e instanceof FormData}class km{constructor(t,n,s,l){let d;if(this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function MR(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||l?(this.body=void 0!==s?s:null,d=l):d=s,d&&(this.reportProgress=!!d.reportProgress,this.withCredentials=!!d.withCredentials,d.responseType&&(this.responseType=d.responseType),d.headers&&(this.headers=d.headers),d.context&&(this.context=d.context),d.params&&(this.params=d.params)),this.headers||(this.headers=new Ac),this.context||(this.context=new DR),this.params){const y=this.params.toString();if(0===y.length)this.urlWithParams=n;else{const w=n.indexOf("?");this.urlWithParams=n+(-1===w?"?":w<n.length-1?"&":"")+y}}else this.params=new Iu,this.urlWithParams=n}serializeBody(){return null===this.body?null:RC(this.body)||LC(this.body)||OC(this.body)||function SR(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Iu?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||OC(this.body)?null:LC(this.body)?this.body.type||null:RC(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Iu?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var n;const s=t.method||this.method,l=t.url||this.url,d=t.responseType||this.responseType,y=void 0!==t.body?t.body:this.body,w=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,D=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let A=t.headers||this.headers,F=t.params||this.params;const j=null!==(n=t.context)&&void 0!==n?n:this.context;return void 0!==t.setHeaders&&(A=Object.keys(t.setHeaders).reduce((Y,te)=>Y.set(te,t.setHeaders[te]),A)),t.setParams&&(F=Object.keys(t.setParams).reduce((Y,te)=>Y.set(te,t.setParams[te]),F)),new km(s,l,y,{params:F,headers:A,context:j,reportProgress:D,responseType:d,withCredentials:w})}}var Jr=(()=>((Jr=Jr||{})[Jr.Sent=0]="Sent",Jr[Jr.UploadProgress=1]="UploadProgress",Jr[Jr.ResponseHeader=2]="ResponseHeader",Jr[Jr.DownloadProgress=3]="DownloadProgress",Jr[Jr.Response=4]="Response",Jr[Jr.User=5]="User",Jr))();class rx{constructor(t,n=200,s="OK"){this.headers=t.headers||new Ac,this.status=void 0!==t.status?t.status:n,this.statusText=t.statusText||s,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class ix extends rx{constructor(t={}){super(t),this.type=Jr.ResponseHeader}clone(t={}){return new ix({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class ny extends rx{constructor(t={}){super(t),this.type=Jr.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new ny({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class FC extends rx{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function ox(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let zC=(()=>{class e{constructor(n){this.handler=n}request(n,s,l={}){let d;if(n instanceof km)d=n;else{let D,A;D=l.headers instanceof Ac?l.headers:new Ac(l.headers),l.params&&(A=l.params instanceof Iu?l.params:new Iu({fromObject:l.params})),d=new km(n,s,void 0!==l.body?l.body:null,{headers:D,context:l.context,params:A,reportProgress:l.reportProgress,responseType:l.responseType||"json",withCredentials:l.withCredentials})}const y=Wt(d).pipe(bp(D=>this.handler.handle(D)));if(n instanceof km||"events"===l.observe)return y;const w=y.pipe(Hh(D=>D instanceof ny));switch(l.observe||"body"){case"body":switch(d.responseType){case"arraybuffer":return w.pipe(Gt(D=>{if(null!==D.body&&!(D.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return D.body}));case"blob":return w.pipe(Gt(D=>{if(null!==D.body&&!(D.body instanceof Blob))throw new Error("Response is not a Blob.");return D.body}));case"text":return w.pipe(Gt(D=>{if(null!==D.body&&"string"!=typeof D.body)throw new Error("Response is not a string.");return D.body}));default:return w.pipe(Gt(D=>D.body))}case"response":return w;default:throw new Error(`Unreachable: unhandled observe type ${l.observe}}`)}}delete(n,s={}){return this.request("DELETE",n,s)}get(n,s={}){return this.request("GET",n,s)}head(n,s={}){return this.request("HEAD",n,s)}jsonp(n,s){return this.request("JSONP",n,{params:(new Iu).append(s,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,s={}){return this.request("OPTIONS",n,s)}patch(n,s,l={}){return this.request("PATCH",n,ox(l,s))}post(n,s,l={}){return this.request("POST",n,ox(l,s))}put(n,s,l={}){return this.request("PUT",n,ox(l,s))}}return e.\u0275fac=function(n){return new(n||e)(et(IC))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();class BC{constructor(t,n){this.next=t,this.interceptor=n}handle(t){return this.interceptor.intercept(t,this.next)}}const NC=new en("HTTP_INTERCEPTORS");let IR=(()=>{class e{intercept(n,s){return s.handle(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();const AR=/^\)\]\}',?\n/;let UC=(()=>{class e{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new sn(s=>{const l=this.xhrFactory.build();if(l.open(n.method,n.urlWithParams),n.withCredentials&&(l.withCredentials=!0),n.headers.forEach((te,ge)=>l.setRequestHeader(te,ge.join(","))),n.headers.has("Accept")||l.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const te=n.detectContentTypeHeader();null!==te&&l.setRequestHeader("Content-Type",te)}if(n.responseType){const te=n.responseType.toLowerCase();l.responseType="json"!==te?te:"text"}const d=n.serializeBody();let y=null;const w=()=>{if(null!==y)return y;const te=1223===l.status?204:l.status,ge=l.statusText||"OK",Ie=new Ac(l.getAllResponseHeaders()),Ve=function PR(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(l)||n.url;return y=new ix({headers:Ie,status:te,statusText:ge,url:Ve}),y},D=()=>{let{headers:te,status:ge,statusText:Ie,url:Ve}=w(),$e=null;204!==ge&&($e=void 0===l.response?l.responseText:l.response),0===ge&&(ge=$e?200:0);let Ce=ge>=200&&ge<300;if("json"===n.responseType&&"string"==typeof $e){const at=$e;$e=$e.replace(AR,"");try{$e=""!==$e?JSON.parse($e):null}catch(st){$e=at,Ce&&(Ce=!1,$e={error:st,text:$e})}}Ce?(s.next(new ny({body:$e,headers:te,status:ge,statusText:Ie,url:Ve||void 0})),s.complete()):s.error(new FC({error:$e,headers:te,status:ge,statusText:Ie,url:Ve||void 0}))},A=te=>{const{url:ge}=w(),Ie=new FC({error:te,status:l.status||0,statusText:l.statusText||"Unknown Error",url:ge||void 0});s.error(Ie)};let F=!1;const j=te=>{F||(s.next(w()),F=!0);let ge={type:Jr.DownloadProgress,loaded:te.loaded};te.lengthComputable&&(ge.total=te.total),"text"===n.responseType&&!!l.responseText&&(ge.partialText=l.responseText),s.next(ge)},Y=te=>{let ge={type:Jr.UploadProgress,loaded:te.loaded};te.lengthComputable&&(ge.total=te.total),s.next(ge)};return l.addEventListener("load",D),l.addEventListener("error",A),l.addEventListener("timeout",A),l.addEventListener("abort",A),n.reportProgress&&(l.addEventListener("progress",j),null!==d&&l.upload&&l.upload.addEventListener("progress",Y)),l.send(d),s.next({type:Jr.Sent}),()=>{l.removeEventListener("error",A),l.removeEventListener("abort",A),l.removeEventListener("load",D),l.removeEventListener("timeout",A),n.reportProgress&&(l.removeEventListener("progress",j),null!==d&&l.upload&&l.upload.removeEventListener("progress",Y)),l.readyState!==l.DONE&&l.abort()}})}}return e.\u0275fac=function(n){return new(n||e)(et(Xw))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})();const sx=new en("XSRF_COOKIE_NAME"),ax=new en("XSRF_HEADER_NAME");class jC{}let kR=(()=>{class e{constructor(n,s,l){this.doc=n,this.platform=s,this.cookieName=l,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=Vw(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return e.\u0275fac=function(n){return new(n||e)(et(Eo),et(x_),et(sx))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})(),lx=(()=>{class e{constructor(n,s){this.tokenService=n,this.headerName=s}intercept(n,s){const l=n.url.toLowerCase();if("GET"===n.method||"HEAD"===n.method||l.startsWith("http://")||l.startsWith("https://"))return s.handle(n);const d=this.tokenService.getToken();return null!==d&&!n.headers.has(this.headerName)&&(n=n.clone({headers:n.headers.set(this.headerName,d)})),s.handle(n)}}return e.\u0275fac=function(n){return new(n||e)(et(jC),et(ax))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})(),RR=(()=>{class e{constructor(n,s){this.backend=n,this.injector=s,this.chain=null}handle(n){if(null===this.chain){const s=this.injector.get(NC,[]);this.chain=s.reduceRight((l,d)=>new BC(l,d),this.backend)}return this.chain.handle(n)}}return e.\u0275fac=function(n){return new(n||e)(et(AC),et(We))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac}),e})(),LR=(()=>{class e{static disable(){return{ngModule:e,providers:[{provide:lx,useClass:IR}]}}static withOptions(n={}){return{ngModule:e,providers:[n.cookieName?{provide:sx,useValue:n.cookieName}:[],n.headerName?{provide:ax,useValue:n.headerName}:[]]}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ro({type:e}),e.\u0275inj=mi({providers:[lx,{provide:NC,useExisting:lx,multi:!0},{provide:jC,useClass:kR},{provide:sx,useValue:"XSRF-TOKEN"},{provide:ax,useValue:"X-XSRF-TOKEN"}]}),e})(),OR=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ro({type:e}),e.\u0275inj=mi({providers:[zC,{provide:IC,useClass:RR},UC,{provide:AC,useExisting:UC}],imports:[[LR.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),e})(),VC=(()=>{class e{constructor(n){this.http=n,this.artiste="NO ARTIST",this.titre="NO SONG",this.count=0,this.ville="NO CITY",this.coordonnees="0, 0",this.videoLink="",this.artisteID="",this.description=""}getRandomOffset(n){return Math.floor(Math.random()*n)}setCoord(n,s){this.coordonnees=n+", "+s}getNumberOfArtists(n){return console.log("Inside"),this.http.get('http://musicbrainz.org/ws/2/artist/?query=area:"'+n+'"&limit=1&fmt=json',{responseType:"json"}).toPromise()}getRandomArtists(n,s){let l=this.getRandomOffset(s);return this.http.get('http://musicbrainz.org/ws/2/artist/?query=area:"'+n+'"&limit=1&offset='+l+"&fmt=json",{responseType:"json"}).toPromise()}getNumberOfSongs(n){return this.http.get('http://musicbrainz.org/ws/2/recording/?query=artist:"'+n+'"&limit=1&fmt=json',{responseType:"json"}).toPromise()}getRandomSong(n,s){let l=this.getRandomOffset(s);return this.http.get('http://musicbrainz.org/ws/2/recording/?query=artist:"'+n+'"&limit=1&offset='+l+"&fmt=json",{responseType:"json"}).toPromise()}setArtistAndSong(n,s,l){var d=this;return Im(function*(){console.log("Before"),yield d.getNumberOfArtists(n).then(y=>d.count=y.count),console.log(d.count),0==d.count?(yield d.getNumberOfArtists(s).then(y=>d.count=y.count),0==d.count?(yield d.getNumberOfArtists(l).then(y=>d.count=y.count),0==d.count?(d.artiste="NO ARTIST",d.titre="NO SONG"):(yield d.getRandomArtists(l,d.count).then(y=>{d.artiste=y.artists[0].name,d.artisteID=y.artists[0].id,d.description=y.artists[0].disambiguation}),d.ville=l,yield d.getNumberOfSongs(d.artiste).then(y=>d.count=y.count),0==d.count?d.titre="NO SONG":yield d.getRandomSong(d.artiste,d.count).then(y=>d.titre=y.recordings[0].title))):(yield d.getRandomArtists(s,d.count).then(y=>{d.artiste=y.artists[0].name,d.artisteID=y.artists[0].id,d.description=y.artists[0].disambiguation}),d.ville=s,yield d.getNumberOfSongs(d.artiste).then(y=>d.count=y.count),0==d.count?d.titre="NO SONG":yield d.getRandomSong(d.artiste,d.count).then(y=>d.titre=y.recordings[0].title))):(yield d.getRandomArtists(n,d.count).then(y=>{d.artiste=y.artists[0].name,d.artisteID=y.artists[0].id,d.description=y.artists[0].disambiguation}),console.log("Artist : "+d.artiste),d.ville=n,yield d.getNumberOfSongs(d.artiste).then(y=>d.count=y.count),console.log(d.count),0==d.count?d.titre="NO SONG":yield d.getRandomSong(d.artiste,d.count).then(y=>d.titre=y.recordings[0].title),console.log("Song : "+d.titre),console.log("After"))})()}setVideoLink(){var n=this;return Im(function*(){"NO ARTIST"!=n.artiste&&(yield n.getLinkFromArtistAndSong(n.artiste,"NO SONG"==n.titre?"":n.titre).then(s=>{n.videoLink="http://www.youtube.com/embed/"+s.items[0].id.videoId+"?&autoplay=1",console.log(s)}),console.log(n.videoLink))})()}getLinkFromArtistAndSong(n,s){return this.http.get('https://www.googleapis.com/youtube/v3/search/?q="'+n+" "+s+'"&type=video&part=snippet&key='+Am_youtube_token,{responseType:"json"}).toPromise()}}return e.\u0275fac=function(n){return new(n||e)(et(zC))},e.\u0275prov=Tt({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),FR=(()=>{class e{constructor(n,s){this.service=n,this.songTileService=s}ngOnInit(){var n=this;this.map=new ey.Map({accessToken:Am_mapbox_token,container:"carte",style:"mapbox://styles/mapbox/streets-v11",center:[.1988608,48.0076426],zoom:9});let s=(new ey.Marker).setLngLat(this.map.getCenter()).addTo(this.map);navigator.geolocation.getCurrentPosition(d=>{console.log(d),s.remove(),s=(new ey.Marker).setLngLat([d.coords.longitude,d.coords.latitude]).addTo(this.map)},()=>{console.log("Geopos non accept\xe9 placement au Mans !")}),this.map.on("load",d=>{this.map.setCenter(s.getLngLat())}),this.map.on("click",d=>{s.remove(),s=(new ey.Marker).setLngLat(d.lngLat).addTo(this.map),console.log(this.service.getPlace(d.lngLat.lng,d.lngLat.lat)),this.songTileService.setCoord(d.lngLat.lng,d.lngLat.lat),this.service.getPlace(d.lngLat.lng,d.lngLat.lat).then(function(){var y=Im(function*(w){n.songTileService.ville=w[0],yield n.songTileService.setArtistAndSong(w[0],w[1],w[2]),n.songTileService.setVideoLink()});return function(w){return y.apply(this,arguments)}}())})}}return e.\u0275fac=function(n){return new(n||e)(_t(SC),_t(VC))},e.\u0275cmp=Fi({type:e,selectors:[["app-carte"]],decls:2,vars:0,consts:[["href","https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.css","rel","stylesheet"],["id","carte"]],template:function(n,s){1&n&&(Yt(0,"link",0),Yt(1,"div",1))},styles:["#carte[_ngcontent-%COMP%]{background:#fffeb9;position:fixed;z-index:100;width:100%;height:100%}.marker[_ngcontent-%COMP%]{background-color:red;width:50px;height:50px;border-radius:50%;cursor:pointer}"]}),e})(),zR=(()=>{class e{constructor(){}hideSide(){console.log("Test HideSide"),document.getElementById("sidebar").classList.remove("active"),document.getElementById("sidebar").classList.add("inactive"),document.getElementById("darker").classList.remove("activeDarker"),document.getElementById("darker").classList.add("inactiveDarker"),document.getElementById("trigger-btn-pre").classList.remove("invisible")}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Fi({type:e,selectors:[["app-darker"]],decls:1,vars:0,consts:[["id","darker",1,"inactiveDarker",3,"click"]],template:function(n,s){1&n&&(ze(0,"div",0),Xr("click",function(){return s.hideSide()}),Be())},styles:["#darker[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;background:rgba(0,0,0,.5)}.activeDarker[_ngcontent-%COMP%]{z-index:3000}.inactiveDarker[_ngcontent-%COMP%]{z-index:-1}"]}),e})(),BR=(()=>{class e{constructor(){}showSide(){console.log("Test ShowSide"),document.getElementById("sidebar").classList.remove("inactive"),document.getElementById("sidebar").classList.add("active"),document.getElementById("darker").classList.remove("inactiveDarker"),document.getElementById("darker").classList.add("activeDarker"),document.getElementById("trigger-btn-pre").classList.add("invisible"),document.getElementById("close-btn-side").classList.remove("invisible")}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Fi({type:e,selectors:[["app-btn-sidebar"]],decls:2,vars:0,consts:[["id","trigger-btn-pre",1,"trigger-btn-side",3,"click"]],template:function(n,s){1&n&&(ze(0,"div"),ze(1,"div",0),Xr("click",function(){return s.showSide()}),Be(),Be())},styles:[".trigger-btn-side[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/950688606127796254/Burger_copie.png);background-repeat:no-repeat;background-size:cover;opacity:.5;width:167px;height:51px;text-align:center;position:relative;align-items:center;left:2%;margin-top:2%;transition:.3s}.trigger-btn-side[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer}#trigger-btn-pre[_ngcontent-%COMP%]{position:fixed;z-index:5000}"]}),e})(),NR=(()=>{class e{constructor(){}hideSide(){console.log("Test HideSide"),document.getElementById("sidebar").classList.remove("active"),document.getElementById("sidebar").classList.add("inactive"),document.getElementById("darker").classList.remove("activeDarker"),document.getElementById("darker").classList.add("inactiveDarker"),document.getElementById("close-btn-side").classList.add("invisible"),document.getElementById("trigger-btn-pre").classList.remove("invisible")}showContacter(){document.getElementById("apropos").classList.contains("active-categorie")&&(document.getElementById("apropos").classList.remove("active-categorie"),document.getElementById("apropos").classList.add("inactive-categorie"),document.getElementById("btn-apropos").classList.remove("text-selected")),document.getElementById("contacter").classList.remove("inactive-categorie"),document.getElementById("contacter").classList.add("active-categorie"),document.getElementById("btn-contacter").classList.add("text-selected")}showContacterMobile(){document.getElementById("apropos").classList.contains("active-categorie")&&(document.getElementById("apropos").classList.remove("active-categorie"),document.getElementById("apropos").classList.add("inactive-categorie"),document.getElementById("btn-apropos").classList.remove("text-selected")),document.getElementById("contacter").classList.remove("inactive-categorie"),document.getElementById("contacter").classList.add("active-categorie"),document.getElementById("btn-contacter").classList.add("text-selected"),document.getElementById("sidebar").classList.remove("active"),document.getElementById("sidebar").classList.add("inactive")}showAPropos(){document.getElementById("contacter").classList.contains("active-categorie")&&(document.getElementById("contacter").classList.remove("active-categorie"),document.getElementById("contacter").classList.add("inactive-categorie"),document.getElementById("btn-contacter").classList.remove("text-selected")),document.getElementById("apropos").classList.remove("inactive-categorie"),document.getElementById("apropos").classList.add("active-categorie"),document.getElementById("btn-apropos").classList.add("text-selected")}showAProposMobile(){document.getElementById("contacter").classList.contains("active-categorie")&&(document.getElementById("contacter").classList.remove("active-categorie"),document.getElementById("contacter").classList.add("inactive-categorie"),document.getElementById("btn-contacter").classList.remove("text-selected")),document.getElementById("apropos").classList.remove("inactive-categorie"),document.getElementById("apropos").classList.add("active-categorie"),document.getElementById("btn-apropos").classList.add("text-selected"),document.getElementById("sidebar").classList.remove("active"),document.getElementById("sidebar").classList.add("inactive")}ngOnInit(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Fi({type:e,selectors:[["app-sidebar"]],decls:24,vars:0,consts:[["id","sidebar",1,"inactive"],[2,"padding","1px"],["id","close-btn-side",1,"close-btn",3,"click"],[1,"remplaceClose"],["src","https://cdn.discordapp.com/attachments/520318904170709023/938858109772890192/Full-Logo.png","alt","logo",1,"logo"],["id","btn-apropos",1,"categorie",3,"click"],["id","btn-apropos",1,"categorie-mobile",3,"click"],["id","btn-contacter",1,"categorie",3,"click"],["id","btn-contacter",1,"categorie-mobile",3,"click"],[1,"categorie"],["href","mailto:radarabeats@gmail.com",1,"mailto"],[1,"categorie-mobile"],[1,"copyright"],[1,"rempli"]],template:function(n,s){1&n&&(ze(0,"div",0),Yt(1,"div",1),ze(2,"div"),ze(3,"div",2),Xr("click",function(){return s.hideSide()}),Be(),Be(),Yt(4,"div",3),ze(5,"div"),Yt(6,"img",4),ze(7,"div",5),Xr("click",function(){return s.showAPropos()}),Rt(8," \xc0 PROPOS "),Be(),ze(9,"div",6),Xr("click",function(){return s.showAProposMobile()}),Rt(10," \xc0 PROPOS "),Be(),ze(11,"div",7),Xr("click",function(){return s.showContacter()}),Rt(12," RESSOURCES "),Be(),ze(13,"div",8),Xr("click",function(){return s.showContacterMobile()}),Rt(14," RESSOURCES "),Be(),ze(15,"div",9),ze(16,"a",10),Rt(17,"CONTACTER"),Be(),Be(),ze(18,"div",11),ze(19,"a",10),Rt(20,"CONTACTER"),Be(),Be(),Be(),ze(21,"div",12),Rt(22," \xa9 Utema & Stun "),Be(),Yt(23,"div",13),Be())},styles:["#sidebar[_ngcontent-%COMP%]{background:#1C1C1C;background-size:50%;max-width:20%;transition:.3s;position:fixed;z-index:8000;align-items:center;text-align:center;overflow:hidden}.active[_ngcontent-%COMP%]{left:0;margin-left:0%}.inactive[_ngcontent-%COMP%]{margin-left:-100%}.rempli[_ngcontent-%COMP%]{padding:100% 0}.close-btn[_ngcontent-%COMP%]{display:none}.remplaceClose[_ngcontent-%COMP%]{background:#44444400;width:30px;height:30px}.logo[_ngcontent-%COMP%]{width:40%;margin:5% 5% 20%}.categorie[_ngcontent-%COMP%]{width:100%;font-size:24px;padding:5% 0;color:#e5e4e4}.categorie[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:#333;color:#ccc610}.categorie-mobile[_ngcontent-%COMP%]{display:none;visibility:hidden}.copyright[_ngcontent-%COMP%]{color:#444;position:absolute;text-align:center;top:72%;left:50%;transform:translate(-50%)}.mailto[_ngcontent-%COMP%]{text-decoration:none;color:#a91917;width:100%;font-size:24px;padding:5% 0}@media screen and (max-width: 415px){.close-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938105617694982154/Cross.png);background-repeat:no-repeat;background-size:cover;width:30px;height:30px;text-align:center;position:relative;margin:8% 0 -1%;left:50%;transform:translate(-50%);padding:0;transition:.3s;display:block}.close-btn[_ngcontent-%COMP%]:hover{cursor:pointer}.remplaceClose[_ngcontent-%COMP%]{display:none}#sidebar[_ngcontent-%COMP%]{background:#1C1C1C;background-size:50%;max-width:100%;transition:.3s;position:fixed;z-index:9000;align-items:center;text-align:center;overflow:hidden}.logo[_ngcontent-%COMP%]{width:40%;margin:20%}.copyright[_ngcontent-%COMP%]{color:#444;position:absolute;text-align:center;top:50%;left:50%;transform:translate(-50%)}.categorie[_ngcontent-%COMP%]{display:none;visibility:hidden}.categorie-mobile[_ngcontent-%COMP%]{width:100%;font-size:24px;padding:5% 0;color:#e5e4e4;display:block;visibility:visible}.categorie-mobile[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:#333;color:#ccc610}}@media screen and (min-width: 930px) and (max-width: 1440px){#sidebar[_ngcontent-%COMP%]{background:#1C1C1C;background-size:50%;max-width:25%;transition:.3s;position:fixed;z-index:8000;align-items:center;text-align:center;overflow:hidden}.copyright[_ngcontent-%COMP%]{color:#444;position:absolute;text-align:center;bottom:60%;left:50%;transform:translate(-50%)}}@media screen and (min-width: 415px) and (max-width: 930px){#sidebar[_ngcontent-%COMP%]{background:#1C1C1C;background-size:50%;max-width:35%;transition:.3s;position:fixed;z-index:8000;align-items:center;text-align:center;overflow:hidden}.copyright[_ngcontent-%COMP%]{color:#444;position:absolute;text-align:center;top:65%;left:50%;transform:translate(-50%)}}"]}),e})(),UR=(()=>{class e{constructor(n){this.sanitizer=n}transform(n){return this.sanitizer.bypassSecurityTrustResourceUrl(n)}}return e.\u0275fac=function(n){return new(n||e)(_t(lE,16))},e.\u0275pipe=nr({name:"safe",type:e,pure:!0}),e})(),jR=(()=>{class e{constructor(n,s){this.songTileService=n,this.carteService=s}showMenu(){console.log("Test ShowMenu"),document.getElementById("menuUp").classList.remove("inactive"),document.getElementById("menuUp").classList.add("active"),document.getElementById("trigger-btn").classList.add("invisible"),document.getElementById("close-btn").classList.remove("invisible"),document.getElementById("greater-btn").classList.remove("invisible"),setTimeout(()=>{document.getElementById("close-btn").classList.remove("close-btn-inactive"),document.getElementById("close-btn").classList.add("close-btn-active"),document.getElementById("greater-btn").classList.remove("greater-btn-inactive"),document.getElementById("greater-btn").classList.add("greater-btn-active")},30)}hideMenu(){console.log("Test HideMenu"),document.getElementById("menuUp").classList.remove("active"),document.getElementById("menuUp").classList.add("inactive"),document.getElementById("close-btn").classList.add("invisible"),document.getElementById("trigger-btn").classList.remove("invisible"),document.getElementById("greater-btn").classList.add("invisible"),document.getElementById("menuUp").classList.contains("greater")&&(document.getElementById("menuUp").classList.remove("greater"),this.lowerMenu()),setTimeout(()=>{document.getElementById("close-btn").classList.remove("close-btn-active"),document.getElementById("close-btn").classList.add("close-btn-inactive"),document.getElementById("greater-btn").classList.remove("greater-btn-active"),document.getElementById("greater-btn").classList.add("greater-btn-inactive")},30)}greaterMenu(){document.getElementById("menuUp").classList.add("greater"),document.getElementById("close-btn").classList.remove("close-btn-active"),document.getElementById("close-btn").classList.add("close-btn-greater"),document.getElementById("greater-btn").classList.remove("greater-btn-img-inactive"),document.getElementById("greater-btn").classList.add("greater-btn-img-active"),document.getElementById("lower-btn").classList.remove("greater-btn-img-inactive"),document.getElementById("lower-btn").classList.add("greater-btn-img-active"),document.getElementById("greater-btn").classList.remove("greater-btn-active"),document.getElementById("greater-btn").classList.add("greater-btn-greater"),document.getElementById("lower-btn").classList.remove("greater-btn-active"),document.getElementById("lower-btn").classList.add("greater-btn-greater"),setTimeout(()=>{document.getElementById("lower-btn").classList.remove("invisible"),document.getElementById("greater-btn").classList.add("invisible")},300)}lowerMenu(){document.getElementById("menuUp").classList.remove("greater"),document.getElementById("close-btn").classList.remove("close-btn-greater"),document.getElementById("close-btn").classList.add("close-btn-active"),document.getElementById("greater-btn").classList.remove("greater-btn-img-active"),document.getElementById("greater-btn").classList.add("greater-btn-img-inactive"),document.getElementById("lower-btn").classList.remove("greater-btn-img-active"),document.getElementById("lower-btn").classList.add("greater-btn-img-inactive"),document.getElementById("greater-btn").classList.remove("greater-btn-greater"),document.getElementById("greater-btn").classList.add("greater-btn-active"),document.getElementById("lower-btn").classList.remove("greater-btn-greater"),document.getElementById("lower-btn").classList.add("greater-btn-active"),setTimeout(()=>{document.getElementById("lower-btn").classList.add("invisible"),document.getElementById("greater-btn").classList.remove("invisible")},300)}ngOnInit(){this.carteService.setComp(this),this.titre="NO SONG",this.artiste="NO ARTIST",this.artisteTwitter="https://www.twitter.com/ronteahri",this.artisteInstagram="https://www.instagram.com/ronteahri",this.artisteSoundcloud="https://www.soundcloud.com/ronteah-rth",this.artisteFacebook="https://www.facebook.com",this.artisteDeezer="https://www.deezer.com",this.artisteSpotify="https://www.spotify.com",this.artisteDescription="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean quis pharetra risus. Aliquam ornare suscipit sem ac mollis. Phasellus fermentum lobortis mi non mattis. Praesent odio tellus, lacinia quis volutpat ac, hendrerit vitae velit. Vestibulum vestibulum maximus lorem sit amet aliquam. Sed pharetra, purus id accumsan vehicula, ipsum lorem rhoncus nibh, et ultrices nulla leo id neque. Nam ac luctus sem, eu viverra nisi. Nulla porttitor dui at libero molestie facilisis. Cras a tellus augue. Pellentesque tincidunt consequat congue. Maecenas et porttitor eros. Nam sed tellus nibh. Nullam placerat eu sem vitae pellentesque. Phasellus efficitur, urna ac posuere fringilla, turpis justo suscipit erat, in pharetra dui ante a lorem. Morbi porta orci blandit massa malesuada, vitae imperdiet dui vulputate. Sed dignissim, risus quis consectetur pellentesque, nisi quam lobortis eros, in porttitor odio quam nec libero. Vivamus finibus, elit eget tempor laoreet, purus dolor mattis mi, ut dignissim mi mauris et risus.Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean quis pharetra risus. Aliquam ornare suscipit sem ac mollis. Phasellus fermentum lobortis mi non mattis. Praesent odio tellus, lacinia quis volutpat ac, hendrerit vitae velit. Vestibulum vestibulum maximus lorem sit amet aliquam. Sed pharetra, purus id accumsan vehicula, ipsum lorem rhoncus nibh, et ultrices nulla leo id neque. Nam ac luctus sem, eu viverra nisi. Nulla porttitor dui at libero molestie facilisis. Cras a tellus augue. Pellentesque tincidunt consequat congue. Maecenas et porttitor eros. Nam sed tellus nibh. Nullam placerat eu sem vitae pellentesque. Phasellus efficitur, urna ac posuere fringilla, turpis justo suscipit erat, in pharetra dui ante a lorem. Morbi porta orci blandit massa malesuada, vitae imperdiet dui vulputate. Sed dignissim, risus quis consectetur pellentesque, nisi quam lobortis eros, in porttitor odio quam nec libero. Vivamus finibus, elit eget tempor laoreet, purus dolor mattis mi, ut dignissim mi mauris et risus.Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean quis pharetra risus. Aliquam ornare suscipit sem ac mollis. Phasellus fermentum lobortis mi non mattis. Praesent odio tellus, lacinia quis volutpat ac, hendrerit vitae velit. Vestibulum vestibulum maximus lorem sit amet aliquam. Sed pharetra, purus id accumsan vehicula, ipsum lorem rhoncus nibh, et ultrices nulla leo id neque. Nam ac luctus sem, eu viverra nisi. Nulla porttitor dui at libero molestie facilisis. Cras a tellus augue. Pellentesque tincidunt consequat congue. Maecenas et porttitor eros. Nam sed tellus nibh. Nullam placerat eu sem vitae pellentesque. Phasellus efficitur, urna ac posuere fringilla, turpis justo suscipit erat, in pharetra dui ante a lorem. Morbi porta orci blandit massa malesuada, vitae imperdiet dui vulputate. Sed dignissim, risus quis consectetur pellentesque, nisi quam lobortis eros, in porttitor odio quam nec libero. Vivamus finibus, elit eget tempor laoreet, purus dolor mattis mi, ut dignissim mi mauris et risus.",this.ville="Le Mans",this.coordonnees="48.00679639723815, 0.19642185178061575"}}return e.\u0275fac=function(n){return new(n||e)(_t(VC),_t(SC))},e.\u0275cmp=Fi({type:e,selectors:[["app-test-musique"]],decls:25,vars:9,consts:[["id","menuUp",1,"scroll","inactive"],["src","https://cdn.discordapp.com/attachments/520318904170709023/938019079955042314/Down.png","alt","icon lower",2,"display","none"],["id","trigger-btn",1,"trigger-btn",3,"click"],["id","greater-btn",1,"greater-btn","greater-btn-inactive","greater-btn-img-inactive",3,"click"],["id","lower-btn",1,"lower-btn","invisible","greater-btn-img-active",3,"click"],["id","close-btn",1,"close-btn","invisible","close-btn-inactive",3,"click"],["id","greater-btn",1,"greater-btn","invisible",3,"click"],[1,"titre1"],[1,"artiste"],["target","_blank",3,"href"],["src","https://cdn.discordapp.com/attachments/382597109167161344/953648198126284911/icon-musicbrainz.png",1,"icon"],[1,"lecteur"],["id","videoPlayer","width","420","height","315",3,"src"],[1,"aPropos"],[1,"description"]],template:function(n,s){1&n&&(ze(0,"div",0),Yt(1,"img",1),ze(2,"div",2),Xr("click",function(){return s.showMenu()}),Be(),ze(3,"div",3),Xr("click",function(){return s.greaterMenu()}),Be(),ze(4,"div",4),Xr("click",function(){return s.lowerMenu()}),Be(),ze(5,"div",5),Xr("click",function(){return s.hideMenu()}),Be(),ze(6,"div",6),Xr("click",function(){return s.hideMenu()}),Be(),ze(7,"h1",7),Rt(8),Be(),ze(9,"h3",8),Rt(10),Be(),ze(11,"div"),ze(12,"a",9),Yt(13,"img",10),Be(),Be(),ze(14,"div",11),Yt(15,"iframe",12),function Ab(e,t){const n=on();let s;const l=e+20;n.firstCreatePass?(s=function RM(e,t){if(t)for(let n=t.length-1;n>=0;n--){const s=t[n];if(e===s.name)return s}}(t,n.pipeRegistry),n.data[l]=s,s.onDestroy&&(n.destroyHooks||(n.destroyHooks=[])).push(l,s.onDestroy)):s=n.data[l];const d=s.factory||(s.factory=zo(s.type)),y=vr(_t);try{const w=wn(!1),D=d();return wn(w),function qC(e,t,n,s){n>=e.data.length&&(e.data[n]=null,e.blueprint[n]=null),t[n]=s}(n,Ne(),l,D),D}finally{vr(y)}}(16,"safe"),Be(),ze(17,"h2"),Rt(18),Be(),ze(19,"h3"),Rt(20),Be(),ze(21,"h3",13),Rt(22,"\xc0 Propos"),Be(),ze(23,"p",14),Rt(24),Be(),Be()),2&n&&(gl(8),hp(s.songTileService.titre),gl(2),hp(s.songTileService.artiste),gl(2),i_("href","https://musicbrainz.org/artist/",s.songTileService.artisteID,"",yh),gl(3),yv("src",Pb(16,7,s.songTileService.videoLink),rc),gl(3),hp(s.songTileService.ville),gl(2),s_("(",s.songTileService.coordonnees,")"),gl(4),hp(s.songTileService.description))},pipes:[UR],styles:["[_ngcontent-%COMP%]::-webkit-scrollbar{width:0px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}.titre1[_ngcontent-%COMP%]{margin-top:3.2%;margin-bottom:-30px;text-transform:uppercase;color:#e5e4e4}.icon[_ngcontent-%COMP%]{width:25px;height:25px;margin:-35px 5px 5px;opacity:.5;transition:.2s}.icon[_ngcontent-%COMP%]:hover{opacity:1;cursor:pointer}.description[_ngcontent-%COMP%]{width:80%;text-align:center;position:relative;left:50%;transform:translate(-50%);color:#e5e4e4;margin-bottom:3%}h2[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:#ccc610;margin-bottom:-1%}h2.span[_ngcontent-%COMP%]{font-weight:200}.artiste[_ngcontent-%COMP%], h3[_ngcontent-%COMP%]{color:#ccc610}.aPropos[_ngcontent-%COMP%]{color:#e5e4e4;font-weight:600;margin-top:2%;font-size:22px}.lecteur[_ngcontent-%COMP%]{margin:3% 0}.trigger-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938019080412209172/Up.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;align-items:center;left:49%;top:3%;transition:.3s}.trigger-btn[_ngcontent-%COMP%]:hover{cursor:pointer}.close-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938105617694982154/Cross.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;left:95%;margin-bottom:-1%;padding:0;position:absolute;position:fixed;transition:.3s}.close-btn-active[_ngcontent-%COMP%]{top:61%}.close-btn-inactive[_ngcontent-%COMP%]{top:100%}.close-btn-greater[_ngcontent-%COMP%]{top:23%}.close-btn[_ngcontent-%COMP%]:hover{cursor:pointer}.lower-btn[_ngcontent-%COMP%]{width:35px;height:35px;text-align:center;position:relative;left:92%;margin-bottom:-1%;top:23%;padding:0;position:fixed;transition:.3s}.lower-btn[_ngcontent-%COMP%]:hover{cursor:pointer}.greater-btn[_ngcontent-%COMP%]{width:35px;height:35px;text-align:center;position:relative;left:92%;margin-bottom:-1%;padding:0;transition:.3s;position:fixed}.greater-btn-img-active[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938019079955042314/Down.png);background-repeat:no-repeat;background-size:cover}.greater-btn-img-inactive[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938019080412209172/Up.png);background-repeat:no-repeat;background-size:cover}.greater-btn-greater[_ngcontent-%COMP%]{top:23%}.greater-btn-active[_ngcontent-%COMP%]{top:61%}.greater-btn-inactive[_ngcontent-%COMP%]{top:100%}.greater-btn[_ngcontent-%COMP%]:hover{cursor:pointer}#menuUp[_ngcontent-%COMP%]{position:absolute;width:100%;background:#1C1C1C;text-align:center;left:0;transition:.3s;position:fixed;z-index:2000}.active[_ngcontent-%COMP%]{bottom:0;overflow-y:auto;height:43%}.inactive[_ngcontent-%COMP%]{bottom:-36%;overflow:hidden;height:43%}.greater[_ngcontent-%COMP%]{height:80%}@media screen and (max-width: 415px){.titre1[_ngcontent-%COMP%]{margin-bottom:-35px;text-transform:uppercase;color:#e5e4e4;font-size:32px}.icon[_ngcontent-%COMP%]{width:15px;height:15px;margin:-35px 5px 5px}h2[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#ccc610;margin-bottom:-6%}h2.span[_ngcontent-%COMP%]{font-weight:200}.artiste[_ngcontent-%COMP%]{font-size:18px;color:#ccc610}h3[_ngcontent-%COMP%]{color:#ccc610;font-size:12px}.description[_ngcontent-%COMP%]{width:80%;text-align:center;position:relative;left:50%;transform:translate(-50%);color:#e5e4e4;margin-bottom:3%;font-size:12px;line-height:18px}.aPropos[_ngcontent-%COMP%]{color:#e5e4e4;font-weight:600;margin-top:3%;margin-bottom:-1%;font-size:22px}.trigger-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938019080412209172/Up.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;align-items:center;left:50%;transform:translate(-50%);top:2%;transition:.3s}.close-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938019079955042314/Down.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;top:3%;left:50%;transform:translate(-50%);margin-bottom:-1%;padding:0;transition:.3s}}@media screen and (max-width: 1440px){.titre1[_ngcontent-%COMP%]{margin-bottom:-35px;margin-top:2%;text-transform:uppercase;color:#e5e4e4;font-size:38px}.icon[_ngcontent-%COMP%]{width:20px;height:20px;margin:-35px 5px 5px}h2[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#ccc610;margin-bottom:-2%}h2.span[_ngcontent-%COMP%]{font-weight:200}.artiste[_ngcontent-%COMP%]{font-size:24px;color:#ccc610}h3[_ngcontent-%COMP%]{color:#ccc610;font-size:18px}.description[_ngcontent-%COMP%]{width:80%;text-align:center;position:relative;left:50%;transform:translate(-50%);color:#e5e4e4;margin-bottom:3%;font-size:16px;line-height:18px}.aPropos[_ngcontent-%COMP%]{color:#e5e4e4;font-weight:600;margin-top:3%;margin-bottom:-.5%;font-size:22px}.trigger-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938019080412209172/Up.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;align-items:center;left:50%;transform:translate(-50%);top:2%;transition:.3s}.close-btn[_ngcontent-%COMP%]{background:url(https://cdn.discordapp.com/attachments/520318904170709023/938019079955042314/Down.png);background-repeat:no-repeat;background-size:cover;width:35px;height:35px;text-align:center;position:relative;top:3%;left:50%;transform:translate(-50%);margin-bottom:-1%;padding:0;transition:.3s}}"]}),e})(),VR=(()=>{class e{constructor(){this.title="my-app"}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Fi({type:e,selectors:[["app-root"]],decls:10,vars:0,consts:[[1,"centre"]],template:function(n,s){1&n&&(ze(0,"div",0),ze(1,"div"),Yt(2,"app-apropos"),Yt(3,"app-contacter"),Yt(4,"app-carte"),Yt(5,"app-darker"),Yt(6,"app-btn-sidebar"),ze(7,"div"),Yt(8,"app-sidebar"),Be(),Yt(9,"app-test-musique"),Be(),Be())},directives:[Gk,Hk,FR,zR,BR,NR,jR],styles:[""]}),e})(),$R=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ro({type:e,bootstrap:[VR]}),e.\u0275inj=mi({providers:[],imports:[[OR,lA,$k]]}),e})();(function FS(){gw=!1})(),sA().bootstrapModule($R).catch(e=>console.error(e))},898:function(Mp){Mp.exports=function(){"use strict";var kc,Rc,$n;function Au(p,Yn){if(kc)if(Rc){var qo="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+kc+")(sharedChunk); ("+Rc+")(sharedChunk); self.onerror = null;",pi={};kc(pi),$n=Yn(pi),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&($n.workerUrl=window.URL.createObjectURL(new Blob([qo],{type:"text/javascript"})))}else Rc=Yn;else kc=Yn}return Au(0,function(p){var qo=pi;function pi(i,r,a,c){this.cx=3*i,this.bx=3*(a-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=c,this.p2x=a,this.p2y=c}pi.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},pi.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},pi.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},pi.prototype.solveCurveX=function(i,r){var a,c,h,f,_;for(void 0===r&&(r=1e-6),h=i,_=0;_<8;_++){if(f=this.sampleCurveX(h)-i,Math.abs(f)<r)return h;var x=this.sampleCurveDerivativeX(h);if(Math.abs(x)<1e-6)break;h-=f/x}if((h=i)<(a=0))return a;if(h>(c=1))return c;for(;a<c;){if(f=this.sampleCurveX(h),Math.abs(f-i)<r)return h;i>f?a=h:c=h,h=.5*(c-a)+a}return h},pi.prototype.solve=function(i,r){return this.sampleCurveY(this.solveCurveX(i,r))};var Je=wt;function wt(i,r){this.x=i,this.y=r}wt.prototype={clone:function(){return new wt(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,r){return this.clone()._rotateAround(i,r)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var r=i.x-this.x,a=i.y-this.y;return r*r+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,r){return Math.atan2(this.x*r-this.y*i,this.x*i+this.y*r)},_matMult:function(i){var r=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=r,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var r=Math.cos(i),a=Math.sin(i),c=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=c,this},_rotateAround:function(i,r){var a=Math.cos(i),c=Math.sin(i),h=r.y+c*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-c*(this.y-r.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},wt.convert=function(i){return i instanceof wt?i:Array.isArray(i)?new wt(i[0],i[1]):i};var Pe="undefined"!=typeof self?self:{},Ai=1e-6,Ln="undefined"!=typeof Float32Array?Float32Array:Array;function Il(){var i=new Ln(9);return Ln!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function fi(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Al(i,r,a){var c=r[0],h=r[1],f=r[2],_=r[3],x=r[4],E=r[5],T=r[6],S=r[7],I=r[8],P=r[9],z=r[10],N=r[11],$=r[12],q=r[13],J=r[14],oe=r[15],ce=a[0],he=a[1],fe=a[2],pe=a[3];return i[0]=ce*c+he*x+fe*I+pe*$,i[1]=ce*h+he*E+fe*P+pe*q,i[2]=ce*f+he*T+fe*z+pe*J,i[3]=ce*_+he*S+fe*N+pe*oe,i[4]=(ce=a[4])*c+(he=a[5])*x+(fe=a[6])*I+(pe=a[7])*$,i[5]=ce*h+he*E+fe*P+pe*q,i[6]=ce*f+he*T+fe*z+pe*J,i[7]=ce*_+he*S+fe*N+pe*oe,i[8]=(ce=a[8])*c+(he=a[9])*x+(fe=a[10])*I+(pe=a[11])*$,i[9]=ce*h+he*E+fe*P+pe*q,i[10]=ce*f+he*T+fe*z+pe*J,i[11]=ce*_+he*S+fe*N+pe*oe,i[12]=(ce=a[12])*c+(he=a[13])*x+(fe=a[14])*I+(pe=a[15])*$,i[13]=ce*h+he*E+fe*P+pe*q,i[14]=ce*f+he*T+fe*z+pe*J,i[15]=ce*_+he*S+fe*N+pe*oe,i}function so(i,r,a){var c,h,f,_,x,E,T,S,I,P,z,N,$=a[0],q=a[1],J=a[2];return r===i?(i[12]=r[0]*$+r[4]*q+r[8]*J+r[12],i[13]=r[1]*$+r[5]*q+r[9]*J+r[13],i[14]=r[2]*$+r[6]*q+r[10]*J+r[14],i[15]=r[3]*$+r[7]*q+r[11]*J+r[15]):(h=r[1],f=r[2],_=r[3],x=r[4],E=r[5],T=r[6],S=r[7],I=r[8],P=r[9],z=r[10],N=r[11],i[0]=c=r[0],i[1]=h,i[2]=f,i[3]=_,i[4]=x,i[5]=E,i[6]=T,i[7]=S,i[8]=I,i[9]=P,i[10]=z,i[11]=N,i[12]=c*$+x*q+I*J+r[12],i[13]=h*$+E*q+P*J+r[13],i[14]=f*$+T*q+z*J+r[14],i[15]=_*$+S*q+N*J+r[15]),i}function Tr(i,r,a){var c=a[0],h=a[1],f=a[2];return i[0]=r[0]*c,i[1]=r[1]*c,i[2]=r[2]*c,i[3]=r[3]*c,i[4]=r[4]*h,i[5]=r[5]*h,i[6]=r[6]*h,i[7]=r[7]*h,i[8]=r[8]*f,i[9]=r[9]*f,i[10]=r[10]*f,i[11]=r[11]*f,i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],i}function Zo(i,r,a){var c=Math.sin(a),h=Math.cos(a),f=r[4],_=r[5],x=r[6],E=r[7],T=r[8],S=r[9],I=r[10],P=r[11];return r!==i&&(i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[4]=f*h+T*c,i[5]=_*h+S*c,i[6]=x*h+I*c,i[7]=E*h+P*c,i[8]=T*h-f*c,i[9]=S*h-_*c,i[10]=I*h-x*c,i[11]=P*h-E*c,i}function To(i,r,a){var c=Math.sin(a),h=Math.cos(a),f=r[0],_=r[1],x=r[2],E=r[3],T=r[8],S=r[9],I=r[10],P=r[11];return r!==i&&(i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[0]=f*h-T*c,i[1]=_*h-S*c,i[2]=x*h-I*c,i[3]=E*h-P*c,i[8]=f*c+T*h,i[9]=_*c+S*h,i[10]=x*c+I*h,i[11]=E*c+P*h,i}Math.hypot||(Math.hypot=function(){for(var i=0,r=arguments.length;r--;)i+=arguments[r]*arguments[r];return Math.sqrt(i)});var Wo=Al;function xs(){var i=new Ln(3);return Ln!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Xo(i){var r=new Ln(3);return r[0]=i[0],r[1]=i[1],r[2]=i[2],r}function Pl(i){return Math.hypot(i[0],i[1],i[2])}function ao(i,r,a){var c=new Ln(3);return c[0]=i,c[1]=r,c[2]=a,c}function kl(i,r,a){return i[0]=r[0]+a[0],i[1]=r[1]+a[1],i[2]=r[2]+a[2],i}function bs(i,r,a){return i[0]=r[0]-a[0],i[1]=r[1]-a[1],i[2]=r[2]-a[2],i}function $i(i,r,a){return i[0]=r[0]*a[0],i[1]=r[1]*a[1],i[2]=r[2]*a[2],i}function Yh(i,r,a){return i[0]=Math.max(r[0],a[0]),i[1]=Math.max(r[1],a[1]),i[2]=Math.max(r[2],a[2]),i}function lo(i,r,a){return i[0]=r[0]*a,i[1]=r[1]*a,i[2]=r[2]*a,i}function sn(i,r,a,c){return i[0]=r[0]+a[0]*c,i[1]=r[1]+a[1]*c,i[2]=r[2]+a[2]*c,i}function Xs(i,r){var a=r[0],c=r[1],h=r[2],f=a*a+c*c+h*h;return f>0&&(f=1/Math.sqrt(f)),i[0]=r[0]*f,i[1]=r[1]*f,i[2]=r[2]*f,i}function Do(i,r){return i[0]*r[0]+i[1]*r[1]+i[2]*r[2]}function Ua(i,r,a){var c=r[0],h=r[1],f=r[2],_=a[0],x=a[1],E=a[2];return i[0]=h*E-f*x,i[1]=f*_-c*E,i[2]=c*x-h*_,i}function Xt(i,r,a){var c=r[0],h=r[1],f=r[2],_=a[3]*c+a[7]*h+a[11]*f+a[15];return i[0]=(a[0]*c+a[4]*h+a[8]*f+a[12])/(_=_||1),i[1]=(a[1]*c+a[5]*h+a[9]*f+a[13])/_,i[2]=(a[2]*c+a[6]*h+a[10]*f+a[14])/_,i}function Gi(i,r,a){var c=a[0],h=a[1],f=a[2],_=r[0],x=r[1],E=r[2],T=h*E-f*x,S=f*_-c*E,I=c*x-h*_,P=h*I-f*S,z=f*T-c*I,N=c*S-h*T,$=2*a[3];return S*=$,I*=$,z*=2,N*=2,i[0]=_+(T*=$)+(P*=2),i[1]=x+S+z,i[2]=E+I+N,i}var ws,i,Es=bs,_r=$i,Jn=Pl;function Gt(i,r,a){var c=r[0],h=r[1],f=r[2],_=r[3];return i[0]=a[0]*c+a[4]*h+a[8]*f+a[12]*_,i[1]=a[1]*c+a[5]*h+a[9]*f+a[13]*_,i[2]=a[2]*c+a[6]*h+a[10]*f+a[14]*_,i[3]=a[3]*c+a[7]*h+a[11]*f+a[15]*_,i}function Ks(){var i=new Ln(4);return Ln!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Pu(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function Rl(i,r,a){a*=.5;var c=r[0],h=r[1],f=r[2],_=r[3],x=Math.sin(a),E=Math.cos(a);return i[0]=c*E+_*x,i[1]=h*E+f*x,i[2]=f*E-h*x,i[3]=_*E-c*x,i}function Lc(i,r){return i[0]===r[0]&&i[1]===r[1]}xs(),ws=new Ln(4),Ln!=Float32Array&&(ws[0]=0,ws[1]=0,ws[2]=0,ws[3]=0),xs(),ao(1,0,0),ao(0,1,0),Ks(),Ks(),Il(),i=new Ln(2),Ln!=Float32Array&&(i[0]=0,i[1]=0);const ku=Math.PI/180,Ll=180/Math.PI;function Nt(i){return i*ku}function Pi(i){return i*Ll}const ja=[[0,0],[1,0],[1,1],[0,1]];function Va(i){if(i<=0)return 0;if(i>=1)return 1;const r=i*i,a=r*i;return 4*(i<.5?a:3*(i-r)+a-.75)}function Oc(i,r,a,c){const h=new qo(i,r,a,c);return function(f){return h.solve(f)}}const $a=Oc(.25,.1,.25,1);function _n(i,r,a){return Math.min(a,Math.max(r,i))}function Ys(i,r,a){return(a=_n((a-i)/(r-i),0,1))*a*(3-2*a)}function Cs(i,r,a){const c=a-r,h=((i-r)%c+c)%c+r;return h===r?a:h}function Ga(i,r,a){if(!i.length)return a(null,[]);let c=i.length;const h=new Array(i.length);let f=null;i.forEach((_,x)=>{r(_,(E,T)=>{E&&(f=E),h[x]=T,0==--c&&a(f,h)})})}function Hi(i){const r=[];for(const a in i)r.push(i[a]);return r}function Xn(i,...r){for(const a of r)for(const c in a)i[c]=a[c];return i}let Fc=1;function Ol(){return Fc++}function zc(){return function i(r){return r?(r^16*Math.random()>>r/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function qi(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Ru(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Fl(i,r){i.forEach(a=>{r[a]&&(r[a]=r[a].bind(r))})}function zl(i,r){return-1!==i.indexOf(r,i.length-r.length)}function Js(i,r,a){const c={};for(const h in i)c[h]=r.call(a||this,i[h],h,i);return c}function Qs(i,r,a){const c={};for(const h in i)r.call(a||this,i[h],h,i)&&(c[h]=i[h]);return c}function ki(i){return Array.isArray(i)?i.map(ki):"object"==typeof i&&i?Js(i,ki):i}const Bl={};function zn(i){Bl[i]||("undefined"!=typeof console&&console.warn(i),Bl[i]=!0)}function Ri(i,r,a){return(a.y-i.y)*(r.x-i.x)>(r.y-i.y)*(a.x-i.x)}function Ha(i){let r=0;for(let a,c,h=0,f=i.length,_=f-1;h<f;_=h++)a=i[h],c=i[_],r+=(c.x-a.x)*(a.y+c.y);return r}function co(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function ea(i){const r={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,c,h,f)=>{const _=h||f;return r[c]=!_||_.toLowerCase(),""}),r["max-age"]){const a=parseInt(r["max-age"],10);isNaN(a)?delete r["max-age"]:r["max-age"]=a}return r}let Ts,Mo,yr,Ds=null;function So(i){if(null==Ds){const r=i.navigator?i.navigator.userAgent:null;Ds=!!i.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Ds}function qa(i){try{const r=Pe[i];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch(r){return!1}}const Li={now:()=>void 0!==yr?yr:Pe.performance.now(),setNow(i){yr=i},restoreNow(){yr=void 0},frame(i){const r=Pe.requestAnimationFrame(i);return{cancel:()=>Pe.cancelAnimationFrame(r)}},getImageData(i,r=0){const a=Pe.document.createElement("canvas"),c=a.getContext("2d");if(!c)throw new Error("failed to create canvas 2d context");return a.width=i.width,a.height=i.height,c.drawImage(i,0,0,i.width,i.height),c.getImageData(-r,-r,i.width+2*r,i.height+2*r)},resolveURL:i=>(Ts||(Ts=Pe.document.createElement("a")),Ts.href=i,Ts.href),get devicePixelRatio(){return Pe.devicePixelRatio},get prefersReducedMotion(){return!!Pe.matchMedia&&(null==Mo&&(Mo=Pe.matchMedia("(prefers-reduced-motion: reduce)")),Mo.matches)}};let K;const O={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==K){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{K=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):i}catch(r){K=i}}return K},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},U={supported:!1,testSupport:function(i){!se&&Q&&(me?de(i):X=i)}};let X,Q,se=!1,me=!1;function de(i){const r=i.createTexture();i.bindTexture(i.TEXTURE_2D,r);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Q),i.isContextLost())return;U.supported=!0}catch(a){}i.deleteTexture(r),se=!0}Pe.document&&(Q=Pe.document.createElement("img"),Q.onload=function(){X&&de(X),X=null,me=!0},Q.onerror=function(){se=!0,X=null},Q.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ue="01",ye="NO_ACCESS_TOKEN";function Me(i){return 0===i.indexOf("mapbox:")}function Ae(i){return O.API_URL_REGEX.test(i)}const Fe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ot(i){const r=i.match(Fe);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function ft(i){const r=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${r}`}function pt(i){if(!i)return null;const r=i.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(Pe.atob(r[1]).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(a){return null}}class mt{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const a=pt(O.ACCESS_TOKEN);let c="";return c=a&&a.u?Pe.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,(h,f)=>String.fromCharCode(Number("0x"+f)))):O.ACCESS_TOKEN||"",r?`mapbox.eventData.${r}:${c}`:`mapbox.eventData:${c}`}fetchEventData(){const r=qa("localStorage"),a=this.getStorageKey(),c=this.getStorageKey("uuid");if(r)try{const h=Pe.localStorage.getItem(a);h&&(this.eventData=JSON.parse(h));const f=Pe.localStorage.getItem(c);f&&(this.anonId=f)}catch(h){zn("Unable to read from LocalStorage")}}saveEventData(){const r=qa("localStorage"),a=this.getStorageKey(),c=this.getStorageKey("uuid");if(r)try{Pe.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&Pe.localStorage.setItem(a,JSON.stringify(this.eventData))}catch(h){zn("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,a,c,h){if(!O.EVENTS_URL)return;const f=ot(O.EVENTS_URL);f.params.push(`access_token=${h||O.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(r).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.7.0",skuId:ue,userId:this.anonId},x=a?Xn(_,a):_,E={url:ft(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=Yo(E,T=>{this.pendingRequest=null,c(T),this.saveEventData(),this.processRequests(h)})}queueRequest(r,a){this.queue.push(r),this.processRequests(a)}}const Lt=new class extends mt{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,r){O.EVENTS_URL&&O.ACCESS_TOKEN&&Array.isArray(i)&&i.some(a=>Me(a)||Ae(a))&&this.queueRequest(Date.now(),r)}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=pt(O.ACCESS_TOKEN),a=r?r.u:O.ACCESS_TOKEN;let c=a!==this.eventData.tokenU;Ru(this.anonId)||(this.anonId=zc(),c=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),_=new Date(h),x=(h-this.eventData.lastSuccess)/864e5;c=c||x>=1||x<-1||f.getDate()!==_.getDate()}else c=!0;if(!c)return this.processRequests();this.postEvent(h,{"enabled.telemetry":!1},f=>{f||(this.eventData.lastSuccess=h,this.eventData.tokenU=a)},i)}},Sn=Lt.postTurnstileEvent.bind(Lt),On=new class extends mt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,r,a,c){this.skuToken=r,this.errorCb=c,O.EVENTS_URL&&(a||O.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},a):this.errorCb(new Error(ye)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),Ru(this.anonId)||(this.anonId=zc()),this.postEvent(a,{skuToken:this.skuToken},c=>{c?this.errorCb(c):r&&(this.success[r]=!0)},i))}},Tn=On.postMapLoadEvent.bind(On),kn=new class extends mt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,r,a,c){if(!O.API_URL||!O.SESSION_PATH)return;const h=ot(O.API_URL+O.SESSION_PATH);h.params.push(`sku=${r||""}`),h.params.push(`access_token=${c||O.ACCESS_TOKEN||""}`);const f={url:ft(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=vn(f,_=>{this.pendingRequest=null,a(_),this.saveEventData(),this.processRequests(c)})}getSessionAPI(i,r,a,c){this.skuToken=r,this.errorCb=c,O.SESSION_PATH&&O.API_URL&&(a||O.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},a):this.errorCb(new Error(ye)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||this.getSession(a,this.skuToken,c=>{c?this.errorCb(c):r&&(this.success[r]=!0)},i)}},Ms=kn.getSessionAPI.bind(kn),Ko=new Set,hn="mapbox-tiles";let Io,ta,Jh=500,Nl=50;function yn(){Pe.caches&&!Io&&(Io=Pe.caches.open(hn))}function Ul(i){const r=i.indexOf("?");return r<0?i:i.slice(0,r)}let fn=1/0;const Za={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Za);class jl extends Error{constructor(r,a,c){401===a&&Ae(c)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(r),this.status=a,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Vl=co()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Pe.location.protocol?Pe.parent:Pe).location.href,vt=function(i,r){if(!(/^file:/.test(a=i.url)||/^file:/.test(Vl())&&!/^\w+:/.test(a))){if(Pe.fetch&&Pe.Request&&Pe.AbortController&&Pe.Request.prototype.hasOwnProperty("signal"))return function(c,h){const f=new Pe.AbortController,_=new Pe.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Vl(),signal:f.signal});let x=!1,E=!1;const T=(S=_.url).indexOf("sku=")>0&&Ae(S);var S;"json"===c.type&&_.headers.set("Accept","application/json");const I=(z,N,$)=>{if(E)return;if(z&&"SecurityError"!==z.message&&zn(z),N&&$)return P(N);const q=Date.now();Pe.fetch(_).then(J=>{if(J.ok){const oe=T?J.clone():null;return P(J,oe,q)}return h(new jl(J.statusText,J.status,c.url))}).catch(J=>{20!==J.code&&h(new Error(J.message))})},P=(z,N,$)=>{("arrayBuffer"===c.type?z.arrayBuffer():"json"===c.type?z.json():z.text()).then(q=>{E||(N&&$&&function(J,oe,ce){if(yn(),!Io)return;const he={status:oe.status,statusText:oe.statusText,headers:new Pe.Headers};oe.headers.forEach((pe,Te)=>he.headers.set(Te,pe));const fe=ea(oe.headers.get("Cache-Control")||"");fe["no-store"]||(fe["max-age"]&&he.headers.set("Expires",new Date(ce+1e3*fe["max-age"]).toUTCString()),new Date(he.headers.get("Expires")).getTime()-ce<42e4||function(pe,Te){if(void 0===ta)try{new Response(new ReadableStream),ta=!0}catch(we){ta=!1}ta?Te(pe.body):pe.blob().then(Te)}(oe,pe=>{const Te=new Pe.Response(pe,he);yn(),Io&&Io.then(we=>we.put(Ul(J.url),Te)).catch(we=>zn(we.message))}))}(_,N,$),x=!0,h(null,q,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(q=>{E||h(new Error(q.message))})};return T?function(z,N){if(yn(),!Io)return N(null);const $=Ul(z.url);Io.then(q=>{q.match($).then(J=>{const oe=function(ce){if(!ce)return!1;const he=new Date(ce.headers.get("Expires")||0),fe=ea(ce.headers.get("Cache-Control")||"");return he>Date.now()&&!fe["no-cache"]}(J);q.delete($),oe&&q.put($,J.clone()),N(null,J,oe)}).catch(N)}).catch(N)}(_,I):I(null,null),{cancel:()=>{E=!0,x||f.abort()}}}(i,r);if(co()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,r,void 0,!0)}var a;return function(c,h){const f=new Pe.XMLHttpRequest;f.open(c.method||"GET",c.url,!0),"arrayBuffer"===c.type&&(f.responseType="arraybuffer");for(const _ in c.headers)f.setRequestHeader(_,c.headers[_]);return"json"===c.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===c.credentials,f.onerror=()=>{h(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let _=f.response;if("json"===c.type)try{_=JSON.parse(f.response)}catch(x){return h(x)}h(null,_,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else h(new jl(f.statusText,f.status,c.url))},f.send(c.body),{cancel:()=>f.abort()}}(i,r)},Wa=function(i,r){return vt(Xn(i,{type:"arrayBuffer"}),r)},Yo=function(i,r){return vt(Xn(i,{method:"POST"}),r)},vn=function(i,r){return vt(Xn(i,{method:"GET"}),r)};function Bc(i){const r=Pe.document.createElement("a");return r.href=i,r.protocol===Pe.document.location.protocol&&r.host===Pe.document.location.host}const Et="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let cr,$l;cr=[],$l=0;const Ip=function(i,r){if(U.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),$l>=O.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:i,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return cr.push(f),f}$l++;let a=!1;const c=()=>{if(!a)for(a=!0,$l--;cr.length&&$l<O.MAX_PARALLEL_IMAGE_REQUESTS;){const f=cr.shift(),{requestParameters:_,callback:x,cancelled:E}=f;E||(f.cancel=Ip(_,x).cancel)}},h=Wa(i,(f,_,x,E)=>{c(),f?r(f):_&&(Pe.createImageBitmap?function(T,S){const I=new Pe.Blob([new Uint8Array(T)],{type:"image/png"});Pe.createImageBitmap(I).then(P=>{S(null,P)}).catch(P=>{S(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(T,S)=>r(T,S,x,E)):function(T,S){const I=new Pe.Image,P=Pe.URL;I.onload=()=>{S(null,I),P.revokeObjectURL(I.src),I.onload=null,Pe.requestAnimationFrame(()=>{I.src=Et})},I.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new Pe.Blob([new Uint8Array(T)],{type:"image/png"});I.src=T.byteLength?P.createObjectURL(z):Et}(_,(T,S)=>r(T,S,x,E)))});return{cancel:()=>{h.cancel(),c()}}};function Ap(i,r,a){a[i]&&-1!==a[i].indexOf(r)||(a[i]=a[i]||[],a[i].push(r))}function na(i,r,a){if(a&&a[i]){const c=a[i].indexOf(r);-1!==c&&a[i].splice(c,1)}}class ur{constructor(r,a={}){Xn(this,a),this.type=r}}class Lu extends ur{constructor(r,a={}){super("error",Xn({error:r},a))}}class Ss{on(r,a){return this._listeners=this._listeners||{},Ap(r,a,this._listeners),this}off(r,a){return na(r,a,this._listeners),na(r,a,this._oneTimeListeners),this}once(r,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Ap(r,a,this._oneTimeListeners),this):new Promise(c=>this.once(r,c))}fire(r,a){"string"==typeof r&&(r=new ur(r,a||{}));const c=r.type;if(this.listens(c)){r.target=this;const h=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const x of h)x.call(this,r);const f=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const x of f)na(c,x,this._oneTimeListeners),x.call(this,r);const _=this._eventedParent;_&&(Xn(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(r))}else r instanceof Lu&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,a){return this._eventedParent=r,this._eventedParentData=a,this}}var Ee=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Xe{constructor(r,a,c,h){this.message=(r?`${r}: `:"")+c,h&&(this.identifier=h),null!=a&&a.__line__&&(this.line=a.__line__)}}function Pp(i){const r=i.value;return r?[new Xe(i.key,r,"constants have been deprecated as of v8")]:[]}function ra(i,...r){for(const a of r)for(const c in a)i[c]=a[c];return i}function tr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Is(i){if(Array.isArray(i))return i.map(Is);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const r={};for(const a in i)r[a]=Is(i[a]);return r}return tr(i)}class Ao extends Error{constructor(r,a){super(a),this.message=a,this.key=r}}class Ou{constructor(r,a=[]){this.parent=r,this.bindings={};for(const[c,h]of a)this.bindings[c]=h}concat(r){return new Ou(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const As={kind:"null"},Qe={kind:"number"},xt={kind:"string"},ct={kind:"boolean"},Jo={kind:"color"},Gl={kind:"object"},Ot={kind:"value"},Tt={kind:"collator"},ia={kind:"formatted"},mi={kind:"resolvedImage"};function gi(i,r){return{kind:"array",itemType:i,N:r}}function Bn(i){if("array"===i.kind){const r=Bn(i.itemType);return"number"==typeof i.N?`array<${r}, ${i.N}>`:"value"===i.itemType.kind?"array":`array<${r}>`}return i.kind}const kp=[As,Qe,xt,ct,Jo,ia,Gl,gi(Ot),mi];function _i(i,r){if("error"===r.kind)return null;if("array"===i.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!_i(i.itemType,r.itemType))&&("number"!=typeof i.N||i.N===r.N))return null}else{if(i.kind===r.kind)return null;if("value"===i.kind)for(const a of kp)if(!_i(a,r))return null}return`Expected ${Bn(i)} but found ${Bn(r)} instead.`}function Hl(i,r){return r.some(a=>a.kind===i.kind)}function Qo(i,r){return r.some(a=>"null"===a?null===i:"array"===a?Array.isArray(i):"object"===a?i&&!Array.isArray(i)&&"object"==typeof i:a===typeof i)}function Ps(i){var r={exports:{}};return i(r,r.exports),r.exports}var oa=Ps(function(i,r){var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(x){return(x=Math.round(x))<0?0:x>255?255:x}function h(x){return c("%"===x[x.length-1]?parseFloat(x)/100*255:parseInt(x))}function f(x){return(E="%"===x[x.length-1]?parseFloat(x)/100:parseFloat(x))<0?0:E>1?1:E;var E}function _(x,E,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?x+(E-x)*T*6:2*T<1?E:3*T<2?x+(E-x)*(2/3-T)*6:x}try{r.parseCSSColor=function(x){var E,T=x.replace(/ /g,"").toLowerCase();if(T in a)return a[T].slice();if("#"===T[0])return 4===T.length?(E=parseInt(T.substr(1),16))>=0&&E<=4095?[(3840&E)>>4|(3840&E)>>8,240&E|(240&E)>>4,15&E|(15&E)<<4,1]:null:7===T.length&&(E=parseInt(T.substr(1),16))>=0&&E<=16777215?[(16711680&E)>>16,(65280&E)>>8,255&E,1]:null;var S=T.indexOf("("),I=T.indexOf(")");if(-1!==S&&I+1===T.length){var P=T.substr(0,S),z=T.substr(S+1,I-(S+1)).split(","),N=1;switch(P){case"rgba":if(4!==z.length)return null;N=f(z.pop());case"rgb":return 3!==z.length?null:[h(z[0]),h(z[1]),h(z[2]),N];case"hsla":if(4!==z.length)return null;N=f(z.pop());case"hsl":if(3!==z.length)return null;var $=(parseFloat(z[0])%360+360)%360/360,q=f(z[1]),J=f(z[2]),oe=J<=.5?J*(q+1):J+q-J*q,ce=2*J-oe;return[c(255*_(ce,oe,$+1/3)),c(255*_(ce,oe,$)),c(255*_(ce,oe,$-1/3)),N];default:return null}}return null}}catch(x){}});class Qt{constructor(r,a,c,h=1){this.r=r,this.g=a,this.b=c,this.a=h}static parse(r){if(!r)return;if(r instanceof Qt)return r;if("string"!=typeof r)return;const a=oa.parseCSSColor(r);return a?new Qt(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[r,a,c,h]=this.toArray();return`rgba(${Math.round(r)},${Math.round(a)},${Math.round(c)},${h})`}toArray(){const{r,g:a,b:c,a:h}=this;return 0===h?[0,0,0,0]:[255*r/h,255*a/h,255*c/h,h]}}Qt.black=new Qt(0,0,0,1),Qt.white=new Qt(1,1,1,1),Qt.transparent=new Qt(0,0,0,0),Qt.red=new Qt(1,0,0,1),Qt.blue=new Qt(0,0,1,1);class Mt{constructor(r,a,c){this.sensitivity=r?a?"variant":"case":a?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,a){return this.collator.compare(r,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ql{constructor(r,a,c,h,f){this.text=r.normalize?r.normalize():r,this.image=a,this.scale=c,this.fontStack=h,this.textColor=f}}class St{constructor(r){this.sections=r}static fromString(r){return new St([new ql(r,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(r=>0!==r.text.length||r.image&&0!==r.image.name.length)}static factory(r){return r instanceof St?r:St.fromString(r)}toString(){return 0===this.sections.length?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const a of this.sections){if(a.image){r.push(["image",a.image.name]);continue}r.push(a.text);const c={};a.fontStack&&(c["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(c["font-scale"]=a.scale),a.textColor&&(c["text-color"]=["rgba"].concat(a.textColor.toArray())),r.push(c)}return r}}class vr{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new vr({name:r,available:!1}):null}serialize(){return["image",this.name]}}function Fu(i,r,a,c){return"number"==typeof i&&i>=0&&i<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof a&&a>=0&&a<=255?void 0===c||"number"==typeof c&&c>=0&&c<=1?null:`Invalid rgba value [${[i,r,a,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof c?[i,r,a,c]:[i,r,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function zu(i){if(null===i||"string"==typeof i||"boolean"==typeof i||"number"==typeof i||i instanceof Qt||i instanceof Mt||i instanceof St||i instanceof vr)return!0;if(Array.isArray(i)){for(const r of i)if(!zu(r))return!1;return!0}if("object"==typeof i){for(const r in i)if(!zu(i[r]))return!1;return!0}return!1}function In(i){if(null===i)return As;if("string"==typeof i)return xt;if("boolean"==typeof i)return ct;if("number"==typeof i)return Qe;if(i instanceof Qt)return Jo;if(i instanceof Mt)return Tt;if(i instanceof St)return ia;if(i instanceof vr)return mi;if(Array.isArray(i)){const r=i.length;let a;for(const c of i){const h=In(c);if(a){if(a===h)continue;a=Ot;break}a=h}return gi(a||Ot,r)}return Gl}function Qr(i){const r=typeof i;return null===i?"":"string"===r||"number"===r||"boolean"===r?String(i):i instanceof Qt||i instanceof St||i instanceof vr?i.toString():JSON.stringify(i)}class sa{constructor(r,a){this.type=r,this.value=a}static parse(r,a){if(2!==r.length)return a.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!zu(r[1]))return a.error("invalid value");const c=r[1];let h=In(c);const f=a.expectedType;return"array"!==h.kind||0!==h.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(h=f),new sa(h,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Qt?["rgba"].concat(this.value.toArray()):this.value instanceof St?this.value.serialize():this.value}}class Fr{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const Oi={string:xt,number:Qe,boolean:ct,object:Gl};class Zi{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");let c,h=1;const f=r[0];if("array"===f){let x,E;if(r.length>2){const T=r[1];if("string"!=typeof T||!(T in Oi)||"object"===T)return a.error('The item type argument of "array" must be one of string, number, boolean',1);x=Oi[T],h++}else x=Ot;if(r.length>3){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return a.error('The length argument to "array" must be a positive integer literal',2);E=r[2],h++}c=gi(x,E)}else c=Oi[f];const _=[];for(;h<r.length;h++){const x=a.parse(r[h],h,Ot);if(!x)return null;_.push(x)}return new Zi(c,_)}evaluate(r){for(let a=0;a<this.args.length;a++){const c=this.args[a].evaluate(r);if(!_i(this.type,In(c)))return c;if(a===this.args.length-1)throw new Fr(`Expected value to be of type ${Bn(this.type)}, but found ${Bn(In(c))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,a=[r.kind];if("array"===r.kind){const c=r.itemType;if("string"===c.kind||"number"===c.kind||"boolean"===c.kind){a.push(c.kind);const h=r.N;("number"==typeof h||this.args.length>1)&&a.push(h)}}return a.concat(this.args.map(c=>c.serialize()))}}class Po{constructor(r){this.type=ia,this.sections=r}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const c=r[1];if(!Array.isArray(c)&&"object"==typeof c)return a.error("First argument must be an image or text section.");const h=[];let f=!1;for(let _=1;_<=r.length-1;++_){const x=r[_];if(f&&"object"==typeof x&&!Array.isArray(x)){f=!1;let E=null;if(x["font-scale"]&&(E=a.parse(x["font-scale"],1,Qe),!E))return null;let T=null;if(x["text-font"]&&(T=a.parse(x["text-font"],1,gi(xt)),!T))return null;let S=null;if(x["text-color"]&&(S=a.parse(x["text-color"],1,Jo),!S))return null;const I=h[h.length-1];I.scale=E,I.font=T,I.textColor=S}else{const E=a.parse(r[_],1,Ot);if(!E)return null;const T=E.type.kind;if("string"!==T&&"value"!==T&&"null"!==T&&"resolvedImage"!==T)return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,h.push({content:E,scale:null,font:null,textColor:null})}}return new Po(h)}evaluate(r){return new St(this.sections.map(a=>{const c=a.content.evaluate(r);return In(c)===mi?new ql("",c,null,null,null):new ql(Qr(c),null,a.scale?a.scale.evaluate(r):null,a.font?a.font.evaluate(r).join(","):null,a.textColor?a.textColor.evaluate(r):null)}))}eachChild(r){for(const a of this.sections)r(a.content),a.scale&&r(a.scale),a.font&&r(a.font),a.textColor&&r(a.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const a of this.sections){r.push(a.content.serialize());const c={};a.scale&&(c["font-scale"]=a.scale.serialize()),a.font&&(c["text-font"]=a.font.serialize()),a.textColor&&(c["text-color"]=a.textColor.serialize()),r.push(c)}return r}}class aa{constructor(r){this.type=mi,this.input=r}static parse(r,a){if(2!==r.length)return a.error("Expected two arguments.");const c=a.parse(r[1],1,xt);return c?new aa(c):a.error("No image name provided.")}evaluate(r){const a=this.input.evaluate(r),c=vr.fromString(a);return c&&r.availableImages&&(c.available=r.availableImages.indexOf(a)>-1),c}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const zm={"to-boolean":ct,"to-color":Jo,"to-number":Qe,"to-string":xt};class Kt{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const c=r[0];if(("to-boolean"===c||"to-string"===c)&&2!==r.length)return a.error("Expected one argument.");const h=zm[c],f=[];for(let _=1;_<r.length;_++){const x=a.parse(r[_],_,Ot);if(!x)return null;f.push(x)}return new Kt(h,f)}evaluate(r){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(r));if("color"===this.type.kind){let a,c;for(const h of this.args){if(a=h.evaluate(r),c=null,a instanceof Qt)return a;if("string"==typeof a){const f=r.parseColor(a);if(f)return f}else if(Array.isArray(a)&&(c=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Fu(a[0],a[1],a[2],a[3]),!c))return new Qt(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Fr(c||`Could not parse color from value '${"string"==typeof a?a:String(JSON.stringify(a))}'`)}if("number"===this.type.kind){let a=null;for(const c of this.args){if(a=c.evaluate(r),null===a)return 0;const h=Number(a);if(!isNaN(h))return h}throw new Fr(`Could not convert ${JSON.stringify(a)} to number.`)}return"formatted"===this.type.kind?St.fromString(Qr(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?vr.fromString(Qr(this.args[0].evaluate(r))):Qr(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Po([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new aa(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(a=>{r.push(a.serialize())}),r}}const Rp=["Unknown","Point","LineString","Polygon"];class Lp{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Rp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:c,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*a-r[0])+this.featureDistanceData.bearing[1]*(h*a-r[1])}return 0}parseColor(r){let a=this._parseColorCache[r];return a||(a=this._parseColorCache[r]=Qt.parse(r)),a}}class Dr{constructor(r,a,c,h){this.name=r,this.type=a,this._evaluate=c,this.args=h}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,a){const c=r[0],h=Dr.definitions[c];if(!h)return a.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=_.filter(([T])=>!Array.isArray(T)||T.length===r.length-1);let E=null;for(const[T,S]of x){E=new ua(a.registry,a.path,null,a.scope);const I=[];let P=!1;for(let z=1;z<r.length;z++){const N=r[z],$=Array.isArray(T)?T[z-1]:T.type,q=E.parse(N,1+I.length,$);if(!q){P=!0;break}I.push(q)}if(!P)if(Array.isArray(T)&&T.length!==I.length)E.error(`Expected ${T.length} arguments, but found ${I.length} instead.`);else{for(let z=0;z<I.length;z++){const N=Array.isArray(T)?T[z]:T.type,$=I[z];E.concat(z+1).checkSubtype(N,$.type)}if(0===E.errors.length)return new Dr(c,f,S,I)}}if(1===x.length)a.errors.push(...E.errors);else{const T=(x.length?x:_).map(([I])=>{return P=I,Array.isArray(P)?`(${P.map(Bn).join(", ")})`:`(${Bn(P.type)}...)`;var P}).join(" | "),S=[];for(let I=1;I<r.length;I++){const P=a.parse(r[I],1+S.length);if(!P)return null;S.push(Bn(P.type))}a.error(`Expected arguments of type ${T}, but found (${S.join(", ")}) instead.`)}return null}static register(r,a){Dr.definitions=a;for(const c in a)r[c]=Dr}}class xn{constructor(r,a,c){this.type=Tt,this.locale=c,this.caseSensitive=r,this.diacriticSensitive=a}static parse(r,a){if(2!==r.length)return a.error("Expected one argument.");const c=r[1];if("object"!=typeof c||Array.isArray(c))return a.error("Collator options argument must be an object.");const h=a.parse(void 0!==c["case-sensitive"]&&c["case-sensitive"],1,ct);if(!h)return null;const f=a.parse(void 0!==c["diacritic-sensitive"]&&c["diacritic-sensitive"],1,ct);if(!f)return null;let _=null;return c.locale&&(_=a.parse(c.locale,1,xt),!_)?null:new xn(h,f,_)}evaluate(r){return new Mt(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const uo=8192;function Xa(i,r){i[0]=Math.min(i[0],r[0]),i[1]=Math.min(i[1],r[1]),i[2]=Math.max(i[2],r[0]),i[3]=Math.max(i[3],r[1])}function la(i,r){return!(i[0]<=r[0]||i[2]>=r[2]||i[1]<=r[1]||i[3]>=r[3])}function Bu(i,r){const a=(180+i[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,r.z);return[Math.round(a*h*uo),Math.round(c*h*uo)]}function ko(i,r,a){const c=i[0]-r[0],h=i[1]-r[1],f=i[0]-a[0],_=i[1]-a[1];return c*_-f*h==0&&c*f<=0&&h*_<=0}function ca(i,r){let a=!1;for(let _=0,x=r.length;_<x;_++){const E=r[_];for(let T=0,S=E.length;T<S-1;T++){if(ko(i,E[T],E[T+1]))return!1;(h=E[T])[1]>(c=i)[1]!=(f=E[T+1])[1]>c[1]&&c[0]<(f[0]-h[0])*(c[1]-h[1])/(f[1]-h[1])+h[0]&&(a=!a)}}var c,h,f;return a}function Qh(i,r){for(let a=0;a<r.length;a++)if(ca(i,r[a]))return!0;return!1}function Fi(i,r,a,c){const h=c[0]-a[0],f=c[1]-a[1],_=(i[0]-a[0])*f-h*(i[1]-a[1]),x=(r[0]-a[0])*f-h*(r[1]-a[1]);return _>0&&x<0||_<0&&x>0}function Op(i,r,a){for(const T of a)for(let S=0;S<T.length-1;++S)if((x=[(_=T[S+1])[0]-(f=T[S])[0],_[1]-f[1]])[0]*(E=[(h=r)[0]-(c=i)[0],h[1]-c[1]])[1]-x[1]*E[0]!=0&&Fi(c,h,f,_)&&Fi(f,_,c,h))return!0;var c,h,f,_,x,E;return!1}function Nu(i,r){for(let a=0;a<i.length;++a)if(!ca(i[a],r))return!1;for(let a=0;a<i.length-1;++a)if(Op(i[a],i[a+1],r))return!1;return!0}function ed(i,r){for(let a=0;a<r.length;a++)if(Nu(i,r[a]))return!0;return!1}function Nc(i,r,a){const c=[];for(let h=0;h<i.length;h++){const f=[];for(let _=0;_<i[h].length;_++){const x=Bu(i[h][_],a);Xa(r,x),f.push(x)}c.push(f)}return c}function Ro(i,r,a){const c=[];for(let h=0;h<i.length;h++){const f=Nc(i[h],r,a);c.push(f)}return c}function Uu(i,r,a,c){if(i[0]<a[0]||i[0]>a[2]){const h=.5*c;let f=i[0]-a[0]>h?-c:a[0]-i[0]>h?c:0;0===f&&(f=i[0]-a[2]>h?-c:a[2]-i[0]>h?c:0),i[0]+=f}Xa(r,i)}function ju(i,r,a,c){const h=Math.pow(2,c.z)*uo,f=[c.x*uo,c.y*uo],_=[];for(const x of i)for(const E of x){const T=[E.x+f[0],E.y+f[1]];Uu(T,r,a,h),_.push(T)}return _}function zr(i,r,a,c){const h=Math.pow(2,c.z)*uo,f=[c.x*uo,c.y*uo],_=[];for(const E of i){const T=[];for(const S of E){const I=[S.x+f[0],S.y+f[1]];Xa(r,I),T.push(I)}_.push(T)}if(r[2]-r[0]<=h/2){(x=r)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const E of _)for(const T of E)Uu(T,r,a,h)}var x;return _}class nr{constructor(r,a){this.type=ct,this.geojson=r,this.geometries=a}static parse(r,a){if(2!==r.length)return a.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(zu(r[1])){const c=r[1];if("FeatureCollection"===c.type)for(let h=0;h<c.features.length;++h){const f=c.features[h].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new nr(c,c.features[h].geometry)}else if("Feature"===c.type){const h=c.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new nr(c,c.geometry)}else if("Polygon"===c.type||"MultiPolygon"===c.type)return new nr(c,c)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(a,c){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if("Polygon"===c.type){const x=Nc(c.coordinates,f,_),E=ju(a.geometry(),h,f,_);if(!la(h,f))return!1;for(const T of E)if(!ca(T,x))return!1}if("MultiPolygon"===c.type){const x=Ro(c.coordinates,f,_),E=ju(a.geometry(),h,f,_);if(!la(h,f))return!1;for(const T of E)if(!Qh(T,x))return!1}return!0}(r,this.geometries);if("LineString"===r.geometryType())return function(a,c){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if("Polygon"===c.type){const x=Nc(c.coordinates,f,_),E=zr(a.geometry(),h,f,_);if(!la(h,f))return!1;for(const T of E)if(!Nu(T,x))return!1}if("MultiPolygon"===c.type){const x=Ro(c.coordinates,f,_),E=zr(a.geometry(),h,f,_);if(!la(h,f))return!1;for(const T of E)if(!ed(T,x))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function rr(i){if(i instanceof Dr&&("get"===i.name&&1===i.args.length||"feature-state"===i.name||"has"===i.name&&1===i.args.length||"properties"===i.name||"geometry-type"===i.name||"id"===i.name||/^filter-/.test(i.name))||i instanceof nr)return!1;let r=!0;return i.eachChild(a=>{r&&!rr(a)&&(r=!1)}),r}function Wi(i){if(i instanceof Dr&&"feature-state"===i.name)return!1;let r=!0;return i.eachChild(a=>{r&&!Wi(a)&&(r=!1)}),r}function ho(i,r){if(i instanceof Dr&&r.indexOf(i.name)>=0)return!1;let a=!0;return i.eachChild(c=>{a&&!ho(c,r)&&(a=!1)}),a}class ei{constructor(r,a){this.type=a.type,this.name=r,this.boundExpression=a}static parse(r,a){if(2!==r.length||"string"!=typeof r[1])return a.error("'var' expression requires exactly one string literal argument.");const c=r[1];return a.scope.has(c)?new ei(c,a.scope.get(c)):a.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ua{constructor(r,a=[],c,h=new Ou,f=[]){this.registry=r,this.path=a,this.key=a.map(_=>`[${_}]`).join(""),this.scope=h,this.errors=f,this.expectedType=c}parse(r,a,c,h,f={}){return a?this.concat(a,c,h)._parse(r,f):this._parse(r,f)}_parse(r,a){function c(h,f,_){return"assert"===_?new Zi(f,[h]):"coerce"===_?new Kt(f,[h]):h}if(null!==r&&"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(r=["literal",r]),Array.isArray(r)){if(0===r.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=r[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[h];if(f){let _=f.parse(r,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,E=_.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==E.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==E.kind&&"string"!==E.kind){if(this.checkSubtype(x,E))return null}else _=c(_,x,a.typeAnnotation||"coerce");else _=c(_,x,a.typeAnnotation||"assert")}if(!(_ instanceof sa)&&"resolvedImage"!==_.type.kind&&Ka(_)){const x=new Lp;try{_=new sa(_.type,_.evaluate(x))}catch(E){return this.error(E.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===r?"'undefined' value invalid. Use null instead.":"object"==typeof r?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,a,c){const h="number"==typeof r?this.path.concat(r):this.path,f=c?this.scope.concat(c):this.scope;return new ua(this.registry,h,a||null,f,this.errors)}error(r,...a){const c=`${this.key}${a.map(h=>`[${h}]`).join("")}`;this.errors.push(new Ao(c,r))}checkSubtype(r,a){const c=_i(r,a);return c&&this.error(c),c}}function Ka(i){if(i instanceof ei)return Ka(i.boundExpression);if(i instanceof Dr&&"error"===i.name||i instanceof xn||i instanceof nr)return!1;const r=i instanceof Kt||i instanceof Zi;let a=!0;return i.eachChild(c=>{a=r?a&&Ka(c):a&&c instanceof sa}),!!a&&rr(i)&&ho(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function es(i,r){const a=i.length-1;let c,h,f=0,_=a,x=0;for(;f<=_;)if(x=Math.floor((f+_)/2),c=i[x],h=i[x+1],c<=r){if(x===a||r<h)return x;f=x+1}else{if(!(c>r))throw new Fr("Input is not a number.");_=x-1}return 0}class ks{constructor(r,a,c){this.type=r,this.input=a,this.labels=[],this.outputs=[];for(const[h,f]of c)this.labels.push(h),this.outputs.push(f)}static parse(r,a){if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");const c=a.parse(r[1],1,Qe);if(!c)return null;const h=[];let f=null;a.expectedType&&"value"!==a.expectedType.kind&&(f=a.expectedType);for(let _=1;_<r.length;_+=2){const x=1===_?-1/0:r[_],E=r[_+1],T=_,S=_+1;if("number"!=typeof x)return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(h.length&&h[h.length-1][0]>=x)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const I=a.parse(E,S,f);if(!I)return null;f=f||I.type,h.push([x,I])}return new ks(f,c,h)}evaluate(r){const a=this.labels,c=this.outputs;if(1===a.length)return c[0].evaluate(r);const h=this.input.evaluate(r);if(h<=a[0])return c[0].evaluate(r);const f=a.length;return h>=a[f-1]?c[f-1].evaluate(r):c[es(a,h)].evaluate(r)}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&r.push(this.labels[a]),r.push(this.outputs[a].serialize());return r}}function Ut(i,r,a){return i*(1-a)+r*a}var xr=Object.freeze({__proto__:null,number:Ut,color:function(i,r,a){return new Qt(Ut(i.r,r.r,a),Ut(i.g,r.g,a),Ut(i.b,r.b,a),Ut(i.a,r.a,a))},array:function(i,r,a){return i.map((c,h)=>Ut(c,r[h],a))}});const nt=4/29,Ft=6/29,Nn=3*Ft*Ft,zi=Math.PI/180,ha=180/Math.PI;function ir(i){return i>.008856451679035631?Math.pow(i,1/3):i/Nn+nt}function Lo(i){return i>Ft?i*i*i:Nn*(i-nt)}function Gn(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function ts(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function da(i){const r=ts(i.r),a=ts(i.g),c=ts(i.b),h=ir((.4124564*r+.3575761*a+.1804375*c)/.95047),f=ir((.2126729*r+.7151522*a+.072175*c)/1);return{l:116*f-16,a:500*(h-f),b:200*(f-ir((.0193339*r+.119192*a+.9503041*c)/1.08883)),alpha:i.a}}function Pt(i){let r=(i.l+16)/116,a=isNaN(i.a)?r:r+i.a/500,c=isNaN(i.b)?r:r-i.b/200;return r=1*Lo(r),a=.95047*Lo(a),c=1.08883*Lo(c),new Qt(Gn(3.2404542*a-1.5371385*r-.4985314*c),Gn(-.969266*a+1.8760108*r+.041556*c),Gn(.0556434*a-.2040259*r+1.0572252*c),i.alpha)}function Uc(i,r,a){const c=r-i;return i+a*(c>180||c<-180?c-360*Math.round(c/360):c)}const Oo={forward:da,reverse:Pt,interpolate:function(i,r,a){return{l:Ut(i.l,r.l,a),a:Ut(i.a,r.a,a),b:Ut(i.b,r.b,a),alpha:Ut(i.alpha,r.alpha,a)}}},pa={forward:function(i){const{l:r,a,b:c}=da(i),h=Math.atan2(c,a)*ha;return{h:h<0?h+360:h,c:Math.sqrt(a*a+c*c),l:r,alpha:i.a}},reverse:function(i){const r=i.h*zi,a=i.c;return Pt({l:i.l,a:Math.cos(r)*a,b:Math.sin(r)*a,alpha:i.alpha})},interpolate:function(i,r,a){return{h:Uc(i.h,r.h,a),c:Ut(i.c,r.c,a),l:Ut(i.l,r.l,a),alpha:Ut(i.alpha,r.alpha,a)}}};var fa=Object.freeze({__proto__:null,lab:Oo,hcl:pa});class Rn{constructor(r,a,c,h,f){this.type=r,this.operator=a,this.interpolation=c,this.input=h,this.labels=[],this.outputs=[];for(const[_,x]of f)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(r,a,c,h){let f=0;if("exponential"===r.name)f=Rs(a,r.base,c,h);else if("linear"===r.name)f=Rs(a,1,c,h);else if("cubic-bezier"===r.name){const _=r.controlPoints;f=new qo(_[0],_[1],_[2],_[3]).solve(Rs(a,1,c,h))}return f}static parse(r,a){let[c,h,f,..._]=r;if(!Array.isArray(h)||0===h.length)return a.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const T=h[1];if("number"!=typeof T)return a.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:T}}else{if("cubic-bezier"!==h[0])return a.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const T=h.slice(1);if(4!==T.length||T.some(S=>"number"!=typeof S||S<0||S>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:T}}}if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(f=a.parse(f,2,Qe),!f)return null;const x=[];let E=null;"interpolate-hcl"===c||"interpolate-lab"===c?E=Jo:a.expectedType&&"value"!==a.expectedType.kind&&(E=a.expectedType);for(let T=0;T<_.length;T+=2){const S=_[T],I=_[T+1],P=T+3,z=T+4;if("number"!=typeof S)return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(x.length&&x[x.length-1][0]>=S)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const N=a.parse(I,z,E);if(!N)return null;E=E||N.type,x.push([S,N])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new Rn(E,c,h,f,x):a.error(`Type ${Bn(E)} is not interpolatable.`)}evaluate(r){const a=this.labels,c=this.outputs;if(1===a.length)return c[0].evaluate(r);const h=this.input.evaluate(r);if(h<=a[0])return c[0].evaluate(r);const f=a.length;if(h>=a[f-1])return c[f-1].evaluate(r);const _=es(a,h),x=Rn.interpolationFactor(this.interpolation,h,a[_],a[_+1]),E=c[_].evaluate(r),T=c[_+1].evaluate(r);return"interpolate"===this.operator?xr[this.type.kind.toLowerCase()](E,T,x):"interpolate-hcl"===this.operator?pa.reverse(pa.interpolate(pa.forward(E),pa.forward(T),x)):Oo.reverse(Oo.interpolate(Oo.forward(E),Oo.forward(T),x))}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,r,this.input.serialize()];for(let c=0;c<this.labels.length;c++)a.push(this.labels[c],this.outputs[c].serialize());return a}}function Rs(i,r,a,c){const h=c-a,f=i-a;return 0===h?0:1===r?f/h:(Math.pow(r,f)-1)/(Math.pow(r,h)-1)}class Xi{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expectected at least one argument.");let c=null;const h=a.expectedType;h&&"value"!==h.kind&&(c=h);const f=[];for(const x of r.slice(1)){const E=a.parse(x,1+f.length,c,void 0,{typeAnnotation:"omit"});if(!E)return null;c=c||E.type,f.push(E)}const _=h&&f.some(x=>_i(h,x.type));return new Xi(_?Ot:c,f)}evaluate(r){let a,c=null,h=0;for(const f of this.args){if(h++,c=f.evaluate(r),c&&c instanceof vr&&!c.available&&(a||(a=c),c=null,h===this.args.length))return a;if(null!==c)break}return c}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(a=>{r.push(a.serialize())}),r}}class yi{constructor(r,a){this.type=a.type,this.bindings=[].concat(r),this.result=a}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const a of this.bindings)r(a[1]);r(this.result)}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const c=[];for(let f=1;f<r.length-1;f+=2){const _=r[f];if("string"!=typeof _)return a.error(`Expected string, but found ${typeof _} instead.`,f);if(/[^a-zA-Z0-9_]/.test(_))return a.error("Variable names must contain only alphanumeric characters or '_'.",f);const x=a.parse(r[f+1],f+1);if(!x)return null;c.push([_,x])}const h=a.parse(r[r.length-1],r.length-1,a.expectedType,c);return h?new yi(c,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[a,c]of this.bindings)r.push(a,c.serialize());return r.push(this.result.serialize()),r}}class An{constructor(r,a,c){this.type=r,this.index=a,this.input=c}static parse(r,a){if(3!==r.length)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,Qe),h=a.parse(r[2],2,gi(a.expectedType||Ot));return c&&h?new An(h.type.itemType,c,h):null}evaluate(r){const a=this.index.evaluate(r),c=this.input.evaluate(r);if(a<0)throw new Fr(`Array index out of bounds: ${a} < 0.`);if(a>=c.length)throw new Fr(`Array index out of bounds: ${a} > ${c.length-1}.`);if(a!==Math.floor(a))throw new Fr(`Array index must be an integer, but found ${a} instead.`);return c[a]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Vu{constructor(r,a){this.type=ct,this.needle=r,this.haystack=a}static parse(r,a){if(3!==r.length)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,Ot),h=a.parse(r[2],2,Ot);return c&&h?Hl(c.type,[ct,xt,Qe,As,Ot])?new Vu(c,h):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Bn(c.type)} instead`):null}evaluate(r){const a=this.needle.evaluate(r),c=this.haystack.evaluate(r);if(!c)return!1;if(!Qo(a,["boolean","string","number","null"]))throw new Fr(`Expected first argument to be of type boolean, string, number or null, but found ${Bn(In(a))} instead.`);if(!Qo(c,["string","array"]))throw new Fr(`Expected second argument to be of type array or string, but found ${Bn(In(c))} instead.`);return c.indexOf(a)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class po{constructor(r,a,c){this.type=Qe,this.needle=r,this.haystack=a,this.fromIndex=c}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,Ot),h=a.parse(r[2],2,Ot);if(!c||!h)return null;if(!Hl(c.type,[ct,xt,Qe,As,Ot]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Bn(c.type)} instead`);if(4===r.length){const f=a.parse(r[3],3,Qe);return f?new po(c,h,f):null}return new po(c,h)}evaluate(r){const a=this.needle.evaluate(r),c=this.haystack.evaluate(r);if(!Qo(a,["boolean","string","number","null"]))throw new Fr(`Expected first argument to be of type boolean, string, number or null, but found ${Bn(In(a))} instead.`);if(!Qo(c,["string","array"]))throw new Fr(`Expected second argument to be of type array or string, but found ${Bn(In(c))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(r);return c.indexOf(a,h)}return c.indexOf(a)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Bi{constructor(r,a,c,h,f,_){this.inputType=r,this.type=a,this.input=c,this.cases=h,this.outputs=f,this.otherwise=_}static parse(r,a){if(r.length<5)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return a.error("Expected an even number of arguments.");let c,h;a.expectedType&&"value"!==a.expectedType.kind&&(h=a.expectedType);const f={},_=[];for(let T=2;T<r.length-1;T+=2){let S=r[T];const I=r[T+1];Array.isArray(S)||(S=[S]);const P=a.concat(T);if(0===S.length)return P.error("Expected at least one branch label.");for(const N of S){if("number"!=typeof N&&"string"!=typeof N)return P.error("Branch labels must be numbers or strings.");if("number"==typeof N&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof N&&Math.floor(N)!==N)return P.error("Numeric branch labels must be integer values.");if(c){if(P.checkSubtype(c,In(N)))return null}else c=In(N);if(void 0!==f[String(N)])return P.error("Branch labels must be unique.");f[String(N)]=_.length}const z=a.parse(I,T,h);if(!z)return null;h=h||z.type,_.push(z)}const x=a.parse(r[1],1,Ot);if(!x)return null;const E=a.parse(r[r.length-1],r.length-1,h);return E?"value"!==x.type.kind&&a.concat(1).checkSubtype(c,x.type)?null:new Bi(c,h,x,f,_,E):null}evaluate(r){const a=this.input.evaluate(r);return(In(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),c=[],h={};for(const _ of a){const x=h[this.cases[_]];void 0===x?(h[this.cases[_]]=c.length,c.push([this.cases[_],[_]])):c[x][1].push(_)}const f=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,x]of c)r.push(1===x.length?f(x[0]):x.map(f)),r.push(this.outputs[_].serialize());return r.push(this.otherwise.serialize()),r}}class Mr{constructor(r,a,c){this.type=r,this.branches=a,this.otherwise=c}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return a.error("Expected an odd number of arguments.");let c;a.expectedType&&"value"!==a.expectedType.kind&&(c=a.expectedType);const h=[];for(let _=1;_<r.length-1;_+=2){const x=a.parse(r[_],_,ct);if(!x)return null;const E=a.parse(r[_+1],_+1,c);if(!E)return null;h.push([x,E]),c=c||E.type}const f=a.parse(r[r.length-1],r.length-1,c);return f?new Mr(c,h,f):null}evaluate(r){for(const[a,c]of this.branches)if(a.evaluate(r))return c.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[a,c]of this.branches)r(a),r(c);r(this.otherwise)}outputDefined(){return this.branches.every(([r,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(a=>{r.push(a.serialize())}),r}}class ma{constructor(r,a,c,h){this.type=r,this.input=a,this.beginIndex=c,this.endIndex=h}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,Ot),h=a.parse(r[2],2,Qe);if(!c||!h)return null;if(!Hl(c.type,[gi(Ot),xt,Ot]))return a.error(`Expected first argument to be of type array or string, but found ${Bn(c.type)} instead`);if(4===r.length){const f=a.parse(r[3],3,Qe);return f?new ma(c.type,c,h,f):null}return new ma(c.type,c,h)}evaluate(r){const a=this.input.evaluate(r),c=this.beginIndex.evaluate(r);if(!Qo(a,["string","array"]))throw new Fr(`Expected first argument to be of type array or string, but found ${Bn(In(a))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(r);return a.slice(c,h)}return a.slice(c)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Zl(i,r){return"=="===i||"!="===i?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function ga(i,r,a,c){return 0===c.compare(r,a)}function Sr(i,r,a){const c="=="!==i&&"!="!==i;return class $C{constructor(f,_,x){this.type=ct,this.lhs=f,this.rhs=_,this.collator=x,this.hasUntypedArgument="value"===f.type.kind||"value"===_.type.kind}static parse(f,_){if(3!==f.length&&4!==f.length)return _.error("Expected two or three arguments.");const x=f[0];let E=_.parse(f[1],1,Ot);if(!E)return null;if(!Zl(x,E.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${Bn(E.type)}'.`);let T=_.parse(f[2],2,Ot);if(!T)return null;if(!Zl(x,T.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${Bn(T.type)}'.`);if(E.type.kind!==T.type.kind&&"value"!==E.type.kind&&"value"!==T.type.kind)return _.error(`Cannot compare types '${Bn(E.type)}' and '${Bn(T.type)}'.`);c&&("value"===E.type.kind&&"value"!==T.type.kind?E=new Zi(T.type,[E]):"value"!==E.type.kind&&"value"===T.type.kind&&(T=new Zi(E.type,[T])));let S=null;if(4===f.length){if("string"!==E.type.kind&&"string"!==T.type.kind&&"value"!==E.type.kind&&"value"!==T.type.kind)return _.error("Cannot use collator to compare non-string types.");if(S=_.parse(f[3],3,Tt),!S)return null}return new $C(E,T,S)}evaluate(f){const _=this.lhs.evaluate(f),x=this.rhs.evaluate(f);if(c&&this.hasUntypedArgument){const E=In(_),T=In(x);if(E.kind!==T.kind||"string"!==E.kind&&"number"!==E.kind)throw new Fr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${E.kind}, ${T.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const E=In(_),T=In(x);if("string"!==E.kind||"string"!==T.kind)return r(f,_,x)}return this.collator?a(f,_,x,this.collator.evaluate(f)):r(f,_,x)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[i];return this.eachChild(_=>{f.push(_.serialize())}),f}}}const nd=Sr("==",function(i,r,a){return r===a},ga),rd=Sr("!=",function(i,r,a){return r!==a},function(i,r,a,c){return!ga(0,r,a,c)}),$u=Sr("<",function(i,r,a){return r<a},function(i,r,a,c){return c.compare(r,a)<0}),id=Sr(">",function(i,r,a){return r>a},function(i,r,a,c){return c.compare(r,a)>0}),od=Sr("<=",function(i,r,a){return r<=a},function(i,r,a,c){return c.compare(r,a)<=0}),Fp=Sr(">=",function(i,r,a){return r>=a},function(i,r,a,c){return c.compare(r,a)>=0});class Gu{constructor(r,a,c,h,f){this.type=xt,this.number=r,this.locale=a,this.currency=c,this.minFractionDigits=h,this.maxFractionDigits=f}static parse(r,a){if(3!==r.length)return a.error("Expected two arguments.");const c=a.parse(r[1],1,Qe);if(!c)return null;const h=r[2];if("object"!=typeof h||Array.isArray(h))return a.error("NumberFormat options argument must be an object.");let f=null;if(h.locale&&(f=a.parse(h.locale,1,xt),!f))return null;let _=null;if(h.currency&&(_=a.parse(h.currency,1,xt),!_))return null;let x=null;if(h["min-fraction-digits"]&&(x=a.parse(h["min-fraction-digits"],1,Qe),!x))return null;let E=null;return h["max-fraction-digits"]&&(E=a.parse(h["max-fraction-digits"],1,Qe),!E)?null:new Gu(c,f,_,x,E)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Hu{constructor(r){this.type=Qe,this.input=r}static parse(r,a){if(2!==r.length)return a.error(`Expected 1 argument, but found ${r.length-1} instead.`);const c=a.parse(r[1],1);return c?"array"!==c.type.kind&&"string"!==c.type.kind&&"value"!==c.type.kind?a.error(`Expected argument of type string or array, but found ${Bn(c.type)} instead.`):new Hu(c):null}evaluate(r){const a=this.input.evaluate(r);if("string"==typeof a||Array.isArray(a))return a.length;throw new Fr(`Expected value to be of type string or array, but found ${Bn(In(a))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(a=>{r.push(a.serialize())}),r}}const Fo={"==":nd,"!=":rd,">":id,"<":$u,">=":Fp,"<=":od,array:Zi,at:An,boolean:Zi,case:Mr,coalesce:Xi,collator:xn,format:Po,image:aa,in:Vu,"index-of":po,interpolate:Rn,"interpolate-hcl":Rn,"interpolate-lab":Rn,length:Hu,let:yi,literal:sa,match:Bi,number:Zi,"number-format":Gu,object:Zi,slice:ma,step:ks,string:Zi,"to-boolean":Kt,"to-color":Kt,"to-number":Kt,"to-string":Kt,var:ei,within:nr};function sd(i,[r,a,c,h]){r=r.evaluate(i),a=a.evaluate(i),c=c.evaluate(i);const f=h?h.evaluate(i):1,_=Fu(r,a,c,f);if(_)throw new Fr(_);return new Qt(r/255*f,a/255*f,c/255*f,f)}function ad(i,r){return i in r}function jc(i,r){const a=r[i];return void 0===a?null:a}function _a(i){return{type:i}}function zp(i){return{result:"success",value:i}}function Ls(i){return{result:"error",value:i}}function Wl(i){return"data-driven"===i["property-type"]||"cross-faded-data-driven"===i["property-type"]}function Bp(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function ld(i){return!!i.expression&&i.expression.interpolated}function rn(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":null===i?"null":typeof i}function Ya(i){return"object"==typeof i&&null!==i&&!Array.isArray(i)}function qu(i){return i}function Vc(i,r){const a="color"===r.type,c=i.stops&&"object"==typeof i.stops[0][0],h=c||!(c||void 0!==i.property),f=i.type||(ld(r)?"exponential":"interval");if(a&&((i=ra({},i)).stops&&(i.stops=i.stops.map(T=>[T[0],Qt.parse(T[1])])),i.default=Qt.parse(i.default?i.default:r.default)),i.colorSpace&&"rgb"!==i.colorSpace&&!fa[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let _,x,E;if("exponential"===f)_=Os;else if("interval"===f)_=Np;else if("categorical"===f){_=zo,x=Object.create(null);for(const T of i.stops)x[T[0]]=T[1];E=typeof i.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);_=cd}if(c){const T={},S=[];for(let z=0;z<i.stops.length;z++){const N=i.stops[z],$=N[0].zoom;void 0===T[$]&&(T[$]={zoom:$,type:i.type,property:i.property,default:i.default,stops:[]},S.push($)),T[$].stops.push([N[0].value,N[1]])}const I=[];for(const z of S)I.push([T[z].zoom,Vc(T[z],r)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:Rn.interpolationFactor.bind(void 0,P),zoomStops:I.map(z=>z[0]),evaluate:({zoom:z},N)=>Os({stops:I,base:i.base},r,z).evaluate(z,N)}}if(h){const T="exponential"===f?{name:"exponential",base:void 0!==i.base?i.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:Rn.interpolationFactor.bind(void 0,T),zoomStops:i.stops.map(S=>S[0]),evaluate:({zoom:S})=>_(i,r,S,x,E)}}return{kind:"source",evaluate(T,S){const I=S&&S.properties?S.properties[i.property]:void 0;return void 0===I?$r(i.default,r.default):_(i,r,I,x,E)}}}function $r(i,r,a){return void 0!==i?i:void 0!==r?r:void 0!==a?a:void 0}function zo(i,r,a,c,h){return $r(typeof a===h?c[a]:void 0,i.default,r.default)}function Np(i,r,a){if("number"!==rn(a))return $r(i.default,r.default);const c=i.stops.length;if(1===c||a<=i.stops[0][0])return i.stops[0][1];if(a>=i.stops[c-1][0])return i.stops[c-1][1];const h=es(i.stops.map(f=>f[0]),a);return i.stops[h][1]}function Os(i,r,a){const c=void 0!==i.base?i.base:1;if("number"!==rn(a))return $r(i.default,r.default);const h=i.stops.length;if(1===h||a<=i.stops[0][0])return i.stops[0][1];if(a>=i.stops[h-1][0])return i.stops[h-1][1];const f=es(i.stops.map(S=>S[0]),a),_=function(S,I,P,z){const N=z-P,$=S-P;return 0===N?0:1===I?$/N:(Math.pow(I,$)-1)/(Math.pow(I,N)-1)}(a,c,i.stops[f][0],i.stops[f+1][0]),x=i.stops[f][1],E=i.stops[f+1][1];let T=xr[r.type]||qu;if(i.colorSpace&&"rgb"!==i.colorSpace){const S=fa[i.colorSpace];T=(I,P)=>S.reverse(S.interpolate(S.forward(I),S.forward(P),_))}return"function"==typeof x.evaluate?{evaluate(...S){const I=x.evaluate.apply(void 0,S),P=E.evaluate.apply(void 0,S);if(void 0!==I&&void 0!==P)return T(I,P,_)}}:T(x,E,_)}function cd(i,r,a){return"color"===r.type?a=Qt.parse(a):"formatted"===r.type?a=St.fromString(a.toString()):"resolvedImage"===r.type?a=vr.fromString(a.toString()):rn(a)===r.type||"enum"===r.type&&r.values[a]||(a=void 0),$r(a,i.default,r.default)}Dr.register(Fo,{error:[{kind:"error"},[xt],(i,[r])=>{throw new Fr(r.evaluate(i))}],typeof:[xt,[Ot],(i,[r])=>Bn(In(r.evaluate(i)))],"to-rgba":[gi(Qe,4),[Jo],(i,[r])=>r.evaluate(i).toArray()],rgb:[Jo,[Qe,Qe,Qe],sd],rgba:[Jo,[Qe,Qe,Qe,Qe],sd],has:{type:ct,overloads:[[[xt],(i,[r])=>ad(r.evaluate(i),i.properties())],[[xt,Gl],(i,[r,a])=>ad(r.evaluate(i),a.evaluate(i))]]},get:{type:Ot,overloads:[[[xt],(i,[r])=>jc(r.evaluate(i),i.properties())],[[xt,Gl],(i,[r,a])=>jc(r.evaluate(i),a.evaluate(i))]]},"feature-state":[Ot,[xt],(i,[r])=>jc(r.evaluate(i),i.featureState||{})],properties:[Gl,[],i=>i.properties()],"geometry-type":[xt,[],i=>i.geometryType()],id:[Ot,[],i=>i.id()],zoom:[Qe,[],i=>i.globals.zoom],pitch:[Qe,[],i=>i.globals.pitch||0],"distance-from-center":[Qe,[],i=>i.distanceFromCenter()],"heatmap-density":[Qe,[],i=>i.globals.heatmapDensity||0],"line-progress":[Qe,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[Qe,[],i=>i.globals.skyRadialProgress||0],accumulated:[Ot,[],i=>void 0===i.globals.accumulated?null:i.globals.accumulated],"+":[Qe,_a(Qe),(i,r)=>{let a=0;for(const c of r)a+=c.evaluate(i);return a}],"*":[Qe,_a(Qe),(i,r)=>{let a=1;for(const c of r)a*=c.evaluate(i);return a}],"-":{type:Qe,overloads:[[[Qe,Qe],(i,[r,a])=>r.evaluate(i)-a.evaluate(i)],[[Qe],(i,[r])=>-r.evaluate(i)]]},"/":[Qe,[Qe,Qe],(i,[r,a])=>r.evaluate(i)/a.evaluate(i)],"%":[Qe,[Qe,Qe],(i,[r,a])=>r.evaluate(i)%a.evaluate(i)],ln2:[Qe,[],()=>Math.LN2],pi:[Qe,[],()=>Math.PI],e:[Qe,[],()=>Math.E],"^":[Qe,[Qe,Qe],(i,[r,a])=>Math.pow(r.evaluate(i),a.evaluate(i))],sqrt:[Qe,[Qe],(i,[r])=>Math.sqrt(r.evaluate(i))],log10:[Qe,[Qe],(i,[r])=>Math.log(r.evaluate(i))/Math.LN10],ln:[Qe,[Qe],(i,[r])=>Math.log(r.evaluate(i))],log2:[Qe,[Qe],(i,[r])=>Math.log(r.evaluate(i))/Math.LN2],sin:[Qe,[Qe],(i,[r])=>Math.sin(r.evaluate(i))],cos:[Qe,[Qe],(i,[r])=>Math.cos(r.evaluate(i))],tan:[Qe,[Qe],(i,[r])=>Math.tan(r.evaluate(i))],asin:[Qe,[Qe],(i,[r])=>Math.asin(r.evaluate(i))],acos:[Qe,[Qe],(i,[r])=>Math.acos(r.evaluate(i))],atan:[Qe,[Qe],(i,[r])=>Math.atan(r.evaluate(i))],min:[Qe,_a(Qe),(i,r)=>Math.min(...r.map(a=>a.evaluate(i)))],max:[Qe,_a(Qe),(i,r)=>Math.max(...r.map(a=>a.evaluate(i)))],abs:[Qe,[Qe],(i,[r])=>Math.abs(r.evaluate(i))],round:[Qe,[Qe],(i,[r])=>{const a=r.evaluate(i);return a<0?-Math.round(-a):Math.round(a)}],floor:[Qe,[Qe],(i,[r])=>Math.floor(r.evaluate(i))],ceil:[Qe,[Qe],(i,[r])=>Math.ceil(r.evaluate(i))],"filter-==":[ct,[xt,Ot],(i,[r,a])=>i.properties()[r.value]===a.value],"filter-id-==":[ct,[Ot],(i,[r])=>i.id()===r.value],"filter-type-==":[ct,[xt],(i,[r])=>i.geometryType()===r.value],"filter-<":[ct,[xt,Ot],(i,[r,a])=>{const c=i.properties()[r.value],h=a.value;return typeof c==typeof h&&c<h}],"filter-id-<":[ct,[Ot],(i,[r])=>{const a=i.id(),c=r.value;return typeof a==typeof c&&a<c}],"filter->":[ct,[xt,Ot],(i,[r,a])=>{const c=i.properties()[r.value],h=a.value;return typeof c==typeof h&&c>h}],"filter-id->":[ct,[Ot],(i,[r])=>{const a=i.id(),c=r.value;return typeof a==typeof c&&a>c}],"filter-<=":[ct,[xt,Ot],(i,[r,a])=>{const c=i.properties()[r.value],h=a.value;return typeof c==typeof h&&c<=h}],"filter-id-<=":[ct,[Ot],(i,[r])=>{const a=i.id(),c=r.value;return typeof a==typeof c&&a<=c}],"filter->=":[ct,[xt,Ot],(i,[r,a])=>{const c=i.properties()[r.value],h=a.value;return typeof c==typeof h&&c>=h}],"filter-id->=":[ct,[Ot],(i,[r])=>{const a=i.id(),c=r.value;return typeof a==typeof c&&a>=c}],"filter-has":[ct,[Ot],(i,[r])=>r.value in i.properties()],"filter-has-id":[ct,[],i=>null!==i.id()&&void 0!==i.id()],"filter-type-in":[ct,[gi(xt)],(i,[r])=>r.value.indexOf(i.geometryType())>=0],"filter-id-in":[ct,[gi(Ot)],(i,[r])=>r.value.indexOf(i.id())>=0],"filter-in-small":[ct,[xt,gi(Ot)],(i,[r,a])=>a.value.indexOf(i.properties()[r.value])>=0],"filter-in-large":[ct,[xt,gi(Ot)],(i,[r,a])=>function(c,h,f,_){for(;f<=_;){const x=f+_>>1;if(h[x]===c)return!0;h[x]>c?_=x-1:f=x+1}return!1}(i.properties()[r.value],a.value,0,a.value.length-1)],all:{type:ct,overloads:[[[ct,ct],(i,[r,a])=>r.evaluate(i)&&a.evaluate(i)],[_a(ct),(i,r)=>{for(const a of r)if(!a.evaluate(i))return!1;return!0}]]},any:{type:ct,overloads:[[[ct,ct],(i,[r,a])=>r.evaluate(i)||a.evaluate(i)],[_a(ct),(i,r)=>{for(const a of r)if(a.evaluate(i))return!0;return!1}]]},"!":[ct,[ct],(i,[r])=>!r.evaluate(i)],"is-supported-script":[ct,[xt],(i,[r])=>{const a=i.globals&&i.globals.isSupportedScript;return!a||a(r.evaluate(i))}],upcase:[xt,[xt],(i,[r])=>r.evaluate(i).toUpperCase()],downcase:[xt,[xt],(i,[r])=>r.evaluate(i).toLowerCase()],concat:[xt,_a(Ot),(i,r)=>r.map(a=>Qr(a.evaluate(i))).join("")],"resolved-locale":[xt,[Tt],(i,[r])=>r.evaluate(i).resolvedLocale()]});class Zu{constructor(r,a){var c;this.expression=r,this._warningHistory={},this._evaluator=new Lp,this._defaultValue=a?"color"===(c=a).type&&Ya(c.default)?new Qt(0,0,0,0):"color"===c.type?Qt.parse(c.default)||null:void 0===c.default?null:c.default:null,this._enumValues=a&&"enum"===a.type?a.values:null}evaluateWithoutErrorHandling(r,a,c,h,f,_,x,E){return this._evaluator.globals=r,this._evaluator.feature=a,this._evaluator.featureState=c,this._evaluator.canonical=h,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(r,a,c,h,f,_,x,E){this._evaluator.globals=r,this._evaluator.feature=a||null,this._evaluator.featureState=c||null,this._evaluator.canonical=h,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null;try{const T=this.expression.evaluate(this._evaluator);if(null==T||"number"==typeof T&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Fr(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,"undefined"!=typeof console&&console.warn(T.message)),this._defaultValue}}}function Ja(i){return Array.isArray(i)&&i.length>0&&"string"==typeof i[0]&&i[0]in Fo}function Qa(i,r){const a=new ua(Fo,[],r?function(h){const f={color:Jo,string:xt,number:Qe,enum:xt,boolean:ct,formatted:ia,resolvedImage:mi};return"array"===h.type?gi(f[h.value]||Ot,h.length):f[h.type]}(r):void 0),c=a.parse(i,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return c?zp(new Zu(c,r)):Ls(a.errors)}class el{constructor(r,a){this.kind=r,this._styleExpression=a,this.isStateDependent="constant"!==r&&!Wi(a.expression)}evaluateWithoutErrorHandling(r,a,c,h,f,_){return this._styleExpression.evaluateWithoutErrorHandling(r,a,c,h,f,_)}evaluate(r,a,c,h,f,_){return this._styleExpression.evaluate(r,a,c,h,f,_)}}class Wu{constructor(r,a,c,h){this.kind=r,this.zoomStops=c,this._styleExpression=a,this.isStateDependent="camera"!==r&&!Wi(a.expression),this.interpolationType=h}evaluateWithoutErrorHandling(r,a,c,h,f,_){return this._styleExpression.evaluateWithoutErrorHandling(r,a,c,h,f,_)}evaluate(r,a,c,h,f,_){return this._styleExpression.evaluate(r,a,c,h,f,_)}interpolationFactor(r,a,c){return this.interpolationType?Rn.interpolationFactor(this.interpolationType,r,a,c):0}}function $c(i,r){if("error"===(i=Qa(i,r)).result)return i;const a=i.value.expression,c=rr(a);if(!c&&!Wl(r))return Ls([new Ao("","data expressions not supported")]);const h=ho(a,["zoom","pitch","distance-from-center"]);if(!h&&!Bp(r))return Ls([new Ao("","zoom expressions not supported")]);const f=ti(a);return f||h?f instanceof Ao?Ls([f]):f instanceof Rn&&!ld(r)?Ls([new Ao("",'"interpolate" expressions cannot be used with this property')]):zp(f?new Wu(c?"camera":"composite",i.value,f.labels,f instanceof Rn?f.interpolation:void 0):new el(c?"constant":"source",i.value)):Ls([new Ao("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class tl{constructor(r,a){this._parameters=r,this._specification=a,ra(this,Vc(this._parameters,this._specification))}static deserialize(r){return new tl(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function ti(i){let r=null;if(i instanceof yi)r=ti(i.result);else if(i instanceof Xi){for(const a of i.args)if(r=ti(a),r)break}else(i instanceof ks||i instanceof Rn)&&i.input instanceof Dr&&"zoom"===i.input.name&&(r=i);return r instanceof Ao||i.eachChild(a=>{const c=ti(a);c instanceof Ao?r=c:!r&&c?r=new Ao("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&c&&r!==c&&(r=new Ao("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function vi(i){const r=i.key,a=i.value,c=i.valueSpec||{},h=i.objectElementValidators||{},f=i.style,_=i.styleSpec;let x=[];const E=rn(a);if("object"!==E)return[new Xe(r,a,`object expected, ${E} found`)];for(const T in a){const S=T.split(".")[0],I=c[S]||c["*"];let P;if(h[S])P=h[S];else if(c[S])P=Ir;else if(h["*"])P=h["*"];else{if(!c["*"]){x.push(new Xe(r,a[T],`unknown property "${T}"`));continue}P=Ir}x=x.concat(P({key:(r&&`${r}.`)+T,value:a[T],valueSpec:I,style:f,styleSpec:_,object:a,objectKey:T},a))}for(const T in c)h[T]||c[T].required&&void 0===c[T].default&&void 0===a[T]&&x.push(new Xe(r,a,`missing required property "${T}"`));return x}function Xu(i){const r=i.value,a=i.valueSpec,c=i.style,h=i.styleSpec,f=i.key,_=i.arrayElementValidator||Ir;if("array"!==rn(r))return[new Xe(f,r,`array expected, ${rn(r)} found`)];if(a.length&&r.length!==a.length)return[new Xe(f,r,`array length ${a.length} expected, length ${r.length} found`)];if(a["min-length"]&&r.length<a["min-length"])return[new Xe(f,r,`array length at least ${a["min-length"]} expected, length ${r.length} found`)];let x={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum};h.$version<7&&(x.function=a.function),"object"===rn(a.value)&&(x=a.value);let E=[];for(let T=0;T<r.length;T++)E=E.concat(_({array:r,arrayIndex:T,value:r[T],valueSpec:x,style:c,styleSpec:h,key:`${f}[${T}]`}));return E}function Gc(i){const r=i.key,a=i.value,c=i.valueSpec;let h=rn(a);if("number"===h&&a!=a&&(h="NaN"),"number"!==h)return[new Xe(r,a,`number expected, ${h} found`)];if("minimum"in c){let f=c.minimum;if("array"===rn(c.minimum)&&(f=c.minimum[i.arrayIndex]),a<f)return[new Xe(r,a,`${a} is less than the minimum value ${f}`)]}if("maximum"in c){let f=c.maximum;if("array"===rn(c.maximum)&&(f=c.maximum[i.arrayIndex]),a>f)return[new Xe(r,a,`${a} is greater than the maximum value ${f}`)]}return[]}function Hc(i){const r=i.valueSpec,a=tr(i.value.type);let c,h,f,_={};const x="categorical"!==a&&void 0===i.value.property,E=!x,T="array"===rn(i.value.stops)&&"array"===rn(i.value.stops[0])&&"object"===rn(i.value.stops[0][0]),S=vi({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(z){if("identity"===a)return[new Xe(z.key,z.value,'identity function may not have a "stops" property')];let N=[];const $=z.value;return N=N.concat(Xu({key:z.key,value:$,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:I})),"array"===rn($)&&0===$.length&&N.push(new Xe(z.key,$,"array must have at least one stop")),N},default:function(z){return Ir({key:z.key,value:z.value,valueSpec:r,style:z.style,styleSpec:z.styleSpec})}}});return"identity"===a&&x&&S.push(new Xe(i.key,i.value,'missing required property "property"')),"identity"===a||i.value.stops||S.push(new Xe(i.key,i.value,'missing required property "stops"')),"exponential"===a&&i.valueSpec.expression&&!ld(i.valueSpec)&&S.push(new Xe(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(E&&!Wl(i.valueSpec)?S.push(new Xe(i.key,i.value,"property functions not supported")):x&&!Bp(i.valueSpec)&&S.push(new Xe(i.key,i.value,"zoom functions not supported"))),"categorical"!==a&&!T||void 0!==i.value.property||S.push(new Xe(i.key,i.value,'"property" property is required')),S;function I(z){let N=[];const $=z.value,q=z.key;if("array"!==rn($))return[new Xe(q,$,`array expected, ${rn($)} found`)];if(2!==$.length)return[new Xe(q,$,`array length 2 expected, length ${$.length} found`)];if(T){if("object"!==rn($[0]))return[new Xe(q,$,`object expected, ${rn($[0])} found`)];if(void 0===$[0].zoom)return[new Xe(q,$,"object stop key must have zoom")];if(void 0===$[0].value)return[new Xe(q,$,"object stop key must have value")];if(f&&f>tr($[0].zoom))return[new Xe(q,$[0].zoom,"stop zoom values must appear in ascending order")];tr($[0].zoom)!==f&&(f=tr($[0].zoom),h=void 0,_={}),N=N.concat(vi({key:`${q}[0]`,value:$[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:Gc,value:P}}))}else N=N.concat(P({key:`${q}[0]`,value:$[0],valueSpec:{},style:z.style,styleSpec:z.styleSpec},$));return Ja(Is($[1]))?N.concat([new Xe(`${q}[1]`,$[1],"expressions are not allowed in function stops.")]):N.concat(Ir({key:`${q}[1]`,value:$[1],valueSpec:r,style:z.style,styleSpec:z.styleSpec}))}function P(z,N){const $=rn(z.value),q=tr(z.value),J=null!==z.value?z.value:N;if(c){if($!==c)return[new Xe(z.key,J,`${$} stop domain type must match previous stop domain type ${c}`)]}else c=$;if("number"!==$&&"string"!==$&&"boolean"!==$)return[new Xe(z.key,J,"stop domain value must be a number, string, or boolean")];if("number"!==$&&"categorical"!==a){let oe=`number expected, ${$} found`;return Wl(r)&&void 0===a&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Xe(z.key,J,oe)]}return"categorical"!==a||"number"!==$||isFinite(q)&&Math.floor(q)===q?"categorical"!==a&&"number"===$&&void 0!==h&&q<h?[new Xe(z.key,J,"stop domain values must appear in ascending order")]:(h=q,"categorical"===a&&q in _?[new Xe(z.key,J,"stop domain values must be unique")]:(_[q]=!0,[])):[new Xe(z.key,J,`integer expected, found ${q}`)]}}function ns(i){const r=("property"===i.expressionContext?$c:Qa)(Is(i.value),i.valueSpec);if("error"===r.result)return r.value.map(c=>new Xe(`${i.key}${c.key}`,i.value,c.message));const a=r.value.expression||r.value._styleExpression.expression;if("property"===i.expressionContext&&"text-font"===i.propertyKey&&!a.outputDefined())return[new Xe(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===i.expressionContext&&"layout"===i.propertyType&&!Wi(a))return[new Xe(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===i.expressionContext)return Xl(a,i);if(i.expressionContext&&0===i.expressionContext.indexOf("cluster")){if(!ho(a,["zoom","feature-state"]))return[new Xe(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===i.expressionContext&&!rr(a))return[new Xe(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Xl(i,r){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const h of r.valueSpec.expression.parameters)a.delete(h);if(0===a.size)return[];const c=[];return i instanceof Dr&&a.has(i.name)?[new Xe(r.key,r.value,`["${i.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(i.eachChild(h=>{c.push(...Xl(h,r))}),c)}function qc(i){const r=i.key,a=i.value,c=i.valueSpec,h=[];return Array.isArray(c.values)?-1===c.values.indexOf(tr(a))&&h.push(new Xe(r,a,`expected one of [${c.values.join(", ")}], ${JSON.stringify(a)} found`)):-1===Object.keys(c.values).indexOf(tr(a))&&h.push(new Xe(r,a,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(a)} found`)),h}function nl(i){if(!0===i||!1===i)return!0;if(!Array.isArray(i)||0===i.length)return!1;switch(i[0]){case"has":return i.length>=2&&"$id"!==i[1]&&"$type"!==i[1];case"in":return i.length>=3&&("string"!=typeof i[1]||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==i.length||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const r of i.slice(1))if(!nl(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}function Ku(i,r="fill"){if(null==i)return{filter:()=>!0,needGeometry:!1,needFeature:!1};nl(i)||(i=ya(i));const a=i;let c=!0;try{c=function(T){if(!rl(T))return T;let S=Is(T);return Yu(S),S=Un(S),S}(a)}catch(T){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(a,null,2)}\n        `)}const h=Ee[`filter_${r}`],f=Qa(c,h);let _=null;if("error"===f.result)throw new Error(f.value.map(T=>`${T.key}: ${T.message}`).join(", "));_=(T,S,I)=>f.value.evaluate(T,S,{},I);let x=null,E=null;if(c!==a){const T=Qa(a,h);if("error"===T.result)throw new Error(T.value.map(S=>`${S.key}: ${S.message}`).join(", "));x=(S,I,P,z,N)=>T.value.evaluate(S,I,{},P,void 0,void 0,z,N),E=!rr(T.value.expression)}return _=_,{filter:_,dynamicFilter:x||void 0,needGeometry:ud(c),needFeature:!!E}}function Un(i){if(!Array.isArray(i))return i;const r=function(a){if(hr.has(a[0]))for(let c=1;c<a.length;c++)if(rl(a[c]))return!0;return a}(i);return!0===r?r:r.map(a=>Un(a))}function Yu(i){let r=!1;const a=[];if("case"===i[0]){for(let c=1;c<i.length-1;c+=2)r=r||rl(i[c]),a.push(i[c+1]);a.push(i[i.length-1])}else if("match"===i[0]){r=r||rl(i[1]);for(let c=2;c<i.length-1;c+=2)a.push(i[c+1]);a.push(i[i.length-1])}else if("step"===i[0]){r=r||rl(i[1]);for(let c=1;c<i.length-1;c+=2)a.push(i[c+1])}r&&(i.length=0,i.push("any",...a));for(let c=1;c<i.length;c++)Yu(i[c])}function rl(i){if(!Array.isArray(i))return!1;if("pitch"===(r=i[0])||"distance-from-center"===r)return!0;var r;for(let a=1;a<i.length;a++)if(rl(i[a]))return!0;return!1}const hr=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Up(i,r){return i<r?-1:i>r?1:0}function ud(i){if(!Array.isArray(i))return!1;if("within"===i[0])return!0;for(let r=1;r<i.length;r++)if(ud(i[r]))return!0;return!1}function ya(i){if(!i)return!0;const r=i[0];return i.length<=1?"any"!==r:"=="===r?xi(i[1],i[2],"=="):"!="===r?rs(xi(i[1],i[2],"==")):"<"===r||">"===r||"<="===r||">="===r?xi(i[1],i[2],r):"any"===r?(a=i.slice(1),["any"].concat(a.map(ya))):"all"===r?["all"].concat(i.slice(1).map(ya)):"none"===r?["all"].concat(i.slice(1).map(ya).map(rs)):"in"===r?hd(i[1],i.slice(2)):"!in"===r?rs(hd(i[1],i.slice(2))):"has"===r?Zc(i[1]):"!has"===r?rs(Zc(i[1])):"within"!==r||i;var a}function xi(i,r,a){switch(i){case"$type":return[`filter-type-${a}`,r];case"$id":return[`filter-id-${a}`,r];default:return[`filter-${a}`,i,r]}}function hd(i,r){if(0===r.length)return!1;switch(i){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(a=>typeof a!=typeof r[0])?["filter-in-large",i,["literal",r.sort(Up)]]:["filter-in-small",i,["literal",r]]}}function Zc(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function rs(i){return["!",i]}function ni(i){if(nl(Is(i.value))){const r=Is(i.layerType);return ns(ra({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${r||"fill"}`]}))}return Ju(i)}function Ju(i){const r=i.value,a=i.key;if("array"!==rn(r))return[new Xe(a,r,`array expected, ${rn(r)} found`)];const c=i.styleSpec;let h,f=[];if(r.length<1)return[new Xe(a,r,"filter array must have at least 1 element")];switch(f=f.concat(qc({key:`${a}[0]`,value:r[0],valueSpec:c.filter_operator,style:i.style,styleSpec:i.styleSpec})),tr(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===tr(r[1])&&f.push(new Xe(a,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&f.push(new Xe(a,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(h=rn(r[1]),"string"!==h&&f.push(new Xe(`${a}[1]`,r[1],`string expected, ${h} found`)));for(let _=2;_<r.length;_++)h=rn(r[_]),"$type"===tr(r[1])?f=f.concat(qc({key:`${a}[${_}]`,value:r[_],valueSpec:c.geometry_type,style:i.style,styleSpec:i.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&f.push(new Xe(`${a}[${_}]`,r[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<r.length;_++)f=f.concat(Ju({key:`${a}[${_}]`,value:r[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":h=rn(r[1]),2!==r.length?f.push(new Xe(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==h&&f.push(new Xe(`${a}[1]`,r[1],`string expected, ${h} found`));break;case"within":h=rn(r[1]),2!==r.length?f.push(new Xe(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):"object"!==h&&f.push(new Xe(`${a}[1]`,r[1],`object expected, ${h} found`))}return f}function va(i,r){const a=i.key,c=i.style,h=i.styleSpec,f=i.value,_=i.objectKey,x=h[`${r}_${i.layerType}`];if(!x)return[];const E=_.match(/^(.*)-transition$/);if("paint"===r&&E&&x[E[1]]&&x[E[1]].transition)return Ir({key:a,value:f,valueSpec:h.transition,style:c,styleSpec:h});const T=i.valueSpec||x[_];if(!T)return[new Xe(a,f,`unknown property "${_}"`)];let S;if("string"===rn(f)&&Wl(T)&&!T.tokens&&(S=/^{([^}]+)}$/.exec(f)))return[new Xe(a,f,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];const I=[];return"symbol"===i.layerType&&("text-field"===_&&c&&!c.glyphs&&I.push(new Xe(a,f,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&Ya(Is(f))&&"identity"===tr(f.type)&&I.push(new Xe(a,f,'"text-font" does not support identity functions'))),I.concat(Ir({key:i.key,value:f,valueSpec:T,style:c,styleSpec:h,expressionContext:"property",propertyType:r,propertyKey:_}))}function dd(i){return va(i,"paint")}function is(i){return va(i,"layout")}function il(i){let r=[];const a=i.value,c=i.key,h=i.style,f=i.styleSpec;a.type||a.ref||r.push(new Xe(c,a,'either "type" or "ref" is required'));let _=tr(a.type);const x=tr(a.ref);if(a.id){const E=tr(a.id);for(let T=0;T<i.arrayIndex;T++){const S=h.layers[T];tr(S.id)===E&&r.push(new Xe(c,a.id,`duplicate layer id "${a.id}", previously used at line ${S.id.__line__}`))}}if("ref"in a){let E;["type","source","source-layer","filter","layout"].forEach(T=>{T in a&&r.push(new Xe(c,a[T],`"${T}" is prohibited for ref layers`))}),h.layers.forEach(T=>{tr(T.id)===x&&(E=T)}),E?E.ref?r.push(new Xe(c,a.ref,"ref cannot reference another ref layer")):_=tr(E.type):r.push(new Xe(c,a.ref,`ref layer "${x}" not found`))}else if("background"!==_&&"sky"!==_)if(a.source){const E=h.sources&&h.sources[a.source],T=E&&tr(E.type);E?"vector"===T&&"raster"===_?r.push(new Xe(c,a.source,`layer "${a.id}" requires a raster source`)):"raster"===T&&"raster"!==_?r.push(new Xe(c,a.source,`layer "${a.id}" requires a vector source`)):"vector"!==T||a["source-layer"]?"raster-dem"===T&&"hillshade"!==_?r.push(new Xe(c,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!a.paint||!a.paint["line-gradient"]||"geojson"===T&&E.lineMetrics||r.push(new Xe(c,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Xe(c,a,`layer "${a.id}" must specify a "source-layer"`)):r.push(new Xe(c,a.source,`source "${a.source}" not found`))}else r.push(new Xe(c,a,'missing required property "source"'));return r=r.concat(vi({key:c,value:a,valueSpec:f.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ir({key:`${c}.type`,value:a.type,valueSpec:f.layer.type,style:i.style,styleSpec:i.styleSpec,object:a,objectKey:"type"}),filter:E=>ni(ra({layerType:_},E)),layout:E=>vi({layer:a,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":T=>is(ra({layerType:_},T))}}),paint:E=>vi({layer:a,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":T=>dd(ra({layerType:_},T))}})}})),r}function Fs(i){const r=i.value,a=i.key,c=rn(r);return"string"!==c?[new Xe(a,r,`string expected, ${c} found`)]:[]}const Ct={promoteId:function({key:i,value:r}){if("string"===rn(r))return Fs({key:i,value:r});{const a=[];for(const c in r)a.push(...Fs({key:`${i}.${c}`,value:r[c]}));return a}}};function jp(i){const r=i.value,a=i.key,c=i.styleSpec,h=i.style;if(!r.type)return[new Xe(a,r,'"type" is required')];const f=tr(r.type);let _;switch(f){case"vector":case"raster":case"raster-dem":return _=vi({key:a,value:r,valueSpec:c[`source_${f.replace("-","_")}`],style:i.style,styleSpec:c,objectElementValidators:Ct}),_;case"geojson":if(_=vi({key:a,value:r,valueSpec:c.source_geojson,style:h,styleSpec:c,objectElementValidators:Ct}),r.cluster)for(const x in r.clusterProperties){const[E,T]=r.clusterProperties[x],S="string"==typeof E?[E,["accumulated"],["get",x]]:E;_.push(...ns({key:`${a}.${x}.map`,value:T,expressionContext:"cluster-map"})),_.push(...ns({key:`${a}.${x}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return _;case"video":return vi({key:a,value:r,valueSpec:c.source_video,style:h,styleSpec:c});case"image":return vi({key:a,value:r,valueSpec:c.source_image,style:h,styleSpec:c});case"canvas":return[new Xe(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qc({key:`${a}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:c})}}function Qu(i){const r=i.value,a=i.styleSpec,c=a.light,h=i.style;let f=[];const _=rn(r);if(void 0===r)return f;if("object"!==_)return f=f.concat([new Xe("light",r,`object expected, ${_} found`)]),f;for(const x in r){const E=x.match(/^(.*)-transition$/);f=f.concat(E&&c[E[1]]&&c[E[1]].transition?Ir({key:x,value:r[x],valueSpec:a.transition,style:h,styleSpec:a}):c[x]?Ir({key:x,value:r[x],valueSpec:c[x],style:h,styleSpec:a}):[new Xe(x,r[x],`unknown property "${x}"`)])}return f}function eh(i){const r=i.value,a=i.key,c=i.style,h=i.styleSpec,f=h.terrain;let _=[];const x=rn(r);if(void 0===r)return _;if("object"!==x)return _=_.concat([new Xe("terrain",r,`object expected, ${x} found`)]),_;for(const E in r){const T=E.match(/^(.*)-transition$/);_=_.concat(T&&f[T[1]]&&f[T[1]].transition?Ir({key:E,value:r[E],valueSpec:h.transition,style:c,styleSpec:h}):f[E]?Ir({key:E,value:r[E],valueSpec:f[E],style:c,styleSpec:h}):[new Xe(E,r[E],`unknown property "${E}"`)])}if(r.source){const E=c.sources&&c.sources[r.source],T=E&&tr(E.type);E?"raster-dem"!==T&&_.push(new Xe(a,r.source,`terrain cannot be used with a source of type ${T}, it only be used with a "raster-dem" source type`)):_.push(new Xe(a,r.source,`source "${r.source}" not found`))}else _.push(new Xe(a,r,'terrain is missing required property "source"'));return _}function th(i){const r=i.value,a=i.style,c=i.styleSpec,h=c.fog;let f=[];const _=rn(r);if(void 0===r)return f;if("object"!==_)return f=f.concat([new Xe("fog",r,`object expected, ${_} found`)]),f;for(const x in r){const E=x.match(/^(.*)-transition$/);f=f.concat(E&&h[E[1]]&&h[E[1]].transition?Ir({key:x,value:r[x],valueSpec:c.transition,style:a,styleSpec:c}):h[x]?Ir({key:x,value:r[x],valueSpec:h[x],style:a,styleSpec:c}):[new Xe(x,r[x],`unknown property "${x}"`)])}return f}const Wc={"*":()=>[],array:Xu,boolean:function(i){const r=i.value,a=i.key,c=rn(r);return"boolean"!==c?[new Xe(a,r,`boolean expected, ${c} found`)]:[]},number:Gc,color:function(i){const r=i.key,a=i.value,c=rn(a);return"string"!==c?[new Xe(r,a,`color expected, ${c} found`)]:null===oa.parseCSSColor(a)?[new Xe(r,a,`color expected, "${a}" found`)]:[]},constants:Pp,enum:qc,filter:ni,function:Hc,layer:il,object:vi,source:jp,light:Qu,terrain:eh,fog:th,string:Fs,formatted:function(i){return 0===Fs(i).length?[]:ns(i)},resolvedImage:function(i){return 0===Fs(i).length?[]:ns(i)},projection:function(i){const r=i.value,a=i.styleSpec,c=a.projection,h=i.style;let f=[];const _=rn(r);if("object"===_)for(const x in r)f=f.concat(Ir({key:x,value:r[x],valueSpec:c[x],style:h,styleSpec:a}));else"string"!==_&&(f=f.concat([new Xe("projection",r,`object or string expected, ${_} found`)]));return f}};function Ir(i){const r=i.value,a=i.valueSpec,c=i.styleSpec;return a.expression&&Ya(tr(r))?Hc(i):a.expression&&Ja(Is(r))?ns(i):a.type&&Wc[a.type]?Wc[a.type](i):vi(ra({},i,{valueSpec:a.type?c[a.type]:a}))}function nh(i){const r=i.value,a=i.key,c=Fs(i);return c.length||(-1===r.indexOf("{fontstack}")&&c.push(new Xe(a,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&c.push(new Xe(a,r,'"glyphs" url must include a "{range}" token'))),c}function Ne(i,r=Ee){let a=[];return a=a.concat(Ir({key:"",value:i,valueSpec:r.$root,styleSpec:r,style:i,objectElementValidators:{glyphs:nh,"*":()=>[]}})),i.constants&&(a=a.concat(Pp({key:"constants",value:i.constants,style:i,styleSpec:r}))),on(a)}function on(i){return[].concat(i).sort((r,a)=>r.line-a.line)}function fo(i){return function(...r){return on(i.apply(this,r))}}Ne.source=fo(jp),Ne.light=fo(Qu),Ne.terrain=fo(eh),Ne.fog=fo(th),Ne.layer=fo(il),Ne.filter=fo(ni),Ne.paintProperty=fo(dd),Ne.layoutProperty=fo(is);const Hn=Ne,xa=Hn.light,Kl=Hn.fog,Ki=Hn.paintProperty,rh=Hn.layoutProperty;function Xc(i,r){let a=!1;if(r&&r.length)for(const c of r)i.fire(new Lu(new Error(c.message))),a=!0;return a}var Kc=ri;function ri(i,r,a){var c=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(r=h[1])+2*(a=h[2]);for(var f=0;f<this.d*this.d;f++){var _=h[3+f],x=h[3+f+1];c.push(_===x?null:h.subarray(_,x))}var E=h[3+c.length+1];this.keys=h.subarray(h[3+c.length],E),this.bboxes=h.subarray(E),this.insert=this._insertReadonly}else{this.d=r+2*a;for(var T=0;T<this.d*this.d;T++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=i,this.padding=a,this.scale=r/i,this.uid=0;var S=a/r*i;this.min=-S,this.max=i+S}ri.prototype.insert=function(i,r,a,c,h){this._forEachCell(r,a,c,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(h)},ri.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ri.prototype._insertCell=function(i,r,a,c,h,f){this.cells[h].push(f)},ri.prototype.query=function(i,r,a,c,h){var f=this.min,_=this.max;if(i<=f&&r<=f&&_<=a&&_<=c&&!h)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(i,r,a,c,this._queryCell,x,{},h),x},ri.prototype._queryCell=function(i,r,a,c,h,f,_,x){var E=this.cells[h];if(null!==E)for(var T=this.keys,S=this.bboxes,I=0;I<E.length;I++){var P=E[I];if(void 0===_[P]){var z=4*P;(x?x(S[z+0],S[z+1],S[z+2],S[z+3]):i<=S[z+2]&&r<=S[z+3]&&a>=S[z+0]&&c>=S[z+1])?(_[P]=!0,f.push(T[P])):_[P]=!1}}},ri.prototype._forEachCell=function(i,r,a,c,h,f,_,x){for(var E=this._convertToCellCoord(i),T=this._convertToCellCoord(r),S=this._convertToCellCoord(a),I=this._convertToCellCoord(c),P=E;P<=S;P++)for(var z=T;z<=I;z++){var N=this.d*z+P;if((!x||x(this._convertFromCellCoord(P),this._convertFromCellCoord(z),this._convertFromCellCoord(P+1),this._convertFromCellCoord(z+1)))&&h.call(this,i,r,a,c,N,f,_,x))return}},ri.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},ri.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},ri.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,r=3+this.cells.length+1+1,a=0,c=0;c<this.cells.length;c++)a+=this.cells[c].length;var h=new Int32Array(r+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var f=r,_=0;_<i.length;_++){var x=i[_];h[3+_]=f,h.set(x,f),f+=x.length}return h[3+i.length]=f,h.set(this.keys,f),h[3+i.length+1]=f+=this.keys.length,h.set(this.bboxes,f),f+=this.bboxes.length,h.buffer};const{ImageData:zs,ImageBitmap:os}=Pe,br={};function Ye(i,r,a={}){Object.defineProperty(r,"_classRegistryKey",{value:i,writeable:!1}),br[i]={klass:r,omit:a.omit||[],shallow:a.shallow||[]}}Ye("Object",Object),Kc.serialize=function(i,r){const a=i.toArrayBuffer();return r&&r.push(a),{buffer:a}},Kc.deserialize=function(i){return new Kc(i.buffer)},Ye("Grid",Kc),Ye("Color",Qt),Ye("Error",Error),Ye("ResolvedImage",vr),Ye("StylePropertyFunction",tl),Ye("StyleExpression",Zu,{omit:["_evaluator"]}),Ye("ZoomDependentExpression",Wu),Ye("ZoomConstantExpression",el),Ye("CompoundExpression",Dr,{omit:["_evaluate"]});for(const i in Fo)Fo[i]._classRegistryKey||Ye(`Expression_${i}`,Fo[i]);function ba(i){return i&&"undefined"!=typeof ArrayBuffer&&(i instanceof ArrayBuffer||i.constructor&&"ArrayBuffer"===i.constructor.name)}function wa(i){return os&&i instanceof os}function Ni(i,r){if(null==i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(ba(i)||wa(i))return r&&r.push(i),i;if(ArrayBuffer.isView(i)){const a=i;return r&&r.push(a.buffer),a}if(i instanceof zs)return r&&r.push(i.data.buffer),i;if(Array.isArray(i)){const a=[];for(const c of i)a.push(Ni(c,r));return a}if("object"==typeof i){const a=i.constructor,c=a._classRegistryKey;if(!c)throw new Error("can't serialize object of unregistered class");const h=a.serialize?a.serialize(i,r):{};if(!a.serialize){for(const f in i){if(!i.hasOwnProperty(f)||br[c].omit.indexOf(f)>=0)continue;const _=i[f];h[f]=br[c].shallow.indexOf(f)>=0?_:Ni(_,r)}i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==c&&(h.$name=c),h}throw new Error("can't serialize object of type "+typeof i)}function Bs(i){if(null==i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||ba(i)||wa(i)||ArrayBuffer.isView(i)||i instanceof zs)return i;if(Array.isArray(i))return i.map(Bs);if("object"==typeof i){const r=i.$name||"Object",{klass:a}=br[r];if(!a)throw new Error(`can't deserialize unregistered class ${r}`);if(a.deserialize)return a.deserialize(i);const c=Object.create(a.prototype);for(const h of Object.keys(i)){if("$name"===h)continue;const f=i[h];c[h]=br[r].shallow.indexOf(h)>=0?f:Bs(f)}return c}throw new Error("can't deserialize object of type "+typeof i)}class m{constructor(){this.first=!0}update(r,a){const c=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=a),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=c,!0))}}const o=i=>i>=1536&&i<=1791,u=i=>i>=1872&&i<=1919,g=i=>i>=2208&&i<=2303,v=i=>i>=11904&&i<=12031,b=i=>i>=12032&&i<=12255,C=i=>i>=12272&&i<=12287,M=i=>i>=12288&&i<=12351,k=i=>i>=12352&&i<=12447,R=i=>i>=12448&&i<=12543,L=i=>i>=12544&&i<=12591,B=i=>i>=12704&&i<=12735,V=i=>i>=12736&&i<=12783,Z=i=>i>=12784&&i<=12799,H=i=>i>=12800&&i<=13055,W=i=>i>=13056&&i<=13311,ae=i=>i>=13312&&i<=19903,G=i=>i>=19968&&i<=40959,re=i=>i>=40960&&i<=42127,ee=i=>i>=42128&&i<=42191,ne=i=>i>=44032&&i<=55215,ie=i=>i>=63744&&i<=64255,le=i=>i>=64336&&i<=65023,_e=i=>i>=65040&&i<=65055,xe=i=>i>=65072&&i<=65103,qe=i=>i>=65104&&i<=65135,Oe=i=>i>=65136&&i<=65279,Le=i=>i>=65280&&i<=65519;function be(i){for(const r of i)if(Se(r.charCodeAt(0)))return!0;return!1}function ve(i){for(const r of i)if(!ke(r.charCodeAt(0)))return!1;return!0}function ke(i){return!(o(i)||u(i)||g(i)||le(i)||Oe(i))}function Se(i){return!(746!==i&&747!==i&&(i<4352||!(B(i)||L(i)||xe(i)&&!(i>=65097&&i<=65103)||ie(i)||W(i)||v(i)||V(i)||!(!M(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||12336===i)||ae(i)||G(i)||H(i)||(r=i,r>=12592&&r<=12687)||(r=>r>=43360&&r<=43391)(i)||(r=>r>=55216&&r<=55295)(i)||(r=>r>=4352&&r<=4607)(i)||ne(i)||k(i)||C(i)||(r=>r>=12688&&r<=12703)(i)||b(i)||Z(i)||R(i)&&12540!==i||!(!Le(i)||65288===i||65289===i||65293===i||i>=65306&&i<=65310||65339===i||65341===i||65343===i||i>=65371&&i<=65503||65507===i||i>=65512&&i<=65519)||!(!qe(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(r=>r>=5120&&r<=5759)(i)||(r=>r>=6320&&r<=6399)(i)||_e(i)||(r=>r>=19904&&r<=19967)(i)||re(i)||ee(i))));var r}function rt(i){return!(Se(i)||(r=i,(a=r)>=128&&a<=255&&(167===r||169===r||174===r||177===r||188===r||189===r||190===r||215===r||247===r)||(a=>a>=8192&&a<=8303)(r)&&(8214===r||8224===r||8225===r||8240===r||8241===r||8251===r||8252===r||8258===r||8263===r||8264===r||8265===r||8273===r)||(a=>a>=8448&&a<=8527)(r)||(a=>a>=8528&&a<=8591)(r)||(a=>a>=8960&&a<=9215)(r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||9003===r||r>=9085&&r<=9114||r>=9150&&r<=9165||9167===r||r>=9169&&r<=9179||r>=9186&&r<=9215)||(a=>a>=9216&&a<=9279)(r)&&9251!==r||(a=>a>=9280&&a<=9311)(r)||(a=>a>=9312&&a<=9471)(r)||(a=>a>=9632&&a<=9727)(r)||(a=>a>=9728&&a<=9983)(r)&&!(r>=9754&&r<=9759)||(a=>a>=11008&&a<=11263)(r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||M(r)||R(r)||(a=>a>=57344&&a<=63743)(r)||xe(r)||qe(r)||Le(r)||8734===r||8756===r||8757===r||r>=9984&&r<=10087||r>=10102&&r<=10131||65532===r||65533===r));var r,a}function dt(i){return i>=1424&&i<=2303||le(i)||Oe(i)}function At(i,r){return!(!r&&dt(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(a=i,a>=6016&&a<=6143));var a}function He(i){for(const r of i)if(dt(r.charCodeAt(0)))return!0;return!1}const ut="deferred",yt="loading",mn="loaded";let Dn=null,bt="unavailable",Bt=null;const Mn=function(i){i&&"string"==typeof i&&i.indexOf("NetworkError")>-1&&(bt="error"),Dn&&Dn(i)};function or(){Gr.fire(new ur("pluginStateChange",{pluginStatus:bt,pluginURL:Bt}))}const Gr=new Ss,ii=function(){return bt},Yi=function(){if(bt!==ut||!Bt)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");bt=yt,or(),Bt&&Wa({url:Bt},i=>{i?Mn(i):(bt=mn,or())})},Ht={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>bt===mn||null!=Ht.applyArabicShaping,isLoading:()=>bt===yt,setState(i){bt=i.pluginStatus,Bt=i.pluginURL},isParsed:()=>null!=Ht.applyArabicShaping&&null!=Ht.processBidirectionalText&&null!=Ht.processStyledBidirectionalText,getPluginURL:()=>Bt};class gt{constructor(r,a){this.zoom=r,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition,this.pitch=a.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new m,this.transition={},this.pitch=0)}isSupportedScript(r){return function(a,c){for(const h of a)if(!At(h.charCodeAt(0),c))return!1;return!0}(r,Ht.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,a=r-Math.floor(r),c=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*a}}}class jt{constructor(r,a){this.property=r,this.value=a,this.expression=function(c,h){if(Ya(c))return new tl(c,h);if(Ja(c)){const f=$c(c,h);if("error"===f.result)throw new Error(f.value.map(_=>`${_.key}: ${_.message}`).join(", "));return f.value}{let f=c;return"string"==typeof c&&"color"===h.type&&(f=Qt.parse(c)),{kind:"constant",evaluate:()=>f}}}(void 0===a?r.specification.default:a,r.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(r,a,c){return this.property.possiblyEvaluate(this,r,a,c)}}class Pn{constructor(r){this.property=r,this.value=new jt(r,void 0)}transitioned(r,a){return new wn(this.property,this.value,a,Xn({},r.transition,this.transition),r.now)}untransitioned(){return new wn(this.property,this.value,null,{},0)}}class oi{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return ki(this._values[r].value.value)}setValue(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new Pn(this._values[r].property)),this._values[r].value=new jt(this._values[r].property,null===a?void 0:ki(a))}getTransition(r){return ki(this._values[r].transition)}setTransition(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new Pn(this._values[r].property)),this._values[r].transition=ki(a)||void 0}serialize(){const r={};for(const a of Object.keys(this._values)){const c=this.getValue(a);void 0!==c&&(r[a]=c);const h=this.getTransition(a);void 0!==h&&(r[`${a}-transition`]=h)}return r}transitioned(r,a){const c=new Ji(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].transitioned(r,a._values[h]);return c}untransitioned(){const r=new Ji(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].untransitioned();return r}}class wn{constructor(r,a,c,h,f){const _=h.delay||0,x=h.duration||0;f=f||0,this.property=r,this.value=a,this.begin=f+_,this.end=this.begin+x,r.specification.transition&&(h.delay||h.duration)&&(this.prior=c)}possiblyEvaluate(r,a,c){const h=r.now||0,f=this.value.possiblyEvaluate(r,a,c),_=this.prior;if(_){if(h>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(h<this.begin)return _.possiblyEvaluate(r,a,c);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(r,a,c),f,Va(x))}}return f}}class Ji{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,a,c){const h=new Ea(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(r,a,c);return h}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class ol{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return ki(this._values[r].value)}setValue(r,a){this._values[r]=new jt(this._values[r].property,null===a?void 0:ki(a))}serialize(){const r={};for(const a of Object.keys(this._values)){const c=this.getValue(a);void 0!==c&&(r[a]=c)}return r}possiblyEvaluate(r,a,c){const h=new Ea(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(r,a,c);return h}}class si{constructor(r,a,c){this.property=r,this.value=a,this.parameters=c}isConstant(){return"constant"===this.value.kind}constantOr(r){return"constant"===this.value.kind?this.value.value:r}evaluate(r,a,c,h){return this.property.evaluate(this.value,this.parameters,r,a,c,h)}}class Ea{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class it{constructor(r){this.specification=r}possiblyEvaluate(r,a){return r.expression.evaluate(a)}interpolate(r,a,c){const h=xr[this.specification.type];return h?h(r,a,c):r}}class ht{constructor(r,a){this.specification=r,this.overrides=a}possiblyEvaluate(r,a,c,h){return new si(this,"constant"===r.expression.kind||"camera"===r.expression.kind?{kind:"constant",value:r.expression.evaluate(a,null,{},c,h)}:r.expression,a)}interpolate(r,a,c){if("constant"!==r.value.kind||"constant"!==a.value.kind)return r;if(void 0===r.value.value||void 0===a.value.value)return new si(this,{kind:"constant",value:void 0},r.parameters);const h=xr[this.specification.type];return h?new si(this,{kind:"constant",value:h(r.value.value,a.value.value,c)},r.parameters):r}evaluate(r,a,c,h,f,_){return"constant"===r.kind?r.value:r.evaluate(a,c,h,f,_)}}class dr extends ht{possiblyEvaluate(r,a,c,h){if(void 0===r.value)return new si(this,{kind:"constant",value:void 0},a);if("constant"===r.expression.kind){const f=r.expression.evaluate(a,null,{},c,h),_="resolvedImage"===r.property.specification.type&&"string"!=typeof f?f.name:f,x=this._calculate(_,_,_,a);return new si(this,{kind:"constant",value:x},a)}if("camera"===r.expression.kind){const f=this._calculate(r.expression.evaluate({zoom:a.zoom-1}),r.expression.evaluate({zoom:a.zoom}),r.expression.evaluate({zoom:a.zoom+1}),a);return new si(this,{kind:"constant",value:f},a)}return new si(this,r.expression,a)}evaluate(r,a,c,h,f,_){if("source"===r.kind){const x=r.evaluate(a,c,h,f,_);return this._calculate(x,x,x,a)}return"composite"===r.kind?this._calculate(r.evaluate({zoom:Math.floor(a.zoom)-1},c,h),r.evaluate({zoom:Math.floor(a.zoom)},c,h),r.evaluate({zoom:Math.floor(a.zoom)+1},c,h),a):r.value}_calculate(r,a,c,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:r,to:a,other:c}:{from:c,to:a,other:r}}interpolate(r){return r}}class ss{constructor(r){this.specification=r}possiblyEvaluate(r,a,c,h){if(void 0!==r.value){if("constant"===r.expression.kind){const f=r.expression.evaluate(a,null,{},c,h);return this._calculate(f,f,f,a)}return this._calculate(r.expression.evaluate(new gt(Math.floor(a.zoom-1),a)),r.expression.evaluate(new gt(Math.floor(a.zoom),a)),r.expression.evaluate(new gt(Math.floor(a.zoom+1),a)),a)}}_calculate(r,a,c,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:r,to:a}:{from:c,to:a}}interpolate(r){return r}}class mo{constructor(r){this.specification=r}possiblyEvaluate(r,a,c,h){return!!r.expression.evaluate(a,null,{},c,h)}interpolate(){return!1}}class pr{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const a in r){const c=r[a];c.specification.overridable&&this.overridableProperties.push(a);const h=this.defaultPropertyValues[a]=new jt(c,void 0),f=this.defaultTransitionablePropertyValues[a]=new Pn(c);this.defaultTransitioningPropertyValues[a]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=h.possiblyEvaluate({})}}}function Bm(i,r){return 256*(i=_n(Math.floor(i),0,255))+_n(Math.floor(r),0,255)}Ye("DataDrivenProperty",ht),Ye("DataConstantProperty",it),Ye("CrossFadedDataDrivenProperty",dr),Ye("CrossFadedProperty",ss),Ye("ColorRampProperty",mo);const Nm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Yc{constructor(r,a){this._structArray=r,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Qn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,a){return r._trim(),a&&(r.isTransferred=!0,a.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const a=Object.create(this.prototype);return a.arrayBuffer=r.arrayBuffer,a.length=r.length,a.capacity=r.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function jn(i,r=1){let a=0,c=0;return{members:i.map(h=>{const f=Nm[h.type].BYTES_PER_ELEMENT,_=a=Um(a,Math.max(r,f)),x=h.components||1;return c=Math.max(c,f),a+=f*x,{name:h.name,type:h.type,components:x,offset:_}}),size:Um(a,Math.max(c,r)),alignment:r}}function Um(i,r){return Math.ceil(i/r)*r}class Jc extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a){const c=this.length;return this.resize(c+1),this.emplace(c,r,a)}emplace(r,a,c){const h=2*r;return this.int16[h+0]=a,this.int16[h+1]=c,r}}Jc.prototype.bytesPerElement=4,Ye("StructArrayLayout2i4",Jc);class Ca extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,c,h)}emplace(r,a,c,h,f){const _=4*r;return this.int16[_+0]=a,this.int16[_+1]=c,this.int16[_+2]=h,this.int16[_+3]=f,r}}Ca.prototype.bytesPerElement=8,Ye("StructArrayLayout4i8",Ca);class Yl extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,a,c,h,f,_,x)}emplace(r,a,c,h,f,_,x,E){const T=6*r,S=12*r,I=3*r;return this.int16[T+0]=a,this.int16[T+1]=c,this.uint8[S+4]=h,this.uint8[S+5]=f,this.uint8[S+6]=_,this.uint8[S+7]=x,this.float32[I+2]=E,r}}Yl.prototype.bytesPerElement=12,Ye("StructArrayLayout2i4ub1f12",Yl);class Qc extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,c)}emplace(r,a,c,h){const f=3*r;return this.float32[f+0]=a,this.float32[f+1]=c,this.float32[f+2]=h,r}}Qc.prototype.bytesPerElement=12,Ye("StructArrayLayout3f12",Qc);class Ta extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f,_,x,E,T,S){const I=this.length;return this.resize(I+1),this.emplace(I,r,a,c,h,f,_,x,E,T,S)}emplace(r,a,c,h,f,_,x,E,T,S,I){const P=10*r;return this.uint16[P+0]=a,this.uint16[P+1]=c,this.uint16[P+2]=h,this.uint16[P+3]=f,this.uint16[P+4]=_,this.uint16[P+5]=x,this.uint16[P+6]=E,this.uint16[P+7]=T,this.uint16[P+8]=S,this.uint16[P+9]=I,r}}Ta.prototype.bytesPerElement=20,Ye("StructArrayLayout10ui20",Ta);class ih extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f,_,x,E){const T=this.length;return this.resize(T+1),this.emplace(T,r,a,c,h,f,_,x,E)}emplace(r,a,c,h,f,_,x,E,T){const S=8*r;return this.uint16[S+0]=a,this.uint16[S+1]=c,this.uint16[S+2]=h,this.uint16[S+3]=f,this.uint16[S+4]=_,this.uint16[S+5]=x,this.uint16[S+6]=E,this.uint16[S+7]=T,r}}ih.prototype.bytesPerElement=16,Ye("StructArrayLayout8ui16",ih);class sl extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f,_,x,E,T,S,I,P,z,N,$,q){const J=this.length;return this.resize(J+1),this.emplace(J,r,a,c,h,f,_,x,E,T,S,I,P,z,N,$,q)}emplace(r,a,c,h,f,_,x,E,T,S,I,P,z,N,$,q,J){const oe=16*r;return this.int16[oe+0]=a,this.int16[oe+1]=c,this.int16[oe+2]=h,this.int16[oe+3]=f,this.uint16[oe+4]=_,this.uint16[oe+5]=x,this.uint16[oe+6]=E,this.uint16[oe+7]=T,this.int16[oe+8]=S,this.int16[oe+9]=I,this.int16[oe+10]=P,this.int16[oe+11]=z,this.int16[oe+12]=N,this.int16[oe+13]=$,this.int16[oe+14]=q,this.int16[oe+15]=J,r}}sl.prototype.bytesPerElement=32,Ye("StructArrayLayout4i4ui4i4i32",sl);class Vp extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint32[1*r+0]=a,r}}Vp.prototype.bytesPerElement=4,Ye("StructArrayLayout1ul4",Vp);class oh extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f,_,x,E,T,S,I,P,z){const N=this.length;return this.resize(N+1),this.emplace(N,r,a,c,h,f,_,x,E,T,S,I,P,z)}emplace(r,a,c,h,f,_,x,E,T,S,I,P,z,N){const $=20*r,q=10*r;return this.int16[$+0]=a,this.int16[$+1]=c,this.int16[$+2]=h,this.int16[$+3]=f,this.int16[$+4]=_,this.float32[q+3]=x,this.float32[q+4]=E,this.float32[q+5]=T,this.float32[q+6]=S,this.int16[$+14]=I,this.uint32[q+8]=P,this.uint16[$+18]=z,this.uint16[$+19]=N,r}}oh.prototype.bytesPerElement=40,Ye("StructArrayLayout5i4f1i1ul2ui40",oh);class al extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,a,c,h,f,_,x)}emplace(r,a,c,h,f,_,x,E){const T=8*r;return this.int16[T+0]=a,this.int16[T+1]=c,this.int16[T+2]=h,this.int16[T+4]=f,this.int16[T+5]=_,this.int16[T+6]=x,this.int16[T+7]=E,r}}al.prototype.bytesPerElement=16,Ye("StructArrayLayout3i2i2i16",al);class ll extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,a,c,h,f)}emplace(r,a,c,h,f,_){const x=4*r,E=8*r;return this.float32[x+0]=a,this.float32[x+1]=c,this.float32[x+2]=h,this.int16[E+6]=f,this.int16[E+7]=_,r}}ll.prototype.bytesPerElement=16,Ye("StructArrayLayout2f1f2i16",ll);class cl extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,c,h)}emplace(r,a,c,h,f){const _=12*r,x=3*r;return this.uint8[_+0]=a,this.uint8[_+1]=c,this.float32[x+1]=h,this.float32[x+2]=f,r}}cl.prototype.bytesPerElement=12,Ye("StructArrayLayout2ub2f12",cl);class Hr extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,c)}emplace(r,a,c,h){const f=3*r;return this.uint16[f+0]=a,this.uint16[f+1]=c,this.uint16[f+2]=h,r}}Hr.prototype.bytesPerElement=6,Ye("StructArrayLayout3ui6",Hr);class pd extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f,_,x,E,T,S,I,P,z,N,$,q,J,oe,ce,he,fe){const pe=this.length;return this.resize(pe+1),this.emplace(pe,r,a,c,h,f,_,x,E,T,S,I,P,z,N,$,q,J,oe,ce,he,fe)}emplace(r,a,c,h,f,_,x,E,T,S,I,P,z,N,$,q,J,oe,ce,he,fe,pe){const Te=30*r,we=15*r,Ze=60*r;return this.int16[Te+0]=a,this.int16[Te+1]=c,this.int16[Te+2]=h,this.float32[we+2]=f,this.float32[we+3]=_,this.uint16[Te+8]=x,this.uint16[Te+9]=E,this.uint32[we+5]=T,this.uint32[we+6]=S,this.uint32[we+7]=I,this.uint16[Te+16]=P,this.uint16[Te+17]=z,this.uint16[Te+18]=N,this.float32[we+10]=$,this.float32[we+11]=q,this.uint8[Ze+48]=J,this.uint8[Ze+49]=oe,this.uint8[Ze+50]=ce,this.uint32[we+13]=he,this.int16[Te+28]=fe,this.uint8[Ze+58]=pe,r}}pd.prototype.bytesPerElement=60,Ye("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",pd);class sh extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f,_,x,E,T,S,I,P,z,N,$,q,J,oe,ce,he,fe,pe,Te,we,Ze,Ue,De,Ge,Ke,Re){const We=this.length;return this.resize(We+1),this.emplace(We,r,a,c,h,f,_,x,E,T,S,I,P,z,N,$,q,J,oe,ce,he,fe,pe,Te,we,Ze,Ue,De,Ge,Ke,Re)}emplace(r,a,c,h,f,_,x,E,T,S,I,P,z,N,$,q,J,oe,ce,he,fe,pe,Te,we,Ze,Ue,De,Ge,Ke,Re,We){const tt=38*r,Vt=19*r;return this.int16[tt+0]=a,this.int16[tt+1]=c,this.int16[tt+2]=h,this.float32[Vt+2]=f,this.float32[Vt+3]=_,this.int16[tt+8]=x,this.int16[tt+9]=E,this.int16[tt+10]=T,this.int16[tt+11]=S,this.int16[tt+12]=I,this.int16[tt+13]=P,this.uint16[tt+14]=z,this.uint16[tt+15]=N,this.uint16[tt+16]=$,this.uint16[tt+17]=q,this.uint16[tt+18]=J,this.uint16[tt+19]=oe,this.uint16[tt+20]=ce,this.uint16[tt+21]=he,this.uint16[tt+22]=fe,this.uint16[tt+23]=pe,this.uint16[tt+24]=Te,this.uint16[tt+25]=we,this.uint16[tt+26]=Ze,this.uint16[tt+27]=Ue,this.uint16[tt+28]=De,this.uint32[Vt+15]=Ge,this.float32[Vt+16]=Ke,this.float32[Vt+17]=Re,this.float32[Vt+18]=We,r}}sh.prototype.bytesPerElement=76,Ye("StructArrayLayout3i2f6i15ui1ul3f76",sh);class Da extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.float32[1*r+0]=a,r}}Da.prototype.bytesPerElement=4,Ye("StructArrayLayout1f4",Da);class jm extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,c)}emplace(r,a,c,h){const f=3*r;return this.int16[f+0]=a,this.int16[f+1]=c,this.int16[f+2]=h,r}}jm.prototype.bytesPerElement=6,Ye("StructArrayLayout3i6",jm);class ah extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,h,f,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,a,c,h,f,_,x)}emplace(r,a,c,h,f,_,x,E){const T=7*r;return this.float32[T+0]=a,this.float32[T+1]=c,this.float32[T+2]=h,this.float32[T+3]=f,this.float32[T+4]=_,this.float32[T+5]=x,this.float32[T+6]=E,r}}ah.prototype.bytesPerElement=28,Ye("StructArrayLayout7f28",ah);class en extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,c,h)}emplace(r,a,c,h,f){const _=6*r;return this.uint32[3*r+0]=a,this.uint16[_+2]=c,this.uint16[_+3]=h,this.uint16[_+4]=f,r}}en.prototype.bytesPerElement=12,Ye("StructArrayLayout1ul3ui12",en);class ul extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a){const c=this.length;return this.resize(c+1),this.emplace(c,r,a)}emplace(r,a,c){const h=2*r;return this.uint16[h+0]=a,this.uint16[h+1]=c,r}}ul.prototype.bytesPerElement=4,Ye("StructArrayLayout2ui4",ul);class $p extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint16[1*r+0]=a,r}}$p.prototype.bytesPerElement=2,Ye("StructArrayLayout1ui2",$p);class Gp extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a){const c=this.length;return this.resize(c+1),this.emplace(c,r,a)}emplace(r,a,c){const h=2*r;return this.float32[h+0]=a,this.float32[h+1]=c,r}}Gp.prototype.bytesPerElement=8,Ye("StructArrayLayout2f8",Gp);class Vm extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,h){const f=this.length;return this.resize(f+1),this.emplace(f,r,a,c,h)}emplace(r,a,c,h,f){const _=4*r;return this.float32[_+0]=a,this.float32[_+1]=c,this.float32[_+2]=h,this.float32[_+3]=f,r}}Vm.prototype.bytesPerElement=16,Ye("StructArrayLayout4f16",Vm);class ry extends Yc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ry.prototype.size=40;class $m extends oh{get(r){return new ry(this,r)}}Ye("CollisionBoxArray",$m);class iy extends Yc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}iy.prototype.size=60;class eu extends pd{get(r){return new iy(this,r)}}Ye("PlacedSymbolArray",eu);class oy extends Yc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}oy.prototype.size=76;class Ar extends sh{get(r){return new oy(this,r)}}Ye("SymbolInstanceArray",Ar);class fd extends Da{getoffsetX(r){return this.float32[1*r+0]}}Ye("GlyphOffsetArray",fd);class tu extends jm{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}Ye("SymbolLineVertexArray",tu);class sy extends Yc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}sy.prototype.size=12;class Gm extends en{get(r){return new sy(this,r)}}Ye("FeatureIndexArray",Gm);class go extends Yc{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}go.prototype.size=4;class as extends ul{get(r){return new go(this,r)}}Ye("FillExtrusionCentroidArray",as);const Hm=jn([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),md=jn([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var nu=Ps(function(i){i.exports=function(r,a){var c,h,f,_,x,E,T,S;for(h=r.length-(c=3&r.length),f=a,x=3432918353,E=461845907,S=0;S<h;)T=255&r.charCodeAt(S)|(255&r.charCodeAt(++S))<<8|(255&r.charCodeAt(++S))<<16|(255&r.charCodeAt(++S))<<24,++S,f=27492+(65535&(_=5*(65535&(f=(f^=T=(65535&(T=(T=(65535&T)*x+(((T>>>16)*x&65535)<<16)&4294967295)<<15|T>>>17))*E+(((T>>>16)*E&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(T=0,c){case 3:T^=(255&r.charCodeAt(S+2))<<16;case 2:T^=(255&r.charCodeAt(S+1))<<8;case 1:f^=T=(65535&(T=(T=(65535&(T^=255&r.charCodeAt(S)))*x+(((T>>>16)*x&65535)<<16)&4294967295)<<15|T>>>17))*E+(((T>>>16)*E&65535)<<16)&4294967295}return f^=r.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}}),qm=Ps(function(i){i.exports=function(r,a){for(var c,h=r.length,f=a^h,_=0;h>=4;)c=1540483477*(65535&(c=255&r.charCodeAt(_)|(255&r.charCodeAt(++_))<<8|(255&r.charCodeAt(++_))<<16|(255&r.charCodeAt(++_))<<24))+((1540483477*(c>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),h-=4,++_;switch(h){case 3:f^=(255&r.charCodeAt(_+2))<<16;case 2:f^=(255&r.charCodeAt(_+1))<<8;case 1:f=1540483477*(65535&(f^=255&r.charCodeAt(_)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}}),lh=nu,ay=qm;lh.murmur3=nu,lh.murmur2=ay;class Hp{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,a,c,h){this.ids.push(ly(r)),this.positions.push(a,c,h)}getPositions(r){const a=ly(r);let c=0,h=this.ids.length-1;for(;c<h;){const _=c+h>>1;this.ids[_]>=a?h=_:c=_+1}const f=[];for(;this.ids[c]===a;)f.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return f}static serialize(r,a){const c=new Float64Array(r.ids),h=new Uint32Array(r.positions);return gd(c,h,0,c.length-1),a&&a.push(c.buffer,h.buffer),{ids:c,positions:h}}static deserialize(r){const a=new Hp;return a.ids=r.ids,a.positions=r.positions,a.indexed=!0,a}}function ly(i){const r=+i;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:lh(String(i))}function gd(i,r,a,c){for(;a<c;){const h=i[a+c>>1];let f=a-1,_=c+1;for(;;){do{f++}while(i[f]<h);do{_--}while(i[_]>h);if(f>=_)break;bi(i,f,_),bi(r,3*f,3*_),bi(r,3*f+1,3*_+1),bi(r,3*f+2,3*_+2)}_-a<c-_?(gd(i,r,a,_),a=_+1):(gd(i,r,_+1,c),c=_)}}function bi(i,r,a){const c=i[r];i[r]=i[a],i[a]=c}Ye("FeaturePositionMap",Hp);class ls{constructor(r,a){this.gl=r.gl,this.location=a}}class Ma extends ls{constructor(r,a){super(r,a),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class cy extends ls{constructor(r,a){super(r,a),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class qp extends ls{constructor(r,a){super(r,a),this.current=Qt.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const uy=new Float32Array(16),hy=new Float32Array(9),dy=new Float32Array(4);function Zp(i){return[Bm(255*i.r,255*i.g),Bm(255*i.b,255*i.a)]}class ch{constructor(r,a,c){this.value=r,this.uniformNames=a.map(h=>`u_${h}`),this.type=c}setUniform(r,a,c){r.set(c.constantOr(this.value))}getBinding(r,a,c){return"color"===this.type?new qp(r,a):new Ma(r,a)}}class Jl{constructor(r,a){this.uniformNames=a.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=a.tl.concat(a.br),this.patternTo=r.tl.concat(r.br)}setUniform(r,a,c,h){const f="u_pattern_to"===h||"u_dash_to"===h?this.patternTo:"u_pattern_from"===h||"u_dash_from"===h?this.patternFrom:"u_pixel_ratio_to"===h?this.pixelRatioTo:"u_pixel_ratio_from"===h?this.pixelRatioFrom:null;f&&r.set(f)}getBinding(r,a,c){return"u_pattern_from"===c||"u_pattern_to"===c||"u_dash_from"===c||"u_dash_to"===c?new cy(r,a):new Ma(r,a)}}class cs{constructor(r,a,c,h){this.expression=r,this.type=c,this.maxValue=0,this.paintVertexAttributes=a.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===c?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(r,a,c,h,f,_){const x=this.paintVertexArray.length,E=this.expression.evaluate(new gt(0),a,{},f,h,_);this.paintVertexArray.resize(r),this._setPaintValue(x,r,E)}updatePaintArray(r,a,c,h,f){const _=this.expression.evaluate({zoom:0},c,h,void 0,f);this._setPaintValue(r,a,_)}_setPaintValue(r,a,c){if("color"===this.type){const h=Zp(c);for(let f=r;f<a;f++)this.paintVertexArray.emplace(f,h[0],h[1])}else{for(let h=r;h<a;h++)this.paintVertexArray.emplace(h,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Qi{constructor(r,a,c,h,f,_){this.expression=r,this.uniformNames=a.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=h,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=a.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===c?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(r,a,c,h,f,_){const x=this.expression.evaluate(new gt(this.zoom),a,{},f,h,_),E=this.expression.evaluate(new gt(this.zoom+1),a,{},f,h,_),T=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(T,r,x,E)}updatePaintArray(r,a,c,h,f){const _=this.expression.evaluate({zoom:this.zoom},c,h,void 0,f),x=this.expression.evaluate({zoom:this.zoom+1},c,h,void 0,f);this._setPaintValue(r,a,_,x)}_setPaintValue(r,a,c,h){if("color"===this.type){const f=Zp(c),_=Zp(h);for(let x=r;x<a;x++)this.paintVertexArray.emplace(x,f[0],f[1],_[0],_[1])}else{for(let f=r;f<a;f++)this.paintVertexArray.emplace(f,c,h);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,a){const c=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,h=_n(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);r.set(h)}getBinding(r,a,c){return new Ma(r,a)}}class Ql{constructor(r,a,c,h,f,_,x){this.expression=r,this.type=c,this.useIntegerZoom=h,this.zoom=f,this.layerId=x,this.paintVertexAttributes=("array"===c?md:Hm).members;for(let E=0;E<a.length;++E);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(r,a,c){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(h,r,a.patterns&&a.patterns[this.layerId],c)}updatePaintArray(r,a,c,h,f,_){this._setPaintValues(r,a,c.patterns&&c.patterns[this.layerId],_)}_setPaintValues(r,a,c,h){if(!h||!c)return;const{min:f,mid:_,max:x}=c,E=h[f],T=h[_],S=h[x];if(E&&T&&S)for(let I=r;I<a;I++)this._setPaintValue(this.zoomInPaintVertexArray,I,T,E),this._setPaintValue(this.zoomOutPaintVertexArray,I,T,S)}_setPaintValue(r,a,c,h){r.emplace(a,c.tl[0],c.tl[1],c.br[0],c.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],c.pixelRatio,h.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class _o{constructor(r,a,c=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const f in r.paint._values){if(!c(f))continue;const _=r.paint.get(f);if(!(_ instanceof si&&Wl(_.property.specification)))continue;const x=py(f,r.type),E=_.value,T=_.property.specification.type,S=_.property.useIntegerZoom,I=_.property.specification["property-type"],P="cross-faded"===I||"cross-faded-data-driven"===I,z="line-dasharray"===String(f)&&"constant"!==r.layout.get("line-cap").value.kind;if("constant"!==E.kind||z)if("source"===E.kind||z||P){const N=Wp(f,T,"source");this.binders[f]=P?new Ql(E,x,T,S,a,N,r.id):new cs(E,x,T,N),h.push(`/a_${f}`)}else{const N=Wp(f,T,"composite");this.binders[f]=new Qi(E,x,T,S,a,N),h.push(`/z_${f}`)}else this.binders[f]=P?new Jl(E.value,x):new ch(E.value,x,T),h.push(`/u_${f}`)}this.cacheKey=h.sort().join("")}getMaxValue(r){const a=this.binders[r];return a instanceof cs||a instanceof Qi?a.maxValue:0}populatePaintArrays(r,a,c,h,f,_){for(const x in this.binders){const E=this.binders[x];(E instanceof cs||E instanceof Qi||E instanceof Ql)&&E.populatePaintArray(r,a,c,h,f,_)}}setConstantPatternPositions(r,a){for(const c in this.binders){const h=this.binders[c];h instanceof Jl&&h.setConstantPatternPositions(r,a)}}updatePaintArrays(r,a,c,h,f,_){let x=!1;for(const E in r){const T=a.getPositions(E);for(const S of T){const I=c.feature(S.index);for(const P in this.binders){const z=this.binders[P];if((z instanceof cs||z instanceof Qi||z instanceof Ql)&&!0===z.expression.isStateDependent){const N=h.paint.get(P);z.expression=N.value,z.updatePaintArray(S.start,S.end,I,r[E],f,_),x=!0}}}}return x}defines(){const r=[];for(const a in this.binders){const c=this.binders[a];(c instanceof ch||c instanceof Jl)&&r.push(...c.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return r}getBinderAttributes(){const r=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof cs||c instanceof Qi||c instanceof Ql)for(let h=0;h<c.paintVertexAttributes.length;h++)r.push(c.paintVertexAttributes[h].name)}return r}getBinderUniforms(){const r=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof ch||c instanceof Jl||c instanceof Qi)for(const h of c.uniformNames)r.push(h)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,a){const c=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof ch||f instanceof Jl||f instanceof Qi)for(const _ of f.uniformNames)if(a[_]){const x=f.getBinding(r,a[_],_);c.push({name:_,property:h,binding:x})}}return c}setUniforms(r,a,c,h){for(const{name:f,property:_,binding:x}of a)this.binders[_].setUniform(x,h,c.get(_),f)}updatePaintBuffers(r){this._buffers=[];for(const a in this.binders){const c=this.binders[a];if(r&&c instanceof Ql){const h=2===r.fromScale?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(c instanceof cs||c instanceof Qi)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(r){for(const a in this.binders){const c=this.binders[a];(c instanceof cs||c instanceof Qi||c instanceof Ql)&&c.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const a=this.binders[r];(a instanceof cs||a instanceof Qi||a instanceof Ql)&&a.destroy()}}}class Sa{constructor(r,a,c=(()=>!0)){this.programConfigurations={};for(const h of r)this.programConfigurations[h.id]=new _o(h,a,c);this.needsUpload=!1,this._featureMap=new Hp,this._bufferOffset=0}populatePaintArrays(r,a,c,h,f,_,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(r,a,h,f,_,x);void 0!==a.id&&this._featureMap.add(a.id,c,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,a,c,h,f){for(const _ of c)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(r,this._featureMap,a,_,h,f)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const _d={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function py(i,r){return _d[i]||[i.replace(`${r}-`,"").replace(/-/g,"_")]}const fy={"line-pattern":{source:Ta,composite:Ta},"fill-pattern":{source:Ta,composite:Ta},"fill-extrusion-pattern":{source:Ta,composite:Ta},"line-dasharray":{source:ih,composite:ih}},my={color:{source:Gp,composite:Vm},number:{source:Da,composite:Gp}};function Wp(i,r,a){const c=fy[i];return c&&c[a]||my[r][a]}Ye("ConstantBinder",ch),Ye("CrossFadedConstantBinder",Jl),Ye("SourceExpressionBinder",cs),Ye("CrossFadedCompositeBinder",Ql),Ye("CompositeExpressionBinder",Qi),Ye("ProgramConfiguration",_o,{omit:["_buffers"]}),Ye("ProgramConfigurationSet",Sa);const yd="-transition";class Ui extends Ss{constructor(r,a){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==r.type&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,"background"!==r.type&&"sky"!==r.type&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),a.layout&&(this._unevaluatedLayout=new ol(a.layout)),a.paint)){this._transitionablePaint=new oi(a.paint);for(const c in r.paint)this.setPaintProperty(c,r.paint[c],{validate:!1});for(const c in r.layout)this.setLayoutProperty(c,r.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ea(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return"visibility"===r?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,a,c={}){null!=a&&this._validate(rh,`layers.${this.id}.layout.${r}`,r,a,c)||("visibility"!==r?this._unevaluatedLayout.setValue(r,a):this.visibility=a)}getPaintProperty(r){return zl(r,yd)?this._transitionablePaint.getTransition(r.slice(0,-yd.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,a,c={}){if(null!=a&&this._validate(Ki,`layers.${this.id}.paint.${r}`,r,a,c))return!1;if(zl(r,yd))return this._transitionablePaint.setTransition(r.slice(0,-yd.length),a||void 0),!1;{const h=this._transitionablePaint._values[r],f="cross-faded-data-driven"===h.property.specification["property-type"],_=h.value.isDataDriven(),x=h.value;this._transitionablePaint.setValue(r,a),this._handleSpecialPaintPropertyUpdate(r);const E=this._transitionablePaint._values[r].value;return E.isDataDriven()||_||f||this._handleOverridablePaintPropertyUpdate(r,x,E)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,a,c){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||"none"===this.visibility}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,a){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,a)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Qs(r,(a,c)=>!(void 0===a||"layout"===c&&!Object.keys(a).length||"paint"===c&&!Object.keys(a).length))}_validate(r,a,c,h,f={}){return(!f||!1!==f.validate)&&Xc(this,r.call(Hn,{key:a,layerType:this.type,objectKey:c,value:h,styleSpec:Ee,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const a=this.paint.get(r);if(a instanceof si&&Wl(a.property.specification)&&("source"===a.value.kind||"composite"===a.value.kind)&&a.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ku(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Zm=jn([{name:"a_pos",components:2,type:"Int16"}],4),{members:gy}=Zm;class et{constructor(r=[]){this.segments=r}prepareSegment(r,a,c,h){let f=this.segments[this.segments.length-1];return r>et.MAX_VERTEX_ARRAY_LENGTH&&zn(`Max vertices per segment is ${et.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!f||f.vertexLength+r>et.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==h)&&(f={vertexOffset:a.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},void 0!==h&&(f.sortKey=h),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const r of this.segments)for(const a in r.vaos)r.vaos[a].destroy()}static simpleSegment(r,a,c,h){return new et([{vertexOffset:r,primitiveOffset:a,vertexLength:c,primitiveLength:h,vaos:{},sortKey:0}])}}et.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ye("SegmentVector",et);var zt=8192;class ru{constructor(r,a){r&&(a?this.setSouthWest(r).setNorthEast(a):4===r.length?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof an?new an(r.lng,r.lat):an.convert(r),this}setSouthWest(r){return this._sw=r instanceof an?new an(r.lng,r.lat):an.convert(r),this}extend(r){const a=this._sw,c=this._ne;let h,f;if(r instanceof an)h=r,f=r;else{if(!(r instanceof ru))return Array.isArray(r)?4===r.length||r.every(Array.isArray)?this.extend(ru.convert(r)):this.extend(an.convert(r)):this;if(h=r._sw,f=r._ne,!h||!f)return this}return a||c?(a.lng=Math.min(h.lng,a.lng),a.lat=Math.min(h.lat,a.lat),c.lng=Math.max(f.lng,c.lng),c.lat=Math.max(f.lat,c.lat)):(this._sw=new an(h.lng,h.lat),this._ne=new an(f.lng,f.lat)),this}getCenter(){return new an((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new an(this.getWest(),this.getNorth())}getSouthEast(){return new an(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:a,lat:c}=an.convert(r);let h=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&h}static convert(r){return!r||r instanceof ru?r:new ru(r)}}const vd=6371008.8;class an{constructor(r,a){if(isNaN(r)||isNaN(a))throw new Error(`Invalid LngLat object: (${r}, ${a})`);if(this.lng=+r,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new an(Cs(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const a=Math.PI/180,c=this.lat*a,h=r.lat*a,f=Math.sin(c)*Math.sin(h)+Math.cos(c)*Math.cos(h)*Math.cos((r.lng-this.lng)*a);return vd*Math.acos(Math.min(f,1))}toBounds(r=0){const a=360*r/40075017,c=a/Math.cos(Math.PI/180*this.lat);return new ru(new an(this.lng-c,this.lat-a),new an(this.lng+c,this.lat+a))}static convert(r){if(r instanceof an)return r;if(Array.isArray(r)&&(2===r.length||3===r.length))return new an(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&"object"==typeof r&&null!==r)return new an(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Wm=2*Math.PI*vd;function Xm(i){return Wm*Math.cos(i*Math.PI/180)}function iu(i){return(180+i)/360}function Ns(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Pr(i,r){return i/Xm(r)}function Us(i){return 360*i-180}function ai(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Km(i,r){return i*Xm(ai(r))}const us=85.051129;class ou{constructor(r,a,c=0){this.x=+r,this.y=+a,this.z=+c}static fromLngLat(r,a=0){const c=an.convert(r);return new ou(iu(c.lng),Ns(c.lat),Pr(a,c.lat))}toLngLat(){return new an(Us(this.x),ai(this.y))}toAltitude(){return Km(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Wm*(r=ai(this.y),1/Math.cos(r*Math.PI/180));var r}}function su(i,r,a,c,h,f,_,x,E){const T=(r+c)/2,S=(a+h)/2,I=new Je(T,S);x(I),function(P,z,N,$,q,J){const oe=N-q,ce=$-J;return Math.abs(($-z)*oe-(N-P)*ce)/Math.hypot(oe,ce)}(I.x,I.y,f.x,f.y,_.x,_.y)>=E?(su(i,r,a,T,S,f,I,x,E),su(i,T,S,c,h,I,_,x,E)):i.push(_)}function Ym(i,r,a){const c=[];let h,f,_;for(const x of i){const{x:E,y:T}=x;r(x),_?su(c,h,f,E,T,_,x,r,a):c.push(x),h=E,f=T,_=x}return c}const Xp=Math.pow(2,14)-1,Jm=-Xp-1;function au(i,r){const a=Math.round(i.x*r),c=Math.round(i.y*r);return i.x=_n(a,Jm,Xp),i.y=_n(c,Jm,Xp),(a<i.x||a>i.x+1||c<i.y||c>i.y+1)&&zn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function yo(i,r,a){const c=i.loadGeometry(),h=i.extent,f=zt/h;if(r&&a&&a.projection.isReprojectedInTileSpace){const _=1<<r.z,{scale:x,x:E,y:T,projection:S}=a,I=P=>{const z=Us((r.x+P.x/h)/_),N=ai((r.y+P.y/h)/_),$=S.project(z,N);P.x=($.x*x-E)*h,P.y=($.y*x-T)*h};for(let P=0;P<c.length;P++)if(1!==i.type)c[P]=Ym(c[P],I,1);else{const z=[];for(const N of c[P])N.x<0||N.x>=h||N.y<0||N.y>=h||(I(N),z.push(N));c[P]=z}}for(const _ of c)for(const x of _)au(x,f);return c}function ec(i,r){return{type:i.type,id:i.id,properties:i.properties,geometry:r?yo(i):[]}}function Kp(i,r,a,c,h){i.emplaceBack(2*r+(c+1)/2,2*a+(h+1)/2)}class xd{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new Jc,this.indexArray=new Hr,this.segments=new et,this.programConfigurations=new Sa(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,c,h){const f=this.layers[0],_=[];let x=null;"circle"===f.type&&(x=f.layout.get("circle-sort-key"));for(const{feature:E,id:T,index:S,sourceLayerIndex:I}of r){const P=this.layers[0]._featureFilter.needGeometry,z=ec(E,P);if(!this.layers[0]._featureFilter.filter(new gt(this.zoom),z,c))continue;const N=x?x.evaluate(z,{},c):void 0,$={id:T,properties:E.properties,type:E.type,sourceLayerIndex:I,index:S,geometry:P?z.geometry:yo(E,c,h),patterns:{},sortKey:N};_.push($)}x&&_.sort((E,T)=>E.sortKey-T.sortKey);for(const E of _){const{geometry:T,index:S,sourceLayerIndex:I}=E,P=r[S].feature;this.addFeature(E,T,S,a.availableImages,c),a.featureIndex.insert(P,T,S,I,this.index)}}update(r,a,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,gy),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,a,c,h,f){for(const _ of a)for(const x of _){const E=x.x,T=x.y;if(E<0||E>=zt||T<0||T>=zt)continue;const S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),I=S.vertexLength;Kp(this.layoutVertexArray,E,T,-1,-1),Kp(this.layoutVertexArray,E,T,1,-1),Kp(this.layoutVertexArray,E,T,1,1),Kp(this.layoutVertexArray,E,T,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,{},h,f)}}function Qm(i,r){for(let a=0;a<i.length;a++)if(lu(r,i[a]))return!0;for(let a=0;a<r.length;a++)if(lu(i,r[a]))return!0;return!!Yp(i,r)}function dx(i,r,a){return!!lu(i,r)||!!uh(r,i,a)}function eg(i,r){if(1===i.length)return tg(r,i[0]);for(let a=0;a<r.length;a++){const c=r[a];for(let h=0;h<c.length;h++)if(lu(i,c[h]))return!0}for(let a=0;a<i.length;a++)if(tg(r,i[a]))return!0;for(let a=0;a<r.length;a++)if(Yp(i,r[a]))return!0;return!1}function _y(i,r,a){if(i.length>1){if(Yp(i,r))return!0;for(let c=0;c<r.length;c++)if(uh(r[c],i,a))return!0}for(let c=0;c<i.length;c++)if(uh(i[c],r,a))return!0;return!1}function Yp(i,r){if(0===i.length||0===r.length)return!1;for(let a=0;a<i.length-1;a++){const c=i[a],h=i[a+1];for(let f=0;f<r.length-1;f++)if(bd(c,h,r[f],r[f+1]))return!0}return!1}function bd(i,r,a,c){return Ri(i,a,c)!==Ri(r,a,c)&&Ri(i,r,a)!==Ri(i,r,c)}function uh(i,r,a){const c=a*a;if(1===r.length)return i.distSqr(r[0])<c;for(let h=1;h<r.length;h++)if(tc(i,r[h-1],r[h])<c)return!0;return!1}function tc(i,r,a){const c=r.distSqr(a);if(0===c)return i.distSqr(r);const h=((i.x-r.x)*(a.x-r.x)+(i.y-r.y)*(a.y-r.y))/c;return i.distSqr(h<0?r:h>1?a:a.sub(r)._mult(h)._add(r))}function tg(i,r){let a,c,h,f=!1;for(let _=0;_<i.length;_++){a=i[_];for(let x=0,E=a.length-1;x<a.length;E=x++)c=a[x],h=a[E],c.y>r.y!=h.y>r.y&&r.x<(h.x-c.x)*(r.y-c.y)/(h.y-c.y)+c.x&&(f=!f)}return f}function lu(i,r){let a=!1;for(let c=0,h=i.length-1;c<i.length;h=c++){const f=i[c],_=i[h];f.y>r.y!=_.y>r.y&&r.x<(_.x-f.x)*(r.y-f.y)/(_.y-f.y)+f.x&&(a=!a)}return a}function yy(i,r,a,c,h){for(const _ of i)if(r<=_.x&&a<=_.y&&c>=_.x&&h>=_.y)return!0;const f=[new Je(r,a),new Je(r,h),new Je(c,h),new Je(c,a)];if(i.length>2)for(const _ of f)if(lu(i,_))return!0;for(let _=0;_<i.length-1;_++)if(wd(i[_],i[_+1],f))return!0;return!1}function wd(i,r,a){const c=a[0],h=a[2];if(i.x<c.x&&r.x<c.x||i.x>h.x&&r.x>h.x||i.y<c.y&&r.y<c.y||i.y>h.y&&r.y>h.y)return!1;const f=Ri(i,r,a[0]);return f!==Ri(i,r,a[1])||f!==Ri(i,r,a[2])||f!==Ri(i,r,a[3])}function hl(i,r,a){const c=r.paint.get(i).value;return"constant"===c.kind?c.value:a.programConfigurations.get(r.id).getMaxValue(i)}function hh(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Jp(i,r,a,c,h){if(!r[0]&&!r[1])return i;const f=Je.convert(r)._mult(h);"viewport"===a&&f._rotate(-c);const _=[];for(let x=0;x<i.length;x++)_.push(i[x].sub(f));return _}function Qp(i,r,a,c){const h=Je.convert(i)._mult(c);return"viewport"===r&&h._rotate(-a),h}Ye("CircleBucket",xd,{omit:["layers"]});const nc=new pr({"circle-sort-key":new ht(Ee.layout_circle["circle-sort-key"])});var vy={paint:new pr({"circle-radius":new ht(Ee.paint_circle["circle-radius"]),"circle-color":new ht(Ee.paint_circle["circle-color"]),"circle-blur":new ht(Ee.paint_circle["circle-blur"]),"circle-opacity":new ht(Ee.paint_circle["circle-opacity"]),"circle-translate":new it(Ee.paint_circle["circle-translate"]),"circle-translate-anchor":new it(Ee.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new it(Ee.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new it(Ee.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ht(Ee.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ht(Ee.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ht(Ee.paint_circle["circle-stroke-opacity"])}),layout:nc};class ef{constructor(r,a){this.points=r,this.planes=a}static fromInvProjectionMatrix(r,a,c,h){const f=Math.pow(2,c),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const T=Gt([],E,r),S=1/T[3]/a*f;return(I=T)[0]=(P=T)[0]*(z=[S,S,h?1/T[3]:S,S])[0],I[1]=P[1]*z[1],I[2]=P[2]*z[2],I[3]=P[3]*z[3],I;var I,P,z}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const T=Xs([],Ua([],Es([],_[E[0]],_[E[1]]),Es([],_[E[2]],_[E[1]]))),S=-Do(T,_[E[1]]);return T.concat(S)});return new ef(_,x)}}class hs{constructor(r,a){this.min=r,this.max=a,this.center=lo([],kl([],this.min,this.max),.5)}quadrant(r){const a=[r%2==0,r<2],c=Xo(this.min),h=Xo(this.max);for(let f=0;f<a.length;f++)c[f]=a[f]?this.min[f]:this.center[f],h[f]=a[f]?this.center[f]:this.max[f];return h[2]=this.max[2],new hs(c,h)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,a=this.max;return[[r[0],r[1],r[2]],[a[0],r[1],r[2]],[a[0],a[1],r[2]],[r[0],a[1],r[2]],[r[0],r[1],a[2]],[a[0],r[1],a[2]],[a[0],a[1],a[2]],[r[0],a[1],a[2]]]}intersects(r){const a=this.getCorners();let c=!0;for(let h=0;h<r.planes.length;h++){const f=r.planes[h];let _=0;for(let x=0;x<a.length;x++)_+=Do(f,a[x])+f[3]>=0;if(0===_)return 0;_!==a.length&&(c=!1)}if(c)return 2;for(let h=0;h<3;h++){let f=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let x=0;x<r.points.length;x++){const E=r.points[x][h]-this.min[h];f=Math.min(f,E),_=Math.max(_,E)}if(_<0||f>this.max[h]-this.min[h])return 0}return 1}}function ng(i,r,a,c,h,f,_,x,E){if(f&&i.queryGeometry.isAboveHorizon)return!1;f&&(E*=i.pixelToTileUnitsFactor);for(const T of r)for(const S of T){const I=S.add(x),P=h&&a.elevation?a.elevation.exaggeration()*h.getElevationAt(I.x,I.y,!0):0,z=f?I:xy(I,P,c),N=f?i.tilespaceRays.map(q=>rg(q,P)):i.queryGeometry.screenGeometry,$=Gt([],[S.x,S.y,P,1],c);if(!_&&f?E*=$[3]/a.cameraToCenterDistance:_&&!f&&(E*=a.cameraToCenterDistance/$[3]),dx(N,z,E))return!0}return!1}function xy(i,r,a){const c=Gt([],[i.x,i.y,r,1],a);return new Je(c[0]/c[3],c[1]/c[3])}const eo=ao(0,0,0),js=ao(0,0,1);function rg(i,r){const a=xs();return eo[2]=r,i.intersectsPlane(eo,js,a),new Je(a[0],a[1])}class ig extends xd{}function tf(i,{width:r,height:a},c,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==r*a*c)throw new RangeError("mismatched image size")}else h=new Uint8Array(r*a*c);return i.width=r,i.height=a,i.data=h,i}function og(i,{width:r,height:a},c){if(r===i.width&&a===i.height)return;const h=tf({},{width:r,height:a},c);nf(i,h,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,r),height:Math.min(i.height,a)},c),i.width=r,i.height=a,i.data=h.data}function nf(i,r,a,c,h,f){if(0===h.width||0===h.height)return r;if(h.width>i.width||h.height>i.height||a.x>i.width-h.width||a.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>r.width||h.height>r.height||c.x>r.width-h.width||c.y>r.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=i.data,x=r.data;for(let E=0;E<h.height;E++){const T=((a.y+E)*i.width+a.x)*f,S=((c.y+E)*r.width+c.x)*f;for(let I=0;I<h.width*f;I++)x[S+I]=_[T+I]}return r}Ye("HeatmapBucket",ig,{omit:["layers"]});class dl{constructor(r,a){tf(this,r,1,a)}resize(r){og(this,r,1)}clone(){return new dl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,c,h,f){nf(r,a,c,h,f,1)}}class to{constructor(r,a){tf(this,r,4,a)}resize(r){og(this,r,4)}replace(r,a){a?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new to({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,c,h,f){nf(r,a,c,h,f,4)}}Ye("AlphaImage",dl),Ye("RGBAImage",to);var by={paint:new pr({"heatmap-radius":new ht(Ee.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ht(Ee.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new it(Ee.paint_heatmap["heatmap-intensity"]),"heatmap-color":new mo(Ee.paint_heatmap["heatmap-color"]),"heatmap-opacity":new it(Ee.paint_heatmap["heatmap-opacity"])})};function rf(i){const r={},a=i.resolution||256,c=i.clips?i.clips.length:1,h=i.image||new to({width:a,height:c}),f=(_,x,E)=>{r[i.evaluationKey]=E;const T=i.expression.evaluate(r);h.data[_+x+0]=Math.floor(255*T.r/T.a),h.data[_+x+1]=Math.floor(255*T.g/T.a),h.data[_+x+2]=Math.floor(255*T.b/T.a),h.data[_+x+3]=Math.floor(255*T.a)};if(i.clips)for(let _=0,x=0;_<c;++_,x+=4*a)for(let E=0,T=0;E<a;E++,T+=4){const S=E/(a-1),{start:I,end:P}=i.clips[_];f(x,T,I*(1-S)+P*S)}else for(let _=0,x=0;_<a;_++,x+=4)f(0,x,_/(a-1));return h}var wy={paint:new pr({"hillshade-illumination-direction":new it(Ee.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new it(Ee.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new it(Ee.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new it(Ee.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new it(Ee.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new it(Ee.paint_hillshade["hillshade-accent-color"])})};const Ey=jn([{name:"a_pos",components:2,type:"Int16"}],4),{members:px}=Ey;var Ed=ph,dh=ph;function ph(i,r,a){a=a||2;var c,h,f,_,x,E,T,S=r&&r.length,I=S?r[0]*a:i.length,P=ds(i,0,I,a,!0),z=[];if(!P||P.next===P.prev)return z;if(S&&(P=function($,q,J,oe){var ce,he,fe,pe=[];for(ce=0,he=q.length;ce<he;ce++)(fe=ds($,q[ce]*oe,ce<he-1?q[ce+1]*oe:$.length,oe,!1))===fe.next&&(fe.steiner=!0),pe.push(_x(fe));for(pe.sort(gx),ce=0;ce<pe.length;ce++)J=Bo(J=of(pe[ce],J),J.next);return J}(i,r,P,a)),i.length>80*a){c=f=i[0],h=_=i[1];for(var N=a;N<I;N+=a)(x=i[N])<c&&(c=x),(E=i[N+1])<h&&(h=E),x>f&&(f=x),E>_&&(_=E);T=0!==(T=Math.max(f-c,_-h))?1/T:0}return cu(P,z,a,c,h,T),z}function ds(i,r,a,c,h){var f,_;if(h===lf(i,r,a,c)>0)for(f=r;f<a;f+=c)_=Dd(f,i[f],i[f+1],_);else for(f=a-c;f>=r;f-=c)_=Dd(f,i[f],i[f+1],_);return _&&Cd(_,_.next)&&(_h(_),_=_.next),_}function Bo(i,r){if(!i)return i;r||(r=i);var a,c=i;do{if(a=!1,c.steiner||!Cd(c,c.next)&&0!==sr(c.prev,c,c.next))c=c.next;else{if(_h(c),(c=r=c.prev)===c.next)break;a=!0}}while(a||c!==r);return r}function cu(i,r,a,c,h,f,_){if(i){!_&&f&&function(S,I,P,z){var N=S;do{null===N.z&&(N.z=fh(N.x,N.y,I,P,z)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next}while(N!==S);N.prevZ.nextZ=null,N.prevZ=null,function($){var q,J,oe,ce,he,fe,pe,Te,we=1;do{for(J=$,$=null,he=null,fe=0;J;){for(fe++,oe=J,pe=0,q=0;q<we&&(pe++,oe=oe.nextZ);q++);for(Te=we;pe>0||Te>0&&oe;)0!==pe&&(0===Te||!oe||J.z<=oe.z)?(ce=J,J=J.nextZ,pe--):(ce=oe,oe=oe.nextZ,Te--),he?he.nextZ=ce:$=ce,ce.prevZ=he,he=ce;J=oe}he.nextZ=null,we*=2}while(fe>1)}(N)}(i,c,h,f);for(var x,E,T=i;i.prev!==i.next;)if(x=i.prev,E=i.next,f?ag(i,c,h,f):sg(i))r.push(x.i/a),r.push(i.i/a),r.push(E.i/a),_h(i),i=E.next,T=E.next;else if((i=E)===T){_?1===_?cu(i=fx(Bo(i),r,a),r,a,c,h,f,2):2===_&&mx(i,r,a,c,h,f):cu(Bo(i),r,a,c,h,f,1);break}}}function sg(i){var r=i.prev,a=i,c=i.next;if(sr(r,a,c)>=0)return!1;for(var h=i.next.next;h!==i.prev;){if(mh(r.x,r.y,a.x,a.y,c.x,c.y,h.x,h.y)&&sr(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function ag(i,r,a,c){var h=i.prev,f=i,_=i.next;if(sr(h,f,_)>=0)return!1;for(var x=h.x>f.x?h.x>_.x?h.x:_.x:f.x>_.x?f.x:_.x,E=h.y>f.y?h.y>_.y?h.y:_.y:f.y>_.y?f.y:_.y,T=fh(h.x<f.x?h.x<_.x?h.x:_.x:f.x<_.x?f.x:_.x,h.y<f.y?h.y<_.y?h.y:_.y:f.y<_.y?f.y:_.y,r,a,c),S=fh(x,E,r,a,c),I=i.prevZ,P=i.nextZ;I&&I.z>=T&&P&&P.z<=S;){if(I!==i.prev&&I!==i.next&&mh(h.x,h.y,f.x,f.y,_.x,_.y,I.x,I.y)&&sr(I.prev,I,I.next)>=0||(I=I.prevZ,P!==i.prev&&P!==i.next&&mh(h.x,h.y,f.x,f.y,_.x,_.y,P.x,P.y)&&sr(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;I&&I.z>=T;){if(I!==i.prev&&I!==i.next&&mh(h.x,h.y,f.x,f.y,_.x,_.y,I.x,I.y)&&sr(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;P&&P.z<=S;){if(P!==i.prev&&P!==i.next&&mh(h.x,h.y,f.x,f.y,_.x,_.y,P.x,P.y)&&sr(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function fx(i,r,a){var c=i;do{var h=c.prev,f=c.next.next;!Cd(h,f)&&cg(h,c,c.next,f)&&pl(h,f)&&pl(f,h)&&(r.push(h.i/a),r.push(c.i/a),r.push(f.i/a),_h(c),_h(c.next),c=i=f),c=c.next}while(c!==i);return Bo(c)}function mx(i,r,a,c,h,f){var _=i;do{for(var x=_.next.next;x!==_.prev;){if(_.i!==x.i&&lg(_,x)){var E=af(_,x);return _=Bo(_,_.next),E=Bo(E,E.next),cu(_,r,a,c,h,f),void cu(E,r,a,c,h,f)}x=x.next}_=_.next}while(_!==i)}function gx(i,r){return i.x-r.x}function of(i,r){var a=function(f,_){var x,E=_,T=f.x,S=f.y,I=-1/0;do{if(S<=E.y&&S>=E.next.y&&E.next.y!==E.y){var P=E.x+(S-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(P<=T&&P>I){if(I=P,P===T){if(S===E.y)return E;if(S===E.next.y)return E.next}x=E.x<E.next.x?E:E.next}}E=E.next}while(E!==_);if(!x)return null;if(T===I)return x;var z,N=x,$=x.x,q=x.y,J=1/0;E=x;do{T>=E.x&&E.x>=$&&T!==E.x&&mh(S<q?T:I,S,$,q,S<q?I:T,S,E.x,E.y)&&(z=Math.abs(S-E.y)/(T-E.x),pl(E,f)&&(z<J||z===J&&(E.x>x.x||E.x===x.x&&sf(x,E)))&&(x=E,J=z)),E=E.next}while(E!==N);return x}(i,r);if(!a)return r;var c=af(a,i),h=Bo(a,a.next);return Bo(c,c.next),r===a?h:r}function sf(i,r){return sr(i.prev,i,r.prev)<0&&sr(r.next,i,i.next)<0}function fh(i,r,a,c,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-a)*h)|i<<8))|i<<4))|i<<2))|i<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-c)*h)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function _x(i){var r=i,a=i;do{(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next}while(r!==i);return a}function mh(i,r,a,c,h,f,_,x){return(h-_)*(r-x)-(i-_)*(f-x)>=0&&(i-_)*(c-x)-(a-_)*(r-x)>=0&&(a-_)*(f-x)-(h-_)*(c-x)>=0}function lg(i,r){return i.next.i!==r.i&&i.prev.i!==r.i&&!function(a,c){var h=a;do{if(h.i!==a.i&&h.next.i!==a.i&&h.i!==c.i&&h.next.i!==c.i&&cg(h,h.next,a,c))return!0;h=h.next}while(h!==a);return!1}(i,r)&&(pl(i,r)&&pl(r,i)&&function(a,c){var h=a,f=!1,_=(a.x+c.x)/2,x=(a.y+c.y)/2;do{h.y>x!=h.next.y>x&&h.next.y!==h.y&&_<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(f=!f),h=h.next}while(h!==a);return f}(i,r)&&(sr(i.prev,i,r.prev)||sr(i,r.prev,r))||Cd(i,r)&&sr(i.prev,i,i.next)>0&&sr(r.prev,r,r.next)>0)}function sr(i,r,a){return(r.y-i.y)*(a.x-r.x)-(r.x-i.x)*(a.y-r.y)}function Cd(i,r){return i.x===r.x&&i.y===r.y}function cg(i,r,a,c){var h=gh(sr(i,r,a)),f=gh(sr(i,r,c)),_=gh(sr(a,c,i)),x=gh(sr(a,c,r));return h!==f&&_!==x||!(0!==h||!Td(i,a,r))||!(0!==f||!Td(i,c,r))||!(0!==_||!Td(a,i,c))||!(0!==x||!Td(a,r,c))}function Td(i,r,a){return r.x<=Math.max(i.x,a.x)&&r.x>=Math.min(i.x,a.x)&&r.y<=Math.max(i.y,a.y)&&r.y>=Math.min(i.y,a.y)}function gh(i){return i>0?1:i<0?-1:0}function pl(i,r){return sr(i.prev,i,i.next)<0?sr(i,r,i.next)>=0&&sr(i,i.prev,r)>=0:sr(i,r,i.prev)<0||sr(i,i.next,r)<0}function af(i,r){var a=new Fn(i.i,i.x,i.y),c=new Fn(r.i,r.x,r.y),h=i.next,f=r.prev;return i.next=r,r.prev=i,a.next=h,h.prev=a,c.next=a,a.prev=c,f.next=c,c.prev=f,c}function Dd(i,r,a,c){var h=new Fn(i,r,a);return c?(h.next=c.next,h.prev=c,c.next.prev=h,c.next=h):(h.prev=h,h.next=h),h}function _h(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Fn(i,r,a){this.i=i,this.x=r,this.y=a,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function lf(i,r,a,c){for(var h=0,f=r,_=a-c;f<a;f+=c)h+=(i[_]-i[f])*(i[f+1]+i[_+1]),_=f;return h}function Cy(i,r,a,c,h){yh(i,r,a||0,c||i.length-1,h||Ty)}function yh(i,r,a,c,h){for(;c>a;){if(c-a>600){var f=c-a+1,_=r-a+1,x=Math.log(f),E=.5*Math.exp(2*x/3),T=.5*Math.sqrt(x*E*(f-E)/f)*(_-f/2<0?-1:1);yh(i,r,Math.max(a,Math.floor(r-_*E/f+T)),Math.min(c,Math.floor(r+(f-_)*E/f+T)),h)}var S=i[r],I=a,P=c;for(rc(i,a,r),h(i[c],S)>0&&rc(i,a,c);I<P;){for(rc(i,I,P),I++,P--;h(i[I],S)<0;)I++;for(;h(i[P],S)>0;)P--}0===h(i[a],S)?rc(i,a,P):rc(i,++P,c),P<=r&&(a=P+1),r<=P&&(c=P-1)}}function rc(i,r,a){var c=i[r];i[r]=i[a],i[a]=c}function Ty(i,r){return i<r?-1:i>r?1:0}function cf(i,r){const a=i.length;if(a<=1)return[i];const c=[];let h,f;for(let _=0;_<a;_++){const x=Ha(i[_]);0!==x&&(i[_].area=Math.abs(x),void 0===f&&(f=x<0),f===x<0?(h&&c.push(h),h=[i[_]]):h.push(i[_]))}if(h&&c.push(h),r>1)for(let _=0;_<c.length;_++)c[_].length<=r||(Cy(c[_],r,1,c[_].length-1,Dy),c[_]=c[_].slice(0,r));return c}function Dy(i,r){return r.area-i.area}function uf(i,r,a){const c=a.patternDependencies;let h=!1;for(const f of r){const _=f.paint.get(`${i}-pattern`);_.isConstant()||(h=!0);const x=_.constantOr(null);x&&(h=!0,c[x.to]=!0,c[x.from]=!0)}return h}function hf(i,r,a,c,h){const f=h.patternDependencies;for(const _ of r){const x=_.paint.get(`${i}-pattern`).value;if("constant"!==x.kind){let E=x.evaluate({zoom:c-1},a,{},h.availableImages),T=x.evaluate({zoom:c},a,{},h.availableImages),S=x.evaluate({zoom:c+1},a,{},h.availableImages);E=E&&E.name?E.name:E,T=T&&T.name?T.name:T,S=S&&S.name?S.name:S,f[E]=!0,f[T]=!0,f[S]=!0,a.patterns[_.id]={min:E,mid:T,max:S}}}return a}ph.deviation=function(i,r,a,c){var h=r&&r.length,f=Math.abs(lf(i,0,h?r[0]*a:i.length,a));if(h)for(var _=0,x=r.length;_<x;_++)f-=Math.abs(lf(i,r[_]*a,_<x-1?r[_+1]*a:i.length,a));var E=0;for(_=0;_<c.length;_+=3){var T=c[_]*a,S=c[_+1]*a,I=c[_+2]*a;E+=Math.abs((i[T]-i[I])*(i[S+1]-i[T+1])-(i[T]-i[S])*(i[I+1]-i[T+1]))}return 0===f&&0===E?0:Math.abs((E-f)/f)},ph.flatten=function(i){for(var r=i[0][0].length,a={vertices:[],holes:[],dimensions:r},c=0,h=0;h<i.length;h++){for(var f=0;f<i[h].length;f++)for(var _=0;_<r;_++)a.vertices.push(i[h][f][_]);h>0&&a.holes.push(c+=i[h-1].length)}return a},Ed.default=dh;class df{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Jc,this.indexArray=new Hr,this.indexArray2=new ul,this.programConfigurations=new Sa(r.layers,r.zoom),this.segments=new et,this.segments2=new et,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,c,h){this.hasPattern=uf("fill",this.layers,a);const f=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:x,id:E,index:T,sourceLayerIndex:S}of r){const I=this.layers[0]._featureFilter.needGeometry,P=ec(x,I);if(!this.layers[0]._featureFilter.filter(new gt(this.zoom),P,c))continue;const z=f?f.evaluate(P,{},c,a.availableImages):void 0,N={id:E,properties:x.properties,type:x.type,sourceLayerIndex:S,index:T,geometry:I?P.geometry:yo(x,c,h),patterns:{},sortKey:z};_.push(N)}f&&_.sort((x,E)=>x.sortKey-E.sortKey);for(const x of _){const{geometry:E,index:T,sourceLayerIndex:S}=x;if(this.hasPattern){const I=hf("fill",this.layers,x,this.zoom,a);this.patternFeatures.push(I)}else this.addFeature(x,E,T,c,{},a.availableImages);a.featureIndex.insert(r[T].feature,E,T,S,this.index)}}update(r,a,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,h)}addFeatures(r,a,c,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,a,c,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,px),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,a,c,h,f,_=[]){for(const x of cf(a,500)){let E=0;for(const N of x)E+=N.length;const T=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),S=T.vertexLength,I=[],P=[];for(const N of x){if(0===N.length)continue;N!==x[0]&&P.push(I.length/2);const $=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),q=$.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(q+N.length-1,q),I.push(N[0].x),I.push(N[0].y);for(let J=1;J<N.length;J++)this.layoutVertexArray.emplaceBack(N[J].x,N[J].y),this.indexArray2.emplaceBack(q+J-1,q+J),I.push(N[J].x),I.push(N[J].y);$.vertexLength+=N.length,$.primitiveLength+=N.length}const z=Ed(I,P);for(let N=0;N<z.length;N+=3)this.indexArray.emplaceBack(S+z[N],S+z[N+1],S+z[N+2]);T.vertexLength+=E,T.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,f,_,h)}}Ye("FillBucket",df,{omit:["layers","patternFeatures"]});const yx=new pr({"fill-sort-key":new ht(Ee.layout_fill["fill-sort-key"])});var vh={paint:new pr({"fill-antialias":new it(Ee.paint_fill["fill-antialias"]),"fill-opacity":new ht(Ee.paint_fill["fill-opacity"]),"fill-color":new ht(Ee.paint_fill["fill-color"]),"fill-outline-color":new ht(Ee.paint_fill["fill-outline-color"]),"fill-translate":new it(Ee.paint_fill["fill-translate"]),"fill-translate-anchor":new it(Ee.paint_fill["fill-translate-anchor"]),"fill-pattern":new dr(Ee.paint_fill["fill-pattern"])}),layout:yx};const ji=jn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),pf=jn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:ug}=ji;var ff=wr;function wr(i,r,a,c,h){this.properties={},this.extent=a,this.type=0,this._pbf=i,this._geometry=-1,this._keys=c,this._values=h,i.readFields(xh,this,r)}function xh(i,r,a){1==i?r.id=a.readVarint():2==i?function(c,h){for(var f=c.readVarint()+c.pos;c.pos<f;){var _=h._keys[c.readVarint()],x=h._values[c.readVarint()];h.properties[_]=x}}(a,r):3==i?r.type=a.readVarint():4==i&&(r._geometry=a.pos)}function mf(i){for(var r,a,c=0,h=0,f=i.length,_=f-1;h<f;_=h++)c+=((a=i[_]).x-(r=i[h]).x)*(r.y+a.y);return c}wr.types=["Unknown","Point","LineString","Polygon"],wr.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var r,a=i.readVarint()+i.pos,c=1,h=0,f=0,_=0,x=[];i.pos<a;){if(h<=0){var E=i.readVarint();c=7&E,h=E>>3}if(h--,1===c||2===c)f+=i.readSVarint(),_+=i.readSVarint(),1===c&&(r&&x.push(r),r=[]),r.push(new Je(f,_));else{if(7!==c)throw new Error("unknown command "+c);r&&r.push(r[0].clone())}}return r&&x.push(r),x},wr.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var r=i.readVarint()+i.pos,a=1,c=0,h=0,f=0,_=1/0,x=-1/0,E=1/0,T=-1/0;i.pos<r;){if(c<=0){var S=i.readVarint();a=7&S,c=S>>3}if(c--,1===a||2===a)(h+=i.readSVarint())<_&&(_=h),h>x&&(x=h),(f+=i.readSVarint())<E&&(E=f),f>T&&(T=f);else if(7!==a)throw new Error("unknown command "+a)}return[_,E,x,T]},wr.prototype.toGeoJSON=function(i,r,a){var c,h,f=this.extent*Math.pow(2,a),_=this.extent*i,x=this.extent*r,E=this.loadGeometry(),T=wr.types[this.type];function S(z){for(var N=0;N<z.length;N++){var $=z[N];z[N]=[360*($.x+_)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+x)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(c=0;c<E.length;c++)I[c]=E[c][0];S(E=I);break;case 2:for(c=0;c<E.length;c++)S(E[c]);break;case 3:for(E=function(z){var N=z.length;if(N<=1)return[z];for(var $,q,J=[],oe=0;oe<N;oe++){var ce=mf(z[oe]);0!==ce&&(void 0===q&&(q=ce<0),q===ce<0?($&&J.push($),$=[z[oe]]):$.push(z[oe]))}return $&&J.push($),J}(E),c=0;c<E.length;c++)for(h=0;h<E[c].length;h++)S(E[c][h])}1===E.length?E=E[0]:T="Multi"+T;var P={type:"Feature",geometry:{type:T,coordinates:E},properties:this.properties};return"id"in this&&(P.id=this.id),P};var hg=dg;function dg(i,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(pg,this,r),this.length=this._features.length}function pg(i,r,a){15===i?r.version=a.readVarint():1===i?r.name=a.readString():5===i?r.extent=a.readVarint():2===i?r._features.push(a.pos):3===i?r._keys.push(a.readString()):4===i&&r._values.push(function(c){for(var h=null,f=c.readVarint()+c.pos;c.pos<f;){var _=c.readVarint()>>3;h=1===_?c.readString():2===_?c.readFloat():3===_?c.readDouble():4===_?c.readVarint64():5===_?c.readVarint():6===_?c.readSVarint():7===_?c.readBoolean():null}return h}(a))}function My(i,r,a){if(3===i){var c=new hg(a,a.readVarint()+a.pos);c.length&&(r[c.name]=c)}}dg.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var r=this._pbf.readVarint()+this._pbf.pos;return new ff(this._pbf,r,this.extent,this._keys,this._values)};var fl={VectorTile:function(i,r){this.layers=i.readFields(My,{},r)},VectorTileFeature:ff,VectorTileLayer:hg};const Sy=fl.VectorTileFeature.types,fg=Math.pow(2,13);function bh(i,r,a,c,h,f,_,x){i.emplaceBack((r<<1)+_,(a<<1)+f,(Math.floor(c*fg)<<1)+h,Math.round(x))}class mg{constructor(){this.acc=new Je(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Je(r.x,r.y),this.max=new Je(r.x,r.y))}append(r,a){this.currentPolyCount.edges++,this.acc._add(r);let c=!!this.borders;const h=this.min,f=this.max;r.x<h.x?(h.x=r.x,c=!0):r.x>f.x&&(f.x=r.x,c=!0),r.y<h.y?(h.y=r.y,c=!0):r.y>f.y&&(f.y=r.y,c=!0),((0===r.x||r.x===zt)&&r.x===a.x)!=((0===r.y||r.y===zt)&&r.y===a.y)&&this.processBorderOverlap(r,a),c&&this.checkBorderIntersection(r,a)}checkBorderIntersection(r,a){a.x<0!=r.x<0&&this.addBorderIntersection(0,Ut(a.y,r.y,(0-a.x)/(r.x-a.x))),a.x>zt!=r.x>zt&&this.addBorderIntersection(1,Ut(a.y,r.y,(zt-a.x)/(r.x-a.x))),a.y<0!=r.y<0&&this.addBorderIntersection(2,Ut(a.x,r.x,(0-a.y)/(r.y-a.y))),a.y>zt!=r.y>zt&&this.addBorderIntersection(3,Ut(a.x,r.x,(zt-a.y)/(r.y-a.y)))}addBorderIntersection(r,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[r];a<c[0]&&(c[0]=a),a>c[1]&&(c[1]=a)}processBorderOverlap(r,a){if(r.x===a.x){if(r.y===a.y)return;const c=0===r.x?0:1;this.addBorderIntersection(c,a.y),this.addBorderIntersection(c,r.y)}else{const c=0===r.y?2:3;this.addBorderIntersection(c,a.x),this.addBorderIntersection(c,r.x)}}centroid(){const r=this.polyCount.reduce((a,c)=>a+c.edges,0);return 0!==r?this.acc.div(r)._round():new Je(0,0)}span(){return new Je(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,a)=>r+ +(a[0]!==Number.MAX_VALUE),0)}}class wh{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new Ca,this.centroidVertexArray=new as,this.indexArray=new Hr,this.programConfigurations=new Sa(r.layers,r.zoom),this.segments=new et,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.enableTerrain=r.enableTerrain}populate(r,a,c,h){this.features=[],this.hasPattern=uf("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(f){const _=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*_/(_*_+1)/zt/(1<<f.z)}(c);for(const{feature:f,id:_,index:x,sourceLayerIndex:E}of r){const T=this.layers[0]._featureFilter.needGeometry,S=ec(f,T);if(!this.layers[0]._featureFilter.filter(new gt(this.zoom),S,c))continue;const I={id:_,sourceLayerIndex:E,index:x,geometry:T?S.geometry:yo(f,c,h),properties:f.properties,type:f.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(hf("fill-extrusion",this.layers,I,this.zoom,a)):this.addFeature(I,I.geometry,x,c,{},a.availableImages),a.featureIndex.insert(f,I.geometry,x,E,this.index,P)}this.sortBorders()}addFeatures(r,a,c,h){for(const f of this.features){const{geometry:_}=f;this.addFeature(f,_,f.index,a,c,h)}this.sortBorders()}update(r,a,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,ug),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,pf.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,a,c,h,f,_){const x=this.enableTerrain?new mg:null;for(const T of cf(a,500)){let S=0,I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===T.length||(E=T[0]).every(q=>q.x<=0)||E.every(q=>q.x>=zt)||E.every(q=>q.y<=0)||E.every(q=>q.y>=zt))continue;for(let q=0;q<T.length;q++){const J=T[q];if(0===J.length)continue;S+=J.length;let oe=0;x&&x.startRing(J[0]);for(let ce=0;ce<J.length;ce++){const he=J[ce];if(ce>=1){const fe=J[ce-1];if(!Iy(he,fe)){x&&x.append(he,fe),I.vertexLength+4>et.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const pe=he.sub(fe)._perp(),Te=pe.x/(Math.abs(pe.x)+Math.abs(pe.y)),we=pe.y>0?1:0,Ze=fe.dist(he);oe+Ze>32768&&(oe=0),bh(this.layoutVertexArray,he.x,he.y,Te,we,0,0,oe),bh(this.layoutVertexArray,he.x,he.y,Te,we,0,1,oe),oe+=Ze,bh(this.layoutVertexArray,fe.x,fe.y,Te,we,0,0,oe),bh(this.layoutVertexArray,fe.x,fe.y,Te,we,0,1,oe);const Ue=I.vertexLength;this.indexArray.emplaceBack(Ue,Ue+2,Ue+1),this.indexArray.emplaceBack(Ue+1,Ue+2,Ue+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+S>et.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),"Polygon"!==Sy[r.type])continue;const P=[],z=[],N=I.vertexLength;for(let q=0;q<T.length;q++){const J=T[q];if(0!==J.length){J!==T[0]&&z.push(P.length/2);for(let oe=0;oe<J.length;oe++){const ce=J[oe];bh(this.layoutVertexArray,ce.x,ce.y,0,0,1,1,0),P.push(ce.x),P.push(ce.y),x&&x.currentPolyCount.top++}}}const $=Ed(P,z);for(let q=0;q<$.length;q+=3)this.indexArray.emplaceBack(N+$[q],N+$[q+2],N+$[q+1]);I.primitiveLength+=$.length/3,I.vertexLength+=S}var E;if(x&&x.polyCount.length>0){if(x.borders){x.vertexArrayOffset=this.centroidVertexArray.length;const T=x.borders,S=this.featuresOnBorder.push(x)-1;for(let I=0;I<4;I++)T[I][0]!==Number.MAX_VALUE&&this.borders[I].push(S)}this.encodeCentroid(x.borders?void 0:x.centroid(),x)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,f,_,h)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((a,c)=>this.featuresOnBorder[a].borders[r][0]-this.featuresOnBorder[c].borders[r][0])}encodeCentroid(r,a,c=!0){let h,f;if(r)if(0!==r.y){const x=a.span()._mult(this.tileToMeter);h=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(x.x/10)),f=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else h=Math.ceil(7*(r.x+450)),f=0;else h=0,f=+c;let _=c?this.centroidVertexArray.length:a.vertexArrayOffset;for(const x of a.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let E=0;E<2*x.edges;E++)this.centroidVertexArray.emplace(_++,0,f),this.centroidVertexArray.emplace(_++,h,f);for(let E=0;E<x.top;E++)this.centroidVertexArray.emplace(_++,h,f)}}}function Iy(i,r){return i.x===r.x&&(i.x<0||i.x>zt)||i.y===r.y&&(i.y<0||i.y>zt)}Ye("FillExtrusionBucket",wh,{omit:["layers","features"]}),Ye("PartMetadata",mg);var Ay={paint:new pr({"fill-extrusion-opacity":new it(Ee["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ht(Ee["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new it(Ee["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new it(Ee["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new dr(Ee["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ht(Ee["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ht(Ee["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new it(Ee["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function ic(i,r){return i.x*r.x+i.y*r.y}function gg(i,r){if(1===i.length){let a=0;const c=r[a++];let h;for(;!h||c.equals(h);)if(h=r[a++],!h)return 1/0;for(;a<r.length;a++){const f=r[a],_=i[0],x=h.sub(c),E=f.sub(c),T=_.sub(c),S=ic(x,x),I=ic(x,E),P=ic(E,E),z=ic(T,x),N=ic(T,E),$=S*P-I*I,q=(P*z-I*N)/$,J=(S*N-I*z)/$,oe=c.z*(1-q-J)+h.z*q+f.z*J;if(isFinite(oe))return oe}return 1/0}{let a=1/0;for(const c of r)a=Math.min(a,c.z);return a}}function _g(i){const r=new Je(i[0],i[1]);return r.z=i[2],r}function uu(i,r,a,c,h,f,_,x){const E=_*h.getElevationAt(i,r,!0,!0),T=0!==f[0],S=T?0===f[1]?_*(f[0]/7-450):_*function(I,P,z){const N=Math.floor(P[0]/8),$=Math.floor(P[1]/8),q=10*(P[0]-8*N),J=10*(P[1]-8*$),oe=I.getElevationAt(N,$,!0,!0),ce=I.getMeterToDEM(z),he=Math.floor(.5*(q*ce-1)),fe=Math.floor(.5*(J*ce-1)),pe=I.tileCoordToPixel(N,$),Te=2*he+1,we=2*fe+1,Ze=(Cn=Te,qt=we,[(We=I).getElevationAtPixel(tt=pe.x-he,Vt=pe.y-fe,!0),We.getElevationAtPixel(tt+qt,Vt,!0),We.getElevationAtPixel(tt,Vt+qt,!0),We.getElevationAtPixel(tt+Cn,Vt+qt,!0)]),Ue=Math.abs(Ze[0]-Ze[1]),De=Math.abs(Ze[2]-Ze[3]),Ge=Math.abs(Ze[0]-Ze[2])+Math.abs(Ze[1]-Ze[3]),Ke=Math.min(.25,.5*ce*(Ue+De)/Te),Re=Math.min(.25,.5*ce*Ge/we);var We,tt,Vt,Cn,qt;return oe+Math.max(Ke*q,Re*J)}(h,f,x):E;return{base:E+(0===a)?-1:a,top:T?Math.max(S+c,E+a+2):E+c}}const Py=jn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:ky}=Py,Ry=jn([{name:"a_packed",components:3,type:"Float32"}]),{members:Ly}=Ry,Oy=fl.VectorTileFeature.types,yg=Math.cos(Math.PI/180*37.5);class Md{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Yl,this.layoutVertexArray2=new Qc,this.indexArray=new Hr,this.programConfigurations=new Sa(r.layers,r.zoom),this.segments=new et,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,c,h){this.hasPattern=uf("line",this.layers,a);const f=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:S,id:I,index:P,sourceLayerIndex:z}of r){const N=this.layers[0]._featureFilter.needGeometry,$=ec(S,N);if(!this.layers[0]._featureFilter.filter(new gt(this.zoom),$,c))continue;const q=f?f.evaluate($,{},c):void 0,J={id:I,properties:S.properties,type:S.type,sourceLayerIndex:z,index:P,geometry:N?$.geometry:yo(S,c,h),patterns:{},sortKey:q};_.push(J)}f&&_.sort((S,I)=>S.sortKey-I.sortKey);const{lineAtlas:x,featureIndex:E}=a,T=this.addConstantDashes(x);for(const S of _){const{geometry:I,index:P,sourceLayerIndex:z}=S;if(T&&this.addFeatureDashes(S,x),this.hasPattern){const N=hf("line",this.layers,S,this.zoom,a);this.patternFeatures.push(N)}else this.addFeature(S,I,P,c,x.positions,a.availableImages);E.insert(r[P].feature,I,P,z,this.index)}}addConstantDashes(r){let a=!1;for(const c of this.layers){const h=c.paint.get("line-dasharray").value,f=c.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==f.kind)a=!0;else{const _=f.value,x=h.value;if(!x)continue;r.addDash(x.from,_),r.addDash(x.to,_),x.other&&r.addDash(x.other,_)}}return a}addFeatureDashes(r,a){const c=this.zoom;for(const h of this.layers){const f=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===_.kind)continue;let x,E,T,S,I,P;if("constant"===f.kind){const q=f.value;if(!q)continue;x=q.other||q.to,E=q.to,T=q.from}else x=f.evaluate({zoom:c-1},r),E=f.evaluate({zoom:c},r),T=f.evaluate({zoom:c+1},r);"constant"===_.kind?S=I=P=_.value:(S=_.evaluate({zoom:c-1},r),I=_.evaluate({zoom:c},r),P=_.evaluate({zoom:c+1},r)),a.addDash(x,S),a.addDash(E,I),a.addDash(T,P);const z=a.getKey(x,S),N=a.getKey(E,I),$=a.getKey(T,P);r.patterns[h.id]={min:z,mid:N,max:$}}}update(r,a,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,h)}addFeatures(r,a,c,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,a,c,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,Ly)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,ky),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,a,c,h,f,_){const x=this.layers[0].layout,E=x.get("line-join").evaluate(r,{}),T=x.get("line-cap").evaluate(r,{}),S=x.get("line-miter-limit"),I=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const P of a)this.addLine(P,r,E,T,S,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,f,_,h)}addLine(r,a,c,h,f,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<r.length-1;J++)this.totalDistance+=r[J].dist(r[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===Oy[a.type];let E=r.length;for(;E>=2&&r[E-1].equals(r[E-2]);)E--;let T=0;for(;T<E-1&&r[T].equals(r[T+1]);)T++;if(E<(x?3:2))return;"bevel"===c&&(f=1.05);const S=this.overscaling<=16?122880/(512*this.overscaling):0,I=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let P,z,N,$,q;this.e1=this.e2=-1,x&&(P=r[E-2],q=r[T].sub(P)._unit()._perp());for(let J=T;J<E;J++){if(N=J===E-1?x?r[T+1]:void 0:r[J+1],N&&r[J].equals(N))continue;q&&($=q),P&&(z=P),P=r[J],q=N?N.sub(P)._unit()._perp():$,$=$||q;let oe=$.add(q);0===oe.x&&0===oe.y||oe._unit();const ce=$.x*q.x+$.y*q.y,he=oe.x*q.x+oe.y*q.y,fe=0!==he?1/he:1/0,pe=2*Math.sqrt(2-2*he),Te=he<yg&&z&&N,we=$.x*q.y-$.y*q.x>0;if(Te&&J>T){const De=P.dist(z);if(De>2*S){const Ge=P.sub(P.sub(z)._mult(S/De)._round());this.updateDistance(z,Ge),this.addCurrentVertex(Ge,$,0,0,I),z=Ge}}const Ze=z&&N;let Ue=Ze?c:x?"butt":h;if(Ze&&"round"===Ue&&(fe<_?Ue="miter":fe<=2&&(Ue="fakeround")),"miter"===Ue&&fe>f&&(Ue="bevel"),"bevel"===Ue&&(fe>2&&(Ue="flipbevel"),fe<f&&(Ue="miter")),z&&this.updateDistance(z,P),"miter"===Ue)oe._mult(fe),this.addCurrentVertex(P,oe,0,0,I);else if("flipbevel"===Ue){if(fe>100)oe=q.mult(-1);else{const De=fe*$.add(q).mag()/$.sub(q).mag();oe._perp()._mult(De*(we?-1:1))}this.addCurrentVertex(P,oe,0,0,I),this.addCurrentVertex(P,oe.mult(-1),0,0,I)}else if("bevel"===Ue||"fakeround"===Ue){const De=-Math.sqrt(fe*fe-1),Ge=we?De:0,Ke=we?0:De;if(z&&this.addCurrentVertex(P,$,Ge,Ke,I),"fakeround"===Ue){const Re=Math.round(180*pe/Math.PI/20);for(let We=1;We<Re;We++){let tt=We/Re;if(.5!==tt){const Cn=tt-.5;tt+=tt*Cn*(tt-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*Cn*Cn+(.848013+ce*(.215638*ce-1.06021)))}const Vt=q.sub($)._mult(tt)._add($)._unit()._mult(we?-1:1);this.addHalfVertex(P,Vt.x,Vt.y,!1,we,0,I)}}N&&this.addCurrentVertex(P,q,-Ge,-Ke,I)}else if("butt"===Ue)this.addCurrentVertex(P,oe,0,0,I);else if("square"===Ue){const De=z?1:-1;z||this.addCurrentVertex(P,oe,De,De,I),this.addCurrentVertex(P,oe,0,0,I),z&&this.addCurrentVertex(P,oe,De,De,I)}else"round"===Ue&&(z&&(this.addCurrentVertex(P,$,0,0,I),this.addCurrentVertex(P,$,1,1,I,!0)),N&&(this.addCurrentVertex(P,q,-1,-1,I,!0),this.addCurrentVertex(P,q,0,0,I)));if(Te&&J<E-1){const De=P.dist(N);if(De>2*S){const Ge=P.add(N.sub(P)._mult(S/De)._round());this.updateDistance(P,Ge),this.addCurrentVertex(Ge,q,0,0,I),P=Ge}}}}addCurrentVertex(r,a,c,h,f,_=!1){const x=a.y*h-a.x,E=-a.y-a.x*h;this.addHalfVertex(r,a.x+a.y*c,a.y-a.x*c,_,!1,c,f),this.addHalfVertex(r,x,E,_,!0,-h,f)}addHalfVertex({x:r,y:a},c,h,f,_,x,E){this.layoutVertexArray.emplaceBack((r<<1)+(f?1:0),(a<<1)+(_?1:0),Math.round(63*c)+128,Math.round(63*h)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const T=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),E.primitiveLength++),_?this.e2=T:this.e1=T}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,a){this.distance+=r.dist(a),this.updateScaledDistance()}}Ye("LineBucket",Md,{omit:["layers","patternFeatures"]});const Fy=new pr({"line-cap":new ht(Ee.layout_line["line-cap"]),"line-join":new ht(Ee.layout_line["line-join"]),"line-miter-limit":new it(Ee.layout_line["line-miter-limit"]),"line-round-limit":new it(Ee.layout_line["line-round-limit"]),"line-sort-key":new ht(Ee.layout_line["line-sort-key"])});var vg={paint:new pr({"line-opacity":new ht(Ee.paint_line["line-opacity"]),"line-color":new ht(Ee.paint_line["line-color"]),"line-translate":new it(Ee.paint_line["line-translate"]),"line-translate-anchor":new it(Ee.paint_line["line-translate-anchor"]),"line-width":new ht(Ee.paint_line["line-width"]),"line-gap-width":new ht(Ee.paint_line["line-gap-width"]),"line-offset":new ht(Ee.paint_line["line-offset"]),"line-blur":new ht(Ee.paint_line["line-blur"]),"line-dasharray":new dr(Ee.paint_line["line-dasharray"]),"line-pattern":new dr(Ee.paint_line["line-pattern"]),"line-gradient":new mo(Ee.paint_line["line-gradient"])}),layout:Fy};const xg=new class extends ht{possiblyEvaluate(i,r){return r=new gt(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(i,r)}evaluate(i,r,a,c){return r=Xn({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(i,r,a,c)}}(vg.paint.properties["line-width"].specification);function gf(i,r){return r>0?r+2*i:i}xg.useIntegerZoom=!0;const zy=jn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),By=jn([{name:"a_projected_pos",components:3,type:"Float32"}],4);jn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ny=jn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),hu=jn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);jn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ps=jn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),vx=jn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);jn([{name:"triangle",components:3,type:"Uint16"}]),jn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),jn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),jn([{type:"Float32",name:"offsetX"}]),jn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const fs=128;function bg(i,r){const{expression:a}=r;if("constant"===a.kind)return{kind:"constant",layoutSize:a.evaluate(new gt(i+1))};if("source"===a.kind)return{kind:"source"};{const{zoomStops:c,interpolationType:h}=a;let f=0;for(;f<c.length&&c[f]<=i;)f++;f=Math.max(0,f-1);let _=f;for(;_<c.length&&c[_]<i+1;)_++;_=Math.min(c.length-1,_);const x=c[f],E=c[_];return"composite"===a.kind?{kind:"composite",minZoom:x,maxZoom:E,interpolationType:h}:{kind:"camera",minZoom:x,maxZoom:E,minSize:a.evaluate(new gt(x)),maxSize:a.evaluate(new gt(E)),interpolationType:h}}}function wi(i,{uSize:r,uSizeT:a},{lowerSize:c,upperSize:h}){return"source"===i.kind?c/fs:"composite"===i.kind?Ut(c/fs,h/fs,a):r}function ml(i,r){let a=0,c=0;if("constant"===i.kind)c=i.layoutSize;else if("source"!==i.kind){const{interpolationType:h,minZoom:f,maxZoom:_}=i,x=h?_n(Rn.interpolationFactor(h,r,f,_),0,1):0;"camera"===i.kind?c=Ut(i.minSize,i.maxSize,x):a=x}return{uSizeT:a,uSize:c}}var _f=Object.freeze({__proto__:null,getSizeData:bg,evaluateSizeForFeature:wi,evaluateSizeForZoom:ml,SIZE_PACK_FACTOR:fs});function Uy(i,r,a){return i.sections.forEach(c=>{c.text=function(h,f,_){const x=f.layout.get("text-transform").evaluate(_,{});return"uppercase"===x?h=h.toLocaleUpperCase():"lowercase"===x&&(h=h.toLocaleLowerCase()),Ht.applyArabicShaping&&(h=Ht.applyArabicShaping(h)),h}(c.text,r,a)}),i}const du={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Eh(i){return"\ufe36"===i||"\ufe48"===i||"\ufe38"===i||"\ufe44"===i||"\ufe42"===i||"\ufe3e"===i||"\ufe3c"===i||"\ufe3a"===i||"\ufe18"===i||"\ufe40"===i||"\ufe10"===i||"\ufe13"===i||"\ufe14"===i||"\uff40"===i||"\uffe3"===i||"\ufe11"===i||"\ufe12"===i}function wg(i){return"\ufe35"===i||"\ufe47"===i||"\ufe37"===i||"\ufe43"===i||"\ufe41"===i||"\ufe3d"===i||"\ufe3b"===i||"\ufe39"===i||"\ufe17"===i||"\ufe3f"===i}var yf=function(i,r,a,c,h){var f,_,x=8*h-c-1,E=(1<<x)-1,T=E>>1,S=-7,I=a?h-1:0,P=a?-1:1,z=i[r+I];for(I+=P,f=z&(1<<-S)-1,z>>=-S,S+=x;S>0;f=256*f+i[r+I],I+=P,S-=8);for(_=f&(1<<-S)-1,f>>=-S,S+=c;S>0;_=256*_+i[r+I],I+=P,S-=8);if(0===f)f=1-T;else{if(f===E)return _?NaN:1/0*(z?-1:1);_+=Math.pow(2,c),f-=T}return(z?-1:1)*_*Math.pow(2,f-c)},Sd=function(i,r,a,c,h,f){var _,x,E,T=8*f-h-1,S=(1<<T)-1,I=S>>1,P=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,z=c?0:f-1,N=c?1:-1,$=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(x=isNaN(r)?1:0,_=S):(_=Math.floor(Math.log(r)/Math.LN2),r*(E=Math.pow(2,-_))<1&&(_--,E*=2),(r+=_+I>=1?P/E:P*Math.pow(2,1-I))*E>=2&&(_++,E/=2),_+I>=S?(x=0,_=S):_+I>=1?(x=(r*E-1)*Math.pow(2,h),_+=I):(x=r*Math.pow(2,I-1)*Math.pow(2,h),_=0));h>=8;i[a+z]=255&x,z+=N,x/=256,h-=8);for(_=_<<h|x,T+=h;T>0;i[a+z]=255&_,z+=N,_/=256,T-=8);i[a+z-N]|=128*$},oc=En;function En(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}En.Varint=0,En.Fixed64=1,En.Bytes=2,En.Fixed32=5;var Eg=4294967296,sc=1/Eg,Id="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Vs(i){return i.type===En.Bytes?i.readVarint()+i.pos:i.pos+1}function Ad(i,r,a){var c=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));a.realloc(c);for(var h=a.pos-1;h>=i;h--)a.buf[h+c]=a.buf[h]}function jy(i,r){for(var a=0;a<i.length;a++)r.writeVarint(i[a])}function Vy(i,r){for(var a=0;a<i.length;a++)r.writeSVarint(i[a])}function $y(i,r){for(var a=0;a<i.length;a++)r.writeFloat(i[a])}function Gy(i,r){for(var a=0;a<i.length;a++)r.writeDouble(i[a])}function Hy(i,r){for(var a=0;a<i.length;a++)r.writeBoolean(i[a])}function qy(i,r){for(var a=0;a<i.length;a++)r.writeFixed32(i[a])}function Cg(i,r){for(var a=0;a<i.length;a++)r.writeSFixed32(i[a])}function vf(i,r){for(var a=0;a<i.length;a++)r.writeFixed64(i[a])}function Tg(i,r){for(var a=0;a<i.length;a++)r.writeSFixed64(i[a])}function fu(i,r){return(i[r]|i[r+1]<<8|i[r+2]<<16)+16777216*i[r+3]}function mu(i,r,a){i[a]=r,i[a+1]=r>>>8,i[a+2]=r>>>16,i[a+3]=r>>>24}function Dg(i,r){return(i[r]|i[r+1]<<8|i[r+2]<<16)+(i[r+3]<<24)}function Mg(i,r,a){r.glyphs=[],1===i&&a.readMessage(Sg,r)}function Sg(i,r,a){if(3===i){const{id:c,bitmap:h,width:f,height:_,left:x,top:E,advance:T}=a.readMessage(ac,{});r.glyphs.push({id:c,bitmap:new dl({width:f+6,height:_+6},h),metrics:{width:f,height:_,left:x,top:E,advance:T}})}else 4===i?r.ascender=a.readSVarint():5===i&&(r.descender=a.readSVarint())}function ac(i,r,a){1===i?r.id=a.readVarint():2===i?r.bitmap=a.readBytes():3===i?r.width=a.readVarint():4===i?r.height=a.readVarint():5===i?r.left=a.readSVarint():6===i?r.top=a.readSVarint():7===i&&(r.advance=a.readVarint())}function Pd(i){let r=0,a=0;for(const _ of i)r+=_.w*_.h,a=Math.max(a,_.w);i.sort((_,x)=>x.h-_.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),a),h:1/0}];let h=0,f=0;for(const _ of i)for(let x=c.length-1;x>=0;x--){const E=c[x];if(!(_.w>E.w||_.h>E.h)){if(_.x=E.x,_.y=E.y,f=Math.max(f,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===E.w&&_.h===E.h){const T=c.pop();x<c.length&&(c[x]=T)}else _.h===E.h?(E.x+=_.w,E.w-=_.w):_.w===E.w?(E.y+=_.h,E.h-=_.h):(c.push({x:E.x+_.w,y:E.y,w:E.w-_.w,h:_.h}),E.y+=_.h,E.h-=_.h);break}}return{w:h,h:f,fill:r/(h*f)||0}}En.prototype={destroy:function(){this.buf=null},readFields:function(i,r,a){for(a=a||this.length;this.pos<a;){var c=this.readVarint(),h=c>>3,f=this.pos;this.type=7&c,i(h,r,this),this.pos===f&&this.skip(c)}return r},readMessage:function(i,r){return this.readFields(i,r,this.readVarint()+this.pos)},readFixed32:function(){var i=fu(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Dg(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=fu(this.buf,this.pos)+fu(this.buf,this.pos+4)*Eg;return this.pos+=8,i},readSFixed64:function(){var i=fu(this.buf,this.pos)+Dg(this.buf,this.pos+4)*Eg;return this.pos+=8,i},readFloat:function(){var i=yf(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=yf(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var r,a,c=this.buf;return r=127&(a=c[this.pos++]),a<128?r:(r|=(127&(a=c[this.pos++]))<<7,a<128?r:(r|=(127&(a=c[this.pos++]))<<14,a<128?r:(r|=(127&(a=c[this.pos++]))<<21,a<128?r:function(h,f,_){var x,E,T=_.buf;if(x=(112&(E=T[_.pos++]))>>4,E<128||(x|=(127&(E=T[_.pos++]))<<3,E<128)||(x|=(127&(E=T[_.pos++]))<<10,E<128)||(x|=(127&(E=T[_.pos++]))<<17,E<128)||(x|=(127&(E=T[_.pos++]))<<24,E<128)||(x|=(1&(E=T[_.pos++]))<<31,E<128))return function pu(i,r,a){return a?4294967296*r+(i>>>0):4294967296*(r>>>0)+(i>>>0)}(h,x,f);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(a=c[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,r=this.pos;return this.pos=i,i-r>=12&&Id?Id.decode(this.buf.subarray(r,i)):function(a,c,h){for(var f="",_=c;_<h;){var x,E,T,S=a[_],I=null,P=S>239?4:S>223?3:S>191?2:1;if(_+P>h)break;1===P?S<128&&(I=S):2===P?128==(192&(x=a[_+1]))&&(I=(31&S)<<6|63&x)<=127&&(I=null):3===P?(E=a[_+2],128==(192&(x=a[_+1]))&&128==(192&E)&&((I=(15&S)<<12|(63&x)<<6|63&E)<=2047||I>=55296&&I<=57343)&&(I=null)):4===P&&(E=a[_+2],T=a[_+3],128==(192&(x=a[_+1]))&&128==(192&E)&&128==(192&T)&&((I=(15&S)<<18|(63&x)<<12|(63&E)<<6|63&T)<=65535||I>=1114112)&&(I=null)),null===I?(I=65533,P=1):I>65535&&(I-=65536,f+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),f+=String.fromCharCode(I),_+=P}return f}(this.buf,r,i)},readBytes:function(){var i=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,i);return this.pos=i,r},readPackedVarint:function(i,r){if(this.type!==En.Bytes)return i.push(this.readVarint(r));var a=Vs(this);for(i=i||[];this.pos<a;)i.push(this.readVarint(r));return i},readPackedSVarint:function(i){if(this.type!==En.Bytes)return i.push(this.readSVarint());var r=Vs(this);for(i=i||[];this.pos<r;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==En.Bytes)return i.push(this.readBoolean());var r=Vs(this);for(i=i||[];this.pos<r;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==En.Bytes)return i.push(this.readFloat());var r=Vs(this);for(i=i||[];this.pos<r;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==En.Bytes)return i.push(this.readDouble());var r=Vs(this);for(i=i||[];this.pos<r;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==En.Bytes)return i.push(this.readFixed32());var r=Vs(this);for(i=i||[];this.pos<r;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==En.Bytes)return i.push(this.readSFixed32());var r=Vs(this);for(i=i||[];this.pos<r;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==En.Bytes)return i.push(this.readFixed64());var r=Vs(this);for(i=i||[];this.pos<r;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==En.Bytes)return i.push(this.readSFixed64());var r=Vs(this);for(i=i||[];this.pos<r;)i.push(this.readSFixed64());return i},skip:function(i){var r=7&i;if(r===En.Varint)for(;this.buf[this.pos++]>127;);else if(r===En.Bytes)this.pos=this.readVarint()+this.pos;else if(r===En.Fixed32)this.pos+=4;else{if(r!==En.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(i,r){this.writeVarint(i<<3|r)},realloc:function(i){for(var r=this.length||16;r<this.pos+i;)r*=2;if(r!==this.length){var a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),mu(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),mu(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),mu(this.buf,-1&i,this.pos),mu(this.buf,Math.floor(i*sc),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),mu(this.buf,-1&i,this.pos),mu(this.buf,Math.floor(i*sc),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(r,a){var c,h,f,x;if(r>=0?(c=r%4294967296|0,h=r/4294967296|0):(h=~(-r/4294967296),4294967295^(c=~(-r%4294967296))?c=c+1|0:(c=0,h=h+1|0)),r>=0x10000000000000000||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),f=c,(x=a).buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,x.buf[x.pos]=127&(f>>>=7),function(f,_){var x=(7&f)<<4;_.buf[_.pos++]|=x|((f>>>=3)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f)))))}(h,a)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var r=this.pos;this.pos=function(c,h,f){for(var _,x,E=0;E<h.length;E++){if((_=h.charCodeAt(E))>55295&&_<57344){if(!x){_>56319||E+1===h.length?(c[f++]=239,c[f++]=191,c[f++]=189):x=_;continue}if(_<56320){c[f++]=239,c[f++]=191,c[f++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(c[f++]=239,c[f++]=191,c[f++]=189,x=null);_<128?c[f++]=_:(_<2048?c[f++]=_>>6|192:(_<65536?c[f++]=_>>12|224:(c[f++]=_>>18|240,c[f++]=_>>12&63|128),c[f++]=_>>6&63|128),c[f++]=63&_|128)}return f}(this.buf,i,this.pos);var a=this.pos-r;a>=128&&Ad(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeFloat:function(i){this.realloc(4),Sd(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Sd(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var r=i.length;this.writeVarint(r),this.realloc(r);for(var a=0;a<r;a++)this.buf[this.pos++]=i[a]},writeRawMessage:function(i,r){this.pos++;var a=this.pos;i(r,this);var c=this.pos-a;c>=128&&Ad(a,c,this),this.pos=a-1,this.writeVarint(c),this.pos+=c},writeMessage:function(i,r,a){this.writeTag(i,En.Bytes),this.writeRawMessage(r,a)},writePackedVarint:function(i,r){r.length&&this.writeMessage(i,jy,r)},writePackedSVarint:function(i,r){r.length&&this.writeMessage(i,Vy,r)},writePackedBoolean:function(i,r){r.length&&this.writeMessage(i,Hy,r)},writePackedFloat:function(i,r){r.length&&this.writeMessage(i,$y,r)},writePackedDouble:function(i,r){r.length&&this.writeMessage(i,Gy,r)},writePackedFixed32:function(i,r){r.length&&this.writeMessage(i,qy,r)},writePackedSFixed32:function(i,r){r.length&&this.writeMessage(i,Cg,r)},writePackedFixed64:function(i,r){r.length&&this.writeMessage(i,vf,r)},writePackedSFixed64:function(i,r){r.length&&this.writeMessage(i,Tg,r)},writeBytesField:function(i,r){this.writeTag(i,En.Bytes),this.writeBytes(r)},writeFixed32Field:function(i,r){this.writeTag(i,En.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(i,r){this.writeTag(i,En.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(i,r){this.writeTag(i,En.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(i,r){this.writeTag(i,En.Fixed64),this.writeSFixed64(r)},writeVarintField:function(i,r){this.writeTag(i,En.Varint),this.writeVarint(r)},writeSVarintField:function(i,r){this.writeTag(i,En.Varint),this.writeSVarint(r)},writeStringField:function(i,r){this.writeTag(i,En.Bytes),this.writeString(r)},writeFloatField:function(i,r){this.writeTag(i,En.Fixed32),this.writeFloat(r)},writeDoubleField:function(i,r){this.writeTag(i,En.Fixed64),this.writeDouble(r)},writeBooleanField:function(i,r){this.writeVarintField(i,Boolean(r))}};class kd{constructor(r,{pixelRatio:a,version:c,stretchX:h,stretchY:f,content:_}){this.paddedRect=r,this.pixelRatio=a,this.stretchX=h,this.stretchY=f,this.content=_,this.version=c}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Ig{constructor(r,a){const c={},h={};this.haveRenderCallbacks=[];const f=[];this.addImages(r,c,f),this.addImages(a,h,f);const{w:_,h:x}=Pd(f),E=new to({width:_||1,height:x||1});for(const T in r){const S=r[T],I=c[T].paddedRect;to.copy(S.data,E,{x:0,y:0},{x:I.x+1,y:I.y+1},S.data)}for(const T in a){const S=a[T],I=h[T].paddedRect,P=I.x+1,z=I.y+1,N=S.data.width,$=S.data.height;to.copy(S.data,E,{x:0,y:0},{x:P,y:z},S.data),to.copy(S.data,E,{x:0,y:$-1},{x:P,y:z-1},{width:N,height:1}),to.copy(S.data,E,{x:0,y:0},{x:P,y:z+$},{width:N,height:1}),to.copy(S.data,E,{x:N-1,y:0},{x:P-1,y:z},{width:1,height:$}),to.copy(S.data,E,{x:0,y:0},{x:P+N,y:z},{width:1,height:$})}this.image=E,this.iconPositions=c,this.patternPositions=h}addImages(r,a,c){for(const h in r){const f=r[h],_={x:0,y:0,w:f.data.width+2,h:f.data.height+2};c.push(_),a[h]=new kd(_,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(r,a){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in r.updatedImages)this.patchUpdatedImage(this.iconPositions[c],r.getImage(c),a),this.patchUpdatedImage(this.patternPositions[c],r.getImage(c),a)}patchUpdatedImage(r,a,c){if(!r||!a||r.version===a.version)return;r.version=a.version;const[h,f]=r.tl;c.update(a.data,void 0,{x:h,y:f})}}Ye("ImagePosition",kd),Ye("ImageAtlas",Ig);const Ei={horizontal:1,vertical:2,horizontalOnly:3};class Ch{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,a){const c=new Ch;return c.scale=r||1,c.fontStack=a,c}static forImage(r){const a=new Ch;return a.imageName=r,a}}class lc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,a){const c=new lc;for(let h=0;h<r.sections.length;h++){const f=r.sections[h];f.image?c.addImageSection(f):c.addTextSection(f,a)}return c}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(a,c){let h="";for(let f=0;f<a.length;f++){const _=a.charCodeAt(f+1)||null,x=a.charCodeAt(f-1)||null;h+=!c&&(_&&rt(_)&&!du[a[f+1]]||x&&rt(x)&&!du[a[f-1]])||!du[a[f]]?a[f]:du[a[f]]}return h}(this.text,r)}trim(){let r=0;for(let c=0;c<this.text.length&&Th[this.text.charCodeAt(c)];c++)r++;let a=this.text.length;for(let c=this.text.length-1;c>=0&&c>=r&&Th[this.text.charCodeAt(c)];c--)a--;this.text=this.text.substring(r,a),this.sectionIndex=this.sectionIndex.slice(r,a)}substring(r,a){const c=new lc;return c.text=this.text.substring(r,a),c.sectionIndex=this.sectionIndex.slice(r,a),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,a)=>Math.max(r,this.sections[a].scale),0)}addTextSection(r,a){this.text+=r.text,this.sections.push(Ch.forText(r.scale,r.fontStack||a));const c=this.sections.length-1;for(let h=0;h<r.text.length;++h)this.sectionIndex.push(c)}addImageSection(r){const a=r.image?r.image.name:"";if(0===a.length)return void zn("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Ch.forImage(a)),this.sectionIndex.push(this.sections.length-1)):zn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Rd(i,r,a,c,h,f,_,x,E,T,S,I,P,z,N,$){const q=lc.fromFeature(i,h);let J;I===Ei.vertical&&q.verticalizePunctuation(P);const{processBidirectionalText:oe,processStyledBidirectionalText:ce}=Ht;if(oe&&1===q.sections.length){J=[];const pe=oe(q.toString(),Fd(q,T,f,r,c,z,N));for(const Te of pe){const we=new lc;we.text=Te,we.sections=q.sections;for(let Ze=0;Ze<Te.length;Ze++)we.sectionIndex.push(0);J.push(we)}}else if(ce){J=[];const pe=ce(q.text,q.sectionIndex,Fd(q,T,f,r,c,z,N));for(const Te of pe){const we=new lc;we.text=Te[0],we.sectionIndex=Te[1],we.sections=q.sections,J.push(we)}}else J=function(pe,Te){const we=[],Ze=pe.text;let Ue=0;for(const De of Te)we.push(pe.substring(Ue,De)),Ue=De;return Ue<Ze.length&&we.push(pe.substring(Ue,Ze.length)),we}(q,Fd(q,T,f,r,c,z,N));const he=[],fe={positionedLines:he,text:q.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(pe,Te,we,Ze,Ue,De,Ge,Ke,Re,We,tt,Vt){let Cn=0,qt=0,Zt=0;const je="right"===Ke?1:"left"===Ke?0:.5;let ln=!1;for(const cn of Ue){const $t=cn.getSections();for(const Zn of $t){if(Zn.imageName)continue;const fr=Te[Zn.fontStack];if(fr&&(ln=void 0!==fr.ascender&&void 0!==fr.descender,!ln))break}if(!ln)break}let tn=0;for(const cn of Ue){cn.trim();const $t=cn.getMaxScale(),Zn=24*($t-1),fr={positionedGlyphs:[],lineOffset:0};pe.positionedLines[tn]=fr;const Wn=fr.positionedGlyphs;let mr=0;if(!cn.length()){qt+=De,++tn;continue}let Nr=0,Di=0;for(let nn=0;nn<cn.length();nn++){const Ur=cn.getSection(nn),gs=cn.getSectionIndex(nn),Rr=cn.getCharCode(nn);let bn=Ur.scale,Er=null,Vn=null,Mi=null,gr=24,Zr=0;const Si=!(Re===Ei.horizontal||!tt&&!Se(Rr)||tt&&(Th[Rr]||(ar=Rr,o(ar)||u(ar)||g(ar)||le(ar)||Oe(ar))));if(Ur.imageName){const Wr=Ze[Ur.imageName];if(!Wr)continue;Mi=Ur.imageName,pe.iconsInText=pe.iconsInText||!0,Vn=Wr.paddedRect;const Lr=Wr.displaySize;bn=24*bn/Vt,Er={width:Lr[0],height:Lr[1],left:1,top:-3,advance:Si?Lr[1]:Lr[0],localGlyph:!1},Zr=ln?-Er.height*bn:24*$t-17-Lr[1]*bn,gr=Er.advance;const _s=(Si?Lr[0]:Lr[1])*bn-24*$t;_s>0&&_s>mr&&(mr=_s)}else{const Wr=we[Ur.fontStack];if(!Wr)continue;Wr[Rr]&&(Vn=Wr[Rr]);const Lr=Te[Ur.fontStack];if(!Lr)continue;const _s=Lr.glyphs[Rr];if(!_s)continue;if(Er=_s.metrics,gr=8203!==Rr?24:0,ln){const bu=void 0!==Lr.ascender?Math.abs(Lr.ascender):0,Bh=void 0!==Lr.descender?Math.abs(Lr.descender):0,Nh=(bu+Bh)*bn;Nr<Nh&&(Nr=Nh,Di=(bu-Bh)/2*bn),Zr=-bu*bn}else Zr=24*($t-bn)-17}Si?(pe.verticalizable=!0,Wn.push({glyph:Rr,imageName:Mi,x:Cn,y:qt+Zr,vertical:Si,scale:bn,localGlyph:Er.localGlyph,fontStack:Ur.fontStack,sectionIndex:gs,metrics:Er,rect:Vn}),Cn+=gr*bn+We):(Wn.push({glyph:Rr,imageName:Mi,x:Cn,y:qt+Zr,vertical:Si,scale:bn,localGlyph:Er.localGlyph,fontStack:Ur.fontStack,sectionIndex:gs,metrics:Er,rect:Vn}),Cn+=Er.advance*bn+We)}0!==Wn.length&&(Zt=Math.max(Cn-We,Zt),ln?gu(Wn,je,mr,Di,De*$t/2):gu(Wn,je,mr,0,De/2)),Cn=0;const io=De*$t+mr;fr.lineOffset=Math.max(mr,Zn),qt+=io,++tn}var ar;const qn=qt,{horizontalAlign:Br,verticalAlign:qr}=Mh(Ge);(function(cn,$t,Zn,fr,Wn,mr){const Nr=($t-Zn)*Wn,Di=-mr*fr;for(const io of cn)for(const nn of io.positionedGlyphs)nn.x+=Nr,nn.y+=Di})(pe.positionedLines,je,Br,qr,Zt,qn),pe.top+=-qr*qn,pe.bottom=pe.top+qn,pe.left+=-Br*Zt,pe.right=pe.left+Zt,pe.hasBaseline=ln}(fe,r,a,c,J,_,x,E,I,T,P,$),!function(pe){for(const Te of pe)if(0!==Te.positionedGlyphs.length)return!1;return!0}(he)&&fe}const Th={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},xf={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function bf(i,r,a,c,h,f){if(r.imageName){const _=c[r.imageName];return _?_.displaySize[0]*r.scale*24/f+h:0}{const _=a[r.fontStack],x=_&&_.glyphs[i];return x?x.metrics.advance*r.scale+h:0}}function Dh(i,r,a,c){const h=Math.pow(i-r,2);return c?i<r?h/2:2*h:h+Math.abs(a)*a}function Ld(i,r,a){let c=0;return 10===i&&(c-=1e4),a&&(c+=150),40!==i&&65288!==i||(c+=50),41!==r&&65289!==r||(c+=50),c}function wf(i,r,a,c,h,f){let _=null,x=Dh(r,a,h,f);for(const E of c){const T=Dh(r-E.x,a,h,f)+E.badness;T<=x&&(_=E,x=T)}return{index:i,x:r,priorBreak:_,badness:x}}function Od(i){return i?Od(i.priorBreak).concat(i.index):[]}function Fd(i,r,a,c,h,f,_){if("point"!==f)return[];if(!i)return[];const x=[],E=function(P,z,N,$,q,J){let oe=0;for(let ce=0;ce<P.length();ce++){const he=P.getSection(ce);oe+=bf(P.getCharCode(ce),he,$,q,z,J)}return oe/Math.max(1,Math.ceil(oe/N))}(i,r,a,c,h,_),T=i.text.indexOf("\u200b")>=0;let S=0;for(let P=0;P<i.length();P++){const z=i.getSection(P),N=i.getCharCode(P);if(Th[N]||(S+=bf(N,z,c,h,r,_)),P<i.length()-1){const $=!((I=N)<11904||!(B(I)||L(I)||xe(I)||ie(I)||W(I)||v(I)||V(I)||M(I)||ae(I)||G(I)||H(I)||Le(I)||k(I)||C(I)||b(I)||Z(I)||R(I)||_e(I)||ee(I)||re(I)));(xf[N]||$||z.imageName)&&x.push(wf(P+1,S,E,x,Ld(N,i.getCharCode(P+1),$&&T),!1))}}var I;return Od(wf(i.length(),S,E,x,0,!0))}function Mh(i){let r=.5,a=.5;switch(i){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:r,verticalAlign:a}}function gu(i,r,a,c,h){if(!(r||a||c||h))return;const f=i.length-1,_=i[f],x=(_.x+_.metrics.advance*_.scale)*r;for(let E=0;E<=f;E++)i[E].x-=x,i[E].y+=a+c+h}function Zy(i,r,a){const{horizontalAlign:c,verticalAlign:h}=Mh(a),f=r[0]-i.displaySize[0]*c,_=r[1]-i.displaySize[1]*h;return{image:i,top:_,bottom:_+i.displaySize[1],left:f,right:f+i.displaySize[0]}}function Ef(i,r,a,c,h,f){const _=i.image;let x;if(_.content){const q=_.content,J=_.pixelRatio||1;x=[q[0]/J,q[1]/J,_.displaySize[0]-q[2]/J,_.displaySize[1]-q[3]/J]}const E=r.left*f,T=r.right*f;let S,I,P,z;"width"===a||"both"===a?(z=h[0]+E-c[3],I=h[0]+T+c[1]):(z=h[0]+(E+T-_.displaySize[0])/2,I=z+_.displaySize[0]);const N=r.top*f,$=r.bottom*f;return"height"===a||"both"===a?(S=h[1]+N-c[0],P=h[1]+$+c[2]):(S=h[1]+(N+$-_.displaySize[1])/2,P=S+_.displaySize[1]),{image:_,top:S,right:I,bottom:P,left:z,collisionPadding:x}}class Ia extends Je{constructor(r,a,c,h,f){super(r,a),this.angle=h,this.z=c,void 0!==f&&(this.segment=f)}clone(){return new Ia(this.x,this.y,this.z,this.angle,this.segment)}}function Ag(i,r,a,c,h){if(void 0===r.segment)return!0;let f=r,_=r.segment+1,x=0;for(;x>-a/2;){if(_--,_<0)return!1;x-=i[_].dist(f),f=i[_]}x+=i[_].dist(i[_+1]),_++;const E=[];let T=0;for(;x<a/2;){const S=i[_],I=i[_+1];if(!I)return!1;let P=i[_-1].angleTo(S)-S.angleTo(I);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:x,angleDelta:P}),T+=P;x-E[0].distance>c;)T-=E.shift().angleDelta;if(T>h)return!1;_++,x+=S.dist(I)}return!0}function Cf(i){let r=0;for(let a=0;a<i.length-1;a++)r+=i[a].dist(i[a+1]);return r}function zd(i,r,a){return i?.6*r*a:0}function Tf(i,r){return Math.max(i?i.right-i.left:0,r?r.right-r.left:0)}function xx(i,r,a,c,h,f){const _=zd(a,h,f),x=Tf(a,c)*f;let E=0;const T=Cf(i)/2;for(let S=0;S<i.length-1;S++){const I=i[S],P=i[S+1],z=I.dist(P);if(E+z>T){const N=(T-E)/z,$=Ut(I.x,P.x,N),q=Ut(I.y,P.y,N),J=new Ia($,q,0,P.angleTo(I),S);return!_||Ag(i,J,x,_,r)?J:void 0}E+=z}}function Pg(i,r,a,c,h,f,_,x,E){const T=zd(c,f,_),S=Tf(c,h),I=S*_,P=0===i[0].x||i[0].x===E||0===i[0].y||i[0].y===E;return r-I<r/4&&(r=I+r/4),kg(i,P?r/2*x%r:(S/2+2*f)*_*x%r,r,T,a,I,P,!1,E)}function kg(i,r,a,c,h,f,_,x,E){const T=f/2,S=Cf(i);let I=0,P=r-a,z=[];for(let N=0;N<i.length-1;N++){const $=i[N],q=i[N+1],J=$.dist(q),oe=q.angleTo($);for(;P+a<I+J;){P+=a;const ce=(P-I)/J,he=Ut($.x,q.x,ce),fe=Ut($.y,q.y,ce);if(he>=0&&he<E&&fe>=0&&fe<E&&P-T>=0&&P+T<=S){const pe=new Ia(he,fe,0,oe,N);pe._round(),c&&!Ag(i,pe,f,c,h)||z.push(pe)}}I+=J}return x||z.length||_||(z=kg(i,I/2,a,c,h,f,_,!0,E)),z}function Df(i,r,a,c,h){const f=[];for(let _=0;_<i.length;_++){const x=i[_];let E;for(let T=0;T<x.length-1;T++){let S=x[T],I=x[T+1];S.x<r&&I.x<r||(S.x<r?S=new Je(r,S.y+(r-S.x)/(I.x-S.x)*(I.y-S.y))._round():I.x<r&&(I=new Je(r,S.y+(r-S.x)/(I.x-S.x)*(I.y-S.y))._round()),S.y<a&&I.y<a||(S.y<a?S=new Je(S.x+(a-S.y)/(I.y-S.y)*(I.x-S.x),a)._round():I.y<a&&(I=new Je(S.x+(a-S.y)/(I.y-S.y)*(I.x-S.x),a)._round()),S.x>=c&&I.x>=c||(S.x>=c?S=new Je(c,S.y+(c-S.x)/(I.x-S.x)*(I.y-S.y))._round():I.x>=c&&(I=new Je(c,S.y+(c-S.x)/(I.x-S.x)*(I.y-S.y))._round()),S.y>=h&&I.y>=h||(S.y>=h?S=new Je(S.x+(h-S.y)/(I.y-S.y)*(I.x-S.x),h)._round():I.y>=h&&(I=new Je(S.x+(h-S.y)/(I.y-S.y)*(I.x-S.x),h)._round()),E&&S.equals(E[E.length-1])||(E=[S],f.push(E)),E.push(I)))))}}return f}Ye("Anchor",Ia);const Sh=1e20;function Rg(i,r,a,c,h,f,_,x,E){for(let T=r;T<r+c;T++)No(i,a*f+T,f,h,_,x,E);for(let T=a;T<a+h;T++)No(i,T*f+r,1,c,_,x,E)}function No(i,r,a,c,h,f,_){f[0]=0,_[0]=-Sh,_[1]=Sh,h[0]=i[r];for(let x=1,E=0,T=0;x<c;x++){h[x]=i[r+x*a];const S=x*x;do{const I=f[E];T=(h[x]-h[I]+S-I*I)/(x-I)/2}while(T<=_[E]&&--E>-1);E++,f[E]=x,_[E]=T,_[E+1]=Sh}for(let x=0,E=0;x<c;x++){for(;_[E+1]<x;)E++;const T=f[E],S=x-T;i[r+x*a]=h[T]+S*S}}const Mf={none:0,ideographs:1,all:2};class cc{constructor(r,a,c){this.requestManager=r,this.localGlyphMode=a,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,a){const c=[];for(const h in r)for(const f of r[h])c.push({stack:h,id:f});Ga(c,({stack:h,id:f},_)=>{let x=this.entries[h];x||(x=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=x.glyphs[f];if(void 0!==E)return void _(null,{stack:h,id:f,glyph:E});if(E=this._tinySDF(x,h,f),E)return x.glyphs[f]=E,void _(null,{stack:h,id:f,glyph:E});const T=Math.floor(f/256);if(256*T>65535)return void _(new Error("glyphs > 65535 not supported"));if(x.ranges[T])return void _(null,{stack:h,id:f,glyph:E});let S=x.requests[T];S||(S=x.requests[T]=[],cc.loadGlyphRange(h,T,this.url,this.requestManager,(I,P)=>{if(P){x.ascender=P.ascender,x.descender=P.descender;for(const z in P.glyphs)this._doesCharSupportLocalGlyph(+z)||(x.glyphs[+z]=P.glyphs[+z]);x.ranges[T]=!0}for(const z of S)z(I,P);delete x.requests[T]})),S.push((I,P)=>{I?_(I):P&&_(null,{stack:h,id:f,glyph:P.glyphs[f]||null})})},(h,f)=>{if(h)a(h);else if(f){const _={};for(const{stack:x,id:E,glyph:T}of f)void 0===_[x]&&(_[x]={}),void 0===_[x].glyphs&&(_[x].glyphs={}),_[x].glyphs[E]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},_[x].ascender=this.entries[x].ascender,_[x].descender=this.entries[x].descender;a(null,_)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==Mf.none&&(this.localGlyphMode===Mf.all?!!this.localFontFamily:!!this.localFontFamily&&(G(r)||ne(r)||k(r)||R(r))||M(r))}_tinySDF(r,a,c){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(c))return;let f=r.tinySDF;if(!f){let $="400";/bold/i.test(a)?$="900":/medium/i.test(a)?$="500":/light/i.test(a)&&($="200"),f=r.tinySDF=new cc.TinySDF({fontFamily:h,fontWeight:$,fontSize:48,buffer:6,radius:16}),f.fontWeight=$}if(this.localGlyphs[f.fontWeight][c])return this.localGlyphs[f.fontWeight][c];const _=String.fromCharCode(c),{data:x,width:E,height:T,glyphWidth:S,glyphHeight:I,glyphLeft:P,glyphTop:z,glyphAdvance:N}=f.draw(_);return this.localGlyphs[f.fontWeight][c]={id:c,bitmap:new dl({width:E,height:T},x),metrics:{width:S/2,height:I/2,left:P/2,top:z/2-27,advance:N/2,localGlyph:!0}}}}function Lg(i,r,a,c){const h=[],f=i.image,_=f.pixelRatio,x=f.paddedRect.w-2,E=f.paddedRect.h-2,T=i.right-i.left,S=i.bottom-i.top,I=f.stretchX||[[0,x]],P=f.stretchY||[[0,E]],z=(De,Ge)=>De+Ge[1]-Ge[0],N=I.reduce(z,0),$=P.reduce(z,0),q=x-N,J=E-$;let oe=0,ce=N,he=0,fe=$,pe=0,Te=q,we=0,Ze=J;if(f.content&&c){const De=f.content;oe=Bd(I,0,De[0]),he=Bd(P,0,De[1]),ce=Bd(I,De[0],De[2]),fe=Bd(P,De[1],De[3]),pe=De[0]-oe,we=De[1]-he,Te=De[2]-De[0]-ce,Ze=De[3]-De[1]-fe}const Ue=(De,Ge,Ke,Re)=>{const We=Nd(De.stretch-oe,ce,T,i.left),tt=Ih(De.fixed-pe,Te,De.stretch,N),Vt=Nd(Ge.stretch-he,fe,S,i.top),Cn=Ih(Ge.fixed-we,Ze,Ge.stretch,$),qt=Nd(Ke.stretch-oe,ce,T,i.left),Zt=Ih(Ke.fixed-pe,Te,Ke.stretch,N),je=Nd(Re.stretch-he,fe,S,i.top),ln=Ih(Re.fixed-we,Ze,Re.stretch,$),tn=new Je(We,Vt),ar=new Je(qt,Vt),qn=new Je(qt,je),Br=new Je(We,je),qr=new Je(tt/_,Cn/_),cn=new Je(Zt/_,ln/_),$t=r*Math.PI/180;if($t){const Wn=Math.sin($t),mr=Math.cos($t),Nr=[mr,-Wn,Wn,mr];tn._matMult(Nr),ar._matMult(Nr),Br._matMult(Nr),qn._matMult(Nr)}const Zn=De.stretch+De.fixed,fr=Ge.stretch+Ge.fixed;return{tl:tn,tr:ar,bl:Br,br:qn,tex:{x:f.paddedRect.x+1+Zn,y:f.paddedRect.y+1+fr,w:Ke.stretch+Ke.fixed-Zn,h:Re.stretch+Re.fixed-fr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:qr,pixelOffsetBR:cn,minFontScaleX:Te/_/T,minFontScaleY:Ze/_/S,isSDF:a}};if(c&&(f.stretchX||f.stretchY)){const De=Og(I,q,N),Ge=Og(P,J,$);for(let Ke=0;Ke<De.length-1;Ke++){const Re=De[Ke],We=De[Ke+1];for(let tt=0;tt<Ge.length-1;tt++)h.push(Ue(Re,Ge[tt],We,Ge[tt+1]))}}else h.push(Ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:E+1}));return h}function Bd(i,r,a){let c=0;for(const h of i)c+=Math.max(r,Math.min(a,h[1]))-Math.max(r,Math.min(a,h[0]));return c}function Og(i,r,a){const c=[{fixed:-1,stretch:0}];for(const[h,f]of i){const _=c[c.length-1];c.push({fixed:h-_.stretch,stretch:_.stretch}),c.push({fixed:h-_.stretch,stretch:_.stretch+(f-h)})}return c.push({fixed:r+1,stretch:a}),c}function Nd(i,r,a,c){return i/r*a+c}function Ih(i,r,a,c){return i-r*a/c}function Wy(i,r,a,c){const h=r+i.positionedLines[c].lineOffset;return 0===c?a+h/2:a+(h+(r+i.positionedLines[c-1].lineOffset))/2}cc.loadGlyphRange=function(i,r,a,c,h){const f=256*r,_=f+255,x=c.transformRequest(c.normalizeGlyphsURL(a).replace("{fontstack}",i).replace("{range}",`${f}-${_}`),Za.Glyphs);Wa(x,(E,T)=>{if(E)h(E);else if(T){const S={},I=new oc(T).readFields(Mg,{});for(const P of I.glyphs)S[P.id]=P;h(null,{glyphs:S,ascender:I.ascender,descender:I.descender})}})},cc.TinySDF=class{constructor({fontSize:i=24,buffer:r=3,radius:a=8,cutoff:c=.25,fontFamily:h="sans-serif",fontWeight:f="normal",fontStyle:_="normal"}){this.buffer=r,this.cutoff=c,this.radius=a;const x=this.size=i+4*r,E=this._createCanvas(x),T=this.ctx=E.getContext("2d",{willReadFrequently:!0});T.font=`${_} ${f} ${i}px ${h}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(i){const r=document.createElement("canvas");return r.width=r.height=i,r}draw(i){const{width:r,actualBoundingBoxAscent:a,actualBoundingBoxDescent:c,actualBoundingBoxLeft:h,actualBoundingBoxRight:f}=this.ctx.measureText(i),_=Math.floor(a),x=Math.min(this.size-this.buffer,Math.ceil(f-h)),E=Math.min(this.size-this.buffer,Math.ceil(a)+Math.ceil(c)),T=x+2*this.buffer,S=E+2*this.buffer,I=T*S,P=new Uint8ClampedArray(I),z={data:P,width:T,height:S,glyphWidth:x,glyphHeight:E,glyphTop:_,glyphLeft:0,glyphAdvance:r};if(0===x||0===E)return z;const{ctx:N,buffer:$,gridInner:q,gridOuter:J}=this;N.clearRect($,$,x,E),N.fillText(i,$,$+_+1);const oe=N.getImageData($,$,x,E);J.fill(Sh,0,I),q.fill(0,0,I);for(let ce=0;ce<E;ce++)for(let he=0;he<x;he++){const fe=oe.data[4*(ce*x+he)+3]/255;if(0===fe)continue;const pe=(ce+$)*T+he+$;if(1===fe)J[pe]=0,q[pe]=Sh;else{const Te=.5-fe;J[pe]=Te>0?Te*Te:0,q[pe]=Te<0?Te*Te:0}}Rg(J,0,0,T,S,T,this.f,this.v,this.z),Rg(q,$,$,x,E,T,this.f,this.v,this.z);for(let ce=0;ce<I;ce++){const he=Math.sqrt(J[ce])-Math.sqrt(q[ce]);P[ce]=Math.round(255-255*(he/this.radius+this.cutoff))}return z}};class Xy{constructor(r=[],a=Ky){if(this.data=r,this.length=this.data.length,this.compare=a,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const r=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:a,compare:c}=this,h=a[r];for(;r>0;){const f=r-1>>1,_=a[f];if(c(h,_)>=0)break;a[r]=_,r=f}a[r]=h}_down(r){const{data:a,compare:c}=this,h=this.length>>1,f=a[r];for(;r<h;){let _=1+(r<<1),x=a[_];const E=_+1;if(E<this.length&&c(a[E],x)<0&&(_=E,x=a[E]),c(x,f)>=0)break;a[r]=x,r=_}a[r]=f}}function Ky(i,r){return i<r?-1:i>r?1:0}function kt(i,r=1,a=!1){let c=1/0,h=1/0,f=-1/0,_=-1/0;const x=i[0];for(let z=0;z<x.length;z++){const N=x[z];(!z||N.x<c)&&(c=N.x),(!z||N.y<h)&&(h=N.y),(!z||N.x>f)&&(f=N.x),(!z||N.y>_)&&(_=N.y)}const E=Math.min(f-c,_-h);let T=E/2;const S=new Xy([],gl);if(0===E)return new Je(c,h);for(let z=c;z<f;z+=E)for(let N=h;N<_;N+=E)S.push(new uc(z+T,N+T,T,i));let I=function(z){let N=0,$=0,q=0;const J=z[0];for(let oe=0,ce=J.length,he=ce-1;oe<ce;he=oe++){const fe=J[oe],pe=J[he],Te=fe.x*pe.y-pe.x*fe.y;$+=(fe.x+pe.x)*Te,q+=(fe.y+pe.y)*Te,N+=3*Te}return new uc($/N,q/N,0,z)}(i),P=S.length;for(;S.length;){const z=S.pop();(z.d>I.d||!I.d)&&(I=z,a&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,P)),z.max-I.d<=r||(T=z.h/2,S.push(new uc(z.p.x-T,z.p.y-T,T,i)),S.push(new uc(z.p.x+T,z.p.y-T,T,i)),S.push(new uc(z.p.x-T,z.p.y+T,T,i)),S.push(new uc(z.p.x+T,z.p.y+T,T,i)),P+=4)}return a&&(console.log(`num probes: ${P}`),console.log(`best distance: ${I.d}`)),I.p}function gl(i,r){return r.max-i.max}function uc(i,r,a,c){this.p=new Je(i,r),this.h=a,this.d=function(h,f){let _=!1,x=1/0;for(let E=0;E<f.length;E++){const T=f[E];for(let S=0,I=T.length,P=I-1;S<I;P=S++){const z=T[S],N=T[P];z.y>h.y!=N.y>h.y&&h.x<(N.x-z.x)*(h.y-z.y)/(N.y-z.y)+z.x&&(_=!_),x=Math.min(x,tc(h,z,N))}}return(_?1:-1)*Math.sqrt(x)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}const Ud=Number.POSITIVE_INFINITY,jd=Math.sqrt(2);function Uo(i,r){return r[1]!==Ud?function(a,c,h){let f=0,_=0;switch(c=Math.abs(c),h=Math.abs(h),a){case"top-right":case"top-left":case"top":_=h-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-h}switch(a){case"top-right":case"bottom-right":case"right":f=-c;break;case"top-left":case"bottom-left":case"left":f=c}return[f,_]}(i,r[0],r[1]):function(a,c){let h=0,f=0;c<0&&(c=0);const _=c/jd;switch(a){case"top-right":case"top-left":f=_-7;break;case"bottom-right":case"bottom-left":f=7-_;break;case"bottom":f=7-c;break;case"top":f=c-7}switch(a){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=c;break;case"right":h=-c}return[h,f]}(i,r[0])}function Fg(i,r,a,c,h,f,_,x,E,T){i.createArrays(),i.tilePixelRatio=zt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const S=i.layers[0].layout,I=i.layers[0]._unevaluatedLayout._values,P={};if("composite"===i.textSizeData.kind){const{minZoom:$,maxZoom:q}=i.textSizeData;P.compositeTextSizes=[I["text-size"].possiblyEvaluate(new gt($),x),I["text-size"].possiblyEvaluate(new gt(q),x)]}if("composite"===i.iconSizeData.kind){const{minZoom:$,maxZoom:q}=i.iconSizeData;P.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new gt($),x),I["icon-size"].possiblyEvaluate(new gt(q),x)]}P.layoutTextSize=I["text-size"].possiblyEvaluate(new gt(E+1),x),P.layoutIconSize=I["icon-size"].possiblyEvaluate(new gt(E+1),x),P.textMaxSize=I["text-size"].possiblyEvaluate(new gt(18),x);const z="map"===S.get("text-rotation-alignment")&&"point"!==S.get("symbol-placement"),N=S.get("text-size");for(const $ of i.features){const q=S.get("text-font").evaluate($,{},x).join(","),J=N.evaluate($,{},x),oe=P.layoutTextSize.evaluate($,{},x),ce=(P.layoutIconSize.evaluate($,{},x),{horizontal:{},vertical:void 0}),he=$.text;let fe,pe=[0,0];if(he){const Ze=he.toString(),Ue=24*S.get("text-letter-spacing").evaluate($,{},x),De=24*S.get("text-line-height").evaluate($,{},x),Ge=ve(Ze)?Ue:0,Ke=S.get("text-anchor").evaluate($,{},x),Re=S.get("text-variable-anchor");if(!Re){const Zt=S.get("text-radial-offset").evaluate($,{},x);pe=Zt?Uo(Ke,[24*Zt,Ud]):S.get("text-offset").evaluate($,{},x).map(je=>24*je)}let We=z?"center":S.get("text-justify").evaluate($,{},x);const tt=S.get("symbol-placement"),Vt="point"===tt,Cn="point"===tt?24*S.get("text-max-width").evaluate($,{},x):0,qt=Zt=>{i.allowVerticalPlacement&&be(Ze)&&(ce.vertical=Rd(he,r,a,h,q,Cn,De,Ke,Zt,Ge,pe,Ei.vertical,!0,tt,oe,J))};if(!z&&Re){const Zt="auto"===We?Re.map(ln=>Sf(ln)):[We];let je=!1;for(let ln=0;ln<Zt.length;ln++){const tn=Zt[ln];if(!ce.horizontal[tn])if(je)ce.horizontal[tn]=ce.horizontal[0];else{const ar=Rd(he,r,a,h,q,Cn,De,"center",tn,Ge,pe,Ei.horizontal,!1,tt,oe,J);ar&&(ce.horizontal[tn]=ar,je=1===ar.positionedLines.length)}}qt("left")}else{if("auto"===We&&(We=Sf(Ke)),Vt||S.get("text-writing-mode").indexOf("horizontal")>=0||!be(Ze)){const Zt=Rd(he,r,a,h,q,Cn,De,Ke,We,Ge,pe,Ei.horizontal,!1,tt,oe,J);Zt&&(ce.horizontal[We]=Zt)}qt("point"===tt?"left":We)}}let Te=!1;if($.icon&&$.icon.name){const Ze=c[$.icon.name];Ze&&(fe=Zy(h[$.icon.name],S.get("icon-offset").evaluate($,{},x),S.get("icon-anchor").evaluate($,{},x)),Te=Ze.sdf,void 0===i.sdfIcons?i.sdfIcons=Ze.sdf:i.sdfIcons!==Ze.sdf&&zn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ze.pixelRatio!==i.pixelRatio||0!==S.get("icon-rotate").constantOr(1))&&(i.iconsNeedLinear=!0))}const we=Af(ce.horizontal)||ce.vertical;i.iconsInText||(i.iconsInText=!!we&&we.iconsInText),(we||fe)&&If(i,$,ce,fe,c,P,oe,0,pe,Te,_,x,T)}f&&i.generateCollisionDebugBuffers(E,i.collisionBoxArray)}function Sf(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function If(i,r,a,c,h,f,_,x,E,T,S,I,P){let z=f.textMaxSize.evaluate(r,{},I);void 0===z&&(z=_);const N=i.layers[0].layout,$=N.get("icon-offset").evaluate(r,{},I),q=Af(a.horizontal)||a.vertical,J=_/24,oe=i.tilePixelRatio*z/24,ce=i.tilePixelRatio*N.get("symbol-spacing"),he=N.get("text-padding")*i.tilePixelRatio,fe=N.get("icon-padding")*i.tilePixelRatio,pe=Nt(N.get("text-max-angle")),Te="map"===N.get("text-rotation-alignment")&&"point"!==N.get("symbol-placement"),we="map"===N.get("icon-rotation-alignment")&&"point"!==N.get("symbol-placement"),Ze=N.get("symbol-placement"),Ue=ce/2,De=N.get("icon-text-fit");let Ge;c&&"none"!==De&&(i.allowVerticalPlacement&&a.vertical&&(Ge=Ef(c,a.vertical,De,N.get("icon-text-fit-padding"),$,J)),q&&(c=Ef(c,q,De,N.get("icon-text-fit-padding"),$,J)));const Ke=(Re,We,tt)=>{if(We.x<0||We.x>=zt||We.y<0||We.y>=zt)return;const{x:Vt,y:Cn,z:qt}=P.projectTilePoint(We.x,We.y,tt),Zt=new Ia(Vt,Cn,qt,0,void 0);!function(je,ln,tn,ar,qn,Br,qr,cn,$t,Zn,fr,Wn,mr,Nr,Di,io,nn,Ur,gs,Rr,bn,Er,Vn,Mi,gr){const Zr=je.addToLineVertexArray(ln,ar);let Si,Wr,Lr,_s,bu,Bh,Nh,e_=0,Uh=0,xc=0,t_=0,bc=-1,tm=-1;const Gs={};let np=lh(""),$o=0,wc=0;if(void 0===$t._unevaluatedLayout.getValue("text-radial-offset")?[$o,wc]=$t.layout.get("text-offset").evaluate(bn,{},gr).map(Kn=>24*Kn):($o=24*$t.layout.get("text-radial-offset").evaluate(bn,{},gr),wc=Ud),je.allowVerticalPlacement&&qn.vertical){const Kn=qn.vertical;if(Di)Bh=zg(Kn),cn&&(Nh=zg(cn));else{const Ii=$t.layout.get("text-rotate").evaluate(bn,{},gr)+90;Lr=_u(Zn,tn,ln,fr,Wn,mr,Kn,Nr,Ii,io),cn&&(_s=_u(Zn,tn,ln,fr,Wn,mr,cn,Ur,Ii))}}if(Br){const Kn=$t.layout.get("icon-rotate").evaluate(bn,{},gr),Ii="none"!==$t.layout.get("icon-text-fit"),Hs=Lg(Br,Kn,Vn,Ii),El=cn?Lg(cn,Kn,Vn,Ii):void 0;Wr=_u(Zn,tn,ln,fr,Wn,mr,Br,Ur,Kn),e_=4*Hs.length;const Ec=je.iconSizeData;let Go=null;"source"===Ec.kind?(Go=[fs*$t.layout.get("icon-size").evaluate(bn,{},gr)],Go[0]>Ci&&zn(`${je.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Ec.kind&&(Go=[fs*Er.compositeIconSizes[0].evaluate(bn,{},gr),fs*Er.compositeIconSizes[1].evaluate(bn,{},gr)],(Go[0]>Ci||Go[1]>Ci)&&zn(`${je.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),je.addSymbols(je.icon,Hs,Go,Rr,gs,bn,!1,tn,ln,Zr.lineStartIndex,Zr.lineLength,-1,Mi,gr),bc=je.icon.placedSymbolArray.length-1,El&&(Uh=4*El.length,je.addSymbols(je.icon,El,Go,Rr,gs,bn,Ei.vertical,tn,ln,Zr.lineStartIndex,Zr.lineLength,-1,Mi,gr),tm=je.icon.placedSymbolArray.length-1)}for(const Kn in qn.horizontal){const Ii=qn.horizontal[Kn];Si||(np=lh(Ii.text),Di?bu=zg(Ii):Si=_u(Zn,tn,ln,fr,Wn,mr,Ii,Nr,$t.layout.get("text-rotate").evaluate(bn,{},gr),io));const Hs=1===Ii.positionedLines.length;if(xc+=Vd(je,tn,ln,Ii,qr,$t,Di,bn,io,Zr,qn.vertical?Ei.horizontal:Ei.horizontalOnly,Hs?Object.keys(qn.horizontal):[Kn],Gs,bc,Er,Mi,gr),Hs)break}qn.vertical&&(t_+=Vd(je,tn,ln,qn.vertical,qr,$t,Di,bn,io,Zr,Ei.vertical,["vertical"],Gs,tm,Er,Mi,gr));let lr=-1;const ka=(Kn,Ii)=>Kn?Math.max(Kn,Ii):Ii;lr=ka(bu,lr),lr=ka(Bh,lr),lr=ka(Nh,lr);const rp=lr>-1?1:0;je.glyphOffsetArray.length>=_l.MAX_GLYPHS&&zn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==bn.sortKey&&je.addToSortKeyRanges(je.symbolInstances.length,bn.sortKey),je.symbolInstances.emplaceBack(tn.x,tn.y,tn.z,ln.x,ln.y,Gs.right>=0?Gs.right:-1,Gs.center>=0?Gs.center:-1,Gs.left>=0?Gs.left:-1,Gs.vertical>=0?Gs.vertical:-1,bc,tm,np,void 0!==Si?Si:je.collisionBoxArray.length,void 0!==Si?Si+1:je.collisionBoxArray.length,void 0!==Lr?Lr:je.collisionBoxArray.length,void 0!==Lr?Lr+1:je.collisionBoxArray.length,void 0!==Wr?Wr:je.collisionBoxArray.length,void 0!==Wr?Wr+1:je.collisionBoxArray.length,_s||je.collisionBoxArray.length,_s?_s+1:je.collisionBoxArray.length,fr,xc,t_,e_,Uh,rp,0,$o,wc,lr)}(i,We,Zt,Re,a,c,h,Ge,i.layers[0],i.collisionBoxArray,r.index,r.sourceLayerIndex,i.index,he,Te,E,0,fe,we,$,r,f,T,S,I)};if("line"===Ze)for(const Re of Df(r.geometry,0,0,zt,zt)){const We=Pg(Re,ce,pe,a.vertical||q,c,24,oe,i.overscaling,zt);for(const tt of We){const Vt=q;Vt&&Bg(i,Vt.text,Ue,tt)||Ke(Re,tt,I)}}else if("line-center"===Ze){for(const Re of r.geometry)if(Re.length>1){const We=xx(Re,pe,a.vertical||q,c,24,oe);We&&Ke(Re,We,I)}}else if("Polygon"===r.type)for(const Re of cf(r.geometry,0)){const We=kt(Re,16);Ke(Re[0],new Ia(We.x,We.y,0,0,void 0),I)}else if("LineString"===r.type)for(const Re of r.geometry)Ke(Re,new Ia(Re[0].x,Re[0].y,0,0,void 0),I);else if("Point"===r.type)for(const Re of r.geometry)for(const We of Re)Ke([We],new Ia(We.x,We.y,0,0,void 0),I)}const Ci=32640;function Vd(i,r,a,c,h,f,_,x,E,T,S,I,P,z,N,$,q){const J=function(he,fe,pe,Te,we,Ze,Ue,De){const Ge=[];if(0===fe.positionedLines.length)return Ge;const Ke=Te.layout.get("text-rotate").evaluate(Ze,{})*Math.PI/180,Re=function(qt){const Zt=qt[0],je=qt[1],ln=Zt*je;return ln>0?[Zt,-je]:ln<0?[-Zt,je]:0===Zt?[je,Zt]:[je,-Zt]}(pe);let We=Math.abs(fe.top-fe.bottom);for(const qt of fe.positionedLines)We-=qt.lineOffset;const tt=fe.positionedLines.length,Vt=We/tt;let Cn=fe.top-pe[1];for(let qt=0;qt<tt;++qt){const Zt=fe.positionedLines[qt];Cn=Wy(fe,Vt,Cn,qt);for(const je of Zt.positionedGlyphs){if(!je.rect)continue;const ln=je.rect||{};let tn=4,ar=!0,qn=1,Br=0;if(je.imageName){const Vn=Ue[je.imageName];if(!Vn)continue;if(Vn.sdf){zn("SDF images are not supported in formatted text and will be ignored.");continue}ar=!1,qn=Vn.pixelRatio,tn=1/qn}const qr=(we||De)&&je.vertical,cn=je.metrics.advance*je.scale/2,$t=je.metrics,Zn=je.rect;if(null===Zn)continue;De&&fe.verticalizable&&(Br=je.imageName?cn-je.metrics.width*je.scale/2:0);const fr=we?[je.x+cn,je.y]:[0,0];let Wn=[0,0],mr=[0,0],Nr=!1;we||(qr?(mr=[je.x+cn+Re[0],je.y+Re[1]-Br],Nr=!0):Wn=[je.x+cn+pe[0],je.y+pe[1]-Br]);const Di=Zn.w*je.scale/(qn*(je.localGlyph?2:1)),io=Zn.h*je.scale/(qn*(je.localGlyph?2:1));let nn,Ur,gs,Rr;if(qr){const Vn=je.y-Cn,Mi=new Je(-cn,cn-Vn),gr=-Math.PI/2,Zr=new Je(...mr);nn=new Je(-cn+Wn[0],Wn[1]),nn._rotateAround(gr,Mi)._add(Zr),nn.x+=-Vn+cn,nn.y-=($t.left-tn)*je.scale;const Si=je.imageName?$t.advance*je.scale:24*je.scale,Wr=String.fromCharCode(je.glyph);Eh(Wr)?nn.x+=(1-tn)*je.scale:wg(Wr)?nn.x+=Si-$t.height*je.scale+(-tn-1)*je.scale:nn.x+=je.imageName||$t.width+2*tn===Zn.w&&$t.height+2*tn===Zn.h?(Si-io)/2:(Si-($t.height+2*tn)*je.scale)/2,Ur=new Je(nn.x,nn.y-Di),gs=new Je(nn.x+io,nn.y),Rr=new Je(nn.x+io,nn.y-Di)}else{const Vn=($t.left-tn)*je.scale-cn+Wn[0],Mi=(-$t.top-tn)*je.scale+Wn[1],gr=Vn+Di,Zr=Mi+io;nn=new Je(Vn,Mi),Ur=new Je(gr,Mi),gs=new Je(Vn,Zr),Rr=new Je(gr,Zr)}if(Ke){let Vn;Vn=we?new Je(0,0):Nr?new Je(Re[0],Re[1]):new Je(pe[0],pe[1]),nn._rotateAround(Ke,Vn),Ur._rotateAround(Ke,Vn),gs._rotateAround(Ke,Vn),Rr._rotateAround(Ke,Vn)}const bn=new Je(0,0),Er=new Je(0,0);Ge.push({tl:nn,tr:Ur,bl:gs,br:Rr,tex:ln,writingMode:fe.writingMode,glyphOffset:fr,sectionIndex:je.sectionIndex,isSDF:ar,pixelOffsetTL:bn,pixelOffsetBR:Er,minFontScaleX:0,minFontScaleY:0})}}return Ge}(0,c,E,f,_,x,h,i.allowVerticalPlacement),oe=i.textSizeData;let ce=null;"source"===oe.kind?(ce=[fs*f.layout.get("text-size").evaluate(x,{},q)],ce[0]>Ci&&zn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===oe.kind&&(ce=[fs*N.compositeTextSizes[0].evaluate(x,{},q),fs*N.compositeTextSizes[1].evaluate(x,{},q)],(ce[0]>Ci||ce[1]>Ci)&&zn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,J,ce,E,_,x,S,r,a,T.lineStartIndex,T.lineLength,z,$,q);for(const he of I)P[he]=i.text.placedSymbolArray.length-1;return 4*J.length}function Af(i){for(const r in i)return i[r];return null}function _u(i,r,a,c,h,f,_,x,E,T){let S=_.top,I=_.bottom,P=_.left,z=_.right;const N=_.collisionPadding;if(N&&(P-=N[0],S-=N[1],z+=N[2],I+=N[3]),E){const $=new Je(P,S),q=new Je(z,S),J=new Je(P,I),oe=new Je(z,I),ce=Nt(E);let he=new Je(0,0);T&&(he=new Je(T[0],T[1])),$._rotateAround(ce,he),q._rotateAround(ce,he),J._rotateAround(ce,he),oe._rotateAround(ce,he),P=Math.min($.x,q.x,J.x,oe.x),z=Math.max($.x,q.x,J.x,oe.x),S=Math.min($.y,q.y,J.y,oe.y),I=Math.max($.y,q.y,J.y,oe.y)}return i.emplaceBack(r.x,r.y,r.z,a.x,a.y,P,S,z,I,x,c,h,f),i.length-1}function zg(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const r=i.bottom-i.top;return r>0?Math.max(10,r):null}function Bg(i,r,a,c){const h=i.compareText;if(r in h){const f=h[r];for(let _=f.length-1;_>=0;_--)if(c.dist(f[_])<a)return!0}else h[r]=[];return h[r].push(c),!1}const bx=fl.VectorTileFeature.types,$d=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hc(i,r,a,c,h,f,_,x,E,T,S,I,P,z,N,$){const q=S?Math.min(Ci,Math.round(S[0])):0,J=S?Math.min(Ci,Math.round(S[1])):0;i.emplaceBack(r,a,Math.round(32*_),Math.round(32*x),E,T,(q<<1)+(I?1:0),J,16*P,16*z,256*N,256*$,c,h,f,0)}function Ah(i,r,a){i.emplaceBack(r.x,r.y,a),i.emplaceBack(r.x,r.y,a),i.emplaceBack(r.x,r.y,a),i.emplaceBack(r.x,r.y,a)}function Pf(i){for(const r of i.sections)if(He(r.text))return!0;return!1}class Ph{constructor(r){this.layoutVertexArray=new sl,this.indexArray=new Hr,this.programConfigurations=r,this.segments=new et,this.dynamicLayoutVertexArray=new Qc,this.opacityVertexArray=new Vp,this.placedSymbolArray=new eu}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(r,a,c,h){this.isEmpty()||(c&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,zy.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,By.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,$d,!0),this.opacityVertexBuffer.itemSize=1),(c||h)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ye("SymbolBuffers",Ph);class Ng{constructor(r,a,c){this.layoutVertexArray=new r,this.layoutAttributes=a,this.indexArray=new c,this.segments=new et,this.collisionVertexArray=new cl,this.collisionVertexArrayExt=new Qc}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,Ny.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,hu.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ye("CollisionBuffers",Ng);class _l{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(_=>_.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=fi([]),this.placementViewportMatrix=fi([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bg(this.zoom,a["text-size"]),this.iconSizeData=bg(this.zoom,a["icon-size"]);const c=this.layers[0].layout,h=c.get("symbol-sort-key"),f=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(_=>Ei[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=r.sourceID}createArrays(){this.text=new Ph(new Sa(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new Ph(new Sa(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new fd,this.lineVertexArray=new tu,this.symbolInstances=new Ar}calculateGlyphDependencies(r,a,c,h,f){for(let _=0;_<r.length;_++)if(a[r.charCodeAt(_)]=!0,h&&f){const x=du[r.charAt(_)];x&&(a[x.charCodeAt(0)]=!0)}}populate(r,a,c,h){const f=this.layers[0],_=f.layout,x=_.get("text-font"),E=_.get("text-field"),T=_.get("icon-image"),S=("constant"!==E.value.kind||E.value.value instanceof St&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),I="constant"!==T.value.kind||!!T.value.value||Object.keys(T.parameters).length>0,P=_.get("symbol-sort-key");if(this.features=[],!S&&!I)return;const z=a.iconDependencies,N=a.glyphDependencies,$=a.availableImages,q=new gt(this.zoom);for(const{feature:J,id:oe,index:ce,sourceLayerIndex:he}of r){const fe=f._featureFilter.needGeometry,pe=ec(J,fe);if(!f._featureFilter.filter(q,pe,c))continue;let Te,we;if(fe||(pe.geometry=yo(J,c,h)),S){const Ue=f.getValueAndResolveTokens("text-field",pe,c,$),De=St.factory(Ue);Pf(De)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ii()||this.hasRTLText&&Ht.isParsed())&&(Te=Uy(De,f,pe))}if(I){const Ue=f.getValueAndResolveTokens("icon-image",pe,c,$);we=Ue instanceof vr?Ue:vr.fromString(Ue)}if(!Te&&!we)continue;const Ze=this.sortFeaturesByKey?P.evaluate(pe,{},c):void 0;if(this.features.push({id:oe,text:Te,icon:we,index:ce,sourceLayerIndex:he,geometry:pe.geometry,properties:J.properties,type:bx[J.type],sortKey:Ze}),we&&(z[we.name]=!0),Te){const Ue=x.evaluate(pe,{},c).join(","),De="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ei.vertical)>=0;for(const Ge of Te.sections)if(Ge.image)z[Ge.image.name]=!0;else{const Ke=be(Te.toString()),Re=Ge.fontStack||Ue,We=N[Re]=N[Re]||{};this.calculateGlyphDependencies(Ge.text,We,De,this.allowVerticalPlacement,Ke)}}}"line"===_.get("symbol-placement")&&(this.features=function(J){const oe={},ce={},he=[];let fe=0;function pe(Ue){he.push(J[Ue]),fe++}function Te(Ue,De,Ge){const Ke=ce[Ue];return delete ce[Ue],ce[De]=Ke,he[Ke].geometry[0].pop(),he[Ke].geometry[0]=he[Ke].geometry[0].concat(Ge[0]),Ke}function we(Ue,De,Ge){const Ke=oe[De];return delete oe[De],oe[Ue]=Ke,he[Ke].geometry[0].shift(),he[Ke].geometry[0]=Ge[0].concat(he[Ke].geometry[0]),Ke}function Ze(Ue,De,Ge){const Ke=Ge?De[0][De[0].length-1]:De[0][0];return`${Ue}:${Ke.x}:${Ke.y}`}for(let Ue=0;Ue<J.length;Ue++){const De=J[Ue],Ge=De.geometry,Ke=De.text?De.text.toString():null;if(!Ke){pe(Ue);continue}const Re=Ze(Ke,Ge),We=Ze(Ke,Ge,!0);if(Re in ce&&We in oe&&ce[Re]!==oe[We]){const tt=we(Re,We,Ge),Vt=Te(Re,We,he[tt].geometry);delete oe[Re],delete ce[We],ce[Ze(Ke,he[Vt].geometry,!0)]=Vt,he[tt].geometry=null}else Re in ce?Te(Re,We,Ge):We in oe?we(Re,We,Ge):(pe(Ue),oe[Re]=fe-1,ce[We]=fe-1)}return he.filter(Ue=>Ue.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,oe)=>J.sortKey-oe.sortKey)}update(r,a,c,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,a,this.layers,c,h),this.icon.programConfigurations.updatePaintArrays(r,a,this.layers,c,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,a){const c=this.lineVertexArray.length;if(void 0!==r.segment){let h=r.dist(a[r.segment+1]),f=r.dist(a[r.segment]);const _={};for(let x=r.segment+1;x<a.length;x++)_[x]={x:a[x].x,y:a[x].y,tileUnitDistanceFromAnchor:h},x<a.length-1&&(h+=a[x+1].dist(a[x]));for(let x=r.segment||0;x>=0;x--)_[x]={x:a[x].x,y:a[x].y,tileUnitDistanceFromAnchor:f},x>0&&(f+=a[x-1].dist(a[x]));for(let x=0;x<a.length;x++){const E=_[x];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(r,a,c,h,f,_,x,E,T,S,I,P,z,N){const $=r.indexArray,q=r.layoutVertexArray,J=r.segments.prepareSegment(4*a.length,q,$,this.canOverlap?_.sortKey:void 0),oe=this.glyphOffsetArray.length,ce=J.vertexLength,he=this.allowVerticalPlacement&&x===Ei.vertical?Math.PI/2:0,fe=_.text&&_.text.sections;for(let pe=0;pe<a.length;pe++){const{tl:Te,tr:we,bl:Ze,br:Ue,tex:De,pixelOffsetTL:Ge,pixelOffsetBR:Ke,minFontScaleX:Re,minFontScaleY:We,glyphOffset:tt,isSDF:Vt,sectionIndex:Cn}=a[pe],qt=J.vertexLength,Zt=tt[1];hc(q,E.x,E.y,E.z,T.x,T.y,Te.x,Zt+Te.y,De.x,De.y,c,Vt,Ge.x,Ge.y,Re,We),hc(q,E.x,E.y,E.z,T.x,T.y,we.x,Zt+we.y,De.x+De.w,De.y,c,Vt,Ke.x,Ge.y,Re,We),hc(q,E.x,E.y,E.z,T.x,T.y,Ze.x,Zt+Ze.y,De.x,De.y+De.h,c,Vt,Ge.x,Ke.y,Re,We),hc(q,E.x,E.y,E.z,T.x,T.y,Ue.x,Zt+Ue.y,De.x+De.w,De.y+De.h,c,Vt,Ke.x,Ke.y,Re,We),Ah(r.dynamicLayoutVertexArray,E,he),$.emplaceBack(qt,qt+1,qt+2),$.emplaceBack(qt+1,qt+2,qt+3),J.vertexLength+=4,J.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(tt[0]),pe!==a.length-1&&Cn===a[pe+1].sectionIndex||r.programConfigurations.populatePaintArrays(q.length,_,_.index,{},z,N,fe&&fe[Cn])}r.placedSymbolArray.emplaceBack(E.x,E.y,E.z,T.x,T.y,oe,this.glyphOffsetArray.length-oe,ce,S,I,T.segment,c?c[0]:0,c?c[1]:0,h[0],h[1],x,0,!1,0,P,0)}_commitLayoutVertex(r,a,c,h,f,_,x){r.emplaceBack(a,c,h,f,_,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(r,a,c,h,f,_,x){const E=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),T=E.vertexLength,S=x.tileAnchorX,I=x.tileAnchorY;for(let z=0;z<4;z++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(a,-r.padding,-r.padding),c.collisionVertexArrayExt.emplaceBack(a,r.padding,-r.padding),c.collisionVertexArrayExt.emplaceBack(a,r.padding,r.padding),c.collisionVertexArrayExt.emplaceBack(a,-r.padding,r.padding),this._commitLayoutVertex(c.layoutVertexArray,h,f,_,S,I,new Je(r.x1,r.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,f,_,S,I,new Je(r.x2,r.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,f,_,S,I,new Je(r.x2,r.y2)),this._commitLayoutVertex(c.layoutVertexArray,h,f,_,S,I,new Je(r.x1,r.y2)),E.vertexLength+=4;const P=c.indexArray;P.emplaceBack(T,T+1),P.emplaceBack(T+1,T+2),P.emplaceBack(T+2,T+3),P.emplaceBack(T+3,T),E.primitiveLength+=4}_addTextDebugCollisionBoxes(r,a,c,h,f,_){for(let x=h;x<f;x++){const E=c.get(x),T=this.getSymbolInstanceTextSize(r,_,a,x);this._addCollisionDebugVertices(E,T,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(r,a,c,h,f,_){for(let x=h;x<f;x++){const E=c.get(x),T=this.getSymbolInstanceIconSize(r,a,x);this._addCollisionDebugVertices(E,T,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}generateCollisionDebugBuffers(r,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ng(al,ps.members,ul),this.iconCollisionBox=new Ng(al,ps.members,ul);const c=ml(this.iconSizeData,r),h=ml(this.textSizeData,r);for(let f=0;f<this.symbolInstances.length;f++){const _=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(h,r,a,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(h,r,a,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,r,a,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,r,a,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(r,a,c,h){const f=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:h),_=wi(this.textSizeData,r,f)/24;return this.tilePixelRatio*_}getSymbolInstanceIconSize(r,a,c){const h=this.icon.placedSymbolArray.get(c),f=wi(this.iconSizeData,r,h);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(r,a,c){r.emplaceBack(a,-c,-c),r.emplaceBack(a,c,-c),r.emplaceBack(a,c,c),r.emplaceBack(a,-c,c)}_updateTextDebugCollisionBoxes(r,a,c,h,f,_){for(let x=h;x<f;x++){const E=c.get(x),T=this.getSymbolInstanceTextSize(r,_,a,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,E.padding)}}_updateIconDebugCollisionBoxes(r,a,c,h,f){for(let _=h;_<f;_++){const x=c.get(_),E=this.getSymbolInstanceIconSize(r,a,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,x.padding)}}updateCollisionDebugBuffers(r,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=ml(this.iconSizeData,r),h=ml(this.textSizeData,r);for(let f=0;f<this.symbolInstances.length;f++){const _=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(h,r,a,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(h,r,a,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(c,r,a,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(c,r,a,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,a,c,h,f,_,x,E,T){const S={};for(let I=a;I<c;I++){const P=r.get(I);S.textBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},S.textFeatureIndex=P.featureIndex;break}for(let I=h;I<f;I++){const P=r.get(I);S.verticalTextBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},S.verticalTextFeatureIndex=P.featureIndex;break}for(let I=_;I<x;I++){const P=r.get(I);S.iconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},S.iconFeatureIndex=P.featureIndex;break}for(let I=E;I<T;I++){const P=r.get(I);S.verticalIconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},S.verticalIconFeatureIndex=P.featureIndex;break}return S}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const c=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,a){const c=r.placedSymbolArray.get(a),h=c.vertexStartIndex+4*c.numGlyphs;for(let f=c.vertexStartIndex;f<h;f+=4)r.indexArray.emplaceBack(f,f+1,f+2),r.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const a=Math.sin(r),c=Math.cos(r),h=[],f=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const E=this.symbolInstances.get(x);h.push(0|Math.round(a*E.tileAnchorX+c*E.tileAnchorY)),f.push(E.featureIndex)}return _.sort((x,E)=>h[x]-h[E]||f[E]-f[x]),_}addToSortKeyRanges(r,a){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===a?c.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const c=this.symbolInstances.get(a);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((h,f,_)=>{h>=0&&_.indexOf(h)===f&&this.addIndicesForPlacedSymbol(this.text,h)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ye("SymbolBucket",_l,{omit:["layers","collisionBoxArray","features","compareText"]}),_l.MAX_GLYPHS=65535,_l.addDynamicAttributes=Ah;const Yy=new pr({"symbol-placement":new it(Ee.layout_symbol["symbol-placement"]),"symbol-spacing":new it(Ee.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new it(Ee.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ht(Ee.layout_symbol["symbol-sort-key"]),"symbol-z-order":new it(Ee.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new it(Ee.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new it(Ee.layout_symbol["icon-ignore-placement"]),"icon-optional":new it(Ee.layout_symbol["icon-optional"]),"icon-rotation-alignment":new it(Ee.layout_symbol["icon-rotation-alignment"]),"icon-size":new ht(Ee.layout_symbol["icon-size"]),"icon-text-fit":new it(Ee.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new it(Ee.layout_symbol["icon-text-fit-padding"]),"icon-image":new ht(Ee.layout_symbol["icon-image"]),"icon-rotate":new ht(Ee.layout_symbol["icon-rotate"]),"icon-padding":new it(Ee.layout_symbol["icon-padding"]),"icon-keep-upright":new it(Ee.layout_symbol["icon-keep-upright"]),"icon-offset":new ht(Ee.layout_symbol["icon-offset"]),"icon-anchor":new ht(Ee.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new it(Ee.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new it(Ee.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new it(Ee.layout_symbol["text-rotation-alignment"]),"text-field":new ht(Ee.layout_symbol["text-field"]),"text-font":new ht(Ee.layout_symbol["text-font"]),"text-size":new ht(Ee.layout_symbol["text-size"]),"text-max-width":new ht(Ee.layout_symbol["text-max-width"]),"text-line-height":new ht(Ee.layout_symbol["text-line-height"]),"text-letter-spacing":new ht(Ee.layout_symbol["text-letter-spacing"]),"text-justify":new ht(Ee.layout_symbol["text-justify"]),"text-radial-offset":new ht(Ee.layout_symbol["text-radial-offset"]),"text-variable-anchor":new it(Ee.layout_symbol["text-variable-anchor"]),"text-anchor":new ht(Ee.layout_symbol["text-anchor"]),"text-max-angle":new it(Ee.layout_symbol["text-max-angle"]),"text-writing-mode":new it(Ee.layout_symbol["text-writing-mode"]),"text-rotate":new ht(Ee.layout_symbol["text-rotate"]),"text-padding":new it(Ee.layout_symbol["text-padding"]),"text-keep-upright":new it(Ee.layout_symbol["text-keep-upright"]),"text-transform":new ht(Ee.layout_symbol["text-transform"]),"text-offset":new ht(Ee.layout_symbol["text-offset"]),"text-allow-overlap":new it(Ee.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new it(Ee.layout_symbol["text-ignore-placement"]),"text-optional":new it(Ee.layout_symbol["text-optional"])});var kf={paint:new pr({"icon-opacity":new ht(Ee.paint_symbol["icon-opacity"]),"icon-color":new ht(Ee.paint_symbol["icon-color"]),"icon-halo-color":new ht(Ee.paint_symbol["icon-halo-color"]),"icon-halo-width":new ht(Ee.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ht(Ee.paint_symbol["icon-halo-blur"]),"icon-translate":new it(Ee.paint_symbol["icon-translate"]),"icon-translate-anchor":new it(Ee.paint_symbol["icon-translate-anchor"]),"text-opacity":new ht(Ee.paint_symbol["text-opacity"]),"text-color":new ht(Ee.paint_symbol["text-color"],{runtimeType:Jo,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ht(Ee.paint_symbol["text-halo-color"]),"text-halo-width":new ht(Ee.paint_symbol["text-halo-width"]),"text-halo-blur":new ht(Ee.paint_symbol["text-halo-blur"]),"text-translate":new it(Ee.paint_symbol["text-translate"]),"text-translate-anchor":new it(Ee.paint_symbol["text-translate-anchor"])}),layout:Yy};class Ug{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:As,this.defaultValue=r}evaluate(r){if(r.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(r.formattedSection))return a.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ye("FormatSectionOverride",Ug,{omit:["defaultValue"]});class kh extends Ui{constructor(r){super(r,kf)}recalculate(r,a){super.recalculate(r,a),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const h=[];for(const f of c)h.indexOf(f)<0&&h.push(f);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,a,c,h){const f=this.layout.get(r).evaluate(a,{},c,h),_=this._unevaluatedLayout._values[r];return _.isDataDriven()||Ja(_.value)||!f?f:(x=a.properties,f.replace(/{([^{}]+)}/g,(T,S)=>S in x?String(x[S]):""));var x}createBucket(r){return new _l(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of kf.paint.overridableProperties){if(!kh.hasPaintOverride(this.layout,r))continue;const a=this.paint.get(r),c=new Ug(a),h=new Zu(c,a.property.specification);let f=null;f="constant"===a.value.kind||"source"===a.value.kind?new el("source",h):new Wu("composite",h,a.value.zoomStops,a.value._interpolationType),this.paint._values[r]=new si(a.property,f,a.parameters)}}_handleOverridablePaintPropertyUpdate(r,a,c){return!(!this.layout||a.isDataDriven()||c.isDataDriven())&&kh.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,a){const c=r.get("text-field"),h=kf.paint.properties[a];let f=!1;const _=x=>{for(const E of x)if(h.overrides&&h.overrides.hasOverride(E))return void(f=!0)};if("constant"===c.value.kind&&c.value.value instanceof St)_(c.value.value.sections);else if("source"===c.value.kind){const x=T=>{f||(T instanceof sa&&In(T.value)===ia?_(T.value.sections):T instanceof Po?_(T.sections):T.eachChild(x))},E=c.value;E._styleExpression&&x(E._styleExpression.expression)}return f}getProgramConfiguration(r){return new _o(this,r)}}var wx={paint:new pr({"background-color":new it(Ee.paint_background["background-color"]),"background-pattern":new ss(Ee.paint_background["background-pattern"]),"background-opacity":new it(Ee.paint_background["background-opacity"])})},Jy={paint:new pr({"raster-opacity":new it(Ee.paint_raster["raster-opacity"]),"raster-hue-rotate":new it(Ee.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new it(Ee.paint_raster["raster-brightness-min"]),"raster-brightness-max":new it(Ee.paint_raster["raster-brightness-max"]),"raster-saturation":new it(Ee.paint_raster["raster-saturation"]),"raster-contrast":new it(Ee.paint_raster["raster-contrast"]),"raster-resampling":new it(Ee.paint_raster["raster-resampling"]),"raster-fade-duration":new it(Ee.paint_raster["raster-fade-duration"])})};class Ex extends Ui{constructor(r){super(r,{}),this.implementation=r}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var jg={paint:new pr({"sky-type":new it(Ee.paint_sky["sky-type"]),"sky-atmosphere-sun":new it(Ee.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new it(Ee.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new it(Ee.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new it(Ee.paint_sky["sky-gradient-radius"]),"sky-gradient":new mo(Ee.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new it(Ee.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new it(Ee.paint_sky["sky-atmosphere-color"]),"sky-opacity":new it(Ee.paint_sky["sky-opacity"])})};function Gd(i,r,a){const c=ao(0,0,1),h=Pu(Ks());return function(f,_,x){x*=.5;var E=_[0],T=_[1],S=_[2],I=_[3],P=Math.sin(x),z=Math.cos(x);f[0]=E*z-S*P,f[1]=T*z+I*P,f[2]=S*z+E*P,f[3]=I*z-T*P}(h,h,a?-Nt(i)+Math.PI:Nt(i)),Rl(h,h,-Nt(r)),Gi(c,c,h),Xs(c,c)}const Qy={circle:class extends Ui{constructor(i){super(i,vy)}createBucket(i){return new xd(i)}queryRadius(i){const r=i;return hl("circle-radius",this,r)+hl("circle-stroke-width",this,r)+hh(this.paint.get("circle-translate"))}queryIntersectsFeature(i,r,a,c,h,f,_,x){const E=Qp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,i.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a);return ng(i,c,f,_,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,T)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new _o(this,i)}},heatmap:class extends Ui{createBucket(i){return new ig(i)}constructor(i){super(i,by),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){"heatmap-color"===i&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=rf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return hl("heatmap-radius",this,i)}queryIntersectsFeature(i,r,a,c,h,f,_,x){const E=this.paint.get("heatmap-radius").evaluate(r,a);return ng(i,c,f,_,x,!0,!0,new Je(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new _o(this,i)}},hillshade:class extends Ui{constructor(i){super(i,wy)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(i){return new _o(this,i)}},fill:class extends Ui{constructor(i){super(i,vh)}getProgramIds(){const i=this.paint.get("fill-pattern"),r=i&&i.constantOr(1),a=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getProgramConfiguration(i){return new _o(this,i)}recalculate(i,r){super.recalculate(i,r);const a=this.paint._values["fill-outline-color"];"constant"===a.value.kind&&void 0===a.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new df(i)}queryRadius(){return hh(this.paint.get("fill-translate"))}queryIntersectsFeature(i,r,a,c,h,f){return!i.queryGeometry.isAboveHorizon&&eg(Jp(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,i.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends Ui{constructor(i){super(i,Ay)}createBucket(i){return new wh(i)}queryRadius(){return hh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new _o(this,i)}queryIntersectsFeature(i,r,a,c,h,f,_,x,E){const T=Qp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,i.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(r,a),I=this.paint.get("fill-extrusion-base").evaluate(r,a),P=[0,0],z=x&&f.elevation,N=f.elevation?f.elevation.exaggeration():1;if(z){const J=i.tile.getBucket(this).centroidVertexArray,oe=E+1;if(oe<J.length){const ce=J.get(oe);P[0]=ce.a_centroid_pos0,P[1]=ce.a_centroid_pos1}}if(0===P[0]&&1===P[1])return!1;const $=(J=c,oe=I,ce=S,he=T,fe=_,(pe=z?x:null)?function(Ue,De,Ge,Ke,Re,We,tt,Vt,Cn){const qt=[],Zt=[],je=[0,0,0,1];for(const ln of Ue){const tn=[],ar=[];for(const qn of ln){const Br=qn.x+Ke.x,qr=qn.y+Ke.y,cn=uu(Br,qr,De,Ge,We,tt,Vt,Cn);je[0]=Br,je[1]=qr,je[2]=cn.base,je[3]=1,Gt(je,je,Re),je[3]=Math.max(je[3],1e-5);const $t=_g([je[0]/je[3],je[1]/je[3],je[2]/je[3]]);je[0]=Br,je[1]=qr,je[2]=cn.top,je[3]=1,Gt(je,je,Re),je[3]=Math.max(je[3],1e-5);const Zn=_g([je[0]/je[3],je[1]/je[3],je[2]/je[3]]);tn.push($t),ar.push(Zn)}qt.push(tn),Zt.push(ar)}return[qt,Zt]}(J,oe,ce,he,fe,pe,P,N,f.center.lat):function(Ue,De,Ge,Ke,Re){const We=[],tt=[],Vt=Re[8]*De,Cn=Re[9]*De,qt=Re[10]*De,Zt=Re[11]*De,je=Re[8]*Ge,ln=Re[9]*Ge,tn=Re[10]*Ge,ar=Re[11]*Ge;for(const qn of Ue){const Br=[],qr=[];for(const cn of qn){const $t=cn.x+Ke.x,Zn=cn.y+Ke.y,fr=Re[0]*$t+Re[4]*Zn+Re[12],Wn=Re[1]*$t+Re[5]*Zn+Re[13],mr=Re[2]*$t+Re[6]*Zn+Re[14],Nr=Re[3]*$t+Re[7]*Zn+Re[15],Di=fr+Vt,io=Wn+Cn,nn=mr+qt,Ur=Math.max(Nr+Zt,1e-5),gs=fr+je,Rr=Wn+ln,bn=mr+tn,Er=Math.max(Nr+ar,1e-5),Vn=new Je(Di/Ur,io/Ur);Vn.z=nn/Ur,Br.push(Vn);const Mi=new Je(gs/Er,Rr/Er);Mi.z=bn/Er,qr.push(Mi)}We.push(Br),tt.push(qr)}return[We,tt]}(J,oe,ce,he,fe)),q=i.queryGeometry;var J,oe,ce,he,fe,pe;return function(J,oe,ce){let he=1/0;eg(ce,oe)&&(he=gg(ce,oe[0]));for(let fe=0;fe<oe.length;fe++){const pe=oe[fe],Te=J[fe];for(let we=0;we<pe.length-1;we++){const Ze=pe[we],Ue=[Ze,pe[we+1],Te[we+1],Te[we],Ze];Qm(ce,Ue)&&(he=Math.min(he,gg(ce,Ue)))}}return he!==1/0&&he}($[0],$[1],q.isPointQuery()?q.screenBounds:q.screenGeometry)}},line:class extends Ui{constructor(i){super(i,vg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if("line-gradient"===i){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof ks,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,r){super.recalculate(i,r),this.paint._values["line-floorwidth"]=xg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Md(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new _o(this,i)}queryRadius(i){const r=i,a=gf(hl("line-width",this,r),hl("line-gap-width",this,r)),c=hl("line-offset",this,r);return a/2+Math.abs(c)+hh(this.paint.get("line-translate"))}queryIntersectsFeature(i,r,a,c,h,f){if(i.queryGeometry.isAboveHorizon)return!1;const _=Jp(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,i.pixelToTileUnitsFactor),x=i.pixelToTileUnitsFactor/2*gf(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),E=this.paint.get("line-offset").evaluate(r,a);return E&&(c=function(T,S){const I=[],P=new Je(0,0);for(let z=0;z<T.length;z++){const N=T[z],$=[];for(let q=0;q<N.length;q++){const J=N[q-1],oe=N[q],ce=N[q+1],he=0===q?P:oe.sub(J)._unit()._perp(),fe=q===N.length-1?P:ce.sub(oe)._unit()._perp(),pe=he._add(fe)._unit();pe._mult(1/(pe.x*fe.x+pe.y*fe.y)),$.push(pe._mult(S)._add(oe))}I.push($)}return I}(c,E*i.pixelToTileUnitsFactor)),function(T,S,I){for(let P=0;P<S.length;P++){const z=S[P];if(T.length>=3)for(let N=0;N<z.length;N++)if(lu(T,z[N]))return!0;if(_y(T,z,I))return!0}return!1}(_,c,x)}isTileClipped(){return!0}},symbol:kh,background:class extends Ui{constructor(i){super(i,wx)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ui{constructor(i){super(i,Jy)}getProgramIds(){return["raster"]}},sky:class extends Ui{constructor(i){super(i,jg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){"sky-gradient"===i?this._updateColorRamp():"sky-atmosphere-sun"!==i&&"sky-atmosphere-halo-color"!==i&&"sky-atmosphere-color"!==i&&"sky-atmosphere-sun-intensity"!==i||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=rf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}}getCenter(i,r){const a=this.paint.get("sky-type");if("atmosphere"===a){const c=this.paint.get("sky-atmosphere-sun"),h=!c,f=i.style.light,_=f.properties.get("position");return h&&"viewport"===f.properties.get("anchor")&&zn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Gd(_.azimuthal,90-_.polar,r):Gd(c[0],90-c[1],r)}if("gradient"===a){const c=this.paint.get("sky-gradient-center");return Gd(c[0],90-c[1],r)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return"atmosphere"===i?["skyboxCapture","skybox"]:"gradient"===i?["skyboxGradient"]:null}}},{HTMLImageElement:Hd,HTMLCanvasElement:ev,HTMLVideoElement:tv,ImageData:nv,ImageBitmap:Rf}=Pe;class Lf{constructor(r,a,c,h){this.context=r,this.format=c,this.texture=r.gl.createTexture(),this.update(a,h)}update(r,a,c){const{width:h,height:f}=r,{context:_}=this,{gl:x}=_;if(x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!a||!1!==a.premultiply)),c||this.size&&this.size[0]===h&&this.size[1]===f){const{x:E,y:T}=c||{x:0,y:0};r instanceof Hd||r instanceof ev||r instanceof tv||r instanceof nv||Rf&&r instanceof Rf?x.texSubImage2D(x.TEXTURE_2D,0,E,T,x.RGBA,x.UNSIGNED_BYTE,r):x.texSubImage2D(x.TEXTURE_2D,0,E,T,h,f,x.RGBA,x.UNSIGNED_BYTE,r.data)}else this.size=[h,f],r instanceof Hd||r instanceof ev||r instanceof tv||r instanceof nv||Rf&&r instanceof Rf?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,r):x.texImage2D(x.TEXTURE_2D,0,this.format,h,f,0,this.format,x.UNSIGNED_BYTE,r.data);this.useMipmap=Boolean(a&&a.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(r,a){const{context:c}=this,{gl:h}=c;h.bindTexture(h.TEXTURE_2D,this.texture),r!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?r===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:r),this.filter=r),a!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,a),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class Vg{constructor(r,a){this.width=r,this.height=a,this.nextRow=0,this.image=new dl({width:r,height:a}),this.positions={},this.uploaded=!1}getDash(r,a){const c=this.getKey(r,a);return this.positions[c]}trim(){const r=this.width,a=this.height=qi(this.nextRow);this.image.resize({width:r,height:a})}getKey(r,a){return r.join(",")+a}getDashRanges(r,a,c){const h=[];let f=r.length%2==1?-r[r.length-1]*c:0,_=r[0]*c,x=!0;h.push({left:f,right:_,isDash:x,zeroLength:0===r[0]});let E=r[0];for(let T=1;T<r.length;T++){x=!x;const S=r[T];f=E*c,E+=S,_=E*c,h.push({left:f,right:_,isDash:x,zeroLength:0===S})}return h}addRoundDash(r,a,c){const h=a/2;for(let f=-c;f<=c;f++){const _=this.width*(this.nextRow+c+f);let x=0,E=r[x];for(let T=0;T<this.width;T++){T/E.right>1&&(E=r[++x]);const S=Math.abs(T-E.left),I=Math.abs(T-E.right),P=Math.min(S,I);let z;const N=f/c*(h+1);if(E.isDash){const $=h-Math.abs(N);z=Math.sqrt(P*P+$*$)}else z=h-Math.sqrt(P*P+N*N);this.image.data[_+T]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(r,a){for(let E=r.length-1;E>=0;--E){const T=r[E],S=r[E+1];T.zeroLength?r.splice(E,1):S&&S.isDash===T.isDash&&(S.left=T.left,r.splice(E,1))}const c=r[0],h=r[r.length-1];c.isDash===h.isDash&&(c.left=h.left-this.width,h.right=c.right+this.width);const f=this.width*this.nextRow;let _=0,x=r[_];for(let E=0;E<this.width;E++){E/x.right>1&&(x=r[++_]);const T=Math.abs(E-x.left),S=Math.abs(E-x.right),I=Math.min(T,S);this.image.data[f+E]=Math.max(0,Math.min(255,(x.isDash?I:-I)+a+128))}}addDash(r,a){const c=this.getKey(r,a);if(this.positions[c])return this.positions[c];const h="round"===a,f=h?7:0,_=2*f+1;if(this.nextRow+_>this.height)return zn("LineAtlas out of space"),null;0===r.length&&r.push(1);let x=0;for(let S=0;S<r.length;S++)r[S]<0&&(zn("Negative value is found in line dasharray, replacing values with 0"),r[S]=0),x+=r[S];if(0!==x){const S=this.width/x,I=this.getDashRanges(r,this.width,S);h?this.addRoundDash(I,S,f):this.addRegularDash(I,"square"===a?.5*S:0)}const E=this.nextRow+f;this.nextRow+=_;const T={tl:[E,f],br:[x,0]};return this.positions[c]=T,T}}Ye("LineAtlas",Vg);class Cx{constructor(r){this._callback=r,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Tx=Pe.performance;function rv(i){const r=i?i.url.toString():void 0;return Tx.getEntriesByName(r)}class Dx{constructor(){this.tasks={},this.taskQueue=[],Fl(["process"],this),this.invoker=new Cx(this.process),this.nextId=0}add(r,a){const c=this.nextId++,h=function({type:f,isSymbolTile:_,zoom:x}){return x=x||0,"message"===f?0:"maybePrepare"!==f||_?"parseTile"!==f||_?"parseTile"===f&&_?300-x:"maybePrepare"===f&&_?400-x:500:200-x:100-x}(a);if(0===h){co();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:r,metadata:a,priority:h,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){co();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const r=this.pick();if(null===r)return;const a=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let r=null,a=1/0;for(let h=0;h<this.taskQueue.length;h++){const f=this.tasks[this.taskQueue[h]];f.priority<a&&(a=f.priority,r=h)}if(null===r)return null;const c=this.taskQueue[r];return this.taskQueue.splice(r,1),c}remove(){this.invoker.remove()}}function Aa(i,r,a){var c=2*Math.PI*6378137/256/Math.pow(2,a);return[i*c-2*Math.PI*6378137/2,r*c-2*Math.PI*6378137/2]}class yu{constructor(r,a,c){this.z=r,this.x=a,this.y=c,this.key=dc(0,r,r,a,c)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,a){const c=(_=this.y,x=this.z,E=Aa(256*(f=this.x),256*(_=Math.pow(2,x)-_-1),x),T=Aa(256*(f+1),256*(_+1),x),E[0]+","+E[1]+","+T[0]+","+T[1]),h=function(f,_,x){let E,T="";for(let S=f;S>0;S--)E=1<<S-1,T+=(_&E?1:0)+(x&E?2:0);return T}(this.z,this.x,this.y);var f,_,x,E,T;return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===a?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Of{constructor(r,a){this.wrap=r,this.canonical=a,this.key=dc(r,a.z,a.z,a.x,a.y)}}class Ti{constructor(r,a,c,h,f){this.overscaledZ=r,this.wrap=a,this.canonical=new yu(c,+h,+f),this.key=0===a&&r===c?this.canonical.key:dc(a,r,c,h,f)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const a=this.canonical.z-r;return r>this.canonical.z?new Ti(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ti(r,this.wrap,r,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(r,a=!0){if(this.overscaledZ===r&&a)return this.key;if(r>this.canonical.z)return dc(this.wrap*+a,r,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-r;return dc(this.wrap*+a,r,r,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const a=this.canonical.z-r.canonical.z;return 0===r.overscaledZ||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>a&&r.canonical.y===this.canonical.y>>a}children(r){if(this.overscaledZ>=r)return[new Ti(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,c=2*this.canonical.x,h=2*this.canonical.y;return[new Ti(a,this.wrap,a,c,h),new Ti(a,this.wrap,a,c+1,h),new Ti(a,this.wrap,a,c,h+1),new Ti(a,this.wrap,a,c+1,h+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Ti(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Ti(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Of(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function dc(i,r,a,c,h){const f=1<<Math.min(a,22);let _=f*(h%f)+c%f;return i&&a<22&&(_+=f*f*((i<0?-2*i-1:2*i)%(1<<2*(22-a)))),16*(32*_+a)+(r-a)}Ye("CanonicalTileID",yu),Ye("OverscaledTileID",Ti,{omit:["projMatrix"]});class pc{constructor(r,a,c){this.func=r,this.mask=a,this.range=c}}pc.ReadOnly=!1,pc.ReadWrite=!0,pc.disabled=new pc(519,pc.ReadOnly,[0,1]);class Ff{constructor(r,a,c,h,f,_){this.test=r,this.ref=a,this.mask=c,this.fail=h,this.depthFail=f,this.pass=_}}Ff.disabled=new Ff({func:519,mask:0},0,0,7680,7680,7680);class ci{constructor(r,a,c){this.blendFunction=r,this.blendColor=a,this.mask=c}}ci.Replace=[1,0],ci.disabled=new ci(ci.Replace,Qt.transparent,[!1,!1,!1,!1]),ci.unblended=new ci(ci.Replace,Qt.transparent,[!0,!0,!0,!0]),ci.alphaBlended=new ci([1,771],Qt.transparent,[!0,!0,!0,!0]);class vo{constructor(r,a,c){this.enable=r,this.mode=a,this.frontFace=c}}vo.disabled=new vo(!1,1029,2305),vo.backCCW=new vo(!0,1029,2305),vo.backCW=new vo(!0,1029,2304),vo.frontCW=new vo(!0,1028,2304),vo.frontCCW=new vo(!0,1028,2305);class $g{constructor(r){this._stringToNumber={},this._numberToString=[];for(let a=0;a<r.length;a++){const c=r[a];this._stringToNumber[c]=a,this._numberToString[a]=c}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}class Bf{constructor(r,a,c,h,f){this.type="Feature",this._vectorTileFeature=r,r._z=a,r._x=c,r._y=h,this.properties=r.properties,this.id=f}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const a in this)"_geometry"!==a&&"_vectorTileFeature"!==a&&(r[a]=this[a]);return r}}class iv{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,a,c){const h=String(a);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][h]=this.stateChanges[r][h]||{},Xn(this.stateChanges[r][h],c),null===this.deletedStates[r]){this.deletedStates[r]={};for(const f in this.state[r])f!==h&&(this.deletedStates[r][f]=null)}else if(this.deletedStates[r]&&null===this.deletedStates[r][h]){this.deletedStates[r][h]={};for(const f in this.state[r][h])c[f]||(this.deletedStates[r][h][f]=null)}else for(const f in c)this.deletedStates[r]&&this.deletedStates[r][h]&&null===this.deletedStates[r][h][f]&&delete this.deletedStates[r][h][f]}removeFeatureState(r,a,c){if(null===this.deletedStates[r])return;const h=String(a);if(this.deletedStates[r]=this.deletedStates[r]||{},c&&void 0!==a)null!==this.deletedStates[r][h]&&(this.deletedStates[r][h]=this.deletedStates[r][h]||{},this.deletedStates[r][h][c]=null);else if(void 0!==a)if(this.stateChanges[r]&&this.stateChanges[r][h])for(c in this.deletedStates[r][h]={},this.stateChanges[r][h])this.deletedStates[r][h][c]=null;else this.deletedStates[r][h]=null;else this.deletedStates[r]=null}getState(r,a){const c=String(a),h=Xn({},(this.state[r]||{})[c],(this.stateChanges[r]||{})[c]);if(null===this.deletedStates[r])return{};if(this.deletedStates[r]){const f=this.deletedStates[r][a];if(null===f)return{};for(const _ in f)delete h[_]}return h}initializeTileState(r,a){r.setFeatureState(this.state,a)}coalesceChanges(r,a){const c={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const f={};for(const _ in this.stateChanges[h])this.state[h][_]||(this.state[h][_]={}),Xn(this.state[h][_],this.stateChanges[h][_]),f[_]=this.state[h][_];c[h]=f}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const f={};if(null===this.deletedStates[h])for(const _ in this.state[h])f[_]={},this.state[h][_]={};else for(const _ in this.deletedStates[h]){if(null===this.deletedStates[h][_])this.state[h][_]={};else for(const x of Object.keys(this.deletedStates[h][_]))delete this.state[h][_][x];f[_]=this.state[h][_]}c[h]=c[h]||{},Xn(c[h],f)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(c).length)for(const h in r)r[h].setFeatureState(c,a)}}class Gg{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,a){const c=this.toIdx(r,a);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(r,a){return this.leaves[this.toIdx(r,a)]}toIdx(r,a){return a*this.size+r}}function vu(i,r,a,c){let h=0,f=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(c[_])<1e-15){if(a[_]<i[_]||a[_]>r[_])return null}else{const x=1/c[_];let E=(i[_]-a[_])*x,T=(r[_]-a[_])*x;if(E>T){const S=E;E=T,T=S}if(E>h&&(h=E),T<f&&(f=T),h>f)return null}return h}function fc(i,r,a,c,h,f,_,x,E,T,S){const I=c-i,P=h-r,z=f-a,N=_-i,$=x-r,q=E-a,J=S[1]*q-S[2]*$,oe=S[2]*N-S[0]*q,ce=S[0]*$-S[1]*N,he=I*J+P*oe+z*ce;if(Math.abs(he)<1e-15)return null;const fe=1/he,pe=T[0]-i,Te=T[1]-r,we=T[2]-a,Ze=(pe*J+Te*oe+we*ce)*fe;if(Ze<0||Ze>1)return null;const Ue=Te*z-we*P,De=we*I-pe*z,Ge=pe*P-Te*I,Ke=(S[0]*Ue+S[1]*De+S[2]*Ge)*fe;return Ke<0||Ze+Ke>1?null:(N*Ue+$*De+q*Ge)*fe}function Zd(i,r,a){return(i-r)/(a-r)}function mc(i,r,a,c,h,f,_,x,E){const T=1<<a,S=f-c,I=_-h,P=(i+1)/T*S+c,z=(r+0)/T*I+h,N=(r+1)/T*I+h;x[0]=(i+0)/T*S+c,x[1]=z,E[0]=P,E[1]=N}class xu{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(f){const _=Math.ceil(Math.log2(f.dim/8)),x=[];let E=Math.ceil(Math.pow(2,_));const T=1/E,S=(z,N,$,q,J)=>{const oe=q?1:0,ce=(z+1)*$-oe,he=N*$,fe=(N+1)*$-oe;J[0]=z*$,J[1]=he,J[2]=ce,J[3]=fe};let I=new Gg(E);const P=[];for(let z=0;z<E*E;z++){S(z%E,Math.floor(z/E),T,!1,P);const N=yl(P[0],P[1],f),$=yl(P[2],P[1],f),q=yl(P[2],P[3],f),J=yl(P[0],P[3],f);I.minimums.push(Math.min(N,$,q,J)),I.maximums.push(Math.max(N,$,q,J)),I.leaves.push(1)}for(x.push(I),E/=2;E>=1;E/=2){const z=x[x.length-1];I=new Gg(E);for(let N=0;N<E*E;N++){S(N%E,Math.floor(N/E),2,!0,P);const $=z.getElevation(P[0],P[1]),q=z.getElevation(P[2],P[1]),J=z.getElevation(P[2],P[3]),oe=z.getElevation(P[0],P[3]),ce=z.isLeaf(P[0],P[1]),he=z.isLeaf(P[2],P[1]),fe=z.isLeaf(P[2],P[3]),pe=z.isLeaf(P[0],P[3]),Te=Math.min($.min,q.min,J.min,oe.min),we=Math.max($.max,q.max,J.max,oe.max),Ze=ce&&he&&fe&&pe;I.maximums.push(we),I.minimums.push(Te),I.leaves.push(we-Te<=5&&Ze?1:0)}x.push(I)}return x}(this.dem),c=a.length-1,h=a[c];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(a,0,0,c,0)}raycastRoot(r,a,c,h,f,_,x=1){return vu([r,a,-100],[c,h,this.maximums[0]*x],f,_)}raycast(r,a,c,h,f,_,x=1){if(!this.nodeCount)return null;const E=this.raycastRoot(r,a,c,h,f,_,x);if(null==E)return null;const T=[],S=[],I=[],P=[],z=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:N,t:$,nodex:q,nodey:J,depth:oe}=z.pop();if(this.leaves[N]){mc(q,J,oe,r,a,c,h,I,P);const he=1<<oe,fe=(q+0)/he,pe=(q+1)/he,Te=(J+0)/he,we=(J+1)/he,Ze=yl(fe,Te,this.dem)*x,Ue=yl(pe,Te,this.dem)*x,De=yl(pe,we,this.dem)*x,Ge=yl(fe,we,this.dem)*x,Ke=fc(I[0],I[1],Ze,P[0],I[1],Ue,P[0],P[1],De,f,_),Re=fc(P[0],P[1],De,I[0],P[1],Ge,I[0],I[1],Ze,f,_),We=Math.min(null!==Ke?Ke:Number.MAX_VALUE,null!==Re?Re:Number.MAX_VALUE);if(We!==Number.MAX_VALUE)return We;{const tt=sn([],f,_,$);if(gc(Ze,Ue,Ge,De,Zd(tt[0],I[0],P[0]),Zd(tt[1],I[1],P[1]))>=tt[2])return $}continue}let ce=0;for(let he=0;he<this._siblingOffset.length;he++){mc((q<<1)+this._siblingOffset[he][0],(J<<1)+this._siblingOffset[he][1],oe+1,r,a,c,h,I,P),I[2]=-100,P[2]=this.maximums[this.childOffsets[N]+he]*x;const fe=vu(I,P,f,_);if(null!=fe){const pe=fe;T[he]=pe;let Te=!1;for(let we=0;we<ce&&!Te;we++)pe>=T[S[we]]&&(S.splice(we,0,he),Te=!0);Te||(S[ce]=he),ce++}}for(let he=0;he<ce;he++){const fe=S[he];z.push({idx:this.childOffsets[N]+fe,t:T[fe],nodex:(q<<1)+this._siblingOffset[fe][0],nodey:(J<<1)+this._siblingOffset[fe][1],depth:oe+1})}}return null}_addNode(r,a,c){return this.minimums.push(r),this.maximums.push(a),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(r,a,c,h,f){if(1===r[h].isLeaf(a,c))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const _=h-1,x=r[_];let E,T=0;for(let S=0;S<this._siblingOffset.length;S++){const I=2*a+this._siblingOffset[S][0],P=2*c+this._siblingOffset[S][1],z=x.getElevation(I,P),N=x.isLeaf(I,P),$=this._addNode(z.min,z.max,N);N&&(T|=1<<S),E||(E=$)}for(let S=0;S<this._siblingOffset.length;S++)T&1<<S||this._construct(r,2*a+this._siblingOffset[S][0],2*c+this._siblingOffset[S][1],_,E+S)}}function gc(i,r,a,c,h,f){return Ut(Ut(i,a,f),Ut(r,c,f),h)}function yl(i,r,a){const c=a.dim,h=_n(i*c-.5,0,c-1),f=_n(r*c-.5,0,c-1),_=Math.floor(h),x=Math.floor(f),E=Math.min(_+1,c-1),T=Math.min(x+1,c-1);return gc(a.get(_,x),a.get(E,x),a.get(_,T),a.get(E,T),h-_,f-x)}const Nf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Lh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,a,c,h=!1,f=!1){if(this.uid=r,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(c&&"mapbox"!==c&&"terrarium"!==c)return zn(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const _=this.dim=a.height-2;if(this.data=new Uint32Array(a.data.buffer),this.encoding=c||"mapbox",this.borderReady=h,!h){for(let x=0;x<_;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(_,x)]=this.data[this._idx(_-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,_)]=this.data[this._idx(x,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new xu(this)}get(r,a,c=!1){const h=new Uint8Array(this.data.buffer);c&&(r=_n(r,-1,this.dim),a=_n(a,-1,this.dim));const f=4*this._idx(r,a);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(h[f],h[f+1],h[f+2])}static getUnpackVector(r){return Nf[r]}get unpackVector(){return Nf[this.encoding]}_idx(r,a){if(r<-1||r>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(r+1)}_unpackMapbox(r,a,c){return(256*r*256+256*a+c)/10-1e4}_unpackTerrarium(r,a,c){return 256*r+a+c/256-32768}static pack(r,a){const c=[0,0,0,0],h=Lh.getUnpackVector(a);let f=Math.floor((r+h[3])/h[2]);return c[2]=f%256,f=Math.floor(f/256),c[1]=f%256,f=Math.floor(f/256),c[0]=f,c}getPixels(){return new to({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,a,c){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let h=a*this.dim,f=a*this.dim+this.dim,_=c*this.dim,x=c*this.dim+this.dim;switch(a){case-1:h=f-1;break;case 1:f=h+1}switch(c){case-1:_=x-1;break;case 1:x=_+1}const E=-a*this.dim,T=-c*this.dim;for(let S=_;S<x;S++)for(let I=h;I<f;I++)this.data[this._idx(I,S)]=r.data[this._idx(I+E,S+T)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ye("DEMData",Lh),Ye("DemMinMaxQuadTree",xu,{omit:["dem"]});class Uf{constructor(r,a){this.max=r,this.onRemove=a,this.reset()}reset(){for(const r in this.data)for(const a of this.data[r])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(r,a,c){const h=r.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const f={value:a,timeout:void 0};if(void 0!==c&&(f.timeout=setTimeout(()=>{this.remove(r,f)},c)),this.data[h].push(f),this.order.push(h),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const a=this.data[r].shift();return a.timeout&&clearTimeout(a.timeout),0===this.data[r].length&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),a.value}getByKey(r){const a=this.data[r];return a?a[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,a){if(!this.has(r))return this;const c=r.wrapped().key,h=void 0===a?0:this.data[c].indexOf(a),f=this.data[c][h];return this.data[c].splice(h,1),f.timeout&&clearTimeout(f.timeout),0===this.data[c].length&&delete this.data[c],this.onRemove(f.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(r){const a=[];for(const c in this.data)for(const h of this.data[c])r(h.value)||a.push(h);for(const c of a)this.remove(c.value.tileID,c)}}class Pa extends Ss{constructor(r,a,c){super(),this.id=r,this._onlySymbols=c,a.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new Uf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new iv}onAdd(r){this.map=r,this._minTileCacheSize=r?r._minTileCacheSize:null,this._maxTileCacheSize=r?r._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const a=this._tiles[r];if("loaded"!==a.state&&"errored"!==a.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,a){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,a)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const c=this._tiles[a];c.upload(r),c.prepare(this.map.style.imageManager)}}getIds(){return Hi(this._tiles).map(r=>r.tileID).sort(jf).map(r=>r.key)}getRenderableIds(r){const a=[];for(const c in this._tiles)this._isIdRenderable(+c,r)&&a.push(this._tiles[c]);return r?a.sort((c,h)=>{const f=c.tileID,_=h.tileID,x=new Je(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),E=new Je(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-_.overscaledZ||E.y-x.y||E.x-x.x}).map(c=>c.tileID.key):a.map(c=>c.tileID).sort(jf).map(c=>c.key)}hasRenderableParent(r){const a=this.findLoadedParent(r,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(r,a){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(a||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)"errored"!==this._tiles[r].state&&this._reloadTile(+r,"reloading")}}_reloadTile(r,a){const c=this._tiles[r];c&&("loading"!==c.state&&(c.state=a),this._loadTile(c,this._tileLoaded.bind(this,c,r,a)))}_tileLoaded(r,a,c,h){if(h)if(r.state="errored",404!==h.status)this._source.fire(new Lu(h,{tile:r}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=Li.now(),"expired"===c&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(a,r),"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new ur("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const a=this.getRenderableIds();for(let h=0;h<a.length;h++){const f=a[h];if(r.neighboringTiles&&r.neighboringTiles[f]){const _=this.getTileByID(f);c(r,_),c(_,r)}}function c(h,f){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let _=f.tileID.canonical.x-h.tileID.canonical.x;const x=f.tileID.canonical.y-h.tileID.canonical.y,E=Math.pow(2,h.tileID.canonical.z),T=f.tileID.key;0===_&&0===x||Math.abs(x)>1||(Math.abs(_)>1&&(1===Math.abs(_+E)?_+=E:1===Math.abs(_-E)&&(_-=E)),f.dem&&h.dem&&(h.dem.backfillBorder(f.dem,_,x),h.neighboringTiles&&h.neighboringTiles[T]&&(h.neighboringTiles[T].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,a,c,h){for(const f in this._tiles){let _=this._tiles[f];if(h[f]||!_.hasData()||_.tileID.overscaledZ<=a||_.tileID.overscaledZ>c)continue;let x=_.tileID;for(;_&&_.tileID.overscaledZ>a+1;){const T=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[T.key],_&&_.hasData()&&(x=T)}let E=x;for(;E.overscaledZ>a;)if(E=E.scaledTo(E.overscaledZ-1),r[E.key]){h[x.key]=x;break}}}findLoadedParent(r,a){if(r.key in this._loadedParentTiles){const c=this._loadedParentTiles[r.key];return c&&c.tileID.overscaledZ>=a?c:null}for(let c=r.overscaledZ-1;c>=a;c--){const h=r.scaledTo(c),f=this._getLoadedTile(h);if(f)return f}}_getLoadedTile(r){const a=this._tiles[r.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,a){a=a||this._source.tileSize;const c=Math.ceil(r.width/a)+1,h=Math.ceil(r.height/a)+1,f=Math.floor(c*h*5),_="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,f):f,x="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(r){const a=Math.round((r-(void 0===this._prevLng?r:this._prevLng))/360);if(this._prevLng=r,a){const c={};for(const h in this._tiles){const f=this._tiles[h];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+a),c[f.tileID.key]=f}this._tiles=c;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(r,a,c){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let h;this.updateCacheSize(r,a),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new Ti(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(h=r.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(x=>this._source.hasTile(x)))):h=[];const f=this._updateRetainedTiles(h);if(Oh(this._source.type)&&0!==h.length){const x={},E={},T=Object.keys(f);for(const I of T){const P=f[I],z=this._tiles[I];if(!z||z.fadeEndTime&&z.fadeEndTime<=Li.now())continue;const N=this.findLoadedParent(P,Math.max(P.overscaledZ-Pa.maxOverzooming,this._source.minzoom));N&&(this._addTile(N.tileID),x[N.tileID.key]=N.tileID),E[I]=P}const S=h[h.length-1].overscaledZ;for(const I in this._tiles){const P=this._tiles[I];if(f[I]||!P.hasData())continue;let z=P.tileID;for(;z.overscaledZ>S;){z=z.scaledTo(z.overscaledZ-1);const N=this._tiles[z.key];if(N&&N.hasData()&&E[z.key]){f[I]=P.tileID;break}}}for(const I in x)f[I]||(this._coveredTiles[I]=!0,f[I]=x[I])}for(const x in f)this._tiles[x].clearFadeHold();const _=function(x,E){const T=[];for(const S in x)S in E||T.push(S);return T}(this._tiles,f);for(const x of _){const E=this._tiles[x];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const a={};if(0===r.length)return a;const c={},h=r.reduce((T,S)=>Math.min(T,S.overscaledZ),1/0),f=r[0].overscaledZ,_=Math.max(f-Pa.maxOverzooming,this._source.minzoom),x=Math.max(f+Pa.maxUnderzooming,this._source.minzoom),E={};for(const T of r){const S=this._addTile(T);a[T.key]=T,S.hasData()||h<this._source.maxzoom&&(E[T.key]=T)}this._retainLoadedChildren(E,h,x,a);for(const T of r){let S=this._tiles[T.key];if(S.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const P=T.children(this._source.maxzoom)[0],z=this.getTile(P);if(z&&z.hasData()){a[P.key]=P;continue}}else{const P=T.children(this._source.maxzoom);if(a[P[0].key]&&a[P[1].key]&&a[P[2].key]&&a[P[3].key])continue}let I=S.wasRequested();for(let P=T.overscaledZ-1;P>=_;--P){const z=T.scaledTo(P);if(c[z.key]||(c[z.key]=!0,S=this.getTile(z),!S&&I&&(S=this._addTile(z)),S&&(a[z.key]=z,I=S.wasRequested(),S.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const a=[];let c,h=this._tiles[r].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){c=this._loadedParentTiles[h.key];break}a.push(h.key);const f=h.scaledTo(h.overscaledZ-1);if(c=this._getLoadedTile(f),c)break;h=f}for(const f of a)this._loadedParentTiles[f]=c}}_addTile(r){let a=this._tiles[r.key];if(a)return a;a=this._cache.getAndRemove(r),a&&(this._setTileReloadTimer(r.key,a),a.tileID=r,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,a)));const c=Boolean(a);if(!c){const h=this.map?this.map.painter:null,f="raster"===this._source.type||"raster-dem"===this._source.type;a=new Kd(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,h,f),this._loadTile(a,this._tileLoaded.bind(this,a,r.key,a.state))}return a?(a.uses++,this._tiles[r.key]=a,c||this._source.fire(new ur("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(r,a){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const c=a.getExpiryTimeout();c&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},c))}_removeTile(r){const a=this._tiles[r];a&&(a.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),a.uses>0||(a.hasData()&&"reloading"!==a.state?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(r,a,c){const h=[],f=this.transform;if(!f)return h;for(const _ in this._tiles){const x=this._tiles[_];if(c&&x.clearQueryDebugViz(),x.holdingForFade())continue;const E=r.containsTile(x,f,a);E&&h.push(E)}return h}getVisibleCoordinates(r){const a=this.getRenderableIds(r).map(c=>this._tiles[c].tileID);for(const c of a)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(Oh(this._source.type))for(const r in this._tiles){const a=this._tiles[r];if(void 0!==a.fadeEndTime&&a.fadeEndTime>=Li.now())return!0}return!1}setFeatureState(r,a,c){this._state.updateState(r=r||"_geojsonTileLayer",a,c)}removeFeatureState(r,a,c){this._state.removeFeatureState(r=r||"_geojsonTileLayer",a,c)}getFeatureState(r,a){return this._state.getState(r=r||"_geojsonTileLayer",a)}setDependencies(r,a,c){const h=this._tiles[r];h&&h.setDependencies(a,c)}reloadTilesForDependencies(r,a){for(const c in this._tiles)this._tiles[c].hasDependency(r,a)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(r,a))}_preloadTiles(r,a){const c=new Map,h=Array.isArray(r)?r:[r],f=this.map.painter.terrain,_=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const T of h){const S=T.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const I of S)c.set(I.key,I);this.usedForTerrain&&T.updateElevation(!1)}const x=Array.from(c.values()),E="raster"===this._source.type||"raster-dem"===this._source.type;Ga(x,(T,S)=>{const I=new Kd(T,this._source.tileSize*T.overscaleFactor(),this.transform.tileZoom,this.map.painter,E);this._loadTile(I,P=>{"raster-dem"===this._source.type&&I.dem&&this._backfillDEM(I),S(P,I)})},a)}}function jf(i,r){const a=Math.abs(2*i.wrap)-+(i.wrap<0),c=Math.abs(2*r.wrap)-+(r.wrap<0);return i.overscaledZ-r.overscaledZ||c-a||r.canonical.y-i.canonical.y||r.canonical.x-i.canonical.x}function Oh(i){return"raster"===i||"image"===i||"video"===i}Pa.maxOverzooming=10,Pa.maxUnderzooming=3;class Wd{constructor(r,a,c){this._demTile=r,this._dem=this._demTile.dem,this._scale=a,this._offset=c}static create(r,a,c){const h=c||r.findDEMTileFor(a);if(!h||!h.dem)return;const f=h.dem,_=h.tileID,x=1<<a.canonical.z-_.canonical.z;return new Wd(h,h.tileSize/zt/x,[(a.canonical.x/x-_.canonical.x)*f.dim,(a.canonical.y/x-_.canonical.y)*f.dim])}tileCoordToPixel(r,a){const c=a*this._scale+this._offset[1],h=Math.floor(r*this._scale+this._offset[0]),f=Math.floor(c);return new Je(h,f)}getElevationAt(r,a,c,h){const f=r*this._scale+this._offset[0],_=a*this._scale+this._offset[1],x=Math.floor(f),E=Math.floor(_),T=this._dem;return h=!!h,c?Ut(Ut(T.get(x,E,h),T.get(x,E+1,h),_-E),Ut(T.get(x+1,E,h),T.get(x+1,E+1,h),_-E),f-x):T.get(x,E,h)}getElevationAtPixel(r,a,c){return this._dem.get(r,a,!!c)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Pr(1,r)*this._dem.stride}}class Vf{constructor(r,a){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Kc(zt,16,0),this.featureIndexArray=new Gm,this.promoteId=a}insert(r,a,c,h,f,_=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,h,f,_);const E=this.grid;for(let T=0;T<a.length;T++){const S=a[T],I=[1/0,1/0,-1/0,-1/0];for(let P=0;P<S.length;P++){const z=S[P];I[0]=Math.min(I[0],z.x),I[1]=Math.min(I[1],z.y),I[2]=Math.max(I[2],z.x),I[3]=Math.max(I[3],z.y)}I[0]<zt&&I[1]<zt&&I[2]>=0&&I[3]>=0&&E.insert(x,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new fl.VectorTile(new oc(this.rawTileData)).layers,this.sourceLayerCoder=new $g(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,a,c,h){this.loadVTLayers();const f=r.params||{},_=Ku(f.filter),x=r.tileResult,E=r.transform,T=x.bufferedTilespaceBounds,S=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(N,$,q,J)=>yy(x.bufferedTilespaceGeometry,N,$,q,J));S.sort(Hg);let I=null;E.elevation&&S.length>0&&(I=Wd.create(E.elevation,this.tileID));const P={};let z;for(let N=0;N<S.length;N++){const $=S[N];if($===z)continue;z=$;const q=this.featureIndexArray.get($);let J=null;this.loadMatchingFeature(P,q,_,f.layers,f.availableImages,a,c,h,(oe,ce,he,fe=0)=>(J||(J=yo(oe,this.tileID.canonical,r.tileTransform)),ce.queryIntersectsFeature(x,oe,he,J,this.z,r.transform,r.pixelPosMatrix,I,fe)))}return P}loadMatchingFeature(r,a,c,h,f,_,x,E,T){const{featureIndex:S,bucketIndex:I,sourceLayerIndex:P,layoutVertexArrayOffset:z}=a,N=this.bucketLayerIDs[I];if(h&&!function(oe,ce){for(let he=0;he<oe.length;he++)if(ce.indexOf(oe[he])>=0)return!0;return!1}(h,N))return;const $=this.sourceLayerCoder.decode(P),q=this.vtLayers[$].feature(S);if(c.needGeometry){const oe=ec(q,!0);if(!c.filter(new gt(this.tileID.overscaledZ),oe,this.tileID.canonical))return}else if(!c.filter(new gt(this.tileID.overscaledZ),q))return;const J=this.getId(q,$);for(let oe=0;oe<N.length;oe++){const ce=N[oe];if(h&&h.indexOf(ce)<0)continue;const he=_[ce];if(!he)continue;let fe={};void 0!==J&&E&&(fe=E.getState(he.sourceLayer||"_geojsonTileLayer",J));const pe=Xn({},x[ce]);pe.paint=ov(pe.paint,he.paint,q,fe,f),pe.layout=ov(pe.layout,he.layout,q,fe,f);const Te=!T||T(q,he,fe,z);if(!Te)continue;const we=new Bf(q,this.z,this.x,this.y,J);we.layer=pe;let Ze=r[ce];void 0===Ze&&(Ze=r[ce]=[]),Ze.push({featureIndex:S,feature:we,intersectionZ:Te})}}lookupSymbolFeatures(r,a,c,h,f,_,x,E){const T={};this.loadVTLayers();const S=Ku(f);for(const I of r)this.loadMatchingFeature(T,{bucketIndex:c,sourceLayerIndex:h,featureIndex:I,layoutVertexArrayOffset:0},S,_,x,E,a);return T}loadFeature(r){const{featureIndex:a,sourceLayerIndex:c}=r;this.loadVTLayers();const h=this.sourceLayerCoder.decode(c),f=this.vtFeatures[h];if(f[a])return f[a];const _=this.vtLayers[h].feature(a);return f[a]=_,_}hasLayer(r){for(const a of this.bucketLayerIDs)for(const c of a)if(r===c)return!0;return!1}getId(r,a){let c=r.id;return this.promoteId&&(c=r.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[a]],"boolean"==typeof c&&(c=Number(c))),c}}function ov(i,r,a,c,h){return Js(i,(f,_)=>{const x=r instanceof Ea?r.get(_):null;return x&&x.evaluate?x.evaluate(a,c,h):x})}function Hg(i,r){return r-i}Ye("FeatureIndex",Vf,{omit:["rawTileData","sourceLayerCoder"]});var qg=jn([{name:"a_pos",type:"Int16",components:2}]);const vl=new Uint16Array(8184);for(let i=0;i<2046;i++){let r=i+2,a=0,c=0,h=0,f=0,_=0,x=0;for(1&r?h=f=_=32:a=c=x=32;(r>>=1)>1;){const T=a+h>>1,S=c+f>>1;1&r?(h=a,f=c,a=_,c=x):(a=h,c=f,h=_,f=x),_=T,x=S}const E=4*i;vl[E+0]=a,vl[E+1]=c,vl[E+2]=h,vl[E+3]=f}const $s=new Uint16Array(2178),kr=new Uint8Array(1089),Xd=new Uint16Array(1089);function Zg(i){return 0===i?-.03125:32===i?.03125:0}var Wg=jn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const sv={type:2,extent:zt,loadGeometry:()=>[[new Je(0,0),new Je(8193,0),new Je(8193,8193),new Je(0,8193),new Je(0,0)]]};class Kd{constructor(r,a,c,h,f){this.tileID=r,this.uid=Ol(),this.uses=0,this.tileSize=a,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(r){const a=r+this.timeAdded;a<Li.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=bl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,a,c){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(h,f){const _={};if(!f)return _;for(const x of h){const E=x.layerIds.map(T=>f.getLayer(T)).filter(Boolean);if(0!==E.length){x.layers=E,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(T=>E.filter(S=>S.id===T)[0]));for(const T of E)_[T.id]=x}}return _}(r.buckets,a.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const f=this.buckets[h];if(f instanceof _l){if(this.hasSymbolBuckets=!0,!c)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const f=this.buckets[h];if(f instanceof _l&&f.hasRTLText){this.hasRTLText=!0,Ht.isLoading()||Ht.isLoaded()||"deferred"!==ii()||Yi();break}}this.queryPadding=0;for(const h in this.buckets){const f=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(h).queryRadius(f))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new $m}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const c in this.buckets){const h=this.buckets[c];h.uploadPending()&&h.upload(r)}const a=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Lf(r,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Lf(r,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Lf(r,this.lineAtlas.image,a.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,a,c,h,f,_,x,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:x,transform:_,params:f,tileTransform:this.tileTransform},r,a,c):{}}querySourceFeatures(r,a){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const h=c.loadVTLayers(),f=a?a.sourceLayer:"",_=h._geojsonTileLayer||h[f];if(!_)return;const x=Ku(a&&a.filter),{z:E,x:T,y:S}=this.tileID.canonical,I={z:E,x:T,y:S};for(let P=0;P<_.length;P++){const z=_.feature(P);if(x.needGeometry){const q=ec(z,!0);if(!x.filter(new gt(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!x.filter(new gt(this.tileID.overscaledZ),z))continue;const N=c.getId(z,f),$=new Bf(z,E,T,S,N);$.tile=I,r.push($)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const a=this.expirationTime;if(r.cacheControl){const c=ea(r.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const c=Date.now();let h=!1;if(this.expirationTime>c)h=!1;else if(a)if(this.expirationTime<a)h=!0;else{const f=this.expirationTime-a;f?this.expirationTime=c+Math.max(f,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(r,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(r).length||!a)return;const c=this.latestFeatureIndex.loadVTLayers(),h=a.style.listImages();for(const f in this.buckets){if(!a.style.hasLayer(f))continue;const _=this.buckets[f],x=_.layers[0].sourceLayer||"_geojsonTileLayer",E=c[x],T=r[x];if(!E||!T||0===Object.keys(T).length)continue;if(_.update(T,E,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof Md||_ instanceof df){const I=a.style._getSourceCache(_.layers[0].source);a._terrain&&a._terrain.enabled&&I&&_.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(I.id,this.tileID)}const S=a&&a.style&&a.style.getLayer(f);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Li.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=Li.now()+r}setDependencies(r,a){const c={};for(const h of a)c[h]=!0;this.dependencies[r]=c}hasDependency(r,a){for(const c of r){const h=this.dependencies[c];if(h)for(const f of a)if(h[f])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,a){if(!a||"mercator"===a.name||this._tileDebugBuffer)return;const c=yo(sv,this.tileID.canonical,this.tileTransform)[0],h=new Jc,f=new $p;for(let _=0;_<c.length;_++){const{x,y:E}=c[_];h.emplaceBack(x,E),f.emplaceBack(_)}f.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(f),this._tileDebugBuffer=r.createVertexBuffer(h,Wg.members),this._tileDebugSegments=et.simpleSegment(0,0,h.length,f.length)}_makeTileBoundsBuffers(r,a){if(this._tileBoundsBuffer||!a||"mercator"===a.name)return;const c=yo(sv,this.tileID.canonical,this.tileTransform)[0];let h,f;if(this.isRaster){const _=function(x,E){const T=bl(x,E),S=Math.pow(2,x.z);for(let q=0;q<33;q++)for(let J=0;J<33;J++){const oe=Us((x.x+(J+Zg(J))/32)/S),ce=ai((x.y+(q+Zg(q))/32)/S),he=E.project(oe,ce),fe=33*q+J;$s[2*fe+0]=Math.round((he.x*T.scale-T.x)*zt),$s[2*fe+1]=Math.round((he.y*T.scale-T.y)*zt)}kr.fill(0),Xd.fill(0);for(let q=2045;q>=0;q--){const J=4*q,oe=vl[J+0],ce=vl[J+1],he=vl[J+2],fe=vl[J+3],pe=oe+he>>1,Te=ce+fe>>1,we=pe+Te-ce,Ze=Te+oe-pe,Ue=33*ce+oe,De=33*fe+he,Ge=33*Te+pe,Ke=Math.hypot(($s[2*Ue+0]+$s[2*De+0])/2-$s[2*Ge+0],($s[2*Ue+1]+$s[2*De+1])/2-$s[2*Ge+1])>=16;if(kr[Ge]=kr[Ge]||(Ke?1:0),q<1022){const Re=33*(ce+Ze>>1)+(oe+we>>1),We=33*(fe+Ze>>1)+(he+we>>1);kr[Ge]=kr[Ge]||kr[Re]||kr[We]}}const I=new Ca,P=new Hr;let z=0;function N(q,J){const oe=33*J+q;return 0===Xd[oe]&&(I.emplaceBack($s[2*oe+0],$s[2*oe+1],q*zt/32,J*zt/32),Xd[oe]=++z),Xd[oe]-1}function $(q,J,oe,ce,he,fe){const pe=q+oe>>1,Te=J+ce>>1;if(Math.abs(q-he)+Math.abs(J-fe)>1&&kr[33*Te+pe])$(he,fe,q,J,pe,Te),$(oe,ce,he,fe,pe,Te);else{const we=N(q,J),Ze=N(oe,ce),Ue=N(he,fe);P.emplaceBack(we,Ze,Ue)}}return $(0,0,32,32,32,0),$(32,32,0,0,0,32),{vertices:I,indices:P}}(this.tileID.canonical,a);h=_.vertices,f=_.indices}else{h=new Ca,f=new Hr;for(const{x,y:E}of c)h.emplaceBack(x,E,0,0);const _=Ed(h.int16,void 0,4);for(let x=0;x<_.length;x+=3)f.emplaceBack(_[x],_[x+1],_[x+2])}this._tileBoundsBuffer=r.createVertexBuffer(h,Wg.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(f),this._tileBoundsSegments=et.simpleSegment(0,0,h.length,f.length)}}const Mx=jn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),av=jn([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Yd}=Mx;function xl(i,r){const a=i.fovAboveCenter,c=i.elevation?i.elevation.getMinElevationBelowMSL()*r:0,h=(i._camera.position[2]*i.worldSize-c)/Math.cos(i._pitch),f=Math.sin(a)*h/Math.sin(Math.max(Math.PI/2-i._pitch-a,.01)),_=Math.sin(i._pitch)*f+h;return Math.min(1.01*_,h*(1/i._horizonShift))}const $f=zt/Math.PI/2,no=-$f,ro=$f,Xg=[new hs([no,no,no],[ro,ro,ro]),new hs([no,no,no],[0,0,ro]),new hs([0,no,no],[ro,0,ro]),new hs([no,0,no],[0,ro,ro]),new hs([0,0,no],[ro,ro,ro])];function Jd(i){if(i.z<=1)return Xg[i.z+2*i.y+i.x];const[r,a]=Gf(i),c=[Qd(r[0],r[1]),Qd(r[0],a[1]),Qd(a[0],r[1]),Qd(a[0],a[1])],h=[ro,ro,ro],f=[no,no,no];for(const _ of c)h[0]=Math.min(h[0],_[0]),h[1]=Math.min(h[1],_[1]),h[2]=Math.min(h[2],_[2]),f[0]=Math.max(f[0],_[0]),f[1]=Math.max(f[1],_[1]),f[2]=Math.max(f[2],_[2]);return new hs(h,f)}function Gf(i){const r=Math.pow(2,i.z),a=i.x/r,c=(i.x+1)/r,h=(i.y+1)/r;return[[ai(i.y/r),Us(a)],[ai(h),Us(c)]]}function Hf(i,r,a,c){return a=Nt(a),c||(c=$f),[i*Math.sin(a)*c,-r*c,i*Math.cos(a)*c]}function Qd(i,r,a){return Hf(Math.cos(Nt(i)),Math.sin(Nt(i)),r,a)}function qf(i){return 16383/Math.max(...Es([],i.max,i.min))}function Zf(i){const r=fi(new Float64Array(16)),a=1/qf(i);return so(r,r,i.min),Tr(r,r,[a,a,a]),r}function Kg(i,r,a){const c=r/(2*Math.PI),h=function(_){const x=zt/(2*Math.PI);return _/(2*Math.PI)/x}(r);if(!a){const _=_n(i.center.lat,-85.051129,us);a=[iu(i.center.lng)*r,Ns(_)*r]}const f=fi(new Float64Array(16));return so(f,f,[a[0],a[1],-c]),Tr(f,f,[h,h,h]),Zo(f,f,Nt(-i._center.lat)),To(f,f,Nt(-i._center.lng)),f}class Vo{constructor(r){const a=this._createGridIndices();this.gridIndexBuffer=r.createIndexBuffer(a,!0),this.gridSegments=et.simpleSegment(0,0,4225,8192);const c=this._createPoleTriangleIndices();this.poleIndexBuffer=r.createIndexBuffer(c,!0),this.poleSegments=et.simpleSegment(0,0,66,64);const h=new ah;h.emplaceBack(-1,1,1,0,0,0,0),h.emplaceBack(1,1,1,0,0,1,0),h.emplaceBack(1,-1,1,0,0,1,1),h.emplaceBack(-1,-1,1,0,0,0,1);const f=new Hr;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.atmosphereVertexBuffer=r.createVertexBuffer(h,av.members),this.atmosphereIndexBuffer=r.createIndexBuffer(f),this.atmosphereSegments=et.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(r,a,c){const h=new ah,f=a/Math.PI/2;h.emplaceBack(0,-f,0,0,0,.5,c?0:1);const _=360/r,x=Math.cos(Nt(85)),E=Math.sin(Nt(85));for(let S=0;S<=64;S++){const I=S/64,P=Hf(x,E,0*(1-(T=I))+_*T,f);h.emplaceBack(P[0],P[1],P[2],0,0,I,c?0:1)}var T;return h}_createPoleTriangleIndices(){const r=new Hr;for(let a=0;a<=64;a++)r.emplaceBack(0,a+1,a+2);return r}static createGridVertices(r){const a=Math.pow(2,r.z),c=(E,T,S)=>E*(1-S)+T*S,[h,f]=Gf(r),_=new ah,x=function(E){const T=fi(new Float64Array(16)),S=qf(E);var I,P;return Tr(T,T,[S,S,S]),so(T,T,((I=[])[0]=-(P=E.min)[0],I[1]=-P[1],I[2]=-P[2],I)),T}(Jd(r));_.reserve(4096);for(let E=0;E<65;E++){const T=c(h[0],f[0],E/64),S=Ns(T),I=S*a-r.y,P=Math.sin(Nt(T)),z=Math.cos(Nt(T));for(let N=0;N<65;N++){const $=N/64,q=c(h[1],f[1],$),J=Hf(z,P,q);Xt(J,J,x);const oe=iu(q);_.emplaceBack(J[0],J[1],J[2],oe,S,$,I)}}return _}_createGridIndices(){const r=new Hr,a=(c,h)=>{const f=65*h+c;r.emplaceBack(f+1,f,f+65),r.emplaceBack(f+65,f+65+1,f+1)};for(let c=0;c<64;c++)for(let h=0;h<64;h++)a(h,c);return r}getWirefameBuffer(r){if(!this.wireframeSegments){const a=this._createWireframeGrid();this.wireframeIndexBuffer=r.createIndexBuffer(a),this.wireframeSegments=et.simpleSegment(0,0,4096,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const r=new ul,a=(c,h)=>{const f=65*h+c;r.emplaceBack(f,f+1),r.emplaceBack(f,f+65),r.emplaceBack(f,f+65+1)};for(let c=0;c<64;c++)for(let h=0;h<64;h++)a(h,c);return r}}function bl(i,r){if(!r.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:r};const a=Math.pow(2,-i.z),c=i.x*a,h=(i.x+1)*a,f=i.y*a,_=(i.y+1)*a,x=Us(c),E=Us(h),T=ai(f),S=ai(_),I=r.project(x,T),P=r.project(E,T),z=r.project(E,S),N=r.project(x,S);let $=Math.min(I.x,P.x,z.x,N.x),q=Math.min(I.y,P.y,z.y,N.y),J=Math.max(I.x,P.x,z.x,N.x),oe=Math.max(I.y,P.y,z.y,N.y);const ce=a/16;function he(pe,Te,we,Ze,Ue,De){const Ge=(we+Ue)/2,Ke=(Ze+De)/2,Re=r.project(Us(Ge),ai(Ke)),We=Math.max(0,$-Re.x,q-Re.y,Re.x-J,Re.y-oe);$=Math.min($,Re.x),J=Math.max(J,Re.x),q=Math.min(q,Re.y),oe=Math.max(oe,Re.y),We>ce&&(he(pe,Re,we,Ze,Ge,Ke),he(Re,Te,Ge,Ke,Ue,De))}he(I,P,c,f,h,f),he(P,z,h,f,h,_),he(z,N,h,_,c,_),he(N,I,c,_,c,f),$-=ce,q-=ce,J+=ce,oe+=ce;const fe=1/Math.max(J-$,oe-q);return{scale:fe,x:$*fe,y:q*fe,x2:J*fe,y2:oe*fe,projection:r}}class Yg{constructor(r){const a={},c=[];for(const x in r){const E=r[x],T=a[x]={};for(const S in E.glyphs){const I=E.glyphs[+S];if(!I||0===I.bitmap.width||0===I.bitmap.height)continue;const P=I.metrics.localGlyph?2:1,z={x:0,y:0,w:I.bitmap.width+2*P,h:I.bitmap.height+2*P};c.push(z),T[S]=z}}const{w:h,h:f}=Pd(c),_=new dl({width:h||1,height:f||1});for(const x in r){const E=r[x];for(const T in E.glyphs){const S=E.glyphs[+T];if(!S||0===S.bitmap.width||0===S.bitmap.height)continue;const I=a[x][T],P=S.metrics.localGlyph?2:1;dl.copy(S.bitmap,_,{x:0,y:0},{x:I.x+P,y:I.y+P},S.bitmap)}}this.image=_,this.positions=a}}Ye("GlyphAtlas",Yg);class lv{constructor(r){this.tileID=new Ti(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=bl(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,a,c,h,f){this.status="parsing",this.data=r,this.collisionBoxArray=new $m;const _=new $g(Object.keys(r.layers).sort()),x=new Vf(this.tileID,this.promoteId);x.bucketLayerIDs=[];const E={},T=new Vg(256,256),S={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:T,availableImages:c},I=a.familiesBySource[this.source];for(const fe in I){const pe=r.layers[fe];if(!pe)continue;let Te=!1,we=!1;for(const De of I[fe])"symbol"===De[0].type?Te=!0:we=!0;if(!0===this.isSymbolTile&&!Te||!1===this.isSymbolTile&&!we)continue;1===pe.version&&zn(`Vector tile source "${this.source}" layer "${fe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ze=_.encode(fe),Ue=[];for(let De=0;De<pe.length;De++){const Ge=pe.feature(De),Ke=x.getId(Ge,fe);Ue.push({feature:Ge,id:Ke,index:De,sourceLayerIndex:Ze})}for(const De of I[fe]){const Ge=De[0];void 0!==this.isSymbolTile&&"symbol"===Ge.type!==this.isSymbolTile||Ge.minzoom&&this.zoom<Math.floor(Ge.minzoom)||Ge.maxzoom&&this.zoom>=Ge.maxzoom||"none"!==Ge.visibility&&(Jg(De,this.zoom,c),(E[Ge.id]=Ge.createBucket({index:x.bucketLayerIDs.length,layers:De,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ze,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:c})).populate(Ue,S,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(De.map(Ke=>Ke.id)))}}let P,z,N,$;T.trim();const q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},J=Js(S.glyphDependencies,fe=>Object.keys(fe).map(Number));Object.keys(J).length?h.send("getGlyphs",{uid:this.uid,stacks:J},(fe,pe)=>{P||(P=fe,z=pe,he.call(this))},void 0,!1,q):z={};const oe=Object.keys(S.iconDependencies);oe.length?h.send("getImages",{icons:oe,source:this.source,tileID:this.tileID,type:"icons"},(fe,pe)=>{P||(P=fe,N=pe,he.call(this))},void 0,!1,q):N={};const ce=Object.keys(S.patternDependencies);function he(){if(P)return f(P);if(z&&N&&$){const fe=new Yg(z),pe=new Ig(N,$);for(const Te in E){const we=E[Te];we instanceof _l?(Jg(we.layers,this.zoom,c),Fg(we,z,fe.positions,N,pe.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection),we.projection=this.projection.name):we.hasPattern&&(we instanceof Md||we instanceof df||we instanceof wh)&&(Jg(we.layers,this.zoom,c),we.addFeatures(S,this.tileID.canonical,pe.patternPositions,c))}this.status="done",f(null,{buckets:Hi(E).filter(Te=>!Te.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:fe.image,lineAtlas:T,imageAtlas:pe,glyphMap:this.returnDependencies?z:null,iconMap:this.returnDependencies?N:null,glyphPositions:this.returnDependencies?fe.positions:null})}}ce.length?h.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"patterns"},(fe,pe)=>{P||(P=fe,$=pe,he.call(this))},void 0,!1,q):$={},he.call(this)}}function Jg(i,r,a){const c=new gt(r);for(const h of i)h.recalculate(c,a)}class Wf{constructor(r){this.entries={},this.scheduler=r}request(r,a,c,h){const f=this.entries[r]=this.entries[r]||{callbacks:[]};if(f.result){const[_,x]=f.result;return this.scheduler?this.scheduler.add(()=>{h(_,x)},a):h(_,x),()=>{}}return f.callbacks.push(h),f.cancel||(f.cancel=c((_,x)=>{f.result=[_,x];for(const E of f.callbacks)this.scheduler?this.scheduler.add(()=>{E(_,x)},a):E(_,x);setTimeout(()=>delete this.entries[r],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(_=>_!==h),f.callbacks.length||(f.cancel(),delete this.entries[r]))}}}function Qg(i,r,a){const c=JSON.stringify(i.request);return i.data&&(this.deduped.entries[c]={result:[null,i.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},h=>{const f=Wa(i.request,(_,x,E,T)=>{_?h(_):x&&h(null,{vectorTile:a?void 0:new fl.VectorTile(new oc(x)),rawData:x,cacheControl:E,expires:T})});return()=>{f.cancel(),h()}},r)}const cv=fi(new Float64Array(16));class _c{constructor(r,a){this._tr=r,this._worldSize=a}createInversionMatrix(){return cv}createTileMatrix(r){let a,c,h;const f=r.canonical,_=fi(new Float64Array(16)),x=this._tr.projection;if(x.isReprojectedInTileSpace){const E=bl(f,x);a=1,c=E.x+r.wrap*E.scale,h=E.y,Tr(_,_,[a/E.scale,a/E.scale,this._tr.pixelsPerMeter/this._worldSize])}else a=this._worldSize/this._tr.zoomScale(f.z),c=(f.x+Math.pow(2,f.z)*r.wrap)*a,h=f.y*a;return so(_,_,[c,h,0]),Tr(_,_,[a/zt,a/zt,1]),_}pointCoordinate(r,a,c){const h=this._tr.horizonLineFromTop(!1),f=new Je(r,Math.max(h,a));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(f,c))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var Xf={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Lc(this.parallels,this.constants.parallels))return;const i=Math.sin(Nt(this.parallels[0])),r=(i+Math.sin(Nt(this.parallels[1])))/2,a=1+i*(2*r-i),c=Math.sqrt(a)/r;this.constants={n:r,c:a,r0:c,parallels:this.parallels}},project(i,r){this.initializeConstants();const a=Nt(i-this.center[0]),c=Nt(r),{n:h,c:f,r0:_}=this.constants,x=Math.sqrt(f-2*h*Math.sin(c))/h;return{x:x*Math.sin(a*h),y:x*Math.cos(a*h)-_,z:0}},unproject(i,r){this.initializeConstants();const{n:a,c,r0:h}=this.constants,f=h+r;let _=Math.atan2(i,Math.abs(f))*Math.sign(f);f*a<0&&(_-=Math.PI*Math.sign(i)*Math.sign(f));const x=Nt(this.center[0])*a;_=Cs(_,-Math.PI-x,Math.PI-x);const E=Pi(_/a)+this.center[0],T=Math.asin(_n((c-(i*i+f*f)*a*a)/(2*a),-1,1)),S=_n(Pi(T),-85.051129,us);return new an(E,S)},projectTilePoint:(i,r)=>({x:i,y:r,z:0}),locationPoint:(i,r)=>i._coordinatePoint(i.locationCoordinate(r),!1),pixelsPerMeter:(i,r)=>Pr(1,i)*r,farthestPixelDistance(i){return xl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,r)=>new _c(i,r)};const Fh=1.340264,zh=-.081106,wl=893e-6,yc=.003796,ep=Math.sqrt(3)/2;var Kf={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(i,r){r=r/180*Math.PI,i=i/180*Math.PI;const a=Math.asin(ep*Math.sin(r)),c=a*a,h=c*c*c;return{x:.5*(i*Math.cos(a)/(ep*(Fh+3*zh*c+h*(7*wl+9*yc*c)))/Math.PI+.5),y:1-.5*(a*(Fh+zh*c+h*(wl+yc*c))/Math.PI+1),z:0}},unproject(i,r){i=(2*i-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,c=a*a,h=c*c*c;for(let T,S,I,P=0;P<12&&(S=a*(Fh+zh*c+h*(wl+yc*c))-r,I=Fh+3*zh*c+h*(7*wl+9*yc*c),T=S/I,a=_n(a-T,-Math.PI/3,Math.PI/3),c=a*a,h=c*c*c,!(Math.abs(T)<1e-12));++P);const f=ep*i*(Fh+3*zh*c+h*(7*wl+9*yc*c))/Math.cos(a),_=Math.asin(Math.sin(a)/ep),x=_n(180*f/Math.PI,-180,180),E=_n(180*_/Math.PI,-85.051129,us);return new an(x,E)},projectTilePoint:(i,r)=>({x:i,y:r,z:0}),locationPoint:(i,r)=>i._coordinatePoint(i.locationCoordinate(r),!1),pixelsPerMeter:(i,r)=>Pr(1,i)*r,farthestPixelDistance(i){return xl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,r)=>new _c(i,r)},Yf={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(i,r)=>({x:.5+i/360,y:.5-r/360,z:0}),unproject(i,r){const a=360*(i-.5),c=_n(360*(.5-r),-85.051129,us);return new an(a,c)},projectTilePoint:(i,r)=>({x:i,y:r,z:0}),locationPoint:(i,r)=>i._coordinatePoint(i.locationCoordinate(r),!1),pixelsPerMeter:(i,r)=>Pr(1,i)*r,farthestPixelDistance(i){return xl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,r)=>new _c(i,r)};const vc=Math.PI/2;function tp(i){return Math.tan((vc+i)/2)}var uv={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Lc(this.parallels,this.constants.parallels))return;const i=Nt(this.parallels[0]),r=Nt(this.parallels[1]),a=Math.cos(i),c=i===r?Math.sin(i):Math.log(a/Math.cos(r))/Math.log(tp(r)/tp(i)),h=a*Math.pow(tp(i),c)/c;this.constants={n:c,f:h,parallels:this.parallels}},project(i,r){this.initializeConstants(),r=Nt(r),i=Nt(i-this.center[0]);const a=1e-6,{n:c,f:h}=this.constants;h>0?r<-vc+a&&(r=-vc+a):r>vc-a&&(r=vc-a);const f=h/Math.pow(tp(r),c),_=f*Math.sin(c*i),x=h-f*Math.cos(c*i);return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+.5),z:0}},unproject(i,r){this.initializeConstants(),i=(2*i-.5)*Math.PI,r=(2*(1-r)-.5)*Math.PI;const{n:a,f:c}=this.constants,h=c-r,f=Math.sign(h),_=Math.sign(a)*Math.sqrt(i*i+h*h);let x=Math.atan2(i,Math.abs(h))*f;h*a<0&&(x-=Math.PI*Math.sign(i)*f);const E=_n(Pi(x/a)+this.center[0],-180,180),T=_n(Pi(2*Math.atan(Math.pow(c/_,1/a))-vc),-85.051129,us);return new an(E,T)},projectTilePoint:(i,r)=>({x:i,y:r,z:0}),locationPoint:(i,r)=>i._coordinatePoint(i.locationCoordinate(r),!1),pixelsPerMeter:(i,r)=>Pr(1,i)*r,farthestPixelDistance(i){return xl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,r)=>new _c(i,r)},Jf={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(i,r)=>({x:iu(i),y:Ns(r),z:0}),unproject(i,r){const a=Us(i),c=ai(r);return new an(a,c)},projectTilePoint:(i,r)=>({x:i,y:r,z:0}),locationPoint:(i,r)=>i._coordinatePoint(i.locationCoordinate(r),!1),pixelsPerMeter:(i,r)=>Pr(1,i)*r,farthestPixelDistance(i){return xl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,r)=>new _c(i,r)};const hv=Nt(us);var dv={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(i,r){const a=(r=Nt(r))*r,c=a*a;return{x:.5*((i=Nt(i))*(.8707-.131979*a+c*(c*(.003971*a-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+a*(.015085+c*(.028874*a-.044475-.005916*c)))/Math.PI+1),z:0}},unproject(i,r){i=(2*i-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,c=25,h=0,f=a*a;do{f=a*a;const E=f*f;h=(a*(1.007226+f*(.015085+E*(.028874*f-.044475-.005916*E)))-r)/(1.007226+f*(.045255+E*(.259866*f-.311325-.005916*11*E))),a=_n(a-h,-hv,hv)}while(Math.abs(h)>1e-6&&--c>0);f=a*a;const _=_n(Pi(i/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),x=Pi(a);return new an(_,x)},projectTilePoint:(i,r)=>({x:i,y:r,z:0}),locationPoint:(i,r)=>i._coordinatePoint(i.locationCoordinate(r),!1),pixelsPerMeter:(i,r)=>Pr(1,i)*r,farthestPixelDistance(i){return xl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,r)=>new _c(i,r)};const Qf=Nt(us),em={albers:Xf,equalEarth:Kf,equirectangular:Yf,lambertConformalConic:uv,mercator:Jf,naturalEarth:dv,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(i,r){r=Nt(r),i=Nt(i);const a=Math.cos(r),c=2/Math.PI,h=Math.acos(a*Math.cos(i/2)),f=Math.sin(h)/h,_=.5*(i*c+2*a*Math.sin(i/2)/f)||0,x=.5*(r+Math.sin(r)/f)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}},unproject(i,r){let a=i=(2*i-.5)*Math.PI,c=r=(2*(1-r)-1)*Math.PI,h=25;const f=1e-6;let _=0,x=0;do{const E=Math.cos(c),T=Math.sin(c),S=2*T*E,I=T*T,P=E*E,z=Math.cos(a/2),N=Math.sin(a/2),$=2*z*N,q=N*N,J=1-P*z*z,oe=J?1/J:0,ce=J?Math.acos(E*z)*Math.sqrt(1/J):0,he=.5*(2*ce*E*N+2*a/Math.PI)-i,fe=.5*(ce*T+c)-r,pe=.5*oe*(P*q+ce*E*z*I)+1/Math.PI,Te=oe*($*S/4-ce*T*N),we=.125*oe*(S*N-ce*T*P*$),Ze=.5*oe*(I*z+ce*q*E)+.5,Ue=Te*we-Ze*pe;_=(fe*Te-he*Ze)/Ue,x=(he*we-fe*pe)/Ue,a=_n(a-_,-Math.PI,Math.PI),c=_n(c-x,-Qf,Qf)}while((Math.abs(_)>f||Math.abs(x)>f)&&--h>0);return new an(Pi(a),Pi(c))},projectTilePoint:(i,r)=>({x:i,y:r,z:0}),locationPoint:(i,r)=>i._coordinatePoint(i.locationCoordinate(r),!1),pixelsPerMeter:(i,r)=>Pr(1,i)*r,farthestPixelDistance(i){return xl(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,r)=>new _c(i,r)}};p.ARRAY_TYPE=Ln,p.AUTH_ERR_MSG=ye,p.Aabb=hs,p.Actor=class{constructor(i,r,a){this.target=i,this.parent=r,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Fl(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=co()?i:Pe,this.scheduler=new Dx}send(i,r,a,c,h=!1,f){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=f,this.callbacks[_]=a);const x=So(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:i,hasCallback:!!a,targetMapId:c,mustQueue:h,sourceMapId:this.mapId,data:Ni(r,x)},x),{cancel:()=>{a&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(i){const r=i.data,a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const c=this.cancelCallbacks[a];delete this.cancelCallbacks[a],c&&c.cancel()}else if(r.mustQueue||co()){const c=this.callbacks[a];this.cancelCallbacks[a]=this.scheduler.add(()=>this.processTask(a,r),c&&c.metadata||{type:"message"})}else this.processTask(a,r)}processTask(i,r){if("<response>"===r.type){const a=this.callbacks[i];delete this.callbacks[i],a&&(r.error?a(Bs(r.error)):a(null,Bs(r.data)))}else{const a=So(this.globalScope)?void 0:[],c=r.hasCallback?(f,_)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:f?Ni(f):null,data:Ni(_,a)},a)}:f=>{},h=Bs(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,h,c);else if(this.parent.getWorkerSource){const f=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,f[0],h.source)[f[1]](h,c)}else c(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=yu,p.Color=Qt,p.ColorMode=ci,p.CullFaceMode=vo,p.DEMData=Lh,p.DataConstantProperty=it,p.DedupedRequest=Wf,p.DepthMode=pc,p.EXTENT=zt,p.Elevation=class{getAtPointOrZero(i,r=0){return this.getAtPoint(i,r)||0}getAtPoint(i,r,a=!0){null==r&&(r=null);const c=this._source();if(!c||i.y<0||i.y>1)return r;const h=c.getSource().maxzoom,f=1<<h,_=Math.floor(i.x),x=i.x-_,E=new Ti(h,_,h,Math.floor(x*f),Math.floor(i.y*f)),T=this.findDEMTileFor(E);if(!T||!T.dem)return r;const S=T.dem,I=1<<T.tileID.canonical.z,P=(x*I-T.tileID.canonical.x)*S.dim,z=(i.y*I-T.tileID.canonical.y)*S.dim,N=Math.floor(P),$=Math.floor(z);return(a?this.exaggeration():1)*Ut(Ut(S.get(N,$),S.get(N,$+1),z-$),Ut(S.get(N+1,$),S.get(N+1,$+1),z-$),P-N)}getAtTileOffset(i,r,a){const c=1<<i.canonical.z;return this.getAtPointOrZero(new ou(i.wrap+(i.canonical.x+r/zt)/c,(i.canonical.y+a/zt)/c))}getAtTileOffsetFunc(i,r){return a=>{const c=this.getAtTileOffset(i,a.x,a.y),h=r.upVector(i.canonical,a.x,a.y);return lo(h,h,c*r.upVectorScale(i.canonical)),h}}getForTilePoints(i,r,a,c){const h=Wd.create(this,i,c);return!!h&&(r.forEach(f=>{f[2]=this.exaggeration()*h.getElevationAt(f[0],f[1],a)}),!0)}getMinMaxForTile(i){const r=this.findDEMTileFor(i);if(!r||!r.dem)return null;const a=r.dem.tree,c=r.tileID,h=1<<i.canonical.z-c.canonical.z;let f=i.canonical.x/h-c.canonical.x,_=i.canonical.y/h-c.canonical.y,x=0;for(let E=0;E<i.canonical.z-c.canonical.z&&!a.leaves[x];E++){f*=2,_*=2;const T=2*Math.floor(_)+Math.floor(f);x=a.childOffsets[x]+T,f%=1,_%=1}return{min:this.exaggeration()*a.minimums[x],max:this.exaggeration()*a.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,r,a){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=Lu,p.EvaluationParameters=gt,p.Event=ur,p.Evented=Ss,p.Frustum=ef,p.GLOBE_ZOOM_THRESHOLD_MAX=6,p.GlobeSharedBuffers=Vo,p.GlyphManager=cc,p.ImagePosition=kd,p.LineAtlas=Vg,p.LngLat=an,p.LngLatBounds=ru,p.LocalGlyphMode=Mf,p.MAX_MERCATOR_LATITUDE=us,p.MercatorCoordinate=ou,p.ONE_EM=24,p.OverscaledTileID=Ti,p.Properties=pr,p.RGBAImage=to,p.Ray=class{constructor(i,r){this.pos=i,this.dir=r}intersectsPlane(i,r,a){const c=Do(r,this.dir);if(Math.abs(c)<1e-6)return!1;const h=((i[0]-this.pos[0])*r[0]+(i[1]-this.pos[1])*r[1]+(i[2]-this.pos[2])*r[2])/c;return a[0]=this.pos[0]+this.dir[0]*h,a[1]=this.pos[1]+this.dir[1]*h,a[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(i,r,a){if(N=(P=this.pos)[0],$=P[1],q=P[2],J=(z=i)[0],oe=z[1],ce=z[2],Math.abs(N-J)<=Ai*Math.max(1,Math.abs(N),Math.abs(J))&&Math.abs($-oe)<=Ai*Math.max(1,Math.abs($),Math.abs(oe))&&Math.abs(q-ce)<=Ai*Math.max(1,Math.abs(q),Math.abs(ce))||0===r)return a[0]=a[1]=a[2]=0,!1;var P,z,N,$,q,J,oe,ce;const[c,h,f]=this.dir,_=this.pos[0]-i[0],x=this.pos[1]-i[1],E=this.pos[2]-i[2],T=c*c+h*h+f*f,S=2*(_*c+x*h+E*f),I=S*S-4*T*(_*_+x*x+E*E-r*r);if(I<0){const P=Math.max(-S/2,0),z=_+c*P,N=x+h*P,$=E+f*P,q=Math.hypot(z,N,$);return a[0]=z*r/q,a[1]=N*r/q,a[2]=$*r/q,!1}{const P=(-S-Math.sqrt(I))/(2*T);if(P<0){const z=Math.hypot(_,x,E);return a[0]=_*r/z,a[1]=x*r/z,a[2]=E*r/z,!1}return a[0]=_+c*P,a[1]=x+h*P,a[2]=E+f*P,!0}}},p.RequestManager=class{constructor(i,r,a){this._transformRequestFn=i,this._customAccessToken=r,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){const i=function(){let r="";for(let a=0;a<10;a++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ue,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,r){return this._transformRequestFn&&this._transformRequestFn(i,r)||{url:i}}normalizeStyleURL(i,r){if(!Me(i))return i;const a=ot(i);return a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeGlyphsURL(i,r){if(!Me(i))return i;const a=ot(i);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeSourceURL(i,r){if(!Me(i))return i;const a=ot(i);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),this._makeAPIURL(a,this._customAccessToken||r)}normalizeSpriteURL(i,r,a,c){const h=ot(i);return Me(i)?(h.path=`/styles/v1${h.path}/sprite${r}${a}`,this._makeAPIURL(h,this._customAccessToken||c)):(h.path+=`${r}${a}`,ft(h))}normalizeTileURL(i,r,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Me(i))return i;const c=ot(i);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||a&&"raster"!==c.authority&&512===a?"@2x":""}${U.supported?".webp":"$1"}`),"raster"===c.authority?c.path=`/${O.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${O.TILE_URL_VERSION}${c.path}`);const h=this._customAccessToken||function(f){for(const _ of f){const x=_.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(c.params)||O.ACCESS_TOKEN;return O.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,h)}canonicalizeTileURL(i,r){const a=ot(i);if(!a.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!a.path.match(/\.[\w]+$/))return i;let c="mapbox://";a.path.match(/^\/raster\/v1\//)?c+=`raster/${a.path.replace(`/${O.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${a.path.replace(`/${O.TILE_URL_VERSION}/`,"")}`;let h=a.params;return r&&(h=h.filter(f=>!f.match(/^access_token=/))),h.length&&(c+=`?${h.join("&")}`),c}canonicalizeTileset(i,r){const a=!!r&&Me(r),c=[];for(const h of i.tiles||[])Ae(h)?c.push(this.canonicalizeTileURL(h,a)):c.push(h);return c}_makeAPIURL(i,r){const a="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=ot(O.API_URL);if(i.protocol=c.protocol,i.authority=c.authority,"http"===i.protocol){const h=i.params.indexOf("secure");h>=0&&i.params.splice(h,1)}if("/"!==c.path&&(i.path=`${c.path}${i.path}`),!O.REQUIRE_ACCESS_TOKEN)return ft(i);if(r=r||O.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return i.params=i.params.filter(h=>-1===h.indexOf("access_token")),i.params.push(`access_token=${r||""}`),ft(i)}},p.ResourceType=Za,p.SegmentVector=et,p.SourceCache=Pa,p.StencilMode=Ff,p.StructArrayLayout1ui2=$p,p.StructArrayLayout2f1f2i16=ll,p.StructArrayLayout2i4=Jc,p.StructArrayLayout2ui4=ul,p.StructArrayLayout3f12=Qc,p.StructArrayLayout3ui6=Hr,p.StructArrayLayout4i8=Ca,p.Texture=Lf,p.Tile=Kd,p.Transitionable=oi,p.Uniform1f=Ma,p.Uniform1i=class extends ls{constructor(i,r){super(i,r),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},p.Uniform2f=class extends ls{constructor(i,r){super(i,r),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},p.Uniform3f=class extends ls{constructor(i,r){super(i,r),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},p.Uniform4f=cy,p.UniformColor=qp,p.UniformMatrix2f=class extends ls{constructor(i,r){super(i,r),this.current=dy}set(i){for(let r=0;r<4;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},p.UniformMatrix3f=class extends ls{constructor(i,r){super(i,r),this.current=hy}set(i){for(let r=0;r<9;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},p.UniformMatrix4f=class extends ls{constructor(i,r){super(i,r),this.current=uy}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let r=1;r<16;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},p.UnwrappedTileID=Of,p.ValidationError=Xe,p.VectorTileWorkerSource=class extends Ss{constructor(i,r,a,c,h){super(),this.actor=i,this.layerIndex=r,this.availableImages=a,this.loadVectorData=h||Qg,this.loading={},this.loaded={},this.deduped=new Wf(i.scheduler),this.isSpriteLoaded=c,this.scheduler=i.scheduler}loadTile(i,r){const a=i.uid,c=i&&i.request,h=c&&c.collectResourceTiming,f=this.loading[a]=new lv(i);f.abort=this.loadVectorData(i,(_,x)=>{const E=!this.loading[a];if(delete this.loading[a],E||_||!x)return f.status="done",E||(this.loaded[a]=f),r(_);const T=x.rawData,S={};x.expires&&(S.expires=x.expires),x.cacheControl&&(S.cacheControl=x.cacheControl),f.vectorTile=x.vectorTile||new fl.VectorTile(new oc(T));const I=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(P,z)=>{if(P||!z)return r(P);const N={};if(h){const $=rv(c);$.length>0&&(N.resourceTiming=JSON.parse(JSON.stringify($)))}r(null,Xn({rawTileData:T.slice(0)},z,S,N))})};this.isSpriteLoaded?I():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(I,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):I()}),this.loaded=this.loaded||{},this.loaded[a]=f})}reloadTile(i,r){const a=this.loaded,c=i.uid,h=this;if(a&&a[c]){const f=a[c];f.showCollisionBoxes=i.showCollisionBoxes,f.enableTerrain=!!i.enableTerrain,f.projection=i.projection;const _=(x,E)=>{const T=f.reloadCallback;T&&(delete f.reloadCallback,f.parse(f.vectorTile,h.layerIndex,this.availableImages,h.actor,T)),r(x,E)};"parsing"===f.status?f.reloadCallback=_:"done"===f.status&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(i,r){const a=i.uid,c=this.loading[a];c&&(c.abort&&c.abort(),delete this.loading[a]),r()}removeTile(i,r){const a=this.loaded,c=i.uid;a&&a[c]&&delete a[c],r()}},p.WritingMode=Ei,p.ZoomHistory=m,p.add=kl,p.addDynamicAttributes=Ah,p.adjoint=function(i,r){var a=r[0],c=r[1],h=r[2],f=r[3],_=r[4],x=r[5],E=r[6],T=r[7],S=r[8];return i[0]=_*S-x*T,i[1]=h*T-c*S,i[2]=c*x-h*_,i[3]=x*E-f*S,i[4]=a*S-h*E,i[5]=h*f-a*x,i[6]=f*T-_*E,i[7]=c*E-a*T,i[8]=a*_-c*f,i},p.asyncAll=Ga,p.bezier=Oc,p.bindAll=Fl,p.boundsAttributes=Wg,p.bufferConvexPolygon=function(i,r){const a=[];for(let c=0;c<i.length;c++){const h=Cs(c-1,-1,i.length-1),f=Cs(c+1,-1,i.length-1),_=i[c],x=i[f],E=i[h].sub(_).unit(),T=x.sub(_).unit(),S=T.angleWithSep(E.x,E.y),I=E.add(T).unit().mult(-1*r/Math.sin(S/2));a.push(_.add(I))}return a},p.cacheEntryPossiblyAdded=function(i){fn++,fn>Nl&&(i.getActor().send("enforceCacheSizeLimit",Jh),fn=0)},p.calculateGlobeMatrix=Kg,p.calculateGlobeMercatorMatrix=function(i){const r=i.worldSize,a=_n(i.center.lat,-85.051129,us),c=new Je(iu(i.center.lng)*r,Ns(a)*r),h=Pr(1,i.center.lat)*r,f=i.pixelsPerMeter,_=r/(h/i.pixelsPerMeter),x=fi(new Float64Array(16));return so(x,x,[c.x,c.y,0]),Tr(x,x,[_,_,f]),x},p.clamp=_n,p.clearTileCache=function(i){const r=Pe.caches.delete(hn);i&&r.catch(i).then(()=>i())},p.clipLine=Df,p.clone=function(i){var r=new Ln(16);return r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],r},p.clone$1=ki,p.collisionCircleLayout=vx,p.config=O,p.conjugate=function(i,r){return i[0]=-r[0],i[1]=-r[1],i[2]=-r[2],i[3]=r[3],i},p.create=function(){var i=new Ln(16);return Ln!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},p.create$1=Il,p.createExpression=Qa,p.createLayout=jn,p.createStyleLayer=function(i){return"custom"===i.type?new Ex(i):new Qy[i.type](i)},p.cross=Ua,p.degToRad=Nt,p.div=function(i,r,a){return i[0]=r[0]/a[0],i[1]=r[1]/a[1],i[2]=r[2]/a[2],i},p.dot=Do,p.ease=$a,p.easeCubicInOut=Va,p.emitValidationErrors=Xc,p.endsWith=zl,p.enforceCacheSizeLimit=function(i){yn(),Io&&Io.then(r=>{r.keys().then(a=>{for(let c=0;c<a.length-i;c++)r.delete(a[c])})})},p.evaluateSizeForFeature=wi,p.evaluateSizeForZoom=ml,p.evaluateVariableOffset=Uo,p.evented=Gr,p.exactEquals=function(i,r){return i[0]===r[0]&&i[1]===r[1]&&i[2]===r[2]&&i[3]===r[3]},p.exactEquals$1=function(i,r){return i[0]===r[0]&&i[1]===r[1]&&i[2]===r[2]},p.exported=Li,p.exported$1=U,p.extend=Xn,p.extend$1=ra,p.filterObject=Qs,p.fromMat4=function(i,r){return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[4],i[4]=r[5],i[5]=r[6],i[6]=r[8],i[7]=r[9],i[8]=r[10],i},p.fromQuat=function(i,r){var a=r[0],c=r[1],h=r[2],f=r[3],_=a+a,x=c+c,E=h+h,T=a*_,S=c*_,I=c*x,P=h*_,z=h*x,N=h*E,$=f*_,q=f*x,J=f*E;return i[0]=1-I-N,i[1]=S+J,i[2]=P-q,i[3]=0,i[4]=S-J,i[5]=1-T-N,i[6]=z+$,i[7]=0,i[8]=P+q,i[9]=z-$,i[10]=1-T-I,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},p.fromRotation=function(i,r){var a=Math.sin(r),c=Math.cos(r);return i[0]=c,i[1]=a,i[2]=0,i[3]=-a,i[4]=c,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},p.fromScaling=function(i,r){return i[0]=r[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=r[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=r[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},p.furthestTileCorner=function(i){const r=Math.round((i+45+360)%360/90)%4;return ja[r]},p.getAABBPointSquareDist=function(i,r,a){let c=0;for(let h=0;h<2;++h){const f=a?a[h]:0;i[h]>f&&(c+=(i[h]-f)*(i[h]-f)),r[h]<f&&(c+=(f-r[h])*(f-r[h]))}return c},p.getAnchorAlignment=Mh,p.getAnchorJustification=Sf,p.getBounds=function(i){let r=1/0,a=1/0,c=-1/0,h=-1/0;for(const f of i)r=Math.min(r,f.x),a=Math.min(a,f.y),c=Math.max(c,f.x),h=Math.max(h,f.y);return{min:new Je(r,a),max:new Je(c,h)}},p.getColumn=function(i,r){return[i[4*r],i[4*r+1],i[4*r+2],i[4*r+3]]},p.getImage=Ip,p.getJSON=function(i,r){return vt(Xn(i,{type:"json"}),r)},p.getMapSessionAPI=Ms,p.getPerformanceMeasurement=rv,p.getProjection=function(i){const r=em[i.name];if(!r)throw new Error(`Invalid projection name: ${i.name}`);return r.conic?function(a,c){if(c.parallels&&Math.abs(c.parallels[0]+c.parallels[1])<.01){let h=function(f){const _=Math.max(.01,Math.cos(Nt(f))),x=1/(2*Math.max(Math.PI*_,1/_));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(E,T){const S=Nt(E)*_,I=Math.sin(Nt(T))/_;return{x:S*x+.5,y:-I*x+.5,z:0}},unproject(E,T){const S=-(T-.5)/x,I=_n(Pi((E-.5)/x)/_,-180,180),P=Math.asin(_n(S*_,-1,1)),z=_n(Pi(P),-85.051129,us);return new an(I,z)}}}(c.parallels[0]);if("lambertConformalConic"===c.name){const{project:f,unproject:_}=em.mercator;h={wrap:!0,supportsWorldCopies:!0,project:f,unproject:_}}return Xn({},a,c,h)}return Xn({},a,c)}(r,i):r},p.getRTLTextPluginStatus=ii,p.getReferrer=Vl,p.getTilePoint=function(i,{x:r,y:a},c=0){return new Je(((r-c)*i.scale-i.x)*zt,(a*i.scale-i.y)*zt)},p.getTileVec3=function(i,r,a=0){return ao(((r.x-a)*i.scale-i.x)*zt,(r.y*i.scale-i.y)*zt,Km(r.z,r.y))},p.getVideo=function(i,r){const a=Pe.document.createElement("video");a.muted=!0,a.onloadstart=function(){r(null,a)};for(let c=0;c<i.length;c++){const h=Pe.document.createElement("source");Bc(i[c])||(a.crossOrigin="Anonymous"),h.src=i[c],a.appendChild(h)}return{cancel:()=>{}}},p.globeBuffersForTileMesh=function(i,r,a,c){const h=i.context,f=i.transform;let _=r.globeGridBuffer,x=r.globePoleBuffer;if(!_){const E=Vo.createGridVertices(a.canonical);_=r.globeGridBuffer=h.createVertexBuffer(E,Yd,!1)}if(!x){const E=Vo.createPoleTriangleVertices(c,f.tileSize*c,0===a.canonical.y);x=r.globePoleBuffer=h.createVertexBuffer(E,Yd,!1)}return[_,x]},p.globeDenormalizeECEF=Zf,p.globeMatrixForTile=function(i,r){const a=Zf(Jd(i)),c=((h=new Float64Array(16))[0]=(f=r)[0],h[1]=f[1],h[2]=f[2],h[3]=f[3],h[4]=f[4],h[5]=f[5],h[6]=f[6],h[7]=f[7],h[8]=f[8],h[9]=f[9],h[10]=f[10],h[11]=f[11],h[12]=f[12],h[13]=f[13],h[14]=f[14],h[15]=f[15],h);var h,f;return Wo(c,c,a),c},p.globePoleMatrixForTile=function(i,r,a){const c=fi(new Float64Array(16)),h=Math.pow(2,i.z),f=(i.x-h/2)/h*Math.PI*2,_=a.point,x=a.worldSize/(a.tileSize*h);return so(c,c,[_.x,_.y,-a.worldSize/Math.PI/2]),Tr(c,c,[x,x,x]),Zo(c,c,Nt(-a._center.lat)),To(c,c,Nt(-a._center.lng)),To(c,c,f),r&&Tr(c,c,[1,-1,1]),c},p.globeTileBounds=Jd,p.globeToMercatorTransition=function(i){return Ys(5,6,i)},p.identity=fi,p.identity$1=Pu,p.invert=function(i,r){var a=r[0],c=r[1],h=r[2],f=r[3],_=r[4],x=r[5],E=r[6],T=r[7],S=r[8],I=r[9],P=r[10],z=r[11],N=r[12],$=r[13],q=r[14],J=r[15],oe=a*x-c*_,ce=a*E-h*_,he=a*T-f*_,fe=c*E-h*x,pe=c*T-f*x,Te=h*T-f*E,we=S*$-I*N,Ze=S*q-P*N,Ue=S*J-z*N,De=I*q-P*$,Ge=I*J-z*$,Ke=P*J-z*q,Re=oe*Ke-ce*Ge+he*De+fe*Ue-pe*Ze+Te*we;return Re?(i[0]=(x*Ke-E*Ge+T*De)*(Re=1/Re),i[1]=(h*Ge-c*Ke-f*De)*Re,i[2]=($*Te-q*pe+J*fe)*Re,i[3]=(P*pe-I*Te-z*fe)*Re,i[4]=(E*Ue-_*Ke-T*Ze)*Re,i[5]=(a*Ke-h*Ue+f*Ze)*Re,i[6]=(q*he-N*Te-J*ce)*Re,i[7]=(S*Te-P*he+z*ce)*Re,i[8]=(_*Ge-x*Ue+T*we)*Re,i[9]=(c*Ue-a*Ge-f*we)*Re,i[10]=(N*pe-$*he+J*oe)*Re,i[11]=(I*he-S*pe-z*oe)*Re,i[12]=(x*Ze-_*De-E*we)*Re,i[13]=(a*De-c*Ze+h*we)*Re,i[14]=($*ce-N*fe-q*oe)*Re,i[15]=(S*fe-I*ce+P*oe)*Re,i):null},p.isMapAuthenticated=function(i){return Ko.has(i)},p.isMapboxURL=Me,p.latFromMercatorY=ai,p.len=Jn,p.length=Pl,p.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},p.loadVectorTile=Qg,p.makeRequest=vt,p.mercatorXfromLng=iu,p.mercatorYfromLat=Ns,p.mercatorZfromAltitude=Pr,p.mul=Wo,p.mul$1=_r,p.multiply=function(i,r,a){var c=r[0],h=r[1],f=r[2],_=r[3],x=r[4],E=r[5],T=r[6],S=r[7],I=r[8],P=a[0],z=a[1],N=a[2],$=a[3],q=a[4],J=a[5],oe=a[6],ce=a[7],he=a[8];return i[0]=P*c+z*_+N*T,i[1]=P*h+z*x+N*S,i[2]=P*f+z*E+N*I,i[3]=$*c+q*_+J*T,i[4]=$*h+q*x+J*S,i[5]=$*f+q*E+J*I,i[6]=oe*c+ce*_+he*T,i[7]=oe*h+ce*x+he*S,i[8]=oe*f+ce*E+he*I,i},p.multiply$1=Al,p.multiply$2=$i,p.nextPowerOfTwo=qi,p.normalize=Xs,p.normalize$1=function(i,r){var a=r[0],c=r[1],h=r[2],f=r[3],_=a*a+c*c+h*h+f*f;return _>0&&(_=1/Math.sqrt(_)),i[0]=a*_,i[1]=c*_,i[2]=h*_,i[3]=f*_,i},p.number=Ut,p.ortho=function(i,r,a,c,h,f,_){var x=1/(r-a),E=1/(c-h),T=1/(f-_);return i[0]=-2*x,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*E,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*T,i[11]=0,i[12]=(r+a)*x,i[13]=(h+c)*E,i[14]=(_+f)*T,i[15]=1,i},p.pbf=oc,p.perspective=function(i,r,a,c,h){var f,_=1/Math.tan(r/2);return i[0]=_/a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,null!=h&&h!==1/0?(i[10]=(h+c)*(f=1/(c-h)),i[14]=2*h*c*f):(i[10]=-1,i[14]=-2*c),i},p.pick=function(i,r){const a={};for(let c=0;c<r.length;c++){const h=r[c];h in i&&(a[h]=i[h])}return a},p.plugin=Ht,p.pointGeometry=Je,p.polygonIntersectsBox=yy,p.polygonIntersectsPolygon=Qm,p.polygonizeBounds=function(i,r,a=0,c=!0){const h=new Je(a,a),f=i.sub(h),_=r.add(h),x=[f,new Je(_.x,f.y),_,new Je(f.x,_.y)];return c&&x.push(f),x},p.posAttributes=qg,p.postMapLoadEvent=Tn,p.postTurnstileEvent=Sn,p.potpack=Pd,p.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},p.radToDeg=Pi,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(i){return i({pluginStatus:bt,pluginURL:Bt}),Gr.on("pluginStateChange",i),i},p.removeAuthState=function(i){Ko.delete(i)},p.renderColorRamp=rf,p.rotateX=Zo,p.rotateX$1=Rl,p.rotateY=To,p.rotateZ=function(i,r,a){var c=Math.sin(a),h=Math.cos(a),f=r[0],_=r[1],x=r[2],E=r[3],T=r[4],S=r[5],I=r[6],P=r[7];return r!==i&&(i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[0]=f*h+T*c,i[1]=_*h+S*c,i[2]=x*h+I*c,i[3]=E*h+P*c,i[4]=T*h-f*c,i[5]=S*h-_*c,i[6]=I*h-x*c,i[7]=P*h-E*c,i},p.rotateZ$1=function(i,r,a){a*=.5;var c=r[0],h=r[1],f=r[2],_=r[3],x=Math.sin(a),E=Math.cos(a);return i[0]=c*E+h*x,i[1]=h*E-c*x,i[2]=f*E+_*x,i[3]=_*E-f*x,i},p.scale=Tr,p.scale$1=function(i,r,a){return i[0]=r[0]*a,i[1]=r[1]*a,i[2]=r[2]*a,i[3]=r[3]*a,i},p.scale$2=lo,p.scaleAndAdd=sn,p.setCacheLimits=function(i,r){Jh=i,Nl=r},p.setColumn=function(i,r,a){i[4*r+0]=a[0],i[4*r+1]=a[1],i[4*r+2]=a[2],i[4*r+3]=a[3]},p.setRTLTextPlugin=function(i,r,a=!1){if(bt===ut||bt===yt||bt===mn)throw new Error("setRTLTextPlugin cannot be called multiple times.");Bt=Li.resolveURL(i),bt=ut,Dn=r,or(),a||Yi()},p.smoothstep=Ys,p.spec=Ee,p.storeAuthState=function(i,r){r?Ko.add(i):Ko.delete(i)},p.sub=Es,p.subtract=bs,p.symbolSize=_f,p.tileAABB=function(i,r,a,c,h,f,_,x,E){if("globe"===E.name){const z=Jd(new Of(f,new yu(a,c,h)).canonical).getCorners(),N=Number.MAX_VALUE,$=[-N,-N,-N],q=[N,N,N],J=Kg(i,r);for(let oe=0;oe<z.length;oe++)Xt(z[oe],z[oe],J),S=q,I=z[oe],(T=q)[0]=Math.min(S[0],I[0]),T[1]=Math.min(S[1],I[1]),T[2]=Math.min(S[2],I[2]),Yh($,$,z[oe]);return new hs(q,$)}var T,S,I;const P=bl({z:a,x:c,y:h},E);return new hs([(f+P.x/P.scale)*r,r*(P.y/P.scale),_],[(f+P.x2/P.scale)*r,r*(P.y2/P.scale),x])},p.tileTransform=bl,p.transformMat3=function(i,r,a){var c=r[0],h=r[1],f=r[2];return i[0]=c*a[0]+h*a[3]+f*a[6],i[1]=c*a[1]+h*a[4]+f*a[7],i[2]=c*a[2]+h*a[5]+f*a[8],i},p.transformMat4=Xt,p.transformMat4$1=Gt,p.transformQuat=Gi,p.translate=so,p.transpose=function(i,r){if(i===r){var a=r[1],c=r[2],h=r[5];i[1]=r[3],i[2]=r[6],i[3]=a,i[5]=r[7],i[6]=c,i[7]=h}else i[0]=r[0],i[1]=r[3],i[2]=r[6],i[3]=r[1],i[4]=r[4],i[5]=r[7],i[6]=r[2],i[7]=r[5],i[8]=r[8];return i},p.triggerPluginCompletionEvent=Mn,p.uniqueId=Ol,p.validateCustomStyleLayer=function(i){const r=[],a=i.id;return void 0===a&&r.push({message:`layers.${a}: missing required property "id"`}),void 0===i.render&&r.push({message:`layers.${a}: missing required method "render"`}),i.renderingMode&&"2d"!==i.renderingMode&&"3d"!==i.renderingMode&&r.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),r},p.validateFog=Kl,p.validateLight=xa,p.validateStyle=Hn,p.values=Hi,p.vectorTile=fl,p.version="2.7.0",p.warnOnce=zn,p.window=Pe,p.wrap=Cs}),Au(0,function(p){function Yn(K){const O=typeof K;if("number"===O||"boolean"===O||"string"===O||null==K)return JSON.stringify(K);if(Array.isArray(K)){let Q="[";for(const se of K)Q+=`${Yn(se)},`;return`${Q}]`}const U=Object.keys(K).sort();let X="{";for(let Q=0;Q<U.length;Q++)X+=`${JSON.stringify(U[Q])}:${Yn(K[U[Q]])},`;return`${X}}`}function qo(K){let O="";for(const U of p.refProperties)O+=`/${Yn(K[U])}`;return O}class pi{constructor(O){this.keyCache={},O&&this.replace(O)}replace(O){this._layerConfigs={},this._layers={},this.update(O,[])}update(O,U){for(const Q of O)this._layerConfigs[Q.id]=Q,(this._layers[Q.id]=p.createStyleLayer(Q)).compileFilter(),this.keyCache[Q.id]&&delete this.keyCache[Q.id];for(const Q of U)delete this.keyCache[Q],delete this._layerConfigs[Q],delete this._layers[Q];this.familiesBySource={};const X=function(Q,se){const me={};for(let ue=0;ue<Q.length;ue++){const ye=se&&se[Q[ue].id]||qo(Q[ue]);se&&(se[Q[ue].id]=ye);let Me=me[ye];Me||(Me=me[ye]=[]),Me.push(Q[ue])}const de=[];for(const ue in me)de.push(me[ue]);return de}(p.values(this._layerConfigs),this.keyCache);for(const Q of X){const se=Q.map(Ae=>this._layers[Ae.id]),me=se[0];if("none"===me.visibility)continue;const de=me.source||"";let ue=this.familiesBySource[de];ue||(ue=this.familiesBySource[de]={});const ye=me.sourceLayer||"_geojsonTileLayer";let Me=ue[ye];Me||(Me=ue[ye]=[]),Me.push(se)}}}const{ImageBitmap:Je}=p.window;class wt{loadTile(O,U){const{uid:X,encoding:Q,rawImageData:se,padding:me,buildQuadTree:de}=O,ue=Je&&se instanceof Je?this.getImageData(se,me):se;U(null,new p.DEMData(X,ue,Q,me<1,de))}getImageData(O,U){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(O.width,O.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=O.width,this.offscreenCanvas.height=O.height,this.offscreenCanvasContext.drawImage(O,0,0,O.width,O.height);const X=this.offscreenCanvasContext.getImageData(-U,-U,O.width+2*U,O.height+2*U);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new p.RGBAImage({width:X.width,height:X.height},X.data)}}var Pe=function K(O,U){var X,Q=O&&O.type;if("FeatureCollection"===Q)for(X=0;X<O.features.length;X++)K(O.features[X],U);else if("GeometryCollection"===Q)for(X=0;X<O.geometries.length;X++)K(O.geometries[X],U);else if("Feature"===Q)K(O.geometry,U);else if("Polygon"===Q)Ai(O.coordinates,U);else if("MultiPolygon"===Q)for(X=0;X<O.coordinates.length;X++)Ai(O.coordinates[X],U);return O};function Ai(K,O){if(0!==K.length){Ln(K[0],O);for(var U=1;U<K.length;U++)Ln(K[U],!O)}}function Ln(K,O){for(var U=0,X=0,Q=0,se=K.length,me=se-1;Q<se;me=Q++){var de=(K[Q][0]-K[me][0])*(K[me][1]+K[Q][1]),ue=U+de;X+=Math.abs(U)>=Math.abs(de)?U-ue+de:de-ue+U,U=ue}U+X>=0!=!!O&&K.reverse()}const Il=p.vectorTile.VectorTileFeature.prototype.toGeoJSON;class fi{constructor(O){this._feature=O,this.extent=p.EXTENT,this.type=O.type,this.properties=O.tags,"id"in O&&!isNaN(O.id)&&(this.id=parseInt(O.id,10))}loadGeometry(){if(1===this._feature.type){const O=[];for(const U of this._feature.geometry)O.push([new p.pointGeometry(U[0],U[1])]);return O}{const O=[];for(const U of this._feature.geometry){const X=[];for(const Q of U)X.push(new p.pointGeometry(Q[0],Q[1]));O.push(X)}return O}}toGeoJSON(O,U,X){return Il.call(this,O,U,X)}}class Al{constructor(O){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=O.length,this._features=O}feature(O){return new fi(this._features[O])}}var so=p.vectorTile.VectorTileFeature,Tr=Zo;function Zo(K,O){this.options=O||{},this.features=K,this.length=K.length}function To(K,O){this.id="number"==typeof K.id?K.id:void 0,this.type=K.type,this.rawGeometry=1===K.type?[K.geometry]:K.geometry,this.properties=K.tags,this.extent=O||4096}Zo.prototype.feature=function(K){return new To(this.features[K],this.options.extent)},To.prototype.loadGeometry=function(){var K=this.rawGeometry;this.geometry=[];for(var O=0;O<K.length;O++){for(var U=K[O],X=[],Q=0;Q<U.length;Q++)X.push(new p.pointGeometry(U[Q][0],U[Q][1]));this.geometry.push(X)}return this.geometry},To.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var K=this.geometry,O=1/0,U=-1/0,X=1/0,Q=-1/0,se=0;se<K.length;se++)for(var me=K[se],de=0;de<me.length;de++){var ue=me[de];O=Math.min(O,ue.x),U=Math.max(U,ue.x),X=Math.min(X,ue.y),Q=Math.max(Q,ue.y)}return[O,X,U,Q]},To.prototype.toGeoJSON=so.prototype.toGeoJSON;var Wo=Xo,xs=Tr;function Xo(K){var O=new p.pbf;return function(U,X){for(var Q in U.layers)X.writeMessage(3,Pl,U.layers[Q])}(K,O),O.finish()}function Pl(K,O){var U;O.writeVarintField(15,K.version||1),O.writeStringField(1,K.name||""),O.writeVarintField(5,K.extent||4096);var X={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<K.length;U++)X.feature=K.feature(U),O.writeMessage(2,ao,X);var Q=X.keys;for(U=0;U<Q.length;U++)O.writeStringField(3,Q[U]);var se=X.values;for(U=0;U<se.length;U++)O.writeMessage(4,lo,se[U])}function ao(K,O){var U=K.feature;void 0!==U.id&&O.writeVarintField(1,U.id),O.writeMessage(2,kl,K),O.writeVarintField(3,U.type),O.writeMessage(4,Yh,U)}function kl(K,O){var U=K.feature,X=K.keys,Q=K.values,se=K.keycache,me=K.valuecache;for(var de in U.properties){var ue=U.properties[de],ye=se[de];if(null!==ue){void 0===ye&&(X.push(de),se[de]=ye=X.length-1),O.writeVarint(ye);var Me=typeof ue;"string"!==Me&&"boolean"!==Me&&"number"!==Me&&(ue=JSON.stringify(ue));var Ae=Me+":"+ue,Fe=me[Ae];void 0===Fe&&(Q.push(ue),me[Ae]=Fe=Q.length-1),O.writeVarint(Fe)}}}function bs(K,O){return(O<<3)+(7&K)}function $i(K){return K<<1^K>>31}function Yh(K,O){for(var U=K.loadGeometry(),X=K.type,Q=0,se=0,me=U.length,de=0;de<me;de++){var ue=U[de],ye=1;1===X&&(ye=ue.length),O.writeVarint(bs(1,ye));for(var Me=3===X?ue.length-1:ue.length,Ae=0;Ae<Me;Ae++){1===Ae&&1!==X&&O.writeVarint(bs(2,Me-1));var Fe=ue[Ae].x-Q,ot=ue[Ae].y-se;O.writeVarint($i(Fe)),O.writeVarint($i(ot)),Q+=Fe,se+=ot}3===X&&O.writeVarint(bs(7,1))}}function lo(K,O){var U=typeof K;"string"===U?O.writeStringField(1,K):"boolean"===U?O.writeBooleanField(7,K):"number"===U&&(K%1!=0?O.writeDoubleField(3,K):K<0?O.writeSVarintField(6,K):O.writeVarintField(5,K))}function sn(K,O,U,X,Q,se){if(Q-X<=U)return;const me=X+Q>>1;Xs(K,O,me,X,Q,se%2),sn(K,O,U,X,me-1,se+1),sn(K,O,U,me+1,Q,se+1)}function Xs(K,O,U,X,Q,se){for(;Q>X;){if(Q-X>600){const ye=Q-X+1,Me=U-X+1,Ae=Math.log(ye),Fe=.5*Math.exp(2*Ae/3),ot=.5*Math.sqrt(Ae*Fe*(ye-Fe)/ye)*(Me-ye/2<0?-1:1);Xs(K,O,U,Math.max(X,Math.floor(U-Me*Fe/ye+ot)),Math.min(Q,Math.floor(U+(ye-Me)*Fe/ye+ot)),se)}const me=O[2*U+se];let de=X,ue=Q;for(Do(K,O,X,U),O[2*Q+se]>me&&Do(K,O,X,Q);de<ue;){for(Do(K,O,de,ue),de++,ue--;O[2*de+se]<me;)de++;for(;O[2*ue+se]>me;)ue--}O[2*X+se]===me?Do(K,O,X,ue):(ue++,Do(K,O,ue,Q)),ue<=U&&(X=ue+1),U<=ue&&(Q=ue-1)}}function Do(K,O,U,X){Ua(K,U,X),Ua(O,2*U,2*X),Ua(O,2*U+1,2*X+1)}function Ua(K,O,U){const X=K[O];K[O]=K[U],K[U]=X}function Xt(K,O,U,X){const Q=K-U,se=O-X;return Q*Q+se*se}Wo.fromVectorTileJs=Xo,Wo.fromGeojsonVt=function(K,O){O=O||{};var U={};for(var X in K)U[X]=new Tr(K[X].features,O),U[X].name=X,U[X].version=O.version,U[X].extent=O.extent;return Xo({layers:U})},Wo.GeoJSONWrapper=xs;const Gi=K=>K[0],ws=K=>K[1];class Es{constructor(O,U=Gi,X=ws,Q=64,se=Float64Array){this.nodeSize=Q,this.points=O;const me=O.length<65536?Uint16Array:Uint32Array,de=this.ids=new me(O.length),ue=this.coords=new se(2*O.length);for(let ye=0;ye<O.length;ye++)de[ye]=ye,ue[2*ye]=U(O[ye]),ue[2*ye+1]=X(O[ye]);sn(de,ue,Q,0,de.length-1,0)}range(O,U,X,Q){return function(se,me,de,ue,ye,Me,Ae){const Fe=[0,se.length-1,0],ot=[];let ft,pt;for(;Fe.length;){const mt=Fe.pop(),Lt=Fe.pop(),Sn=Fe.pop();if(Lt-Sn<=Ae){for(let kn=Sn;kn<=Lt;kn++)ft=me[2*kn],pt=me[2*kn+1],ft>=de&&ft<=ye&&pt>=ue&&pt<=Me&&ot.push(se[kn]);continue}const On=Math.floor((Sn+Lt)/2);ft=me[2*On],pt=me[2*On+1],ft>=de&&ft<=ye&&pt>=ue&&pt<=Me&&ot.push(se[On]);const Tn=(mt+1)%2;(0===mt?de<=ft:ue<=pt)&&(Fe.push(Sn),Fe.push(On-1),Fe.push(Tn)),(0===mt?ye>=ft:Me>=pt)&&(Fe.push(On+1),Fe.push(Lt),Fe.push(Tn))}return ot}(this.ids,this.coords,O,U,X,Q,this.nodeSize)}within(O,U,X){return function(Q,se,me,de,ue,ye){const Me=[0,Q.length-1,0],Ae=[],Fe=ue*ue;for(;Me.length;){const ot=Me.pop(),ft=Me.pop(),pt=Me.pop();if(ft-pt<=ye){for(let Tn=pt;Tn<=ft;Tn++)Xt(se[2*Tn],se[2*Tn+1],me,de)<=Fe&&Ae.push(Q[Tn]);continue}const mt=Math.floor((pt+ft)/2),Lt=se[2*mt],Sn=se[2*mt+1];Xt(Lt,Sn,me,de)<=Fe&&Ae.push(Q[mt]);const On=(ot+1)%2;(0===ot?me-ue<=Lt:de-ue<=Sn)&&(Me.push(pt),Me.push(mt-1),Me.push(On)),(0===ot?me+ue>=Lt:de+ue>=Sn)&&(Me.push(mt+1),Me.push(ft),Me.push(On))}return Ae}(this.ids,this.coords,O,U,X,this.nodeSize)}}const _r={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:K=>K},Jn=Math.fround||(Gt=new Float32Array(1),K=>(Gt[0]=+K,Gt[0]));var Gt;class Ks{constructor(O){this.options=ja(Object.create(_r),O),this.trees=new Array(this.options.maxZoom+1)}load(O){const{log:U,minZoom:X,maxZoom:Q,nodeSize:se}=this.options;U&&console.time("total time");const me=`prepare ${O.length} points`;U&&console.time(me),this.points=O;let de=[];for(let ue=0;ue<O.length;ue++)O[ue].geometry&&de.push(Rl(O[ue],ue));this.trees[Q+1]=new Es(de,Va,Oc,se,Float32Array),U&&console.timeEnd(me);for(let ue=Q;ue>=X;ue--){const ye=+Date.now();de=this._cluster(de,ue),this.trees[ue]=new Es(de,Va,Oc,se,Float32Array),U&&console.log("z%d: %d clusters in %dms",ue,de.length,+Date.now()-ye)}return U&&console.timeEnd("total time"),this}getClusters(O,U){let X=((O[0]+180)%360+360)%360-180;const Q=Math.max(-90,Math.min(90,O[1]));let se=180===O[2]?180:((O[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)X=-180,se=180;else if(X>se){const Me=this.getClusters([X,Q,180,me],U),Ae=this.getClusters([-180,Q,se,me],U);return Me.concat(Ae)}const de=this.trees[this._limitZoom(U)],ue=de.range(Ll(X),Nt(me),Ll(se),Nt(Q)),ye=[];for(const Me of ue){const Ae=de.points[Me];ye.push(Ae.numPoints?Lc(Ae):this.points[Ae.index])}return ye}getChildren(O){const U=this._getOriginId(O),X=this._getOriginZoom(O),Q="No cluster with the specified id.",se=this.trees[X];if(!se)throw new Error(Q);const me=se.points[U];if(!me)throw new Error(Q);const de=this.options.radius/(this.options.extent*Math.pow(2,X-1)),ue=se.within(me.x,me.y,de),ye=[];for(const Me of ue){const Ae=se.points[Me];Ae.parentId===O&&ye.push(Ae.numPoints?Lc(Ae):this.points[Ae.index])}if(0===ye.length)throw new Error(Q);return ye}getLeaves(O,U,X){const Q=[];return this._appendLeaves(Q,O,U=U||10,X=X||0,0),Q}getTile(O,U,X){const Q=this.trees[this._limitZoom(O)],se=Math.pow(2,O),{extent:me,radius:de}=this.options,ue=de/me,ye=(X-ue)/se,Me=(X+1+ue)/se,Ae={features:[]};return this._addTileFeatures(Q.range((U-ue)/se,ye,(U+1+ue)/se,Me),Q.points,U,X,se,Ae),0===U&&this._addTileFeatures(Q.range(1-ue/se,ye,1,Me),Q.points,se,X,se,Ae),U===se-1&&this._addTileFeatures(Q.range(0,ye,ue/se,Me),Q.points,-1,X,se,Ae),Ae.features.length?Ae:null}getClusterExpansionZoom(O){let U=this._getOriginZoom(O)-1;for(;U<=this.options.maxZoom;){const X=this.getChildren(O);if(U++,1!==X.length)break;O=X[0].properties.cluster_id}return U}_appendLeaves(O,U,X,Q,se){const me=this.getChildren(U);for(const de of me){const ue=de.properties;if(ue&&ue.cluster?se+ue.point_count<=Q?se+=ue.point_count:se=this._appendLeaves(O,ue.cluster_id,X,Q,se):se<Q?se++:O.push(de),O.length===X)break}return se}_addTileFeatures(O,U,X,Q,se,me){for(const de of O){const ue=U[de],ye=ue.numPoints;let Me,Ae,Fe;if(ye)Me=ku(ue),Ae=ue.x,Fe=ue.y;else{const pt=this.points[ue.index];Me=pt.properties,Ae=Ll(pt.geometry.coordinates[0]),Fe=Nt(pt.geometry.coordinates[1])}const ot={type:1,geometry:[[Math.round(this.options.extent*(Ae*se-X)),Math.round(this.options.extent*(Fe*se-Q))]],tags:Me};let ft;ye?ft=ue.id:this.options.generateId?ft=ue.index:this.points[ue.index].id&&(ft=this.points[ue.index].id),void 0!==ft&&(ot.id=ft),me.features.push(ot)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(+O,this.options.maxZoom+1))}_cluster(O,U){const X=[],{radius:Q,extent:se,reduce:me,minPoints:de}=this.options,ue=Q/(se*Math.pow(2,U));for(let ye=0;ye<O.length;ye++){const Me=O[ye];if(Me.zoom<=U)continue;Me.zoom=U;const Ae=this.trees[U+1],Fe=Ae.within(Me.x,Me.y,ue),ot=Me.numPoints||1;let ft=ot;for(const pt of Fe){const mt=Ae.points[pt];mt.zoom>U&&(ft+=mt.numPoints||1)}if(ft>ot&&ft>=de){let pt=Me.x*ot,mt=Me.y*ot,Lt=me&&ot>1?this._map(Me,!0):null;const Sn=(ye<<5)+(U+1)+this.points.length;for(const On of Fe){const Tn=Ae.points[On];if(Tn.zoom<=U)continue;Tn.zoom=U;const kn=Tn.numPoints||1;pt+=Tn.x*kn,mt+=Tn.y*kn,Tn.parentId=Sn,me&&(Lt||(Lt=this._map(Me,!0)),me(Lt,this._map(Tn)))}Me.parentId=Sn,X.push(Pu(pt/ft,mt/ft,Sn,ft,Lt))}else if(X.push(Me),ft>1)for(const pt of Fe){const mt=Ae.points[pt];mt.zoom<=U||(mt.zoom=U,X.push(mt))}}return X}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,U){if(O.numPoints)return U?ja({},O.properties):O.properties;const X=this.points[O.index].properties,Q=this.options.map(X);return U&&Q===X?ja({},Q):Q}}function Pu(K,O,U,X,Q){return{x:Jn(K),y:Jn(O),zoom:1/0,id:U,parentId:-1,numPoints:X,properties:Q}}function Rl(K,O){const[U,X]=K.geometry.coordinates;return{x:Jn(Ll(U)),y:Jn(Nt(X)),zoom:1/0,index:O,parentId:-1}}function Lc(K){return{type:"Feature",id:K.id,properties:ku(K),geometry:{type:"Point",coordinates:[(O=K.x,360*(O-.5)),Pi(K.y)]}};var O}function ku(K){const O=K.numPoints,U=O>=1e4?`${Math.round(O/1e3)}k`:O>=1e3?Math.round(O/100)/10+"k":O;return ja(ja({},K.properties),{cluster:!0,cluster_id:K.id,point_count:O,point_count_abbreviated:U})}function Ll(K){return K/360+.5}function Nt(K){const O=Math.sin(K*Math.PI/180),U=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return U<0?0:U>1?1:U}function Pi(K){const O=(180-360*K)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function ja(K,O){for(const U in O)K[U]=O[U];return K}function Va(K){return K.x}function Oc(K){return K.y}function $a(K,O,U,X){for(var Q,se=X,me=U-O>>1,de=U-O,ue=K[O],ye=K[O+1],Me=K[U],Ae=K[U+1],Fe=O+3;Fe<U;Fe+=3){var ot=_n(K[Fe],K[Fe+1],ue,ye,Me,Ae);if(ot>se)Q=Fe,se=ot;else if(ot===se){var ft=Math.abs(Fe-me);ft<de&&(Q=Fe,de=ft)}}se>X&&(Q-O>3&&$a(K,O,Q,X),K[Q+2]=se,U-Q>3&&$a(K,Q,U,X))}function _n(K,O,U,X,Q,se){var me=Q-U,de=se-X;if(0!==me||0!==de){var ue=((K-U)*me+(O-X)*de)/(me*me+de*de);ue>1?(U=Q,X=se):ue>0&&(U+=me*ue,X+=de*ue)}return(me=K-U)*me+(de=O-X)*de}function Ys(K,O,U,X){var Q={id:void 0===K?null:K,type:O,geometry:U,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(se){var me=se.geometry,de=se.type;if("Point"===de||"MultiPoint"===de||"LineString"===de)Cs(se,me);else if("Polygon"===de||"MultiLineString"===de)for(var ue=0;ue<me.length;ue++)Cs(se,me[ue]);else if("MultiPolygon"===de)for(ue=0;ue<me.length;ue++)for(var ye=0;ye<me[ue].length;ye++)Cs(se,me[ue][ye])}(Q),Q}function Cs(K,O){for(var U=0;U<O.length;U+=3)K.minX=Math.min(K.minX,O[U]),K.minY=Math.min(K.minY,O[U+1]),K.maxX=Math.max(K.maxX,O[U]),K.maxY=Math.max(K.maxY,O[U+1])}function Ga(K,O,U,X){if(O.geometry){var Q=O.geometry.coordinates,se=O.geometry.type,me=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),de=[],ue=O.id;if(U.promoteId?ue=O.properties[U.promoteId]:U.generateId&&(ue=X||0),"Point"===se)Hi(Q,de);else if("MultiPoint"===se)for(var ye=0;ye<Q.length;ye++)Hi(Q[ye],de);else if("LineString"===se)Xn(Q,de,me,!1);else if("MultiLineString"===se){if(U.lineMetrics){for(ye=0;ye<Q.length;ye++)Xn(Q[ye],de=[],me,!1),K.push(Ys(ue,"LineString",de,O.properties));return}Fc(Q,de,me,!1)}else if("Polygon"===se)Fc(Q,de,me,!0);else{if("MultiPolygon"!==se){if("GeometryCollection"===se){for(ye=0;ye<O.geometry.geometries.length;ye++)Ga(K,{id:ue,geometry:O.geometry.geometries[ye],properties:O.properties},U,X);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ye=0;ye<Q.length;ye++){var Me=[];Fc(Q[ye],Me,me,!0),de.push(Me)}}K.push(Ys(ue,se,de,O.properties))}}function Hi(K,O){O.push(Ol(K[0])),O.push(zc(K[1])),O.push(0)}function Xn(K,O,U,X){for(var Q,se,me=0,de=0;de<K.length;de++){var ue=Ol(K[de][0]),ye=zc(K[de][1]);O.push(ue),O.push(ye),O.push(0),de>0&&(me+=X?(Q*ye-ue*se)/2:Math.sqrt(Math.pow(ue-Q,2)+Math.pow(ye-se,2))),Q=ue,se=ye}var Me=O.length-3;O[2]=1,$a(O,0,Me,U),O[Me+2]=1,O.size=Math.abs(me),O.start=0,O.end=O.size}function Fc(K,O,U,X){for(var Q=0;Q<K.length;Q++){var se=[];Xn(K[Q],se,U,X),O.push(se)}}function Ol(K){return K/360+.5}function zc(K){var O=Math.sin(K*Math.PI/180),U=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return U<0?0:U>1?1:U}function qi(K,O,U,X,Q,se,me,de){if(X/=O,se>=(U/=O)&&me<X)return K;if(me<U||se>=X)return null;for(var ue=[],ye=0;ye<K.length;ye++){var Me=K[ye],Ae=Me.geometry,Fe=Me.type,ot=0===Q?Me.minX:Me.minY,ft=0===Q?Me.maxX:Me.maxY;if(ot>=U&&ft<X)ue.push(Me);else if(!(ft<U||ot>=X)){var pt=[];if("Point"===Fe||"MultiPoint"===Fe)Ru(Ae,pt,U,X,Q);else if("LineString"===Fe)Fl(Ae,pt,U,X,Q,!1,de.lineMetrics);else if("MultiLineString"===Fe)Js(Ae,pt,U,X,Q,!1);else if("Polygon"===Fe)Js(Ae,pt,U,X,Q,!0);else if("MultiPolygon"===Fe)for(var mt=0;mt<Ae.length;mt++){var Lt=[];Js(Ae[mt],Lt,U,X,Q,!0),Lt.length&&pt.push(Lt)}if(pt.length){if(de.lineMetrics&&"LineString"===Fe){for(mt=0;mt<pt.length;mt++)ue.push(Ys(Me.id,Fe,pt[mt],Me.tags));continue}"LineString"!==Fe&&"MultiLineString"!==Fe||(1===pt.length?(Fe="LineString",pt=pt[0]):Fe="MultiLineString"),"Point"!==Fe&&"MultiPoint"!==Fe||(Fe=3===pt.length?"Point":"MultiPoint"),ue.push(Ys(Me.id,Fe,pt,Me.tags))}}}return ue.length?ue:null}function Ru(K,O,U,X,Q){for(var se=0;se<K.length;se+=3){var me=K[se+Q];me>=U&&me<=X&&(O.push(K[se]),O.push(K[se+1]),O.push(K[se+2]))}}function Fl(K,O,U,X,Q,se,me){for(var de,ue,ye=zl(K),Me=0===Q?ki:Bl,Ae=K.start,Fe=0;Fe<K.length-3;Fe+=3){var ot=K[Fe],ft=K[Fe+1],pt=K[Fe+2],mt=K[Fe+3],Lt=K[Fe+4],Sn=0===Q?ot:ft,On=0===Q?mt:Lt,Tn=!1;me&&(de=Math.sqrt(Math.pow(ot-mt,2)+Math.pow(ft-Lt,2))),Sn<U?On>U&&(ue=Me(ye,ot,ft,mt,Lt,U),me&&(ye.start=Ae+de*ue)):Sn>X?On<X&&(ue=Me(ye,ot,ft,mt,Lt,X),me&&(ye.start=Ae+de*ue)):Qs(ye,ot,ft,pt),On<U&&Sn>=U&&(ue=Me(ye,ot,ft,mt,Lt,U),Tn=!0),On>X&&Sn<=X&&(ue=Me(ye,ot,ft,mt,Lt,X),Tn=!0),!se&&Tn&&(me&&(ye.end=Ae+de*ue),O.push(ye),ye=zl(K)),me&&(Ae+=de)}var kn=K.length-3;ot=K[kn],ft=K[kn+1],pt=K[kn+2],(Sn=0===Q?ot:ft)>=U&&Sn<=X&&Qs(ye,ot,ft,pt),kn=ye.length-3,se&&kn>=3&&(ye[kn]!==ye[0]||ye[kn+1]!==ye[1])&&Qs(ye,ye[0],ye[1],ye[2]),ye.length&&O.push(ye)}function zl(K){var O=[];return O.size=K.size,O.start=K.start,O.end=K.end,O}function Js(K,O,U,X,Q,se){for(var me=0;me<K.length;me++)Fl(K[me],O,U,X,Q,se,!1)}function Qs(K,O,U,X){K.push(O),K.push(U),K.push(X)}function ki(K,O,U,X,Q,se){var me=(se-O)/(X-O);return K.push(se),K.push(U+(Q-U)*me),K.push(1),me}function Bl(K,O,U,X,Q,se){var me=(se-U)/(Q-U);return K.push(O+(X-O)*me),K.push(se),K.push(1),me}function zn(K,O){for(var U=[],X=0;X<K.length;X++){var Q,se=K[X],me=se.type;if("Point"===me||"MultiPoint"===me||"LineString"===me)Q=Ri(se.geometry,O);else if("MultiLineString"===me||"Polygon"===me){Q=[];for(var de=0;de<se.geometry.length;de++)Q.push(Ri(se.geometry[de],O))}else if("MultiPolygon"===me)for(Q=[],de=0;de<se.geometry.length;de++){for(var ue=[],ye=0;ye<se.geometry[de].length;ye++)ue.push(Ri(se.geometry[de][ye],O));Q.push(ue)}U.push(Ys(se.id,me,Q,se.tags))}return U}function Ri(K,O){var U=[];U.size=K.size,void 0!==K.start&&(U.start=K.start,U.end=K.end);for(var X=0;X<K.length;X+=3)U.push(K[X]+O,K[X+1],K[X+2]);return U}function Ha(K,O){if(K.transformed)return K;var U,X,Q,se=1<<K.z,me=K.x,de=K.y;for(U=0;U<K.features.length;U++){var ue=K.features[U],ye=ue.geometry,Me=ue.type;if(ue.geometry=[],1===Me)for(X=0;X<ye.length;X+=2)ue.geometry.push(co(ye[X],ye[X+1],O,se,me,de));else for(X=0;X<ye.length;X++){var Ae=[];for(Q=0;Q<ye[X].length;Q+=2)Ae.push(co(ye[X][Q],ye[X][Q+1],O,se,me,de));ue.geometry.push(Ae)}}return K.transformed=!0,K}function co(K,O,U,X,Q,se){return[Math.round(U*(K*X-Q)),Math.round(U*(O*X-se))]}function ea(K,O,U,X,Q){for(var se=O===Q.maxZoom?0:Q.tolerance/((1<<O)*Q.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:X,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},de=0;de<K.length;de++){me.numFeatures++,Ts(me,K[de],se,Q);var ue=K[de].minX,ye=K[de].minY,Me=K[de].maxX,Ae=K[de].maxY;ue<me.minX&&(me.minX=ue),ye<me.minY&&(me.minY=ye),Me>me.maxX&&(me.maxX=Me),Ae>me.maxY&&(me.maxY=Ae)}return me}function Ts(K,O,U,X){var Q=O.geometry,se=O.type,me=[];if("Point"===se||"MultiPoint"===se)for(var de=0;de<Q.length;de+=3)me.push(Q[de]),me.push(Q[de+1]),K.numPoints++,K.numSimplified++;else if("LineString"===se)Mo(me,Q,K,U,!1,!1);else if("MultiLineString"===se||"Polygon"===se)for(de=0;de<Q.length;de++)Mo(me,Q[de],K,U,"Polygon"===se,0===de);else if("MultiPolygon"===se)for(var ue=0;ue<Q.length;ue++){var ye=Q[ue];for(de=0;de<ye.length;de++)Mo(me,ye[de],K,U,!0,0===de)}if(me.length){var Me=O.tags||null;if("LineString"===se&&X.lineMetrics){for(var Ae in Me={},O.tags)Me[Ae]=O.tags[Ae];Me.mapbox_clip_start=Q.start/Q.size,Me.mapbox_clip_end=Q.end/Q.size}var Fe={geometry:me,type:"Polygon"===se||"MultiPolygon"===se?3:"LineString"===se||"MultiLineString"===se?2:1,tags:Me};null!==O.id&&(Fe.id=O.id),K.features.push(Fe)}}function Mo(K,O,U,X,Q,se){var me=X*X;if(X>0&&O.size<(Q?me:X))U.numPoints+=O.length/3;else{for(var de=[],ue=0;ue<O.length;ue+=3)(0===X||O[ue+2]>me)&&(U.numSimplified++,de.push(O[ue]),de.push(O[ue+1])),U.numPoints++;Q&&function(ye,Me){for(var Ae=0,Fe=0,ot=ye.length,ft=ot-2;Fe<ot;ft=Fe,Fe+=2)Ae+=(ye[Fe]-ye[ft])*(ye[Fe+1]+ye[ft+1]);if(Ae>0===Me)for(Fe=0,ot=ye.length;Fe<ot/2;Fe+=2){var pt=ye[Fe],mt=ye[Fe+1];ye[Fe]=ye[ot-2-Fe],ye[Fe+1]=ye[ot-1-Fe],ye[ot-2-Fe]=pt,ye[ot-1-Fe]=mt}}(de,se),K.push(de)}}function yr(K,O){var U=(O=this.options=function(Q,se){for(var me in se)Q[me]=se[me];return Q}(Object.create(this.options),O)).debug;if(U&&console.time("preprocess data"),O.maxZoom<0||O.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(O.promoteId&&O.generateId)throw new Error("promoteId and generateId cannot be used together.");var Q,se,me,de,ue,ye,X=function(Q,se){var me=[];if("FeatureCollection"===Q.type)for(var de=0;de<Q.features.length;de++)Ga(me,Q.features[de],se,de);else Ga(me,"Feature"===Q.type?Q:{geometry:Q},se);return me}(K,O);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",O.indexMaxZoom,O.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Q=X,se=O,me=se.buffer/se.extent,de=Q,ue=qi(Q,1,-1-me,me,0,-1,2,se),ye=qi(Q,1,1-me,2+me,0,-1,2,se),(ue||ye)&&(de=qi(Q,1,-me,1+me,0,-1,2,se)||[],ue&&(de=zn(ue,1).concat(de)),ye&&(de=de.concat(zn(ye,-1)))),X=de).length&&this.splitTile(X,0,0,0),U&&(X.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ds(K,O,U){return 32*((1<<K)*U+O)+K}function So(K,O){const U=K.tileID.canonical;if(!this._geoJSONIndex)return O(null,null);const X=this._geoJSONIndex.getTile(U.z,U.x,U.y);if(!X)return O(null,null);const Q=new Al(X.features);let se=Wo(Q);0===se.byteOffset&&se.byteLength===se.buffer.byteLength||(se=new Uint8Array(se)),O(null,{vectorTile:Q,rawData:se.buffer})}yr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yr.prototype.splitTile=function(K,O,U,X,Q,se,me){for(var de=[K,O,U,X],ue=this.options,ye=ue.debug;de.length;){X=de.pop(),U=de.pop(),O=de.pop(),K=de.pop();var Me=1<<O,Ae=Ds(O,U,X),Fe=this.tiles[Ae];if(!Fe&&(ye>1&&console.time("creation"),Fe=this.tiles[Ae]=ea(K,O,U,X,ue),this.tileCoords.push({z:O,x:U,y:X}),ye)){ye>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",O,U,X,Fe.numFeatures,Fe.numPoints,Fe.numSimplified),console.timeEnd("creation"));var ot="z"+O;this.stats[ot]=(this.stats[ot]||0)+1,this.total++}if(Fe.source=K,Q){if(O===ue.maxZoom||O===Q)continue;var ft=1<<Q-O;if(U!==Math.floor(se/ft)||X!==Math.floor(me/ft))continue}else if(O===ue.indexMaxZoom||Fe.numPoints<=ue.indexMaxPoints)continue;if(Fe.source=null,0!==K.length){ye>1&&console.time("clipping");var pt,mt,Lt,Sn,On,Tn,kn=.5*ue.buffer/ue.extent,Ms=.5-kn,Ko=.5+kn,hn=1+kn;pt=mt=Lt=Sn=null,On=qi(K,Me,U-kn,U+Ko,0,Fe.minX,Fe.maxX,ue),Tn=qi(K,Me,U+Ms,U+hn,0,Fe.minX,Fe.maxX,ue),K=null,On&&(pt=qi(On,Me,X-kn,X+Ko,1,Fe.minY,Fe.maxY,ue),mt=qi(On,Me,X+Ms,X+hn,1,Fe.minY,Fe.maxY,ue),On=null),Tn&&(Lt=qi(Tn,Me,X-kn,X+Ko,1,Fe.minY,Fe.maxY,ue),Sn=qi(Tn,Me,X+Ms,X+hn,1,Fe.minY,Fe.maxY,ue),Tn=null),ye>1&&console.timeEnd("clipping"),de.push(pt||[],O+1,2*U,2*X),de.push(mt||[],O+1,2*U,2*X+1),de.push(Lt||[],O+1,2*U+1,2*X),de.push(Sn||[],O+1,2*U+1,2*X+1)}}},yr.prototype.getTile=function(K,O,U){var X=this.options,Q=X.extent,se=X.debug;if(K<0||K>24)return null;var me=1<<K,de=Ds(K,O=(O%me+me)%me,U);if(this.tiles[de])return Ha(this.tiles[de],Q);se>1&&console.log("drilling down to z%d-%d-%d",K,O,U);for(var ue,ye=K,Me=O,Ae=U;!ue&&ye>0;)ye--,Me=Math.floor(Me/2),Ae=Math.floor(Ae/2),ue=this.tiles[Ds(ye,Me,Ae)];return ue&&ue.source?(se>1&&console.log("found parent tile z%d-%d-%d",ye,Me,Ae),se>1&&console.time("drilling down"),this.splitTile(ue.source,ye,Me,Ae,K,O,U),se>1&&console.timeEnd("drilling down"),this.tiles[de]?Ha(this.tiles[de],Q):null):null};class qa extends p.VectorTileWorkerSource{constructor(O,U,X,Q,se){super(O,U,X,Q,So),se&&(this.loadGeoJSON=se)}loadData(O,U){const X=O&&O.request,Q=X&&X.collectResourceTiming;this.loadGeoJSON(O,(se,me)=>{if(se||!me)return U(se);if("object"!=typeof me)return U(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));{Pe(me,!0);try{if(O.filter){const ue=p.createExpression(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ue.result)throw new Error(ue.value.map(Me=>`${Me.key}: ${Me.message}`).join(", "));const ye=me.features.filter(Me=>ue.value.evaluate({zoom:0},Me));me={type:"FeatureCollection",features:ye}}this._geoJSONIndex=O.cluster?new Ks(function({superclusterOptions:ue,clusterProperties:ye}){if(!ye||!ue)return ue;const Me={},Ae={},Fe={accumulated:null,zoom:0},ot={properties:null},ft=Object.keys(ye);for(const pt of ft){const[mt,Lt]=ye[pt],Sn=p.createExpression(Lt),On=p.createExpression("string"==typeof mt?[mt,["accumulated"],["get",pt]]:mt);Me[pt]=Sn.value,Ae[pt]=On.value}return ue.map=pt=>{ot.properties=pt;const mt={};for(const Lt of ft)mt[Lt]=Me[Lt].evaluate(Fe,ot);return mt},ue.reduce=(pt,mt)=>{ot.properties=mt;for(const Lt of ft)Fe.accumulated=pt[Lt],pt[Lt]=Ae[Lt].evaluate(Fe,ot)},ue}(O)).load(me.features):new yr(ue=me,O.geojsonVtOptions)}catch(ue){return U(ue)}this.loaded={};const de={};if(Q){const ue=p.getPerformanceMeasurement(X);ue&&(de.resourceTiming={},de.resourceTiming[O.source]=JSON.parse(JSON.stringify(ue)))}U(null,de)}var ue})}reloadTile(O,U){const X=this.loaded;return X&&X[O.uid]?super.reloadTile(O,U):this.loadTile(O,U)}loadGeoJSON(O,U){if(O.request)p.getJSON(O.request,U);else{if("string"!=typeof O.data)return U(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));try{return U(null,JSON.parse(O.data))}catch(X){return U(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(O,U){try{U(null,this._geoJSONIndex.getClusterExpansionZoom(O.clusterId))}catch(X){U(X)}}getClusterChildren(O,U){try{U(null,this._geoJSONIndex.getChildren(O.clusterId))}catch(X){U(X)}}getClusterLeaves(O,U){try{U(null,this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset))}catch(X){U(X)}}}class Li{constructor(O){this.self=O,this.actor=new p.Actor(O,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:qa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(U,X)=>{if(this.workerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.workerSourceTypes[U]=X},this.self.registerRTLTextPlugin=U=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=U.applyArabicShaping,p.plugin.processBidirectionalText=U.processBidirectionalText,p.plugin.processStyledBidirectionalText=U.processStyledBidirectionalText}}clearCaches(O,U,X){delete this.layerIndexes[O],delete this.availableImages[O],delete this.workerSources[O],delete this.demWorkerSources[O],X()}checkIfReady(O,U,X){X()}setReferrer(O,U){this.referrer=U}spriteLoaded(O,U){this.isSpriteLoaded[O]=U;for(const X in this.workerSources[O]){const Q=this.workerSources[O][X];for(const se in Q)Q[se]instanceof p.VectorTileWorkerSource&&(Q[se].isSpriteLoaded=U,Q[se].fire(new p.Event("isSpriteLoaded")))}}setImages(O,U,X){this.availableImages[O]=U;for(const Q in this.workerSources[O]){const se=this.workerSources[O][Q];for(const me in se)se[me].availableImages=U}X()}enableTerrain(O,U,X){this.terrain=U,X()}setProjection(O,U){this.projections[O]=p.getProjection(U)}setLayers(O,U,X){this.getLayerIndex(O).replace(U),X()}updateLayers(O,U,X){this.getLayerIndex(O).update(U.layers,U.removedIds),X()}loadTile(O,U,X){const Q=this.enableTerrain?p.extend({enableTerrain:this.terrain},U):U;Q.projection=this.projections[O]||this.defaultProjection,this.getWorkerSource(O,U.type,U.source).loadTile(Q,X)}loadDEMTile(O,U,X){const Q=this.enableTerrain?p.extend({buildQuadTree:this.terrain},U):U;this.getDEMWorkerSource(O,U.source).loadTile(Q,X)}reloadTile(O,U,X){const Q=this.enableTerrain?p.extend({enableTerrain:this.terrain},U):U;Q.projection=this.projections[O]||this.defaultProjection,this.getWorkerSource(O,U.type,U.source).reloadTile(Q,X)}abortTile(O,U,X){this.getWorkerSource(O,U.type,U.source).abortTile(U,X)}removeTile(O,U,X){this.getWorkerSource(O,U.type,U.source).removeTile(U,X)}removeSource(O,U,X){if(!this.workerSources[O]||!this.workerSources[O][U.type]||!this.workerSources[O][U.type][U.source])return;const Q=this.workerSources[O][U.type][U.source];delete this.workerSources[O][U.type][U.source],void 0!==Q.removeSource?Q.removeSource(U,X):X()}loadWorkerSource(O,U,X){try{this.self.importScripts(U.url),X()}catch(Q){X(Q.toString())}}syncRTLPluginState(O,U,X){try{p.plugin.setState(U);const Q=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=Q){this.self.importScripts(Q);const se=p.plugin.isParsed();X(se?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Q}`),se)}}catch(Q){X(Q.toString())}}getAvailableImages(O){let U=this.availableImages[O];return U||(U=[]),U}getLayerIndex(O){let U=this.layerIndexes[O];return U||(U=this.layerIndexes[O]=new pi),U}getWorkerSource(O,U,X){return this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][U]||(this.workerSources[O][U]={}),this.workerSources[O][U][X]||(this.workerSources[O][U][X]=new this.workerSourceTypes[U]({send:(Q,se,me,de,ue,ye)=>{this.actor.send(Q,se,me,O,ue,ye)},scheduler:this.actor.scheduler},this.getLayerIndex(O),this.getAvailableImages(O),this.isSpriteLoaded[O])),this.workerSources[O][U][X]}getDEMWorkerSource(O,U){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][U]||(this.demWorkerSources[O][U]=new wt),this.demWorkerSources[O][U]}enforceCacheSizeLimit(O,U){p.enforceCacheSizeLimit(U)}getWorkerPerformanceMetrics(O,U,X){X(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Li(self)),Li}),Au(0,function(p){var Yn=qo;function qo(m){return o=m,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,b=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(b);try{v=new Worker(C),g=!0}catch(M){g=!1}return v&&v.terminate(),URL.revokeObjectURL(C),g}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var b=v.getImageData(0,0,1,1);return b&&b.width===g.width}()||(void 0===pi[u=o&&o.failIfMajorPerformanceCaveat]&&(pi[u]=function(g){var v,C,M,k,b=(C=g,M=document.createElement("canvas"),(k=Object.create(qo.webGLContextAttributes)).failIfMajorPerformanceCaveat=C,M.getContext("webgl",k)||M.getContext("experimental-webgl",k));if(!b)return!1;try{v=b.createShader(b.VERTEX_SHADER)}catch(C){return!1}return!(!v||b.isContextLost())&&(b.shaderSource(v,"void main() {}"),b.compileShader(v),!0===b.getShaderParameter(v,b.COMPILE_STATUS))}(u)),!pi[u]||document.documentMode));var o,u}var pi={};function Je(m,o){var u=o[0],g=o[1],v=o[2],b=o[3],C=u*b-v*g;return C?(m[0]=b*(C=1/C),m[1]=-g*C,m[2]=-v*C,m[3]=u*C,m):null}function wt(m,o){if(Array.isArray(m)){if(!Array.isArray(o)||m.length!==o.length)return!1;for(let u=0;u<m.length;u++)if(!wt(m[u],o[u]))return!1;return!0}if("object"==typeof m&&null!==m&&null!==o){if("object"!=typeof o||Object.keys(m).length!==Object.keys(o).length)return!1;for(const u in m)if(!wt(m[u],o[u]))return!1;return!0}return m===o}qo.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Pe={create:function(m,o,u){const g=p.window.document.createElement(m);return void 0!==o&&(g.className=o),u&&u.appendChild(g),g},createSVG:function(m,o,u){const g=p.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(const v of Object.keys(o))g.setAttributeNS(null,v,o[v]);return u&&u.appendChild(g),g}},Ai=p.window.document&&p.window.document.documentElement.style,Ln=Ai&&void 0!==Ai.userSelect?"userSelect":"WebkitUserSelect";let Il;Pe.disableDrag=function(){Ai&&Ln&&(Il=Ai[Ln],Ai[Ln]="none")},Pe.enableDrag=function(){Ai&&Ln&&(Ai[Ln]=Il)};const fi=function(m){m.preventDefault(),m.stopPropagation(),p.window.removeEventListener("click",fi,!0)};function Al(m,o,u){const g=m.offsetWidth===o.width?1:m.offsetWidth/o.width;return new p.pointGeometry((u.clientX-o.left)*g,(u.clientY-o.top)*g)}function so(m){const{userImage:o}=m;return!!(o&&o.render&&o.render())&&(m.data.replace(new Uint8Array(o.data.buffer)),!0)}Pe.suppressClick=function(){p.window.addEventListener("click",fi,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",fi,!0)},0)},Pe.mousePos=function(m,o){const u=m.getBoundingClientRect();return Al(m,u,o)},Pe.touchPos=function(m,o){const u=m.getBoundingClientRect(),g=[];for(let v=0;v<o.length;v++)g.push(Al(m,u,o[v]));return g},Pe.mouseButton=function(m){return void 0!==p.window.InstallTrigger&&2===m.button&&m.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button};class Tr extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:u,callback:g}of this.requestors)this._notify(u,g);this.requestors=[]}}getImage(o){return this.images[o]}addImage(o,u){this._validate(o,u)&&(this.images[o]=u)}_validate(o,u){let g=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),g=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),g=!1),this._validateContent(u.content,u)||(this.fire(new p.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),g=!1),g}_validateStretch(o,u){if(!o)return!0;let g=0;for(const v of o){if(v[0]<g||v[1]<v[0]||u<v[1])return!1;g=v[1]}return!0}_validateContent(o,u){return!(o&&(4!==o.length||o[0]<0||u.data.width<o[0]||o[1]<0||u.data.height<o[1]||o[2]<0||u.data.width<o[2]||o[3]<0||u.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,u){u.version=this.images[o].version+1,this.images[o]=u,this.updatedImages[o]=!0}removeImage(o){const u=this.images[o];delete this.images[o],delete this.patterns[o],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,u){let g=!0;if(!this.isLoaded())for(const v of o)this.images[v]||(g=!1);this.isLoaded()||g?this._notify(o,u):this.requestors.push({ids:o,callback:u})}_notify(o,u){const g={};for(const v of o){this.images[v]||this.fire(new p.Event("styleimagemissing",{id:v}));const b=this.images[v];b?g[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:p.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,g)}getPixelSize(){const{width:o,height:u}=this.atlasImage;return{width:o,height:u}}getPattern(o){const u=this.patterns[o],g=this.getImage(o);if(!g)return null;if(u&&u.position.version===g.version)return u.position;if(u)u.position.version=g.version;else{const v={w:g.data.width+2,h:g.data.height+2,x:0,y:0},b=new p.ImagePosition(v,g);this.patterns[o]={bin:v,position:b}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const u=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(o,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const b in this.patterns)o.push(this.patterns[b].bin);const{w:u,h:g}=p.potpack(o),v=this.atlasImage;v.resize({width:u||1,height:g||1});for(const b in this.patterns){const{bin:C}=this.patterns[b],M=C.x+1,k=C.y+1,R=this.images[b].data,L=R.width,B=R.height;p.RGBAImage.copy(R,v,{x:0,y:0},{x:M,y:k},{width:L,height:B}),p.RGBAImage.copy(R,v,{x:0,y:B-1},{x:M,y:k-1},{width:L,height:1}),p.RGBAImage.copy(R,v,{x:0,y:0},{x:M,y:k+B},{width:L,height:1}),p.RGBAImage.copy(R,v,{x:L-1,y:0},{x:M-1,y:k},{width:1,height:B}),p.RGBAImage.copy(R,v,{x:0,y:0},{x:M+L,y:k},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const u of o){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const g=this.images[u];so(g)&&this.updateImage(u,g)}}}const Zo=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(m,o){return function([u,g,v]){const b=p.degToRad(g+90),C=p.degToRad(v);return{x:u*Math.cos(b)*Math.sin(C),y:u*Math.sin(b)*Math.sin(C),z:u*Math.cos(C),azimuthal:g,polar:v}}(m.expression.evaluate(o))}interpolate(m,o,u){return{x:p.number(m.x,o.x,u),y:p.number(m.y,o.y,u),z:p.number(m.z,o.z,u),azimuthal:p.number(m.azimuthal,o.azimuthal,u),polar:p.number(m.polar,o.polar,u)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)}),To="-transition";class Wo extends p.Evented{constructor(o){super(),this._transitionable=new p.Transitionable(Zo),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,u={}){if(!this._validate(p.validateLight,o,u))for(const g in o){const v=o[g];p.endsWith(g,To)?this._transitionable.setTransition(g.slice(0,-To.length),v):this._transitionable.setValue(g,v)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,g){return(!g||!1!==g.validate)&&p.emitValidationErrors(this,o.call(p.validateStyle,p.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const xs=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)}),Xo="-transition";class Pl extends p.Evented{constructor(o,u){super(),this._transitionable=new p.Transitionable(xs),this.set(o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=u}get(){return this._transitionable.serialize()}set(o){for(const u in o){const g=o[u];p.endsWith(u,Xo)?this._transitionable.setTransition(u.slice(0,-Xo.length),g):this._transitionable.setValue(u,g)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}}function ao(m,o,u,g){const v=p.smoothstep(45,65,u),[b,C]=kl(m,g),M=p.length(o);let k=1-Math.min(1,Math.exp((M-b)/(C-b)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*v*m.alpha}function kl(m,o){const u=.5/Math.tan(.5*o);return[m.range[0]+u,m.range[1]+u]}const bs=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"])}),$i="-transition";class Yh extends p.Evented{constructor(o,u){super(),this._transitionable=new p.Transitionable(bs),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=u}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,u={}){if(!this._validate(p.validateFog,o,u))for(const g in o){const v=o[g];p.endsWith(g,$i)?this._transitionable.setTransition(g.slice(0,-$i.length),v):this._transitionable.setValue(g,v)}}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return p.smoothstep(45,65,o)*u.a}getOpacityAtLatLng(o,u){return this._transform.projection.supportsFog?function(g,v,b){const C=p.MercatorCoordinate.fromLngLat(v),M=b.elevation?b.elevation.getAtPointOrZero(C):0,k=[C.x,C.y,M];return p.transformMat4(k,k,b.mercatorFogMatrix),ao(g,k,b.pitch,b._fov)}(this.state,o,u):0}getFovAdjustedRange(o){return this._transform.projection.supportsFog?kl(this.state,o):[0,1]}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,g){return(!g||!1!==g.validate)&&p.emitValidationErrors(this,o.call(p.validateStyle,p.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class lo{constructor(o,u){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const g=this.workerPool.acquire(this.id);for(let v=0;v<g.length;v++){const b=new lo.Actor(g[v],u,this.id);b.name=`Worker ${v}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,u,g){p.asyncAll(this.actors,(v,b)=>{v.send(o,u,b)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function sn(m,o,u){return o*(p.EXTENT/(m.tileSize*Math.pow(2,u-m.tileID.overscaledZ)))}lo.Actor=p.Actor;class Xs{constructor(o,u,g){this.context=o;const v=o.gl;this.buffer=v.createBuffer(),this.dynamicDraw=Boolean(g),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Do={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ua{constructor(o,u,g,v){this.length=u.length,this.attributes=g,this.itemSize=u.bytesPerElement,this.dynamicDraw=v,this.context=o;const b=o.gl;this.buffer=b.createBuffer(),o.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,u){for(let g=0;g<this.attributes.length;g++){const v=u.attributes[this.attributes[g].name];void 0!==v&&o.enableVertexAttribArray(v)}}setVertexAttribPointers(o,u,g){for(let v=0;v<this.attributes.length;v++){const b=this.attributes[v],C=u.attributes[b.name];void 0!==C&&o.vertexAttribPointer(C,b.components,o[Do[b.type]],!1,this.itemSize,b.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Xt{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Gi extends Xt{getDefault(){return p.Color.transparent}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class ws extends Xt{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Es extends Xt{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class _r extends Xt{getDefault(){return[!0,!0,!0,!0]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Jn extends Xt{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Gt extends Xt{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Ks extends Xt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const u=this.current;(o.func!==u.func||o.ref!==u.ref||o.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Pu extends Xt{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Rl extends Xt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=o,this.dirty=!1}}class Lc extends Xt{getDefault(){return[0,1]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class ku extends Xt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=o,this.dirty=!1}}class Ll extends Xt{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Nt extends Xt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.BLEND):u.disable(u.BLEND),this.current=o,this.dirty=!1}}class Pi extends Xt{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class ja extends Xt{getDefault(){return p.Color.transparent}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Va extends Xt{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Oc extends Xt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=o,this.dirty=!1}}class $a extends Xt{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class _n extends Xt{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Ys extends Xt{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Cs extends Xt{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Ga extends Xt{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Hi extends Xt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Xn extends Xt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Fc extends Xt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Ol extends Xt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class zc extends Xt{getDefault(){return null}set(o){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class qi extends Xt{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class Ru extends Xt{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Fl extends Xt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class zl extends Xt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Js extends Xt{constructor(o,u){super(o),this.context=o,this.parent=u}getDefault(){return null}}class Qs extends Js{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class ki extends Js{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Bl extends ki{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class zn{constructor(o,u,g,v){this.context=o,this.width=u,this.height=g;const b=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new Qs(o,b),v&&(this.depthAttachment=new ki(o,b))}destroy(){const o=this.context.gl,u=this.colorAttachment.get();if(u&&o.deleteTexture(u),this.depthAttachment){const g=this.depthAttachment.get();g&&o.deleteRenderbuffer(g)}o.deleteFramebuffer(this.framebuffer)}}class Ri{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Gi(this),this.clearDepth=new ws(this),this.clearStencil=new Es(this),this.colorMask=new _r(this),this.depthMask=new Jn(this),this.stencilMask=new Gt(this),this.stencilFunc=new Ks(this),this.stencilOp=new Pu(this),this.stencilTest=new Rl(this),this.depthRange=new Lc(this),this.depthTest=new ku(this),this.depthFunc=new Ll(this),this.blend=new Nt(this),this.blendFunc=new Pi(this),this.blendColor=new ja(this),this.blendEquation=new Va(this),this.cullFace=new Oc(this),this.cullFaceSide=new $a(this),this.frontFace=new _n(this),this.program=new Ys(this),this.activeTexture=new Cs(this),this.viewport=new Ga(this),this.bindFramebuffer=new Hi(this),this.bindRenderbuffer=new Xn(this),this.bindTexture=new Fc(this),this.bindVertexBuffer=new Ol(this),this.bindElementBuffer=new zc(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new qi(this),this.pixelStoreUnpack=new Ru(this),this.pixelStoreUnpackPremultiplyAlpha=new Fl(this),this.pixelStoreUnpackFlipY=new zl(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,u){return new Xs(this,o,u)}createVertexBuffer(o,u,g){return new Ua(this,o,u,g)}createRenderbuffer(o,u,g){const v=this.gl,b=v.createRenderbuffer();return this.bindRenderbuffer.set(b),v.renderbufferStorage(v.RENDERBUFFER,o,u,g),this.bindRenderbuffer.set(null),b}createFramebuffer(o,u,g){return new zn(this,o,u,g)}clear({color:o,depth:u,stencil:g}){const v=this.gl;let b=0;o&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),void 0!==u&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),void 0!==g&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),v.clear(b)}setCullFace(o){!1===o.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){wt(o.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ha{constructor(o,u,g,v){this.screenBounds=o,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(b=>v.pointCoordinate3D(b)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(o,u){let g,v;if(o instanceof p.pointGeometry||"number"==typeof o[0]){const b=p.pointGeometry.convert(o);g=[p.pointGeometry.convert(o)],v=u.isPointAboveHorizon(b)}else{const b=p.pointGeometry.convert(o[0]),C=p.pointGeometry.convert(o[1]);g=[b,C],v=p.polygonizeBounds(b,C).every(M=>u.isPointAboveHorizon(M))}return new Ha(g,u.getCameraPoint(),v,u)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(o){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const u=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new p.pointGeometry(1,1)):this.screenBounds[1],v=p.polygonizeBounds(u,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(v[3]=this.cameraPoint)),p.bufferConvexPolygon(v,o)}containsTile(o,u,g){const v=o.queryPadding+1,b=o.tileID.wrap,C=g?this._bufferedCameraMercator(v,u).map(H=>p.getTilePoint(o.tileTransform,H,b)):this._bufferedScreenMercator(v,u).map(H=>p.getTilePoint(o.tileTransform,H,b)),M=this.screenGeometryMercator.map(H=>p.getTileVec3(o.tileTransform,H,b)),k=M.map(H=>new p.pointGeometry(H[0],H[1])),R=u.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),L=p.getTileVec3(o.tileTransform,R,b),B=M.map(H=>{const W=p.sub(H,H,L);return p.normalize(W,W),new p.Ray(L,W)}),V=sn(o,1,u.zoom);if(p.polygonIntersectsBox(C,0,0,p.EXTENT,p.EXTENT))return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:B,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(Z=p.getBounds(C),Z.min.x=p.clamp(Z.min.x,0,p.EXTENT),Z.min.y=p.clamp(Z.min.y,0,p.EXTENT),Z.max.x=p.clamp(Z.max.x,0,p.EXTENT),Z.max.y=p.clamp(Z.max.y,0,p.EXTENT),Z),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:V};var Z}_bufferedScreenMercator(o,u){const g=co(o);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{const v=this.bufferedScreenGeometry(o).map(b=>u.pointCoordinate3D(b));return this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(o,u){const g=co(o);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{const v=this.bufferedCameraGeometry(o).map(b=>u.pointCoordinate3D(b));return this._cameraRaycastCache[g]=v,v}}}function co(m){return 100*m|0}function ea(m,o,u){const g=function(v,b){if(v)return u(v);if(b){const C=p.pick(p.extend(b,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(C.vectorLayers=b.vector_layers,C.vectorLayerIds=C.vectorLayers.map(M=>M.id)),C.tiles=o.canonicalizeTileset(C,m.url),u(null,C)}};return m.url?p.getJSON(o.transformRequest(o.normalizeSourceURL(m.url),p.ResourceType.Source),g):p.exported.frame(()=>g(null,m))}class Ts{constructor(o,u,g){this.bounds=p.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=u||0,this.maxzoom=g||24}validateBounds(o){return Array.isArray(o)&&4===o.length?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const u=Math.pow(2,o.z),g=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*u),v=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*u),b=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*u),C=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*u);return o.x>=g&&o.x<b&&o.y>=v&&o.y<C}}class Mo extends p.Evented{constructor(o,u,g,v){super(),this.id=o,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},u),p.extend(this,p.pick(u,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ea(this._options,this.map._requestManager,(o,u)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new p.ErrorEvent(o)):u&&(p.extend(this,u),u.bounds&&(this.tileBounds=new Ts(u.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(u.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return p.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,u){const g=p.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);o.request=p.getImage(this.map._requestManager.transformRequest(v,p.ResourceType.Tile),(b,C,M,k)=>{if(delete o.request,o.aborted)o.state="unloaded",u(null);else if(b)o.state="errored",u(b);else if(C){this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:M,expires:k});const R=this.map.painter.context,L=R.gl;o.texture=this.map.painter.getTileTexture(C.width),o.texture?o.texture.update(C,{useMipmap:!0}):(o.texture=new p.Texture(R,C,L.RGBA,{useMipmap:!0}),o.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE),R.extTextureFilterAnisotropic&&L.texParameterf(L.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax)),o.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),u(null)}})}abortTile(o,u){o.request&&(o.request.cancel(),delete o.request),u()}unloadTile(o,u){o.texture&&this.map.painter.saveTileTexture(o.texture),u()}hasTransition(){return!1}}let yr;function Ds(m,o,u,g,v,b,C,M){const k=[m,u,v,o,g,b,1,1,1],R=[C,M,1],L=p.adjoint([],k),[B,V,Z]=p.transformMat3(R,R,p.transpose(L,L));return p.multiply(k,[B,0,0,0,V,0,0,0,Z],k)}class So extends p.Evented{constructor(o,u,g,v){super(),this.id=o,this.dispatcher=g,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=u}load(o,u){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(g,v)=>{this._loaded=!0,g?this.fire(new p.ErrorEvent(g)):v&&(this.image=p.exported.getImageData(v),this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),u&&u(),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}setCoordinates(o){this.coordinates=o,delete this._boundsArray;const u=o.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(g){let v=1/0,b=1/0,C=-1/0,M=-1/0;for(const B of g)v=Math.min(v,B.x),b=Math.min(b,B.y),C=Math.max(C,B.x),M=Math.max(M,B.y);const k=Math.max(C-v,M-b),R=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),L=Math.pow(2,R);return new p.CanonicalTileID(R,Math.floor((v+C)/2*L),Math.floor((b+M)/2*L))}(u),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const o=p.tileTransform(this.tileID,this.map.transform.projection),[u,g,v,b]=this.coordinates.map(C=>{const M=o.projection.project(C[0],C[1]);return p.getTilePoint(o,M)._round()});return this.perspectiveTransform=function(C,M,k,R,L,B,V,Z,H,W){const ae=Ds(0,0,C,0,0,M,C,M),G=Ds(k,R,L,B,V,Z,H,W);return p.multiply(G,p.adjoint(ae,ae),G),[G[6]/G[8]*C/p.EXTENT,G[7]/G[8]*M/p.EXTENT]}(this.width,this.height,u.x,u.y,g.x,g.y,b.x,b.y,v.x,v.y),this._boundsArray=new p.StructArrayLayout4i8,this._boundsArray.emplaceBack(u.x,u.y,0,0),this._boundsArray.emplaceBack(g.x,g.y,p.EXTENT,0),this._boundsArray.emplaceBack(b.x,b.y,0,p.EXTENT),this._boundsArray.emplaceBack(v.x,v.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const o=this.map.painter.context,u=o.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,p.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new p.Texture(o,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));for(const g in this.tiles){const v=this.tiles[g];"loaded"!==v.state&&(v.state="loaded",v.texture=this.texture)}}loadTile(o,u){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},u(null)):(o.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const qa={vector:class extends p.Evented{constructor(m,o,u,g){if(super(),this.id=m,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(o,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ea(this._options,this.map._requestManager,(m,o)=>{this._tileJSONRequest=null,this._loaded=!0,m?this.fire(new p.ErrorEvent(m)):o&&(p.extend(this,o),o.bounds&&(this.tileBounds=new Ts(o.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(o.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}onAdd(m){this.map=m,this.load()}setSourceProperty(m){this._tileJSONRequest&&this._tileJSONRequest.cancel(),m();const o=this.map.style._getSourceCaches(this.id);for(const u of o)u.clearTiles();this.load()}setTiles(m){return this.setSourceProperty(()=>{this._options.tiles=m}),this}setUrl(m){return this.setSourceProperty(()=>{this.url=m,this._options.url=m}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return p.extend({},this._options)}loadTile(m,o){const u=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(u,p.ResourceType.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:m.isSymbolTile};if(g.request.collectResourceTiming=this._collectResourceTiming,m.actor&&"expired"!==m.state)"loading"===m.state?m.reloadCallback=o:m.request=m.actor.send("reloadTile",g,v.bind(this));else if(m.actor=this._tileWorkers[u]=this._tileWorkers[u]||this.dispatcher.getActor(),this.dispatcher.ready)m.request=m.actor.send("loadTile",g,v.bind(this),void 0,!0);else{const b=p.loadVectorTile.call({deduped:this._deduped},g,(C,M)=>{C||!M?v.call(this,C):(g.data={cacheControl:M.cacheControl,expires:M.expires,rawData:M.rawData.slice(0)},m.actor&&m.actor.send("loadTile",g,v.bind(this),void 0,!0))},!0);m.request={cancel:b}}function v(b,C){return delete m.request,m.aborted?o(null):b&&404!==b.status?o(b):(C&&C.resourceTiming&&(m.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&m.setExpiryData(C),m.loadVectorData(C,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(m.reloadCallback&&(this.loadTile(m,m.reloadCallback),m.reloadCallback=null)))}}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.actor&&m.actor.send("abortTile",{uid:m.uid,type:this.type,source:this.id})}unloadTile(m){m.unloadVectorData(),m.actor&&m.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Mo,"raster-dem":class extends Mo{constructor(m,o,u,g){super(m,o,u,g),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(m,o){const u=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,b){v&&(m.state="errored",o(v)),b&&(m.dem=b,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",o(null))}m.request=p.getImage(this.map._requestManager.transformRequest(u,p.ResourceType.Tile),function(v,b,C,M){if(delete m.request,m.aborted)m.state="unloaded",o(null);else if(v)m.state="errored",o(v);else if(b){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:C,expires:M});const k=p.window.ImageBitmap&&b instanceof p.window.ImageBitmap&&(null==yr&&(yr=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),yr),R=1-(b.width-p.prevPowerOfTwo(b.width))/2;R<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const L=k?b:p.exported.getImageData(b,R),B={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:R};m.actor&&"expired"!==m.state||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",B,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const o=m.canonical,u=Math.pow(2,o.z),g=(o.x-1+u)%u,v=0===o.x?m.wrap-1:m.wrap,b=(o.x+1+u)%u,C=o.x+1===u?m.wrap+1:m.wrap,M={};return M[new p.OverscaledTileID(m.overscaledZ,v,o.z,g,o.y).key]={backfilled:!1},M[new p.OverscaledTileID(m.overscaledZ,C,o.z,b,o.y).key]={backfilled:!1},o.y>0&&(M[new p.OverscaledTileID(m.overscaledZ,v,o.z,g,o.y-1).key]={backfilled:!1},M[new p.OverscaledTileID(m.overscaledZ,m.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},M[new p.OverscaledTileID(m.overscaledZ,C,o.z,b,o.y-1).key]={backfilled:!1}),o.y+1<u&&(M[new p.OverscaledTileID(m.overscaledZ,v,o.z,g,o.y+1).key]={backfilled:!1},M[new p.OverscaledTileID(m.overscaledZ,m.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},M[new p.OverscaledTileID(m.overscaledZ,C,o.z,b,o.y+1).key]={backfilled:!1}),M}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends p.Evented{constructor(m,o,u,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(g),this._data=o.data,this._options=p.extend({},o),this._collectResourceTiming=o.collectResourceTiming,void 0!==o.maxzoom&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const v=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(void 0!==o.buffer?o.buffer:128)*v,tolerance:(void 0!==o.tolerance?o.tolerance:.375)*v,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:void 0!==o.clusterMaxZoom?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==o.clusterRadius?o.clusterRadius:50)*v,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},o),this}getClusterChildren(m,o){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},o),this}getClusterLeaves(m,o,u,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:o,offset:u},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const m=p.extend({},this.workerOptions),o=this._data;"string"==typeof o?(m.request=this.map._requestManager.transformRequest(p.exported.resolveURL(o),p.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(u,g)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new p.ErrorEvent(u));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v.resourceTiming=g.resourceTiming[this.id]),this.fire(new p.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,o){const u=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(u,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(g,v)=>(delete m.request,m.unloadVectorData(),m.aborted?o(null):g?o(g):(m.loadVectorData(v,this.map.painter,"reloadTile"===u),o(null))),void 0,"loadTile"===u)}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends So{constructor(m,o,u,g){super(m,o,u,g),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const o of m.urls)this.urls.push(this.map._requestManager.transformRequest(o,p.ResourceType.Source).url);p.getVideo(this.urls,(o,u)=>{this._loaded=!0,o?this.fire(new p.ErrorEvent(o)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const o=this.video.seekable;m<o.start(0)||m>o.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const m=this.map.painter.context,o=m.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(m,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,p.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2));for(const u in this.tiles){const g=this.tiles[u];"loaded"!==g.state&&(g.state="loaded",g.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:So,canvas:class extends So{constructor(m,o,u,g){super(m,o,u,g),o.coordinates?Array.isArray(o.coordinates)&&4===o.coordinates.length&&!o.coordinates.some(v=>!Array.isArray(v)||2!==v.length||v.some(b=>"number"!=typeof b))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),o.animate&&"boolean"!=typeof o.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),o.canvas?"string"==typeof o.canvas||o.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=o,this.animate=void 0===o.animate||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const o=this.map.painter.context,u=o.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,p.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(o,this.canvas,u.RGBA,{premultiply:!0});for(const g in this.tiles){const v=this.tiles[g];"loaded"!==v.state&&(v.state="loaded",v.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}}},Li=function(m,o,u,g){const v=new qa[o.type](m,o,u,g);if(v.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${v.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],v),v};function K(m,o){const u=p.identity([]);return p.scale(u,u,[.5*m.width,.5*-m.height,1]),p.translate(u,u,[1,-1,0]),p.multiply$1(u,u,m.calculateProjMatrix(o.toUnwrapped()))}function O(m,o,u,g,v,b,C,M=!1){const k=m.tilesIn(g,C,M);k.sort(X);const R=[];for(const B of k)R.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(o,u,m._state,B,v,b,K(m.transform,B.tile.tileID),M)});const L=function(B){const V={},Z={};for(const H of B){const W=H.queryResults,ae=H.wrappedTileID,G=Z[ae]=Z[ae]||{};for(const re in W){const ee=W[re],ne=G[re]=G[re]||{},ie=V[re]=V[re]||[];for(const le of ee)ne[le.featureIndex]||(ne[le.featureIndex]=!0,ie.push(le))}}return V}(R);for(const B in L)L[B].forEach(V=>{const Z=V.feature,H=m.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=H});return L}function U(m,o){const u=m.getRenderableIds().map(b=>m.getTileByID(b)),g=[],v={};for(let b=0;b<u.length;b++){const C=u[b],M=C.tileID.canonical.key;v[M]||(v[M]=!0,C.querySourceFeatures(g,o))}return g}function X(m,o){const u=m.tileID,g=o.tileID;return u.overscaledZ-g.overscaledZ||u.canonical.y-g.canonical.y||u.wrap-g.wrap||u.canonical.x-g.canonical.x}function Q(){return null!=Bs.workerClass?new Bs.workerClass:new p.window.Worker(Bs.workerUrl)}const se="mapboxgl_preloaded_worker_pool";class me{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<me.workerCount;)this.workers.push(new Q);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[se]}numActive(){return Object.keys(this.active).length}}let de;function ue(){return de||(de=new me),de}function ye(m,o){const u={};for(const g in m)"ref"!==g&&(u[g]=m[g]);return p.refProperties.forEach(g=>{g in o&&(u[g]=o[g])}),u}function Me(m){m=m.slice();const o=Object.create(null);for(let u=0;u<m.length;u++)o[m[u].id]=m[u];for(let u=0;u<m.length;u++)"ref"in m[u]&&(m[u]=ye(m[u],o[m[u].ref]));return m}me.workerCount=2;const Ae={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Fe(m,o,u){u.push({command:Ae.addSource,args:[m,o[m]]})}function ot(m,o,u){o.push({command:Ae.removeSource,args:[m]}),u[m]=!0}function ft(m,o,u,g){ot(m,u,g),Fe(m,o,u)}function pt(m,o,u){let g;for(g in m[u])if(m[u].hasOwnProperty(g)&&"data"!==g&&!wt(m[u][g],o[u][g]))return!1;for(g in o[u])if(o[u].hasOwnProperty(g)&&"data"!==g&&!wt(m[u][g],o[u][g]))return!1;return!0}function mt(m,o,u,g,v,b){let C;for(C in o=o||{},m=m||{})m.hasOwnProperty(C)&&(wt(m[C],o[C])||u.push({command:b,args:[g,C,o[C],v]}));for(C in o)o.hasOwnProperty(C)&&!m.hasOwnProperty(C)&&(wt(m[C],o[C])||u.push({command:b,args:[g,C,o[C],v]}))}function Lt(m){return m.id}function Sn(m,o){return m[o.id]=o,m}class On{constructor(o,u){this.reset(o,u)}reset(o,u){this.points=o||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(1===this.points.length)return this.points[0];o=p.clamp(o,0,1);let u=1,g=this._distances[u];const v=o*this.paddedLength+this.padding;for(;g<v&&u<this._distances.length;)g=this._distances[++u];const b=u-1,C=this._distances[b],M=g-C,k=M>0?(v-C)/M:0;return this.points[b].mult(1-k).add(this.points[u].mult(k))}}class Tn{constructor(o,u,g){const v=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(o/g),this.yCellCount=Math.ceil(u/g);for(let C=0;C<this.xCellCount*this.yCellCount;C++)v.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=u,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,u,g,v,b){this._forEachCell(u,g,v,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(b)}insertCircle(o,u,g,v){this._forEachCell(u-v,g-v,u+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(u),this.circles.push(g),this.circles.push(v)}_insertBoxCell(o,u,g,v,b,C){this.boxCells[b].push(C)}_insertCircleCell(o,u,g,v,b,C){this.circleCells[b].push(C)}_query(o,u,g,v,b,C){if(g<0||o>this.width||v<0||u>this.height)return!b&&[];const M=[];if(o<=0&&u<=0&&this.width<=g&&this.height<=v){if(b)return!0;for(let k=0;k<this.boxKeys.length;k++)M.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const R=this.circles[3*k],L=this.circles[3*k+1],B=this.circles[3*k+2];M.push({key:this.circleKeys[k],x1:R-B,y1:L-B,x2:R+B,y2:L+B})}return C?M.filter(C):M}return this._forEachCell(o,u,g,v,this._queryCell,M,{hitTest:b,seenUids:{box:{},circle:{}}},C),b?M.length>0:M}_queryCircle(o,u,g,v,b){const C=o-g,M=o+g,k=u-g,R=u+g;if(M<0||C>this.width||R<0||k>this.height)return!v&&[];const L=[];return this._forEachCell(C,k,M,R,this._queryCellCircle,L,{hitTest:v,circle:{x:o,y:u,radius:g},seenUids:{box:{},circle:{}}},b),v?L.length>0:L}query(o,u,g,v,b){return this._query(o,u,g,v,!1,b)}hitTest(o,u,g,v,b){return this._query(o,u,g,v,!0,b)}hitTestCircle(o,u,g,v){return this._queryCircle(o,u,g,!0,v)}_queryCell(o,u,g,v,b,C,M,k){const R=M.seenUids,L=this.boxCells[b];if(null!==L){const V=this.bboxes;for(const Z of L)if(!R.box[Z]){R.box[Z]=!0;const H=4*Z;if(o<=V[H+2]&&u<=V[H+3]&&g>=V[H+0]&&v>=V[H+1]&&(!k||k(this.boxKeys[Z]))){if(M.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[Z],x1:V[H],y1:V[H+1],x2:V[H+2],y2:V[H+3]})}}}const B=this.circleCells[b];if(null!==B){const V=this.circles;for(const Z of B)if(!R.circle[Z]){R.circle[Z]=!0;const H=3*Z;if(this._circleAndRectCollide(V[H],V[H+1],V[H+2],o,u,g,v)&&(!k||k(this.circleKeys[Z]))){if(M.hitTest)return C.push(!0),!0;{const W=V[H],ae=V[H+1],G=V[H+2];C.push({key:this.circleKeys[Z],x1:W-G,y1:ae-G,x2:W+G,y2:ae+G})}}}}}_queryCellCircle(o,u,g,v,b,C,M,k){const R=M.circle,L=M.seenUids,B=this.boxCells[b];if(null!==B){const Z=this.bboxes;for(const H of B)if(!L.box[H]){L.box[H]=!0;const W=4*H;if(this._circleAndRectCollide(R.x,R.y,R.radius,Z[W+0],Z[W+1],Z[W+2],Z[W+3])&&(!k||k(this.boxKeys[H])))return C.push(!0),!0}}const V=this.circleCells[b];if(null!==V){const Z=this.circles;for(const H of V)if(!L.circle[H]){L.circle[H]=!0;const W=3*H;if(this._circlesCollide(Z[W],Z[W+1],Z[W+2],R.x,R.y,R.radius)&&(!k||k(this.circleKeys[H])))return C.push(!0),!0}}}_forEachCell(o,u,g,v,b,C,M,k){const R=this._convertToXCellCoord(o),L=this._convertToYCellCoord(u),B=this._convertToXCellCoord(g),V=this._convertToYCellCoord(v);for(let Z=R;Z<=B;Z++)for(let H=L;H<=V;H++)if(b.call(this,o,u,g,v,this.xCellCount*H+Z,C,M,k))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,u,g,v,b,C){const M=v-o,k=b-u,R=g+C;return R*R>M*M+k*k}_circleAndRectCollide(o,u,g,v,b,C,M){const k=(C-v)/2,R=Math.abs(o-(v+k));if(R>k+g)return!1;const L=(M-b)/2,B=Math.abs(u-(b+L));if(B>L+g)return!1;if(R<=k||B<=L)return!0;const V=R-k,Z=B-L;return V*V+Z*Z<=g*g}}const kn=Math.tan(85*Math.PI/180);function Ms(m,o,u,g,v,b){let C=p.create();if(u){if("globe"===v.projection.name)C=p.calculateGlobeMatrix(v,v.worldSize/v._projectionScaler,[0,0]),p.multiply$1(C,C,p.globeDenormalizeECEF(p.globeTileBounds(o)));else{const M=Je([],b);C[0]=M[0],C[1]=M[1],C[4]=M[2],C[5]=M[3]}g||p.rotateZ(C,C,v.angle)}else p.multiply$1(C,v.labelPlaneMatrix,m);return C}function Ko(m,o,u,g,v,b){if(u){if("globe"===v.projection.name){const C=Ms(m,o,u,g,v,b);return p.invert(C,C),p.multiply$1(C,m,C),C}{const C=p.clone(m),M=p.identity([]);return M[0]=b[0],M[1]=b[1],M[4]=b[2],M[5]=b[3],p.multiply$1(C,C,M),g||p.rotateZ(C,C,-v.angle),C}}return v.glCoordMatrix}function hn(m,o,u=0){const g=[m.x,m.y,u,1];u?p.transformMat4$1(g,g,o):Wa(g,g,o);const v=g[3];return{point:new p.pointGeometry(g[0]/v,g[1]/v),signedDistanceFromCamera:v}}function Io(m,o){return Math.min(.5+m/o*.5,1.5)}function ta(m,o){const u=m[0]/m[3],g=m[1]/m[3];return u>=-o[0]&&u<=o[0]&&g>=-o[1]&&g<=o[1]}function Jh(m,o,u,g,v,b,C,M,k,R){const L=u.transform,B=g?m.textSizeData:m.iconSizeData,V=p.evaluateSizeForZoom(B,u.transform.zoom),Z=[256/u.width*2+1,256/u.height*2+1],H=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;H.clear();const W=m.lineVertexArray,ae=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,G=u.transform.width/u.transform.height;let re=!1;for(let ee=0;ee<ae.length;ee++){const ne=ae.get(ee);if(ne.writingMode!==p.WritingMode.vertical||re||0!==ee&&ae.get(ee-1).writingMode===p.WritingMode.horizontal||(re=!0),ne.hidden||ne.writingMode===p.WritingMode.vertical&&!re){vt(ne.numGlyphs,H);continue}re=!1;const ie=new p.pointGeometry(ne.tileAnchorX,ne.tileAnchorY),le=k?k(ie):[0,0,0],_e=L.projection.projectTilePoint(ie.x,ie.y,R.canonical),xe=[_e.x+le[0],_e.y+le[1],_e.z+le[2]],qe=[...xe,1];if(p.transformMat4$1(qe,qe,o),!ta(qe,Z)){vt(ne.numGlyphs,H);continue}const Oe=Io(u.transform.cameraToCenterDistance,qe[3]),Le=p.evaluateSizeForFeature(B,V,ne),be=C?Le/Oe:Le*Oe,ve=hn(new p.pointGeometry(xe[0],xe[1]),v,xe[2]);if(ve.signedDistanceFromCamera<=0){vt(ne.numGlyphs,H);continue}let ke={};const Se=C?null:k,rt=Ul(ne,be,!1,M,o,v,b,m.glyphOffsetArray,W,H,ve.point,ie,ke,G,Se,L.projection,R);re=rt.useVertical,Se&&rt.needsFlipping&&(ke={}),(rt.notEnoughRoom||re||rt.needsFlipping&&Ul(ne,be,!0,M,o,v,b,m.glyphOffsetArray,W,H,ve.point,ie,ke,G,Se,L.projection,R).notEnoughRoom)&&vt(ne.numGlyphs,H)}g?m.text.dynamicLayoutVertexBuffer.updateData(H):m.icon.dynamicLayoutVertexBuffer.updateData(H)}function Nl(m,o,u,g,v,b,C,M,k,R,L,B,V,Z,H){const W=M.glyphStartIndex+M.numGlyphs,ae=M.lineStartIndex,G=M.lineStartIndex+M.lineLength,re=o.getoffsetX(M.glyphStartIndex),ee=o.getoffsetX(W-1),ne=jl(m*re,u,g,v,b,C,M.segment,ae,G,k,R,L,B,V,!0,Z,H);if(!ne)return null;const ie=jl(m*ee,u,g,v,b,C,M.segment,ae,G,k,R,L,B,V,!0,Z,H);return ie?{first:ne,last:ie}:null}function yn(m,o,u,g){return m.writingMode===p.WritingMode.horizontal&&Math.abs(u.y-o.y)>Math.abs(u.x-o.x)*g?{useVertical:!0}:m.writingMode===p.WritingMode.vertical?o.y<u.y?{needsFlipping:!0}:null:0!==m.flipState&&function(v,b,C){const M=(b.x-v.x)*C;return 0===M||Math.abs((b.y-v.y)/M)>kn}(o,u,g)?1===m.flipState?{needsFlipping:!0}:null:o.x>u.x?{needsFlipping:!0}:null}function Ul(m,o,u,g,v,b,C,M,k,R,L,B,V,Z,H,W,ae){const G=o/24,re=m.lineOffsetX*G,ee=m.lineOffsetY*G;let ne;if(m.numGlyphs>1){const ie=m.glyphStartIndex+m.numGlyphs,le=m.lineStartIndex,_e=m.lineStartIndex+m.lineLength,xe=Nl(G,M,re,ee,u,L,B,m,k,b,V,H,!1,W,ae);if(!xe)return{notEnoughRoom:!0};const qe=hn(xe.first.point,C).point,Oe=hn(xe.last.point,C).point;if(g&&!u){const Le=yn(m,qe,Oe,Z);if(m.flipState=Le&&Le.needsFlipping?1:2,Le)return Le}ne=[xe.first];for(let Le=m.glyphStartIndex+1;Le<ie-1;Le++)ne.push(jl(G*M.getoffsetX(Le),re,ee,u,L,B,m.segment,le,_e,k,b,V,H,!1,!1,W,ae));ne.push(xe.last)}else{if(g&&!u){const le=hn(B,v).point,_e=m.lineStartIndex+m.segment+1,xe=new p.pointGeometry(k.getx(_e),k.gety(_e)),qe=hn(xe,v),Oe=yn(m,le,qe.signedDistanceFromCamera>0?qe.point:Za(B,xe,le,1,v,void 0,W,ae.canonical),Z);if(m.flipState=Oe&&Oe.needsFlipping?1:2,Oe)return Oe}const ie=jl(G*M.getoffsetX(m.glyphStartIndex),re,ee,u,L,B,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,k,b,V,H,!1,!1,W,ae);if(!ie)return{notEnoughRoom:!0};ne=[ie]}for(const ie of ne)p.addDynamicAttributes(R,ie.point,ie.angle);return{}}function fn(m,o,u,g,v){const b=g.projectTilePoint(m.x,m.y,o);if(!v)return hn(b,u,b.z);const C=v(m);return hn(new p.pointGeometry(b.x+C[0],b.y+C[1]),u,b.z+C[2])}function Za(m,o,u,g,v,b,C,M){const k=fn(m.add(m.sub(o)._unit()),M,v,C,b).point,R=u.sub(k);return u.add(R._mult(g/R.mag()))}function jl(m,o,u,g,v,b,C,M,k,R,L,B,V,Z,H,W,ae){const G=g?m-o:m+o;let re=G>0?1:-1,ee=0;g&&(re*=-1,ee=Math.PI),re<0&&(ee+=Math.PI);let ne=re>0?M+C:M+C+1,ie=v,le=v,_e=0,xe=0;const qe=Math.abs(G),Oe=[],Le=[];let be=b;const ve=()=>{const He=ne-re;return 0===_e?b:new p.pointGeometry(R.getx(He),R.gety(He))},ke=()=>Za(ve(),be,le,qe-_e+1,L,V,W,ae.canonical);for(;_e+xe<=qe;){if(ne+=re,ne<M||ne>=k)return null;if(le=ie,Oe.push(ie),Z&&Le.push(be||ve()),ie=B[ne],void 0===ie){be=new p.pointGeometry(R.getx(ne),R.gety(ne));const He=fn(be,ae.canonical,L,W,V);ie=He.signedDistanceFromCamera>0?B[ne]=He.point:ke()}else be=null;_e+=xe,xe=le.dist(ie)}H&&V&&(be=be||new p.pointGeometry(R.getx(ne),R.gety(ne)),B[ne]=ie=void 0===B[ne]?ie:ke(),xe=le.dist(ie));const Se=(qe-_e)/xe,rt=ie.sub(le),dt=rt.mult(Se)._add(le);u&&dt._add(rt._unit()._perp()._mult(u*re));const At=ee+Math.atan2(ie.y-le.y,ie.x-le.x);return Oe.push(dt),Z&&(be=be||new p.pointGeometry(R.getx(ne),R.gety(ne)),Le.push(function(He,ut,yt){const mn=1-yt;return new p.pointGeometry(He.x*mn+ut.x*yt,He.y*mn+ut.y*yt)}(Le.length>0?Le[Le.length-1]:be,be,Se))),{point:dt,angle:At,path:Oe,tilePath:Le}}const Vl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function vt(m,o){for(let u=0;u<m;u++){const g=o.length;o.resize(g+4),o.float32.set(Vl,3*g)}}function Wa(m,o,u){const g=o[0],v=o[1];return m[0]=u[0]*g+u[4]*v+u[12],m[1]=u[1]*g+u[5]*v+u[13],m[3]=u[3]*g+u[7]*v+u[15],m}const Yo=100;class vn{constructor(o,u,g=new Tn(o.width+200,o.height+200,25),v=new Tn(o.width+200,o.height+200,25)){this.transform=o,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Yo,this.screenBottomBoundary=o.height+Yo,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=u}placeCollisionBox(o,u,g,v,b,C,M){let k=u.projectedAnchorX,R=u.projectedAnchorY,L=u.projectedAnchorZ;const B=u.elevation,V=u.tileID;if(B&&V){const ne=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),ie=ne.upVector(V.canonical,u.tileAnchorX,u.tileAnchorY),le=ne.upVectorScale(V.canonical);k+=ie[0]*B*le,R+=ie[1]*B*le,L+=ie[2]*B*le}const Z=this.projectAndGetPerspectiveRatio(C,k,R,L,u.tileID),H=b*Z.perspectiveRatio,W=(u.x1*o+g.x-u.padding)*H+Z.point.x,ae=(u.y1*o+g.y-u.padding)*H+Z.point.y,G=(u.x2*o+g.x+u.padding)*H+Z.point.x,re=(u.y2*o+g.y+u.padding)*H+Z.point.y,ee=Z.perspectiveRatio<=.55||Z.aboveHorizon;return!this.isInsideGrid(W,ae,G,re)||!v&&this.grid.hitTest(W,ae,G,re,M)||ee?{box:[],offscreen:!1}:{box:[W,ae,G,re],offscreen:this.isOffscreen(W,ae,G,re)}}placeCollisionCircles(o,u,g,v,b,C,M,k,R,L,B,V,Z,H){const W=[],ae=this.transform.elevation,G=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),re=ae?ae.getAtTileOffsetFunc(H,G):Se=>[0,0,0],ee=new p.pointGeometry(u.tileAnchorX,u.tileAnchorY),ne=this.transform.projection.projectTilePoint(u.tileAnchorX,u.tileAnchorY,H.canonical),ie=re(ee),le=[ne.x+ie[0],ne.y+ie[1],ne.z+ie[2]],_e=this.projectAndGetPerspectiveRatio(C,le[0],le[1],le[2],H),{perspectiveRatio:xe}=_e,qe=(L?b/xe:b*xe)/p.ONE_EM,Oe=hn(new p.pointGeometry(le[0],le[1]),M,le[2]).point,Le=_e.signedDistanceFromCamera>0?Nl(qe,v,u.lineOffsetX*qe,u.lineOffsetY*qe,!1,Oe,ee,u,g,M,{},ae&&!L?re:null,L&&!!ae,this.transform.projection,H):null;let be=!1,ve=!1,ke=!0;if(Le&&!_e.aboveHorizon){const Se=.5*V*xe+Z,rt=new p.pointGeometry(-100,-100),dt=new p.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),At=new On,He=Le.first,ut=Le.last;let yt=[];for(let bt=He.path.length-1;bt>=1;bt--)yt.push(He.path[bt]);for(let bt=1;bt<ut.path.length;bt++)yt.push(ut.path[bt]);const mn=2.5*Se;if(k){const bt=yt.map(ae?(Bt,Mn)=>{const or=re(Mn<He.path.length-1?He.tilePath[He.path.length-1-Mn]:ut.tilePath[Mn-He.path.length+2]);return hn(Bt,k,or[2])}:Bt=>hn(Bt,k));yt=bt.some(Bt=>Bt.signedDistanceFromCamera<=0)?[]:bt.map(Bt=>Bt.point)}let Dn=[];if(yt.length>0){const bt=yt[0].clone(),Bt=yt[0].clone();for(let Mn=1;Mn<yt.length;Mn++)bt.x=Math.min(bt.x,yt[Mn].x),bt.y=Math.min(bt.y,yt[Mn].y),Bt.x=Math.max(Bt.x,yt[Mn].x),Bt.y=Math.max(Bt.y,yt[Mn].y);Dn=bt.x>=rt.x&&Bt.x<=dt.x&&bt.y>=rt.y&&Bt.y<=dt.y?[yt]:Bt.x<rt.x||bt.x>dt.x||Bt.y<rt.y||bt.y>dt.y?[]:p.clipLine([yt],rt.x,rt.y,dt.x,dt.y)}for(const bt of Dn){At.reset(bt,.25*Se);let Bt=0;Bt=At.length<=.5*Se?1:Math.ceil(At.paddedLength/mn)+1;for(let Mn=0;Mn<Bt;Mn++){const or=Mn/Math.max(Bt-1,1),Gr=At.lerp(or),ii=Gr.x+Yo,Yi=Gr.y+Yo;W.push(ii,Yi,Se,0);const Ht=ii-Se,gt=Yi-Se,jt=ii+Se,Pn=Yi+Se;if(ke=ke&&this.isOffscreen(Ht,gt,jt,Pn),ve=ve||this.isInsideGrid(Ht,gt,jt,Pn),!o&&this.grid.hitTestCircle(ii,Yi,Se,B)&&(be=!0,!R))return{circles:[],offscreen:!1,collisionDetected:be}}}}return{circles:!R&&be||!ve?[]:W,offscreen:ke,collisionDetected:be}}queryRenderedSymbols(o){if(0===o.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const u=[];let g=1/0,v=1/0,b=-1/0,C=-1/0;for(const L of o){const B=new p.pointGeometry(L.x+Yo,L.y+Yo);g=Math.min(g,B.x),v=Math.min(v,B.y),b=Math.max(b,B.x),C=Math.max(C,B.y),u.push(B)}const M=this.grid.query(g,v,b,C).concat(this.ignoredGrid.query(g,v,b,C)),k={},R={};for(const L of M){const B=L.key;if(void 0===k[B.bucketInstanceId]&&(k[B.bucketInstanceId]={}),k[B.bucketInstanceId][B.featureIndex])continue;const V=[new p.pointGeometry(L.x1,L.y1),new p.pointGeometry(L.x2,L.y1),new p.pointGeometry(L.x2,L.y2),new p.pointGeometry(L.x1,L.y2)];p.polygonIntersectsPolygon(u,V)&&(k[B.bucketInstanceId][B.featureIndex]=!0,void 0===R[B.bucketInstanceId]&&(R[B.bucketInstanceId]=[]),R[B.bucketInstanceId].push(B.featureIndex))}return R}insertCollisionBox(o,u,g,v,b){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:b},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,u,g,v,b){const C=u?this.ignoredGrid:this.grid,M={bucketInstanceId:g,featureIndex:v,collisionGroupID:b};for(let k=0;k<o.length;k+=4)C.insertCircle(M,o[k],o[k+1],o[k+2])}projectAndGetPerspectiveRatio(o,u,g,v,b){const C=[u,g,v||0,1];let M=!1;if(v||this.transform.pitch>0){p.transformMat4$1(C,C,o);let k=!1;this.fogState&&b&&(k=function(R,L,B,V,Z,H){const W=H.calculateFogTileMatrix(Z),ae=[L,B,V];return p.transformMat4(ae,ae,W),ao(R,ae,H.pitch,H._fov)}(this.fogState,u,g,v||0,b.toUnwrapped(),this.transform)>.9),M=C[2]>C[3]||k}else Wa(C,C,o);return{point:new p.pointGeometry((C[0]/C[3]+1)/2*this.transform.width+Yo,(-C[1]/C[3]+1)/2*this.transform.height+Yo),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/C[3]*.5,1.5),signedDistanceFromCamera:C[3],aboveHorizon:M}}isOffscreen(o,u,g,v){return g<Yo||o>=this.screenRightBoundary||v<Yo||u>this.screenBottomBoundary}isInsideGrid(o,u,g,v){return g>=0&&o<this.gridRightBoundary&&v>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const o=p.identity([]);return p.translate(o,o,[-100,-100,0]),o}}class Bc{constructor(o,u,g,v){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?u:-u))):v&&g?1:0,this.placed=g}isHidden(){return 0===this.opacity&&!this.placed}}class Et{constructor(o,u,g,v,b,C=!1){this.text=new Bc(o?o.text:null,u,g,b),this.icon=new Bc(o?o.icon:null,u,v,b),this.clipped=C}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class cr{constructor(o,u,g,v=!1){this.text=o,this.icon=u,this.skipFade=g,this.clipped=v}}class $l{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class Ip{constructor(o,u,g,v,b){this.bucketInstanceId=o,this.featureIndex=u,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=b}}class Ap{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const u=++this.maxGroupID;this.collisionGroups[o]={ID:u,predicate:g=>g.collisionGroupID===u}}return this.collisionGroups[o]}}function na(m,o,u,g,v){const{horizontalAlign:b,verticalAlign:C}=p.getAnchorAlignment(m),M=-(b-.5)*o,k=-(C-.5)*u,R=p.evaluateVariableOffset(m,g);return new p.pointGeometry(M+R[0]*v,k+R[1]*v)}function ur(m,o,u,g,v){const b=new p.pointGeometry(m,o);return u&&b._rotate(g?v:-v),b}class Lu{constructor(o,u,g,v,b){this.transform=o.clone(),this.collisionIndex=new vn(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Ap(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,u,g,v){const b=g.getBucket(u),C=g.latestFeatureIndex;if(!b||!C||u.id!==b.layerIds[0])return;const M=b.layers[0].layout,k=g.collisionBoxArray,R=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),L=g.tileSize/p.EXTENT,B=g.tileID.toUnwrapped(),V=this.transform.calculateProjMatrix(B),Z="map"===M.get("text-pitch-alignment"),H="map"===M.get("text-rotation-alignment");u.compileFilter();const W=u.dynamicFilter(),ae=u.dynamicFilterNeedsFeature(),G=this.transform.calculatePixelsToTileUnitsMatrix(g),re=Ms(V,g.tileID.canonical,Z,H,this.transform,G);let ee=null;if(Z){const le=Ko(V,g.tileID.canonical,Z,H,this.transform,G);ee=p.multiply$1([],this.transform.labelPlaneMatrix,le)}let ne=null;W&&g.latestFeatureIndex&&(ne={unwrappedTileID:B,dynamicFilter:W,dynamicFilterNeedsFeature:ae,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new Ip(b.bucketInstanceId,C,b.sourceLayerIndex,b.index,g.tileID);const ie={bucket:b,layout:M,posMatrix:V,textLabelPlaneMatrix:re,labelToScreenMatrix:ee,clippingData:ne,scale:R,textPixelRatio:L,holdingForFade:g.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(v)for(const le of b.sortKeyRanges){const{sortKey:_e,symbolInstanceStart:xe,symbolInstanceEnd:qe}=le;o.push({sortKey:_e,symbolInstanceStart:xe,symbolInstanceEnd:qe,parameters:ie})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:ie})}attemptAnchorPlacement(o,u,g,v,b,C,M,k,R,L,B,V,Z,H,W,ae,G,re){const ee=[V.textOffset0,V.textOffset1],ne=na(o,g,v,ee,b),ie=this.collisionIndex.placeCollisionBox(b,u,ur(ne.x,ne.y,C,M,this.transform.angle),B,k,R,L.predicate);if((!ae||0!==this.collisionIndex.placeCollisionBox(H.getSymbolInstanceIconSize(re,this.transform.zoom,Z),ae,ur(ne.x,ne.y,C,M,this.transform.angle),B,k,R,L.predicate).box.length)&&ie.box.length>0){let le;return this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(le=this.prevPlacement.variableOffsets[V.crossTileID].anchor),this.variableOffsets[V.crossTileID]={textOffset:ee,width:g,height:v,anchor:o,textScale:b,prevAnchor:le},this.markUsedJustification(H,o,V,W),H.allowVerticalPlacement&&(this.markUsedOrientation(H,W,V),this.placedOrientations[V.crossTileID]=W),{shift:ne,placedGlyphBoxes:ie}}}placeLayerBucketPart(o,u,g,v){const{bucket:b,layout:C,posMatrix:M,textLabelPlaneMatrix:k,labelToScreenMatrix:R,clippingData:L,textPixelRatio:B,holdingForFade:V,collisionBoxArray:Z,partiallyEvaluatedTextSize:H,partiallyEvaluatedIconSize:W,collisionGroup:ae}=o.parameters,G=C.get("text-optional"),re=C.get("icon-optional"),ee=C.get("text-allow-overlap"),ne=C.get("icon-allow-overlap"),ie="map"===C.get("text-rotation-alignment"),le="map"===C.get("text-pitch-alignment"),_e="none"!==C.get("icon-text-fit"),xe="viewport-y"===C.get("symbol-z-order"),qe=ee&&(ne||!b.hasIconData()||re),Oe=ne&&(ee||!b.hasTextData()||G);!b.collisionArrays&&Z&&b.deserializeCollisionBoxes(Z),g&&v&&b.updateCollisionDebugBuffers(this.transform.zoom,Z);const Le=(be,ve,ke)=>{if(L){const Ht={zoom:this.transform.zoom,pitch:this.transform.pitch};let gt=null;if(L.dynamicFilterNeedsFeature){const jt=this.retainedQueryData[b.bucketInstanceId];gt=L.featureIndex.loadFeature({featureIndex:be.featureIndex,bucketIndex:jt.bucketIndex,sourceLayerIndex:jt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(Ht,gt,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new p.pointGeometry(be.tileAnchorX,be.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[be.crossTileID]=new cr(!1,!1,!1,!0),void(u[be.crossTileID]=!0)}if(u[be.crossTileID])return;if(V)return void(this.placements[be.crossTileID]=new cr(!1,!1,!1));let Se=!1,rt=!1,dt=!0,At=null,He={box:null,offscreen:null},ut={box:null,offscreen:null},yt=null,mn=null,Dn=null,bt=0,Bt=0,Mn=0;ke.textFeatureIndex?bt=ke.textFeatureIndex:be.useRuntimeCollisionCircles&&(bt=be.featureIndex),ke.verticalTextFeatureIndex&&(Bt=ke.verticalTextFeatureIndex);const or=Ht=>{Ht.tileID=this.retainedQueryData[b.bucketInstanceId].tileID,(this.transform.elevation||Ht.elevation)&&(Ht.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[b.bucketInstanceId].tileID,Ht.tileAnchorX,Ht.tileAnchorY):0)},Gr=ke.textBox;if(Gr){or(Gr);const Ht=jt=>{let Pn=p.WritingMode.horizontal;if(b.allowVerticalPlacement&&!jt&&this.prevPlacement){const oi=this.prevPlacement.placedOrientations[be.crossTileID];oi&&(this.placedOrientations[be.crossTileID]=oi,Pn=oi,this.markUsedOrientation(b,Pn,be))}return Pn},gt=(jt,Pn)=>{if(b.allowVerticalPlacement&&be.numVerticalGlyphVertices>0&&ke.verticalTextBox){for(const oi of b.writingModes)if(oi===p.WritingMode.vertical?(He=Pn(),ut=He):He=jt(),He&&He.box&&He.box.length)break}else He=jt()};if(C.get("text-variable-anchor")){let jt=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[be.crossTileID]){const wn=this.prevPlacement.variableOffsets[be.crossTileID];jt.indexOf(wn.anchor)>0&&(jt=jt.filter(Ji=>Ji!==wn.anchor),jt.unshift(wn.anchor))}const Pn=(wn,Ji,ol)=>{const si=b.getSymbolInstanceTextSize(H,be,this.transform.zoom,ve),Ea=(wn.x2-wn.x1)*si+2*wn.padding,it=(wn.y2-wn.y1)*si+2*wn.padding,ht=_e&&!ne?Ji:null;ht&&or(ht);let dr={box:[],offscreen:!1};const ss=ee?2*jt.length:jt.length;for(let mo=0;mo<ss;++mo){const pr=this.attemptAnchorPlacement(jt[mo%jt.length],wn,Ea,it,si,ie,le,B,M,ae,mo>=jt.length,be,ve,b,ol,ht,H,W);if(pr&&(dr=pr.placedGlyphBoxes,dr&&dr.box&&dr.box.length)){Se=!0,At=pr.shift;break}}return dr};gt(()=>Pn(Gr,ke.iconBox,p.WritingMode.horizontal),()=>{const wn=ke.verticalTextBox;return wn&&or(wn),b.allowVerticalPlacement&&!(He&&He.box&&He.box.length)&&be.numVerticalGlyphVertices>0&&wn?Pn(wn,ke.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null}}),He&&(Se=He.box,dt=He.offscreen);const oi=Ht(He&&He.box);if(!Se&&this.prevPlacement){const wn=this.prevPlacement.variableOffsets[be.crossTileID];wn&&(this.variableOffsets[be.crossTileID]=wn,this.markUsedJustification(b,wn.anchor,be,oi))}}else{const jt=(Pn,oi)=>{const wn=b.getSymbolInstanceTextSize(H,be,this.transform.zoom,ve),Ji=this.collisionIndex.placeCollisionBox(wn,Pn,new p.pointGeometry(0,0),ee,B,M,ae.predicate);return Ji&&Ji.box&&Ji.box.length&&(this.markUsedOrientation(b,oi,be),this.placedOrientations[be.crossTileID]=oi),Ji};gt(()=>jt(Gr,p.WritingMode.horizontal),()=>{const Pn=ke.verticalTextBox;return b.allowVerticalPlacement&&be.numVerticalGlyphVertices>0&&Pn?(or(Pn),jt(Pn,p.WritingMode.vertical)):{box:null,offscreen:null}}),Ht(He&&He.box&&He.box.length)}}if(yt=He,Se=yt&&yt.box&&yt.box.length>0,dt=yt&&yt.offscreen,be.useRuntimeCollisionCircles){const Ht=b.text.placedSymbolArray.get(be.centerJustifiedTextSymbolIndex>=0?be.centerJustifiedTextSymbolIndex:be.verticalPlacedTextSymbolIndex),gt=p.evaluateSizeForFeature(b.textSizeData,H,Ht),jt=C.get("text-padding");mn=this.collisionIndex.placeCollisionCircles(ee,Ht,b.lineVertexArray,b.glyphOffsetArray,gt,M,k,R,g,le,ae.predicate,be.collisionCircleDiameter*gt/p.ONE_EM,jt,this.retainedQueryData[b.bucketInstanceId].tileID),Se=ee||mn.circles.length>0&&!mn.collisionDetected,dt=dt&&mn.offscreen}if(ke.iconFeatureIndex&&(Mn=ke.iconFeatureIndex),ke.iconBox){const Ht=gt=>{or(gt);const jt=_e&&At?ur(At.x,At.y,ie,le,this.transform.angle):new p.pointGeometry(0,0),Pn=b.getSymbolInstanceIconSize(W,this.transform.zoom,ve);return this.collisionIndex.placeCollisionBox(Pn,gt,jt,ne,B,M,ae.predicate)};ut&&ut.box&&ut.box.length&&ke.verticalIconBox?(Dn=Ht(ke.verticalIconBox),rt=Dn.box.length>0):(Dn=Ht(ke.iconBox),rt=Dn.box.length>0),dt=dt&&Dn.offscreen}const ii=G||0===be.numHorizontalGlyphVertices&&0===be.numVerticalGlyphVertices,Yi=re||0===be.numIconVertices;if(ii||Yi?Yi?ii||(rt=rt&&Se):Se=rt&&Se:rt=Se=rt&&Se,Se&&yt&&yt.box&&this.collisionIndex.insertCollisionBox(yt.box,C.get("text-ignore-placement"),b.bucketInstanceId,ut&&ut.box&&Bt?Bt:bt,ae.ID),rt&&Dn&&this.collisionIndex.insertCollisionBox(Dn.box,C.get("icon-ignore-placement"),b.bucketInstanceId,Mn,ae.ID),mn&&(Se&&this.collisionIndex.insertCollisionCircles(mn.circles,C.get("text-ignore-placement"),b.bucketInstanceId,bt,ae.ID),g)){const Ht=b.bucketInstanceId;let gt=this.collisionCircleArrays[Ht];void 0===gt&&(gt=this.collisionCircleArrays[Ht]=new $l);for(let jt=0;jt<mn.circles.length;jt+=4)gt.circles.push(mn.circles[jt+0]),gt.circles.push(mn.circles[jt+1]),gt.circles.push(mn.circles[jt+2]),gt.circles.push(mn.collisionDetected?1:0)}this.placements[be.crossTileID]=new cr(Se||qe,rt||Oe,dt||b.justReloaded),u[be.crossTileID]=!0};if(xe){const be=b.getSortedSymbolIndexes(this.transform.angle);for(let ve=be.length-1;ve>=0;--ve){const ke=be[ve];Le(b.symbolInstances.get(ke),ke,b.collisionArrays[ke])}}else for(let be=o.symbolInstanceStart;be<o.symbolInstanceEnd;be++)Le(b.symbolInstances.get(be),be,b.collisionArrays[be]);if(g&&b.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[b.bucketInstanceId];p.invert(be.invProjMatrix,M),be.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(o,u,g,v){let b;b=v===p.WritingMode.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(u)];const C=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const M of C)M>=0&&(o.text.placedSymbolArray.get(M).crossTileID=b>=0&&M!==b?0:g.crossTileID)}markUsedOrientation(o,u,g){const v=u===p.WritingMode.horizontal||u===p.WritingMode.horizontalOnly?u:0,b=u===p.WritingMode.vertical?u:0,C=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];for(const M of C)o.text.placedSymbolArray.get(M).placedOrientation=v;g.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let g=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const v=u?u.symbolFadeChange(o):1,b=u?u.opacities:{},C=u?u.variableOffsets:{},M=u?u.placedOrientations:{};for(const k in this.placements){const R=this.placements[k],L=b[k];L?(this.opacities[k]=new Et(L,v,R.text,R.icon,null,R.clipped),g=g||R.text!==L.text.placed||R.icon!==L.icon.placed):(this.opacities[k]=new Et(null,v,R.text,R.icon,R.skipFade,R.clipped),g=g||R.text||R.icon)}for(const k in b){const R=b[k];if(!this.opacities[k]){const L=new Et(R,v,!1,!1);L.isHidden()||(this.opacities[k]=L,g=g||R.text.placed||R.icon.placed)}}for(const k in C)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=C[k]);for(const k in M)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=M[k]);g?this.lastPlacementChangeTime=o:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:o)}updateLayerOpacities(o,u){const g={};for(const v of u){const b=v.getBucket(o);b&&v.latestFeatureIndex&&o.id===b.layerIds[0]&&this.updateBucketOpacities(b,g,v.collisionBoxArray)}}updateBucketOpacities(o,u,g){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const v=o.layers[0].layout,b=!!o.layers[0].dynamicFilter(),C=new Et(null,0,!1,!1,!0),M=v.get("text-allow-overlap"),k=v.get("icon-allow-overlap"),R=v.get("text-variable-anchor"),L="map"===v.get("text-rotation-alignment"),B="map"===v.get("text-pitch-alignment"),V="none"!==v.get("icon-text-fit"),Z=new Et(null,0,M&&(k||!o.hasIconData()||v.get("icon-optional")),k&&(M||!o.hasTextData()||v.get("text-optional")),!0);!o.collisionArrays&&g&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(g);const H=(ae,G,re)=>{for(let ee=0;ee<G/4;ee++)ae.opacityVertexArray.emplaceBack(re)};let W=0;for(let ae=0;ae<o.symbolInstances.length;ae++){const G=o.symbolInstances.get(ae),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:ee,crossTileID:ne}=G;let ie=this.opacities[ne];u[ne]?ie=C:ie||(ie=Z,this.opacities[ne]=ie),u[ne]=!0;const le=re>0||ee>0,_e=G.numIconVertices>0,xe=this.placedOrientations[G.crossTileID],qe=xe===p.WritingMode.vertical,Oe=xe===p.WritingMode.horizontal||xe===p.WritingMode.horizontalOnly;if(!le&&!_e||ie.isHidden()||W++,le){const Le=Ou(ie.text);H(o.text,re,qe?As:Le),H(o.text,ee,Oe?As:Le);const be=ie.text.isHidden();[G.rightJustifiedTextSymbolIndex,G.centerJustifiedTextSymbolIndex,G.leftJustifiedTextSymbolIndex].forEach(Se=>{Se>=0&&(o.text.placedSymbolArray.get(Se).hidden=be||qe?1:0)}),G.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(G.verticalPlacedTextSymbolIndex).hidden=be||Oe?1:0);const ve=this.variableOffsets[G.crossTileID];ve&&this.markUsedJustification(o,ve.anchor,G,xe);const ke=this.placedOrientations[G.crossTileID];ke&&(this.markUsedJustification(o,"left",G,ke),this.markUsedOrientation(o,ke,G))}if(_e){const Le=Ou(ie.icon);G.placedIconSymbolIndex>=0&&(H(o.icon,G.numIconVertices,qe?As:Le),o.icon.placedSymbolArray.get(G.placedIconSymbolIndex).hidden=ie.icon.isHidden()),G.verticalPlacedIconSymbolIndex>=0&&(H(o.icon,G.numVerticalIconVertices,Oe?As:Le),o.icon.placedSymbolArray.get(G.verticalPlacedIconSymbolIndex).hidden=ie.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Le=o.collisionArrays[ae];if(Le){let be=new p.pointGeometry(0,0),ve=!0;if(Le.textBox||Le.verticalTextBox){if(R){const Se=this.variableOffsets[ne];Se?(be=na(Se.anchor,Se.width,Se.height,Se.textOffset,Se.textScale),L&&be._rotate(B?this.transform.angle:-this.transform.angle)):ve=!1}b&&(ve=!ie.clipped),Le.textBox&&Ss(o.textCollisionBox.collisionVertexArray,ie.text.placed,!ve||qe,be.x,be.y),Le.verticalTextBox&&Ss(o.textCollisionBox.collisionVertexArray,ie.text.placed,!ve||Oe,be.x,be.y)}const ke=ve&&Boolean(!Oe&&Le.verticalIconBox);Le.iconBox&&Ss(o.iconCollisionBox.collisionVertexArray,ie.icon.placed,ke,V?be.x:0,V?be.y:0),Le.verticalIconBox&&Ss(o.iconCollisionBox.collisionVertexArray,ie.icon.placed,!ke,V?be.x:0,V?be.y:0)}}}if(o.fullyClipped=0===W,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=ae.invProjMatrix,o.placementViewportMatrix=ae.viewportMatrix,o.collisionCircleArray=ae.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return 0===this.fadeDuration?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,u){const g=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*g>o}setStale(){this.stale=!0}}function Ss(m,o,u,g,v){m.emplaceBack(o?1:0,u?1:0,g||0,v||0),m.emplaceBack(o?1:0,u?1:0,g||0,v||0),m.emplaceBack(o?1:0,u?1:0,g||0,v||0),m.emplaceBack(o?1:0,u?1:0,g||0,v||0)}const Ee=Math.pow(2,25),Xe=Math.pow(2,24),Pp=Math.pow(2,17),ra=Math.pow(2,16),tr=Math.pow(2,9),Is=Math.pow(2,8),Ao=Math.pow(2,1);function Ou(m){if(0===m.opacity&&!m.placed)return 0;if(1===m.opacity&&m.placed)return 4294967295;const o=m.placed?1:0,u=Math.floor(127*m.opacity);return u*Ee+o*Xe+u*Pp+o*ra+u*tr+o*Is+u*Ao+o}const As=0;class Qe{constructor(o){this._sortAcrossTiles="viewport-y"!==o.layout.get("symbol-z-order")&&void 0!==o.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,u,g,v,b){const C=this._bucketParts;for(;this._currentTileIndex<o.length;)if(u.getBucketParts(C,v,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((M,k)=>M.sortKey-k.sortKey));this._currentPartIndex<C.length;){const M=C[this._currentPartIndex];if(u.placeLayerBucketPart(M,this._seenCrossTileIDs,g,0===M.symbolInstanceStart),this._currentPartIndex++,b())return!0}return!1}}class xt{constructor(o,u,g,v,b,C,M,k){this.placement=new Lu(o,b,C,M,k),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(o,u,g){const v=p.exported.now(),b=()=>{const C=p.exported.now()-v;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=u[o[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if("symbol"===C.type&&(!C.minzoom||C.minzoom<=M)&&(!C.maxzoom||C.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Qe(C)),this._inProgressLayer.continuePlacement(g[C.source],this.placement,this._showCollisionBoxes,C,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const ct=512/p.EXTENT/2;class Jo{constructor(o,u,g){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=g;for(let v=0;v<u.length;v++){const b=u.get(v),C=b.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,o)})}}getScaledCoordinates(o,u){const g=ct/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*p.EXTENT+o.tileAnchorX)*g),y:Math.floor((u.canonical.y*p.EXTENT+o.tileAnchorY)*g)}}findMatches(o,u,g){const v=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let b=0;b<o.length;b++){const C=o.get(b);if(C.crossTileID)continue;const M=this.indexedSymbolInstances[C.key];if(!M)continue;const k=this.getScaledCoordinates(C,u);for(const R of M)if(Math.abs(R.coord.x-k.x)<=v&&Math.abs(R.coord.y-k.y)<=v&&!g[R.crossTileID]){g[R.crossTileID]=!0,C.crossTileID=R.crossTileID;break}}}}class Gl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ot{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const u=Math.round((o-this.lng)/360);if(0!==u)for(const g in this.indexes){const v=this.indexes[g],b={};for(const C in v){const M=v[C];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+u),b[M.tileID.key]=M}this.indexes[g]=b}this.lng=o}addBucket(o,u,g){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let b=0;b<u.symbolInstances.length;b++)u.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const v=this.usedCrossTileIDs[o.overscaledZ];for(const b in this.indexes){const C=this.indexes[b];if(Number(b)>o.overscaledZ)for(const M in C){const k=C[M];k.tileID.isChildOf(o)&&k.findMatches(u.symbolInstances,o,v)}else{const M=C[o.scaledTo(Number(b)).key];M&&M.findMatches(u.symbolInstances,o,v)}}for(let b=0;b<u.symbolInstances.length;b++){const C=u.symbolInstances.get(b);C.crossTileID||(C.crossTileID=g.generate(),v[C.crossTileID]=!0)}return void 0===this.indexes[o.overscaledZ]&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Jo(o,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(o,u){for(const g in u.indexedSymbolInstances)for(const v of u.indexedSymbolInstances[g])delete this.usedCrossTileIDs[o][v.crossTileID]}removeStaleBuckets(o){let u=!1;for(const g in this.indexes){const v=this.indexes[g];for(const b in v)o[v[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[b]),delete v[b],u=!0)}return u}}class Tt{constructor(){this.layerIndexes={},this.crossTileIDs=new Gl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,u,g,v){let b=this.layerIndexes[o.id];void 0===b&&(b=this.layerIndexes[o.id]=new Ot);let C=!1;const M={};"globe"!==v.name&&b.handleWrapJump(g);for(const k of u){const R=k.getBucket(o);R&&o.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(k.tileID,R,this.crossTileIDs)&&(C=!0),M[R.bucketInstanceId]=!0)}return b.removeStaleBuckets(M)&&(C=!0),C}pruneUnusedLayers(o){const u={};o.forEach(g=>{u[g]=!0});for(const g in this.layerIndexes)u[g]||delete this.layerIndexes[g]}}const ia=(m,o)=>p.emitValidationErrors(m,o&&o.filter(u=>"source.canvas"!==u.identifier)),mi=p.pick(Ae,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),gi=p.pick(Ae,["setCenter","setZoom","setBearing","setPitch"]),Bn=function(){const m={},o=p.spec.$version;for(const u in p.spec.$root){const g=p.spec.$root[u];if(g.required){let v=null;v="version"===u?o:"array"===g.type?[]:{},null!=v&&(m[u]=v)}}return m}(),kp={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class _i extends p.Evented{constructor(o,u={}){super(),this.map=o,this.dispatcher=new lo(ue(),this),this.imageManager=new Tr,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(o._requestManager,u.localFontFamily?p.LocalGlyphMode.all:u.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,u.localFontFamily||u.localIdeographFontFamily),this.lineAtlas=new p.LineAtlas(256,512),this.crossTileSymbolIndex=new Tt,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const g=this;this._rtlTextPluginCallback=_i.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(b,C)=>{if(p.triggerPluginCompletionEvent(b),C&&C.every(M=>M))for(const M in g._sourceCaches){const k=g._sourceCaches[M],R=k.getSource().type;"vector"!==R&&"geojson"!==R||k.reload()}})}),this.on("data",v=>{if("source"!==v.dataType||"metadata"!==v.sourceDataType)return;const b=this.getSource(v.sourceId);if(b&&b.vectorLayerIds)for(const C in this._layers){const M=this._layers[C];M.source===b.id&&this._validateLayer(M)}})}loadURL(o,u={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const g="boolean"==typeof u.validate?u.validate:!p.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,u.accessToken);const v=this.map._requestManager.transformRequest(o,p.ResourceType.Style);this._request=p.getJSON(v,(b,C)=>{this._request=null,b?this.fire(new p.ErrorEvent(b)):C&&this._load(C,g)})}loadJSON(o,u={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(o,!1!==u.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Bn,!1)}_updateLayerCount(o,u){const g=u?1:-1;o.is3D()&&(this._num3DLayers+=g),"circle"===o.type&&(this._numCircleLayers+=g),"symbol"===o.type&&(this._numSymbolLayers+=g)}_load(o,u){if(u&&ia(this,p.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o,this.updateProjection();for(const v in o.sources)this.addSource(v,o.sources[v],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const g=Me(this.stylesheet.layers);this._order=g.map(v=>v.id),this._layers={},this._serializedLayers={};for(let v of g)v=p.createStyleLayer(v),v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Wo(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&0===this.terrain.drapeRenderMode}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const o=this.map.transform.projection,u=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),g=this.map.transform.projection;if(this._loaded&&(g.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),u){if(g.isReprojectedInTileSpace||o.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(o){this._spriteRequest=function(u,g,v){let b,C,M;const k=p.exported.devicePixelRatio>1?"@2x":"";let R=p.getJSON(g.transformRequest(g.normalizeSpriteURL(u,k,".json"),p.ResourceType.SpriteJSON),(V,Z)=>{R=null,M||(M=V,b=Z,B())}),L=p.getImage(g.transformRequest(g.normalizeSpriteURL(u,k,".png"),p.ResourceType.SpriteImage),(V,Z)=>{L=null,M||(M=V,C=Z,B())});function B(){if(M)v(M);else if(b&&C){const V=p.exported.getImageData(C),Z={};for(const H in b){const{width:W,height:ae,x:G,y:re,sdf:ee,pixelRatio:ne,stretchX:ie,stretchY:le,content:_e}=b[H],xe=new p.RGBAImage({width:W,height:ae});p.RGBAImage.copy(V,xe,{x:G,y:re},{x:0,y:0},{width:W,height:ae}),Z[H]={data:xe,pixelRatio:ne,sdf:ee,stretchX:ie,stretchY:le,content:_e}}v(null,Z)}}return{cancel(){R&&(R.cancel(),R=null),L&&(L.cancel(),L=null)}}}(o,this.map._requestManager,(u,g)=>{if(this._spriteRequest=null,u)this.fire(new p.ErrorEvent(u));else if(g)for(const v in g)this.imageManager.addImage(v,g[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(o){const u=this.getSource(o.source);if(!u)return;const g=o.sourceLayer;g&&("geojson"===u.type||u.vectorLayerIds&&-1===u.vectorLayerIds.indexOf(g))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${g}" does not exist on source "${u.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const u=[];for(const g of o){const v=this._layers[g];"custom"!==v.type&&u.push(v.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&kp[o.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const u=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(v.length||b.length)&&this._updateWorkerLayers(v,b);for(const C in this._updatedSources){const M=this._updatedSources[C];"reload"===M?this._reloadSource(C):"clear"===M&&this._clearSource(C)}this._updateTilesForChangedImages();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const g={};for(const v in this._sourceCaches){const b=this._sourceCaches[v];g[v]=b.used,b.used=!1}for(const v of this._order){const b=this._layers[v];if(b.recalculate(o,this._availableImages),!b.isHidden(o.zoom)){const M=this._getLayerSourceCache(b);M&&(M.used=!0)}const C=this.map.painter;if(C){const M=b.getProgramIds();if(!M)continue;const k=b.getProgramConfiguration(o.zoom);for(const R of M)C.useProgram(R,k)}}for(const v in g){const b=this._sourceCaches[v];g[v]!==b.used&&b.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),ia(this,p.validateStyle(o)))return!1;(o=p.clone$1(o)).layers=Me(o.layers);const u=function(v,b){if(!v)return[{command:Ae.setStyle,args:[b]}];let C=[];try{if(!wt(v.version,b.version))return[{command:Ae.setStyle,args:[b]}];wt(v.center,b.center)||C.push({command:Ae.setCenter,args:[b.center]}),wt(v.zoom,b.zoom)||C.push({command:Ae.setZoom,args:[b.zoom]}),wt(v.bearing,b.bearing)||C.push({command:Ae.setBearing,args:[b.bearing]}),wt(v.pitch,b.pitch)||C.push({command:Ae.setPitch,args:[b.pitch]}),wt(v.sprite,b.sprite)||C.push({command:Ae.setSprite,args:[b.sprite]}),wt(v.glyphs,b.glyphs)||C.push({command:Ae.setGlyphs,args:[b.glyphs]}),wt(v.transition,b.transition)||C.push({command:Ae.setTransition,args:[b.transition]}),wt(v.light,b.light)||C.push({command:Ae.setLight,args:[b.light]}),wt(v.fog,b.fog)||C.push({command:Ae.setFog,args:[b.fog]}),wt(v.projection,b.projection)||C.push({command:Ae.setProjection,args:[b.projection]});const M={},k=[];!function(B,V,Z,H){let W;for(W in V=V||{},B=B||{})B.hasOwnProperty(W)&&(V.hasOwnProperty(W)||ot(W,Z,H));for(W in V)V.hasOwnProperty(W)&&(B.hasOwnProperty(W)?wt(B[W],V[W])||("geojson"===B[W].type&&"geojson"===V[W].type&&pt(B,V,W)?Z.push({command:Ae.setGeoJSONSourceData,args:[W,V[W].data]}):ft(W,V,Z,H)):Fe(W,V,Z))}(v.sources,b.sources,k,M);const R=[];v.layers&&v.layers.forEach(B=>{M[B.source]?C.push({command:Ae.removeLayer,args:[B.id]}):R.push(B)});let L=v.terrain;L&&M[L.source]&&(C.push({command:Ae.setTerrain,args:[void 0]}),L=void 0),C=C.concat(k),wt(L,b.terrain)||C.push({command:Ae.setTerrain,args:[b.terrain]}),function(B,V,Z){V=V||[];const H=(B=B||[]).map(Lt),W=V.map(Lt),ae=B.reduce(Sn,{}),G=V.reduce(Sn,{}),re=H.slice(),ee=Object.create(null);let ne,ie,le,_e,xe,qe,Oe;for(ne=0,ie=0;ne<H.length;ne++)le=H[ne],G.hasOwnProperty(le)?ie++:(Z.push({command:Ae.removeLayer,args:[le]}),re.splice(re.indexOf(le,ie),1));for(ne=0,ie=0;ne<W.length;ne++)le=W[W.length-1-ne],re[re.length-1-ne]!==le&&(ae.hasOwnProperty(le)?(Z.push({command:Ae.removeLayer,args:[le]}),re.splice(re.lastIndexOf(le,re.length-ie),1)):ie++,qe=re[re.length-ne],Z.push({command:Ae.addLayer,args:[G[le],qe]}),re.splice(re.length-ne,0,le),ee[le]=!0);for(ne=0;ne<W.length;ne++)if(le=W[ne],_e=ae[le],xe=G[le],!ee[le]&&!wt(_e,xe))if(wt(_e.source,xe.source)&&wt(_e["source-layer"],xe["source-layer"])&&wt(_e.type,xe.type)){for(Oe in mt(_e.layout,xe.layout,Z,le,null,Ae.setLayoutProperty),mt(_e.paint,xe.paint,Z,le,null,Ae.setPaintProperty),wt(_e.filter,xe.filter)||Z.push({command:Ae.setFilter,args:[le,xe.filter]}),wt(_e.minzoom,xe.minzoom)&&wt(_e.maxzoom,xe.maxzoom)||Z.push({command:Ae.setLayerZoomRange,args:[le,xe.minzoom,xe.maxzoom]}),_e)_e.hasOwnProperty(Oe)&&"layout"!==Oe&&"paint"!==Oe&&"filter"!==Oe&&"metadata"!==Oe&&"minzoom"!==Oe&&"maxzoom"!==Oe&&(0===Oe.indexOf("paint.")?mt(_e[Oe],xe[Oe],Z,le,Oe.slice(6),Ae.setPaintProperty):wt(_e[Oe],xe[Oe])||Z.push({command:Ae.setLayerProperty,args:[le,Oe,xe[Oe]]}));for(Oe in xe)xe.hasOwnProperty(Oe)&&!_e.hasOwnProperty(Oe)&&"layout"!==Oe&&"paint"!==Oe&&"filter"!==Oe&&"metadata"!==Oe&&"minzoom"!==Oe&&"maxzoom"!==Oe&&(0===Oe.indexOf("paint.")?mt(_e[Oe],xe[Oe],Z,le,Oe.slice(6),Ae.setPaintProperty):wt(_e[Oe],xe[Oe])||Z.push({command:Ae.setLayerProperty,args:[le,Oe,xe[Oe]]}))}else Z.push({command:Ae.removeLayer,args:[le]}),qe=re[re.lastIndexOf(le)+1],Z.push({command:Ae.addLayer,args:[xe,qe]})}(R,b.layers,C)}catch(M){console.warn("Unable to compute style diff:",M),C=[{command:Ae.setStyle,args:[b]}]}return C}(this.serialize(),o).filter(v=>!(v.command in gi));if(0===u.length)return!1;const g=u.filter(v=>!(v.command in mi));if(g.length>0)throw new Error(`Unimplemented: ${g.map(v=>v.command).join(", ")}.`);return u.forEach(v=>{"setTransition"!==v.command&&this[v.command].apply(this,v.args)}),this.stylesheet=o,this.updateProjection(),!0}addImage(o,u){if(this.getImage(o))return this.fire(new p.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(o,u),this._afterImageUpdated(o)}updateImage(o,u){this.imageManager.updateImage(o,u)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new p.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(o,u,g={}){if(this._checkLoaded(),void 0!==this.getSource(o))throw new Error("There is already a source with this ID");if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(p.validateStyle.source,`sources.${o}`,u,null,g))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const v=Li(o,u,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:v.serialize(),sourceId:o}));const b=C=>{const M=(C?"symbol:":"other:")+o,k=this._sourceCaches[M]=new p.SourceCache(M,v,C);(C?this._symbolSourceCaches:this._otherSourceCaches)[o]=k,k.style=this,k.onAdd(this.map)};b(!1),"vector"!==u.type&&"geojson"!==u.type||b(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const u=this.getSource(o);if(void 0===u)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===o)return this.fire(new p.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new p.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const g=this._getSourceCaches(o);for(const v of g)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,u){this._checkLoaded(),this.getSource(o).setData(u),this._changed=!0}getSource(o){const u=this._getSourceCache(o);return u&&u.getSource()}addLayer(o,u,g={}){this._checkLoaded();const v=o.id;if(this.getLayer(v))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let b;if("custom"===o.type){if(ia(this,p.validateCustomStyleLayer(o)))return;b=p.createStyleLayer(o)}else{if("object"==typeof o.source&&(this.addSource(v,o.source),o=p.clone$1(o),o=p.extend(o,{source:v})),this._validate(p.validateStyle.layer,`layers.${v}`,o,{arrayIndex:-1},g))return;b=p.createStyleLayer(o),this._validateLayer(b),b.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const C=u?this._order.indexOf(u):this._order.length;if(u&&-1===C)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`)));this._order.splice(C,0,v),this._layerOrderChanged=!0,this._layers[v]=b;const M=this._getLayerSourceCache(b);if(this._removedLayers[v]&&b.source&&M&&"custom"!==b.type){const k=this._removedLayers[v];delete this._removedLayers[v],k.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",M.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,u){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===u)return;const g=this._order.indexOf(o);this._order.splice(g,1);const v=u?this._order.indexOf(u):this._order.length;u&&-1===v?this.fire(new p.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`))):(this._order.splice(v,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const u=this._layers[o];if(!u)return void this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));u.setEventedParent(null),this._updateLayerCount(u,!1);const g=this._order.indexOf(o);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=u,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],u.onRemove&&u.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const u in this._layers)if(this._layers[u].type===o)return!0;return!1}setLayerZoomRange(o,u,g){this._checkLoaded();const v=this.getLayer(o);v?v.minzoom===u&&v.maxzoom===g||(null!=u&&(v.minzoom=u),null!=g&&(v.maxzoom=g),this._updateLayer(v)):this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,u,g={}){this._checkLoaded();const v=this.getLayer(o);if(v){if(!wt(v.filter,u))return null==u?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(p.validateStyle.filter,`layers.${v.id}.filter`,u,{layerType:v.type},g)||(v.filter=p.clone$1(u),this._updateLayer(v)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){return p.clone$1(this.getLayer(o).filter)}setLayoutProperty(o,u,g,v={}){this._checkLoaded();const b=this.getLayer(o);b?wt(b.getLayoutProperty(u),g)||(b.setLayoutProperty(u,g,v),this._updateLayer(b)):this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,u){const g=this.getLayer(o);if(g)return g.getLayoutProperty(u);this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,u,g,v={}){this._checkLoaded();const b=this.getLayer(o);b?wt(b.getPaintProperty(u),g)||(b.setPaintProperty(u,g,v)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,u){return this.getLayer(o).getPaintProperty(u)}setFeatureState(o,u){this._checkLoaded();const g=o.source,v=o.sourceLayer,b=this.getSource(g);if(void 0===b)return void this.fire(new p.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const C=b.type;if("geojson"===C&&v)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===C&&!v)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===o.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const M=this._getSourceCaches(g);for(const k of M)k.setFeatureState(v,o.id,u)}removeFeatureState(o,u){this._checkLoaded();const g=o.source,v=this.getSource(g);if(void 0===v)return void this.fire(new p.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const b=v.type,C="vector"===b?o.sourceLayer:void 0;if("vector"===b&&!C)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&"string"!=typeof o.id&&"number"!=typeof o.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const M=this._getSourceCaches(g);for(const k of M)k.removeFeatureState(C,o.id,u)}getFeatureState(o){this._checkLoaded();const u=o.source,g=o.sourceLayer,v=this.getSource(u);if(void 0!==v){if("vector"!==v.type||g)return void 0===o.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(u)[0].getFeatureState(g,o.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const u in this._sourceCaches){const g=this._sourceCaches[u].getSource();o[g.id]||(o[g.id]=g.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:o,layers:this._serializeLayers(this._order)},u=>void 0!==u)}_updateLayer(o){this._updatedLayers[o.id]=!0;const u=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&u&&"raster"!==u.getSource().type&&(this._updatedSources[o.source]="reload",u.pause()),this._changed=!0,o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const u=C=>"fill-extrusion"===this._layers[C].type,g={},v=[];for(let C=this._order.length-1;C>=0;C--){const M=this._order[C];if(u(M)){g[M]=C;for(const k of o){const R=k[M];if(R)for(const L of R)v.push(L)}}}v.sort((C,M)=>M.intersectionZ-C.intersectionZ);const b=[];for(let C=this._order.length-1;C>=0;C--){const M=this._order[C];if(u(M))for(let k=v.length-1;k>=0;k--){const R=v[k].feature;if(g[R.layer.id]<C)break;b.push(R),v.pop()}else for(const k of o){const R=k[M];if(R)for(const L of R)b.push(L.feature)}}return b}queryRenderedFeatures(o,u,g){u&&u.filter&&this._validate(p.validateStyle.filter,"queryRenderedFeatures.filter",u.filter,null,u);const v={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const k of u.layers){const R=this._layers[k];if(!R)return this.fire(new p.ErrorEvent(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];v[R.source]=!0}}const b=[];u.availableImages=this._availableImages;const C=u&&u.layers?u.layers.some(k=>{const R=this.getLayer(k);return R&&R.is3D()}):this.has3DLayers(),M=Ha.createFromScreenPoints(o,g);for(const k in this._sourceCaches){const R=this._sourceCaches[k].getSource().id;u.layers&&!v[R]||b.push(O(this._sourceCaches[k],this._layers,this._serializedLayers,M,u,g,C,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(k,R,L,B,V,Z,H){const W={},ae=Z.queryRenderedSymbols(B),G=[];for(const re of Object.keys(ae).map(Number))G.push(H[re]);G.sort(X);for(const re of G){const ee=re.featureIndex.lookupSymbolFeatures(ae[re.bucketInstanceId],R,re.bucketIndex,re.sourceLayerIndex,V.filter,V.layers,V.availableImages,k);for(const ne in ee){const ie=W[ne]=W[ne]||[],le=ee[ne];le.sort((_e,xe)=>{const qe=re.featureSortOrder;if(qe){const Oe=qe.indexOf(_e.featureIndex);return qe.indexOf(xe.featureIndex)-Oe}return xe.featureIndex-_e.featureIndex});for(const _e of le)ie.push(_e)}}for(const re in W)W[re].forEach(ee=>{const ne=ee.feature,ie=L(k[re]).getFeatureState(ne.layer["source-layer"],ne.id);ne.source=ne.layer.source,ne.layer["source-layer"]&&(ne.sourceLayer=ne.layer["source-layer"]),ne.state=ie});return W}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),M.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(o,u){u&&u.filter&&this._validate(p.validateStyle.filter,"querySourceFeatures.filter",u.filter,null,u);const g=this._getSourceCaches(o);let v=[];for(const b of g)v=v.concat(U(b,u));return v}addSourceType(o,u,g){return _i.getSourceType(o)?g(new Error(`A source type called "${o}" already exists.`)):(_i.setSourceType(o,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:u.workerSourceURL},g):g(null,null))}getLight(){return this.light.getLight()}setLight(o,u={}){this._checkLoaded();const g=this.light.getLight();let v=!1;for(const C in o)if(!wt(o[C],g[C])){v=!0;break}if(!v)return;const b={now:p.exported.now(),transition:p.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,u),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,u=1){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===u){if("object"==typeof o.source){const g="terrain-dem-src";this.addSource(g,o.source),o=p.clone$1(o),o=p.extend(o,{source:g})}if(this._validate(p.validateStyle.terrain,"terrain",o))return}if(!this.terrain||this.terrain&&u!==this.terrain.drapeRenderMode)this._createTerrain(o,u);else{const g=this.terrain,v=g.get();for(const b in o)if(!wt(o[b],v[b])){g.set(o),this.stylesheet.terrain=o;const C={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};g.updateTransitions(C);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const u=this.fog=new Yh(o,this.map.transform);this.stylesheet.fog=o;const g={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};u.updateTransitions(g)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog,g=u.get();for(const v in o)if(!wt(o[v],g[v])){u.set(o),this.stylesheet.fog=o;const b={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};u.updateTransitions(b);break}}else this._createFog(o);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(g=>this.isLayerDraped(this._layers[g])),u=this._order.filter(g=>!this.isLayerDraped(this._layers[g]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...u)}_createTerrain(o,u){const g=this.terrain=new Pl(o,u);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const v={now:p.exported.now(),transition:p.extend({duration:0},this.stylesheet.transition)};g.updateTransitions(v)}_force3DLayerUpdate(){for(const o in this._layers){const u=this._layers[o];"fill-extrusion"===u.type&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const u=this._layers[o];"symbol"===u.type&&this._updateLayer(u)}}_validate(o,u,g,v,b={}){return(!b||!1!==b.validate)&&ia(this,o.call(p.validateStyle,p.extend({key:u,style:this.serialize(),value:g,styleSpec:p.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const u=this._getSourceCaches(o);for(const g of u)g.clearTiles()}_reloadSource(o){const u=this._getSourceCaches(o);for(const g of u)g.resume(),g.reload()}_updateSources(o){for(const u in this._sourceCaches)this._sourceCaches[u].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const u=this._sourceCaches[o];u.resume(),u.reload()}}_updatePlacement(o,u,g,v,b=!1){let C=!1,M=!1;const k={};for(const R of this._order){const L=this._layers[R];if("symbol"!==L.type)continue;if(!k[L.source]){const V=this._getLayerSourceCache(L);if(!V)continue;k[L.source]=V.getRenderableIds(!0).map(Z=>V.getTileByID(Z)).sort((Z,H)=>H.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(H.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(L,k[L.source],o.center.lng,o.projection);C=C||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||0===g,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),o.zoom))&&(this.pauseablePlacement=new xt(o,this._order,b,u,g,v,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),M=!0),C&&this.pauseablePlacement.placement.setStale()),M||C)for(const R of this._order){const L=this._layers[R];"symbol"===L.type&&this.placement.updateLayerOpacities(L,k[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,u,g){this.imageManager.getImages(u.icons,g),this._updateTilesForChangedImages();const v=b=>{b&&b.setDependencies(u.tileID.key,u.type,u.icons)};v(this._otherSourceCaches[u.source]),v(this._symbolSourceCaches[u.source])}getGlyphs(o,u,g){this.glyphManager.getGlyphs(u.stacks,g)}getResource(o,u,g){return p.makeRequest(u,g)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return"symbol"===o.type?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const u=[];return this._otherSourceCaches[o]&&u.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&u.push(this._symbolSourceCaches[o]),u}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}_i.getSourceType=function(m){return qa[m]},_i.setSourceType=function(m,o){qa[m]=o},_i.registerForPluginStateChange=p.registerForPluginStateChange;var Hl="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Qo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Ps={},oa={};Ps=St("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),oa=St("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Qt=St("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}\n#ifdef PROJECTION_GLOBE_VIEW\nmat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Mt=Hl;var ql={background:St("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:St("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:St("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:St("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:St("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:St("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:St("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:St("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:St("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:St("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:St("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:St("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:St("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:St("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:St("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:St("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:St("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:St("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:St("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:St("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:St("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:St("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:St("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:St("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:St("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:St("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Qo),skyboxGradient:St("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Qo),skyboxCapture:St("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:St("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:St("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function St(m,o,u){const g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,b=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),C=m.match(v),M=o.match(v),k=Hl.match(v);let R=M?M.concat(C):C;u||(Ps.staticUniforms&&(R=Ps.staticUniforms.concat(R)),oa.staticUniforms&&(R=oa.staticUniforms.concat(R))),R&&(R=R.concat(k));const L={};return{fragmentSource:m=m.replace(g,(B,V,Z,H,W)=>(L[W]=!0,"define"===V?`\n#ifndef HAS_UNIFORM_u_${W}\nvarying ${Z} ${H} ${W};\n#else\nuniform ${Z} ${H} u_${W};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${W}\n    ${Z} ${H} ${W} = u_${W};\n#endif\n`)),vertexSource:o=o.replace(g,(B,V,Z,H,W)=>{const ae="float"===H?"vec2":"vec4",G=W.match(/color/)?"color":ae;return L[W]?"define"===V?`\n#ifndef HAS_UNIFORM_u_${W}\nuniform lowp float u_${W}_t;\nattribute ${Z} ${ae} a_${W};\nvarying ${Z} ${H} ${W};\n#else\nuniform ${Z} ${H} u_${W};\n#endif\n`:"vec4"===G?`\n#ifndef HAS_UNIFORM_u_${W}\n    ${W} = a_${W};\n#else\n    ${Z} ${H} ${W} = u_${W};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${W}\n    ${W} = unpack_mix_${G}(a_${W}, u_${W}_t);\n#else\n    ${Z} ${H} ${W} = u_${W};\n#endif\n`:"define"===V?`\n#ifndef HAS_UNIFORM_u_${W}\nuniform lowp float u_${W}_t;\nattribute ${Z} ${ae} a_${W};\n#else\nuniform ${Z} ${H} u_${W};\n#endif\n`:"vec4"===G?`\n#ifndef HAS_UNIFORM_u_${W}\n    ${Z} ${H} ${W} = a_${W};\n#else\n    ${Z} ${H} ${W} = u_${W};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${W}\n    ${Z} ${H} ${W} = unpack_mix_${G}(a_${W}, u_${W}_t);\n#else\n    ${Z} ${H} ${W} = u_${W};\n#endif\n`}),staticAttributes:b,staticUniforms:R}}class vr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,u,g,v,b,C,M,k){this.context=o;let R=this.boundPaintVertexBuffers.length!==v.length;for(let L=0;!R&&L<v.length;L++)this.boundPaintVertexBuffers[L]!==v[L]&&(R=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===g&&!R&&this.boundIndexBuffer===b&&this.boundVertexOffset===C&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===k?(o.bindVertexArrayOES.set(this.vao),M&&M.bind(),b&&b.dynamicDraw&&b.bind(),k&&k.bind()):this.freshBind(u,g,v,b,C,M,k)}freshBind(o,u,g,v,b,C,M){let k;const R=o.numAttributes,L=this.context,B=L.gl;if(L.extVertexArrayObject)this.vao&&this.destroy(),this.vao=L.extVertexArrayObject.createVertexArrayOES(),L.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=o,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=M;else{k=L.currentNumAttributes||0;for(let V=R;V<k;V++)B.disableVertexAttribArray(V)}u.enableAttributes(B,o);for(const V of g)V.enableAttributes(B,o);C&&C.enableAttributes(B,o),M&&M.enableAttributes(B,o),u.bind(),u.setVertexAttribPointers(B,o,b);for(const V of g)V.bind(),V.setVertexAttribPointers(B,o,b);C&&(C.bind(),C.setVertexAttribPointers(B,o,b)),v&&v.bind(),M&&(M.bind(),M.setVertexAttribPointers(B,o,b)),L.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Fu(m,o){const u=Math.pow(2,o.canonical.z),g=o.canonical.y;return[new p.MercatorCoordinate(0,g/u).toLngLat().lat,new p.MercatorCoordinate(0,(g+1)/u).toLngLat().lat]}function zu(m,o,u,g,v,b,C){const M=m.context,k=M.gl,R=u.fbo;if(!R)return;m.prepareDrawTile(o);const L=m.useProgram("hillshade");M.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,R.colorAttachment.get());const B=((W,ae,G,re)=>{const ee=G.paint.get("hillshade-shadow-color"),ne=G.paint.get("hillshade-highlight-color"),ie=G.paint.get("hillshade-accent-color");let le=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===G.paint.get("hillshade-illumination-anchor")&&(le-=W.transform.angle);const _e=!W.options.moving;return{u_matrix:re||W.transform.calculateProjMatrix(ae.tileID.toUnwrapped(),_e),u_image:0,u_latrange:Fu(0,ae.tileID),u_light:[G.paint.get("hillshade-exaggeration"),le],u_shadow:ee,u_highlight:ne,u_accent:ie}})(m,u,g,m.terrain?o.projMatrix:null);m.prepareDrawProgram(M,L,o.toUnwrapped());const{tileBoundsBuffer:V,tileBoundsIndexBuffer:Z,tileBoundsSegments:H}=m.getTileBoundsBuffers(u);L.draw(M,k.TRIANGLES,v,b,C,p.CullFaceMode.disabled,B,g.id,V,Z,H)}function In(m,o,u){if(!o.needsDEMTextureUpload)return;const g=m.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||m.getTileTexture(u.stride);const b=u.getPixels();o.demTexture?o.demTexture.update(b,{premultiply:!1}):o.demTexture=new p.Texture(g,b,v.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function Qr(m,o,u,g,v,b){const C=m.context,M=C.gl;if(!o.dem)return;const k=o.dem;if(C.activeTexture.set(M.TEXTURE1),In(m,o,k),!o.demTexture)return;o.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);const R=k.dim;C.activeTexture.set(M.TEXTURE0);let L=o.fbo;if(!L){const H=new p.Texture(C,{width:R,height:R,data:null},M.RGBA);H.bind(M.LINEAR,M.CLAMP_TO_EDGE),L=o.fbo=C.createFramebuffer(R,R,!0),L.colorAttachment.set(H.texture)}C.bindFramebuffer.set(L.framebuffer),C.viewport.set([0,0,R,R]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:V,tileBoundsSegments:Z}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(C,M.TRIANGLES,g,v,b,p.CullFaceMode.disabled,((H,W)=>{const ae=W.stride,G=p.create();return p.ortho(G,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(G,G,[0,-p.EXTENT,0]),{u_matrix:G,u_image:1,u_dimension:[ae,ae],u_zoom:H.overscaledZ,u_unpack:W.unpackVector}})(o.tileID,k),u.id,B,V,Z),o.needsHillshadePrepare=!1}const sa=(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_image0:new p.Uniform1i(m,o.u_image0),u_skirt_height:new p.Uniform1f(m,o.u_skirt_height)}),Fr=(m,o)=>({u_matrix:m,u_image0:0,u_skirt_height:o}),Oi=(m,o,u,g,v)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:o,u_merc_matrix:u,u_zoom_transition:g,u_merc_center:v,u_image0:0});function Zi(m,o){return null!=m&&null!=o&&!(!m.hasData()||!o.hasData())&&null!=m.demTexture&&null!=o.demTexture&&m.tileID.key!==o.tileID.key}const Po=new class{constructor(){this.operations={}}newMorphing(m,o,u,g,v){if(m in this.operations){const b=this.operations[m];b.to.tileID.key!==u.tileID.key&&(b.queued=u)}else this.operations[m]={startTime:g,phase:0,duration:v,from:o,to:u,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const o=this.operations[m];return{from:o.from,to:o.to,phase:o.phase}}update(m){for(const o in this.operations){const u=this.operations[o];for(u.phase=(m-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,m)){delete this.operations[o];break}}}_nextOp(m,o){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=o,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},aa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function zm(m,o){const u=1<<m.z;return!o&&(0===m.x||m.x===u-1)||0===m.y||m.y===u-1}const Kt=m=>({u_matrix:m});function Rp(m,o,u,g,v){if(v>0){const b=p.exported.now(),C=(b-m.timeAdded)/v,M=o?(b-o.timeAdded)/v:-1,k=u.getSource(),R=g.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),L=!o||Math.abs(o.tileID.overscaledZ-R)>Math.abs(m.tileID.overscaledZ-R),B=L&&m.refreshedUponExpiration?1:p.clamp(L?C:1-M,0,1);return m.refreshedUponExpiration&&C>=1&&(m.refreshedUponExpiration=!1),o?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class Lp extends p.SourceCache{constructor(o){const u={type:"raster-dem",maxzoom:o.transform.maxZoom},g=new lo(ue(),null),v=Li("mock-dem",u,g,o.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,u){o.state="loaded",u(null)}}class Dr extends p.SourceCache{constructor(o){const u=Li("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new lo(ue(),null),o.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,u,g){if(o.freezeTileCoverage)return;this.transform=o;const v=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,C)=>{if(b[C.key]="",!this._tiles[C.key]){const M=new p.Tile(C,this._source.tileSize*C.overscaleFactor(),o.tileZoom);M.state="loaded",this._tiles[C.key]=M}return b},{});for(const b in this._tiles)b in v||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(o){const u=this.proxyCachedFBO[o];if(void 0!==u){const g=Object.values(u);this.renderCachePool.push(...g),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class xn extends p.OverscaledTileID{constructor(o,u,g){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=u,this.projMatrix=g}}class uo extends p.Elevation{constructor(o,u){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,v,b]=function(k){const R=new p.StructArrayLayout4i8,L=new p.StructArrayLayout3ui6,B=131;R.reserve(17161),L.reserve(33800);const V=p.EXTENT/128,Z=p.EXTENT+V/2,H=Z+V;for(let ae=-V;ae<H;ae+=V)for(let G=-V;G<H;G+=V){const re=G<0||G>Z||ae<0||ae>Z?24575:0,ee=p.clamp(Math.round(G),0,p.EXTENT),ne=p.clamp(Math.round(ae),0,p.EXTENT);R.emplaceBack(ee+re,ne,ee,ne)}const W=(ae,G)=>{const re=G*B+ae;L.emplaceBack(re+1,re,re+B),L.emplaceBack(re+B,re+B+1,re+1)};for(let ae=1;ae<129;ae++)for(let G=1;G<129;G++)W(G,ae);return[0,129].forEach(ae=>{for(let G=0;G<130;G++)W(G,ae),W(ae,G)}),[R,L,32768]}(),C=o.context;this.gridBuffer=C.createVertexBuffer(g,p.boundsAttributes.members),this.gridIndexBuffer=C.createIndexBuffer(v),this.gridSegments=p.SegmentVector.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,g.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Dr(u.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,0,p.EXTENT,0,p.EXTENT,0,1);const M=C.gl;this._overlapStencilMode=new p.StencilMode({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Lp(u.map)}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency()}update(o,u,g){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const v=o.terrain.properties;this.sourceCache=0===o.terrain.drapeRenderMode?this._mockSourceCache:o._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const b=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const C=this.getScaledDemTileSize();this.sourceCache.update(u,C,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),u.updateElevation(!g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==o.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&"source"===o.dataType?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):"style"===o.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=0===g._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(g.center),-1),this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=u.getIds().map(k=>{const R=u.getTileByID(k).tileID;return R.projMatrix=g.calculateProjMatrix(R.toUnwrapped()),R});(function(k,R){const L=R.transform.pointCoordinate(R.transform.getCameraPoint()),B=new p.pointGeometry(L.x,L.y);k.sort((V,Z)=>{if(Z.overscaledZ-V.overscaledZ)return Z.overscaledZ-V.overscaledZ;const H=new p.pointGeometry(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),W=new p.pointGeometry(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),ae=B.mult(1<<V.canonical.z);return ae.x-=.5,ae.y-=.5,ae.distSqr(H)-ae.distSqr(W)})})(v,this.painter),this._previousZoom=g.zoom;const b=this.proxyToSource||{};this.proxyToSource={},v.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const C=this._style._sourceCaches;for(const k in C){const R=C[k];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,o[k],b),R.usedForTerrain))continue;const L=o[k];R.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[u.id]=v.map(k=>new xn(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const M={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const R=this.terrainTileForTile[k.key];if(!R)continue;const L=R.tileID.key;L in M||(this._visibleDemTiles.push(R),M[L]=L)}}_assignTerrainTiles(o){this._initializing||o.forEach(u=>{if(this.terrainTileForTile[u.key])return;const g=this._findTileCoveringTileID(u,this.sourceCache);g&&(this.terrainTileForTile[u.key]=g)})}_prepareDEMTextures(){const o=this.painter.context,u=o.gl;for(const g in this.terrainTileForTile){const v=this.terrainTileForTile[g],b=v.dem;!b||v.demTexture&&!v.needsDEMTextureUpload||(o.activeTexture.set(u.TEXTURE1),In(this.painter,v,b))}}_prepareDemTileUniforms(o,u,g,v){if(!u||null==u.demTexture)return!1;const b=o.tileID.canonical,C=Math.pow(2,u.tileID.canonical.z-b.z),M=v||"";return g[`u_dem_tl${M}`]=[b.x*C%1,b.y*C%1],g[`u_dem_scale${M}`]=C,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const o=this.painter.context,u=o.gl;if(!this._emptyDepthBufferTexture){const g={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new p.Texture(o,g,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0;const u=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;const b=v.dem.tree.minimums[0];return b>0&&o++,g+b},0);return o?u/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,u=o.gl;o.activeTexture.set(u.TEXTURE2);const g=this._getLoadedAreaMinimum(),v={width:1,height:1,data:new Uint8Array(p.DEMData.pack(g,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(v,{premultiply:!1}):b=this._emptyDEMTexture=new p.Texture(o,v,u.RGBA,{premultiply:!1}),b}setupElevationDraw(o,u,g){const v=this.painter.context,b=v.gl,C=(M=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(M),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var M;C.u_dem_size=this.sourceCache.getSource().tileSize,C.u_exaggeration=this.exaggeration();const k=this.painter.transform,R=k.projection.createTileTransform(k,k.worldSize),L=o.tileID.canonical;C.u_tile_tl_up=R.upVector(L,0,0),C.u_tile_tr_up=R.upVector(L,p.EXTENT,0),C.u_tile_br_up=R.upVector(L,p.EXTENT,p.EXTENT),C.u_tile_bl_up=R.upVector(L,0,p.EXTENT),C.u_tile_up_scale=R.upVectorScale(L);let B=null,V=null,Z=1;if(g&&g.morphing&&this._useVertexMorphing){const H=g.morphing.srcDemTile,W=g.morphing.dstDemTile;Z=g.morphing.phase,H&&W&&(this._prepareDemTileUniforms(o,H,C,"_prev")&&(V=H),this._prepareDemTileUniforms(o,W,C)&&(B=W))}if(V&&B?(v.activeTexture.set(b.TEXTURE2),B.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),v.activeTexture.set(b.TEXTURE4),V.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),C.u_dem_lerp=Z):(B=this.terrainTileForTile[o.tileID.key],v.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(o,B,C)?B.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),v.activeTexture.set(b.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),C.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),C.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&B){const H=(1<<B.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;C.u_meter_to_dem=H}g&&g.labelPlaneMatrixInv&&(C.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),u.setTerrainUniformValues(v,C)}renderToBackBuffer(o){const u=this.painter,g=this.painter.context;0!==o.length&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),this.renderingToTexture=!1,function(v,b,C,M,k){if("globe"===v.transform.projection.name)!function(R,L,B,V,Z){const H=R.context,W=H.gl;let ae,G;const re=R.options.showTerrainWireframe?2:0,ee=(Le,be)=>{if(G===Le)return;const ve=[];be&&ve.push(aa[re]),ve.push(aa[Le]),ve.push("PROJECTION_GLOBE_VIEW"),ae=R.useProgram("globeRaster",null,ve),G=Le},ne=R.colorModeForRenderPass(),ie=new p.DepthMode(W.LEQUAL,p.DepthMode.ReadWrite,R.depthRangeFor3D);Po.update(Z);const le=R.transform,_e=p.calculateGlobeMatrix(le,le.worldSize),xe=p.calculateGlobeMercatorMatrix(le),qe=[p.mercatorXfromLng(le.center.lng),p.mercatorYfromLat(le.center.lat)],Oe=R.globeSharedBuffers;(re?[!1,!0]:[!1]).forEach(Le=>{G=-1;const be=Le?W.LINES:W.TRIANGLES;for(const ve of V){const ke=B.getTile(ve),Se=Math.pow(2,ve.canonical.z),[rt,dt]=p.globeBuffersForTileMesh(R,ke,ve,Se),At=p.StencilMode.disabled,He=L.prevTerrainTileForTile[ve.key],ut=L.terrainTileForTile[ve.key];Zi(He,ut)&&Po.newMorphing(ve.key,He,ut,Z,250),H.activeTexture.set(W.TEXTURE0),ke.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const yt=Po.getMorphValuesForProxy(ve.key),mn=yt?1:0,Dn={};yt&&p.extend$1(Dn,{morphing:{srcDemTile:yt.from,dstDemTile:yt.to,phase:p.easeCubicInOut(yt.phase)}});const bt=p.globeMatrixForTile(ve.canonical,_e),Bt=Oi(le.projMatrix,bt,xe,p.globeToMercatorTransition(le.zoom),qe);if(ee(mn,Le),L.setupElevationDraw(ke,ae,Dn),R.prepareDrawProgram(H,ae,ve.toUnwrapped()),Oe){const[Mn,or]=Le?Oe.getWirefameBuffer(R.context):[Oe.gridIndexBuffer,Oe.gridSegments];ae.draw(H,be,ie,At,ne,p.CullFaceMode.backCCW,Bt,"globe_raster",rt,Mn,or)}if(!Le){const Mn=[0===ve.canonical.y?p.globePoleMatrixForTile(ve.canonical,!1,le):null,ve.canonical.y===Se-1?p.globePoleMatrixForTile(ve.canonical,!0,le):null];for(const or of Mn){if(!or)continue;const Gr=Oi(le.projMatrix,or,or,0,qe);Oe&&ae.draw(H,be,ie,At,ne,p.CullFaceMode.disabled,Gr,"globe_pole_raster",dt,Oe.poleIndexBuffer,Oe.poleSegments)}}}})}(v,b,C,M,k);else{const R=v.context,L=R.gl;let B,V;const Z=v.options.showTerrainWireframe?2:0,H=(ee,ne)=>{if(V===ee)return;const ie=[aa[ee]];ne&&ie.push(aa[Z]),B=v.useProgram("terrainRaster",null,ie),V=ee},W=v.colorModeForRenderPass(),ae=new p.DepthMode(L.LEQUAL,p.DepthMode.ReadWrite,v.depthRangeFor3D);Po.update(k);const G=v.transform,re=6*Math.pow(1.5,22-G.zoom)*b.exaggeration();(Z?[!1,!0]:[!1]).forEach(ee=>{V=-1;const ne=ee?L.LINES:L.TRIANGLES,[ie,le]=ee?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const _e of M){const xe=C.getTile(_e),qe=p.StencilMode.disabled,Oe=b.prevTerrainTileForTile[_e.key],Le=b.terrainTileForTile[_e.key];Zi(Oe,Le)&&Po.newMorphing(_e.key,Oe,Le,k,250),R.activeTexture.set(L.TEXTURE0),xe.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const be=Po.getMorphValuesForProxy(_e.key),ve=be?1:0;let ke;be&&(ke={morphing:{srcDemTile:be.from,dstDemTile:be.to,phase:p.easeCubicInOut(be.phase)}});const Se=Fr(_e.projMatrix,zm(_e.canonical,G.renderWorldCopies)?re/10:re);H(ve,ee),b.setupElevationDraw(xe,B,ke),v.prepareDrawProgram(R,B,_e.toUnwrapped()),B.draw(R,ne,ae,qe,W,p.CullFaceMode.backCCW,Se,"terrain_raster",b.gridBuffer,ie,le)}})}}(u,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,o.splice(0,o.length))}renderBatch(o){if(0===this._drapedRenderBatches.length)return o+1;this.renderingToTexture=!0;const u=this.painter,g=this.painter.context,v=this.proxySourceCache,b=this.proxiedCoords[v.id],C=this._drapedRenderBatches.shift(),M=[],k=u.style.order;let R=0;for(const L of b){const B=v.getTileByID(L.proxyTileKey),V=v.proxyCachedFBO[L.key]?v.proxyCachedFBO[L.key][o]:void 0,Z=void 0!==V?v.renderCache[V]:this.pool[R++],H=void 0!==V;if(B.texture=Z.tex,H&&!Z.dirty){M.push(B.tileID);continue}let W;g.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(g.clear({color:p.Color.transparent,stencil:0}),Z.dirty=!1);for(let ae=C.start;ae<=C.end;++ae){const G=u.style._layers[k[ae]];if(G.isHidden(u.transform.zoom))continue;const re=u.style._getLayerSourceCache(G),ee=re?this.proxyToSource[L.key][re.id]:[L];if(!ee)continue;const ne=ee;g.viewport.set([0,0,Z.fb.width,Z.fb.height]),W!==(re?re.id:null)&&(this._setupStencil(Z,ee,G,re),W=re?re.id:null),u.renderLayer(u,re,G,ne)}this.renderedToTile?(Z.dirty=!0,M.push(B.tileID)):H||--R,5===R&&(R=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),C.end+1}postRender(){}renderCacheEfficiency(o){const u=o.order.length;if(0===u)return{efficiency:100};let g,v=0,b=0,C=!1;for(let M=0;M<u;++M){const k=o._layers[o.order[M]];this._style.isLayerDraped(k)?(C&&++v,++b):C||(C=!0,g=k.id)}return 0===b?{efficiency:100}:{efficiency:100*(1-v/b),firstUndrapedLayer:g}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{o=Math.min(o,u.dem.tree.minimums[0])}),0===o?o:(o-30)*this._exaggeration}raycast(o,u,g){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const C=b.tileID,M=Math.pow(2,C.overscaledZ),{x:k,y:R}=C.canonical,L=k/M,B=(k+1)/M,V=R/M,Z=(R+1)/M;return{minx:L,miny:V,maxx:B,maxy:Z,t:b.dem.tree.raycastRoot(L,V,B,Z,o,u,g),tile:b}});v.sort((b,C)=>(null!==b.t?b.t:Number.MAX_VALUE)-(null!==C.t?C.t:Number.MAX_VALUE));for(const b of v){if(null==b.t)return null;const C=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,o,u,g);if(null!=C)return C}return null}_createFBO(){const o=this.painter.context,u=o.gl,g=this.drapeBufferSize;o.activeTexture.set(u.TEXTURE0);const v=new p.Texture(o,{width:g[0],height:g[1],data:null},u.RGBA);v.bind(u.LINEAR,u.CLAMP_TO_EDGE);const b=o.createFramebuffer(g[0],g[1],!1);return b.colorAttachment.set(v.texture),b.depthAttachment=new Bl(o,b.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&u.texParameterf(u.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:b,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const u=this._style._layers[o],g=u.isHidden(this.painter.transform.zoom),v=u.getCrossfadeParameters(),b=!!v&&1!==v.t,C=u.hasTransition();return"custom"!==u.type&&!g&&(b||C)})}_clearRasterFadeFromRenderCache(){let o=!1;for(const u in this._style._sourceCaches)if(this._style._sourceCaches[u]._source instanceof Mo){o=!0;break}if(o)for(let u=0;u<this._style.order.length;++u){const g=this._style._layers[this._style.order[u]],v=g.isHidden(this.painter.transform.zoom),b=this._style._getLayerSourceCache(g);if("raster"!==g.type||v||!b)continue;const C=g.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const k=this.proxyToSource[M.key][b.id];if(k)for(const R of k){const L=Rp(b.getTile(R),b.findLoadedParent(R,0),b,this.painter.transform,C);(1!==L.opacity||0!==L.mix)&&this._clearRenderCacheForTile(b.id,R)}}}}_setupDrapedRenderBatches(){const o=this._style.order,u=o.length;if(0===u)return;const g=[];let v,b=0,C=this._style._layers[o[b]];for(;!this._style.isLayerDraped(C)&&C.isHidden(this.painter.transform.zoom)&&++b<u;)C=this._style._layers[o[b]];for(;b<u;++b){const M=this._style._layers[o[b]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?void 0===v&&(v=b):void 0!==v&&(g.push({start:v,end:b-1}),v=void 0))}void 0!==v&&g.push({start:v,end:b-1}),this._drapedRenderBatches=g}_setupRenderCache(o){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const C=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let M=0;M<C.length;++M){const k=Object.values(C[M]);u.renderCachePool.push(...k)}}return}this._clearRasterFadeFromRenderCache();const g=this.proxyCoords,v=this._tilesDirty;for(let C=g.length-1;C>=0;C--){const M=g[C];if(u.getTileByID(M.key),void 0!==u.proxyCachedFBO[M.key]){const k=o[M.key],R=this.proxyToSource[M.key];let L=0;for(const B in R){const V=R[B],Z=k[B];if(!Z||Z.length!==V.length||V.some((H,W)=>H!==Z[W]||v[B]&&v[B].hasOwnProperty(H.key))){L=-1;break}++L}for(const B in u.proxyCachedFBO[M.key])u.renderCache[u.proxyCachedFBO[M.key][B]].dirty=L<0||L!==Object.values(k).length}}const b=[...this._drapedRenderBatches];b.sort((C,M)=>M.end-M.start-(C.end-C.start));for(const C of b)for(const M of g){if(u.proxyCachedFBO[M.key])continue;let k=u.renderCachePool.pop();void 0===k&&u.renderCache.length<50&&(k=u.renderCache.length,u.renderCache.push(this._createFBO())),void 0!==k&&(u.proxyCachedFBO[M.key]={},u.proxyCachedFBO[M.key][C.start]=k,u.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(o,u,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,C=b.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let M;if(g.isTileClipped())M=u.length,this._overlapStencilMode.test={func:C.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:C.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(o,u){const g=this.painter,v=this.painter.context,b=v.gl;g._tileClippingMaskIDs={},v.setColorMode(p.ColorMode.disabled),v.setDepthMode(p.DepthMode.disabled);const C=g.useProgram("clippingMask");for(const M of o){const k=g._tileClippingMaskIDs[M.key]=--u;C.draw(v,b.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:b.ALWAYS,mask:0},k,255,b.KEEP,b.KEEP,b.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,Kt(M.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(o){const u=this.painter.transform;if(o.x<0||o.x>u.width||o.y<0||o.y>u.height)return null;const g=[o.x,o.y,1,1];p.transformMat4$1(g,g,u.pixelMatrixInverse),p.scale$1(g,g,1/g[3]),g[0]/=u.worldSize,g[1]/=u.worldSize;const v=u._camera.position,b=p.mercatorZfromAltitude(1,u.center.lat),C=[v[0],v[1],v[2]/b,0],M=p.subtract([],g.slice(0,3),C);p.normalize(M,M);const k=this.raycast(C,M,this._exaggeration);return null!==k&&k?(p.scaleAndAdd(C,C,M,k),C[3]=C[2],C[2]*=b,C):null}drawDepth(){const o=this.painter,u=o.context,g=this.proxySourceCache,v=Math.ceil(o.width),b=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===b||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const C=u.gl,M=u.createFramebuffer(v,b,!0);u.activeTexture.set(C.TEXTURE0);const k=new p.Texture(u,{width:v,height:b,data:null},C.RGBA);k.bind(C.NEAREST,C.CLAMP_TO_EDGE),M.colorAttachment.set(k.texture);const R=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,v,b);M.depthAttachment.set(R),this._depthFBO=M,this._depthTexture=k}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,v,b]),function(C,M,k,R){if("globe"===C.transform.projection.name)return;const L=C.context,B=L.gl;L.clear({depth:1});const V=C.useProgram("terrainDepth"),Z=new p.DepthMode(B.LESS,p.DepthMode.ReadWrite,C.depthRangeFor3D);for(const H of R){const W=k.getTile(H),ae=Fr(H.projMatrix,0);M.setupElevationDraw(W,V),V.draw(L,B.TRIANGLES,Z,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,ae,"terrain_depth",M.gridBuffer,M.gridIndexBuffer,M.gridNoSkirtSegments)}}(o,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,u,g){if(o.getSource()instanceof So)return this._setupProxiedCoordsForImageSource(o,u,g);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const v=this.proxiedCoords[o.id]=[],b=this.proxyCoords;for(let M=0;M<b.length;M++){const k=b[M],R=this._findTileCoveringTileID(k,o);if(R){const L=this._createProxiedId(k,R,g[k.key]&&g[k.key][o.id]);v.push(L),this.proxyToSource[k.key][o.id]=[L]}}let C=!1;for(let M=0;M<u.length;M++){const k=o.getTile(u[M]);if(!k||!k.hasData())continue;const R=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==k.tileID.canonical.z){const L=this.proxyToSource[R.tileID.key][o.id],B=this._createProxiedId(R.tileID,k,g[R.tileID.key]&&g[R.tileID.key][o.id]);L?L.splice(L.length-1,0,B):this.proxyToSource[R.tileID.key][o.id]=[B],v.push(B),C=!0}}this._sourceTilesOverlap[o.id]=C}_setupProxiedCoordsForImageSource(o,u,g){if(!o.getSource().loaded())return;const v=this.proxiedCoords[o.id]=[],b=this.proxyCoords,C=o.getSource(),M=new p.pointGeometry(C.tileID.x,C.tileID.y)._div(1<<C.tileID.z),k=C.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((L,B)=>(L.min.x=Math.min(L.min.x,B.x-M.x),L.min.y=Math.min(L.min.y,B.y-M.y),L.max.x=Math.max(L.max.x,B.x-M.x),L.max.y=Math.max(L.max.y,B.y-M.y),L),{min:new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(L,B)=>{const V=L.wrap+L.canonical.x/(1<<L.canonical.z),Z=L.canonical.y/(1<<L.canonical.z),H=p.EXTENT/(1<<L.canonical.z),W=B.wrap+B.canonical.x/(1<<B.canonical.z),ae=B.canonical.y/(1<<B.canonical.z);return V+H<W+k.min.x||V>W+k.max.x||Z+H<ae+k.min.y||Z>ae+k.max.y};for(let L=0;L<b.length;L++){const B=b[L];for(let V=0;V<u.length;V++){const Z=o.getTile(u[V]);if(!Z||!Z.hasData()||R(B,Z.tileID))continue;const H=this._createProxiedId(B,Z,g[B.key]&&g[B.key][o.id]),W=this.proxyToSource[B.key][o.id];W?W.push(H):this.proxyToSource[B.key][o.id]=[H],v.push(H)}}}_createProxiedId(o,u,g){let v=this.orthoMatrix;if(g){const b=g.find(C=>C.key===u.tileID.key);if(b)return b}if(u.tileID.key!==o.key){const b=o.canonical.z-u.tileID.canonical.z;let C,M,k;v=p.create();const R=u.tileID.wrap-o.wrap<<o.overscaledZ;b>0?(C=p.EXTENT>>b,M=C*((u.tileID.canonical.x<<b)-o.canonical.x+R),k=C*((u.tileID.canonical.y<<b)-o.canonical.y)):(C=p.EXTENT<<-b,M=p.EXTENT*(u.tileID.canonical.x-(o.canonical.x+R<<-b)),k=p.EXTENT*(u.tileID.canonical.y-(o.canonical.y<<-b))),p.ortho(v,0,C,0,C,0,1),p.translate(v,v,[M,k,0])}return new xn(u.tileID,o.key,v)}_findTileCoveringTileID(o,u){let g=u.getTile(o);if(g&&g.hasData())return g;const v=this._findCoveringTileCache[u.id],b=v[o.key];if(g=b?u.getTileByID(b):null,g&&g.hasData()||null===b)return g;let C=g?g.tileID:o,M=C.overscaledZ;const k=u.getSource().minzoom,R=[];if(!b){const B=u.getSource().maxzoom;if(o.canonical.z>=B){const V=o.canonical.z-B;u.getSource().reparseOverscaled?(M=Math.max(o.canonical.z+2,u.transform.tileZoom),C=new p.OverscaledTileID(M,o.wrap,B,o.canonical.x>>V,o.canonical.y>>V)):0!==V&&(M=B,C=new p.OverscaledTileID(M,o.wrap,B,o.canonical.x>>V,o.canonical.y>>V))}C.key!==o.key&&(R.push(C.key),g=u.getTile(C))}const L=B=>{R.forEach(V=>{v[V]=B}),R.length=0};for(M-=1;M>=k&&(!g||!g.hasData());M--){g&&L(g.tileID.key);const B=C.calculateScaledKey(M);if(g=u.getTileByID(B),g&&g.hasData())break;const V=v[B];if(null===V)break;void 0===V?R.push(B):g=u.getTileByID(V)}return L(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(o){this.renderedToTile=!0}_clearRenderCacheForTile(o,u){let g=this._tilesDirty[o];g||(g=this._tilesDirty[o]={}),g[u.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(u){let g,v,b;const C=new p.StructArrayLayout2ui4,M=131;for(v=1;v<129;v++){for(g=1;g<129;g++)b=v*M+g,C.emplaceBack(b,b+1),C.emplaceBack(b,b+M),C.emplaceBack(b+1,b+M),128===v&&C.emplaceBack(b+M,b+M+1);C.emplaceBack(b+1,b+1+M)}return C}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Xa(m){const o=[];for(let u=0;u<m.length;u++){if(null===m[u])continue;const g=m[u].split(" ");o.push(g.pop())}return o}class la{static cacheKey(o,u,g){let v=`${o}${g?g.cacheKey:""}`;for(const b of u)v+=`/${b}`;return v}constructor(o,u,g,v,b,C){const M=o.gl;this.program=M.createProgram();const k=Xa(g.staticAttributes),R=v?v.getBinderAttributes():[],L=k.concat(R),B=g.staticUniforms?Xa(g.staticUniforms):[],V=v?v.getBinderUniforms():[],Z=B.concat(V),H=[];for(const ie of Z)H.indexOf(ie)<0&&H.push(ie);let W=v?v.defines():[];W=W.concat(C.map(ie=>`#define ${ie}`));const ae=W.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Mt,Qt.fragmentSource,oa.fragmentSource,g.fragmentSource).join("\n"),G=W.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Mt,Qt.vertexSource,oa.vertexSource,Ps.vertexSource,g.vertexSource).join("\n"),re=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(re,ae),M.compileShader(re),M.attachShader(this.program,re);const ee=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(ee,G),M.compileShader(ee),M.attachShader(this.program,ee),this.attributes={};const ne={};this.numAttributes=L.length;for(let ie=0;ie<this.numAttributes;ie++)L[ie]&&(M.bindAttribLocation(this.program,ie,L[ie]),this.attributes[L[ie]]=ie);M.linkProgram(this.program),M.deleteShader(ee),M.deleteShader(re);for(let ie=0;ie<H.length;ie++){const le=H[ie];if(le&&!ne[le]){const _e=M.getUniformLocation(this.program,le);_e&&(ne[le]=_e)}}var ie,le;this.fixedUniforms=b(o,ne),this.binderUniforms=v?v.getUniforms(o,ne):[],-1!==C.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(ie=o,(le=ne).u_dem),u_dem_prev:new p.Uniform1i(ie,le.u_dem_prev),u_dem_unpack:new p.Uniform4f(ie,le.u_dem_unpack),u_dem_tl:new p.Uniform2f(ie,le.u_dem_tl),u_dem_scale:new p.Uniform1f(ie,le.u_dem_scale),u_dem_tl_prev:new p.Uniform2f(ie,le.u_dem_tl_prev),u_dem_scale_prev:new p.Uniform1f(ie,le.u_dem_scale_prev),u_dem_size:new p.Uniform1f(ie,le.u_dem_size),u_dem_lerp:new p.Uniform1f(ie,le.u_dem_lerp),u_exaggeration:new p.Uniform1f(ie,le.u_exaggeration),u_depth:new p.Uniform1i(ie,le.u_depth),u_depth_size_inv:new p.Uniform2f(ie,le.u_depth_size_inv),u_meter_to_dem:new p.Uniform1f(ie,le.u_meter_to_dem),u_label_plane_matrix_inv:new p.UniformMatrix4f(ie,le.u_label_plane_matrix_inv),u_tile_tl_up:new p.Uniform3f(ie,le.u_tile_tl_up),u_tile_tr_up:new p.Uniform3f(ie,le.u_tile_tr_up),u_tile_br_up:new p.Uniform3f(ie,le.u_tile_br_up),u_tile_bl_up:new p.Uniform3f(ie,le.u_tile_bl_up),u_tile_up_scale:new p.Uniform1f(ie,le.u_tile_up_scale)}),-1!==C.indexOf("FOG")&&(this.fogUniforms=((ie,le)=>({u_fog_matrix:new p.UniformMatrix4f(ie,le.u_fog_matrix),u_fog_range:new p.Uniform2f(ie,le.u_fog_range),u_fog_color:new p.Uniform4f(ie,le.u_fog_color),u_fog_horizon_blend:new p.Uniform1f(ie,le.u_fog_horizon_blend),u_fog_temporal_offset:new p.Uniform1f(ie,le.u_fog_temporal_offset)}))(o,ne))}setTerrainUniformValues(o,u){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in u)g[v].set(u[v])}}setFogUniformValues(o,u){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const v in u)g[v].location&&g[v].set(u[v])}}draw(o,u,g,v,b,C,M,k,R,L,B,V,Z,H,W,ae){const G=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(g),o.setStencilMode(v),o.setColorMode(b),o.setCullFace(C);for(const ee of Object.keys(this.fixedUniforms))this.fixedUniforms[ee].set(M[ee]);H&&H.setUniforms(o,this.binderUniforms,V,{zoom:Z});const re={[G.LINES]:2,[G.TRIANGLES]:3,[G.LINE_STRIP]:1}[u];for(const ee of B.get()){const ne=ee.vaos||(ee.vaos={});(ne[k]||(ne[k]=new vr)).bind(o,this,R,H?H.getPaintVertexBuffers():[],L,ee.vertexOffset,W,ae),G.drawElements(u,ee.primitiveLength*re,G.UNSIGNED_SHORT,ee.primitiveOffset*re*2)}}}function Bu(m,o,u){const g=1/sn(u,1,o.transform.tileZoom),v=Math.pow(2,u.tileID.overscaledZ),b=u.tileSize*Math.pow(2,o.transform.tileZoom)/v,C=b*(u.tileID.canonical.x+u.tileID.wrap*v),M=b*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[g,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[C>>16,M>>16],u_pixel_coord_lower:[65535&C,65535&M]}}const ko=(m,o,u,g)=>{const v=o.style.light,b=v.properties.get("position"),C=[b.x,b.y,b.z],M=p.create$1();"viewport"===v.properties.get("anchor")&&(p.fromRotation(M,-o.transform.angle),p.transformMat3(C,C,M));const k=v.properties.get("color");return{u_matrix:m,u_lightpos:C,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+u,u_opacity:g}},ca=(m,o,u,g,v,b,C)=>p.extend(ko(m,o,u,g),Bu(b,o,C),{u_height_factor:-Math.pow(2,v.overscaledZ)/C.tileSize/8}),Qh=m=>({u_matrix:m}),Fi=(m,o,u,g)=>p.extend(Qh(m),Bu(u,o,g)),Op=(m,o)=>({u_matrix:m,u_world:o}),Nu=(m,o,u,g,v)=>p.extend(Fi(m,o,u,g),{u_world:v}),ed=(m,o,u,g)=>{const v=m.transform;let b;return b="map"===g.paint.get("circle-pitch-alignment")?v.calculatePixelsToTileUnitsMatrix(u):new Float32Array([v.pixelsToGLUnits[0],0,0,v.pixelsToGLUnits[1]]),{u_camera_to_center_distance:v.cameraToCenterDistance,u_matrix:m.translatePosMatrix(o.projMatrix,u,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:b}},Nc=m=>{const o=[];return"map"===m.paint.get("circle-pitch-alignment")&&o.push("PITCH_WITH_MAP"),"map"===m.paint.get("circle-pitch-scale")&&o.push("SCALE_WITH_MAP"),o},Ro=(m,o,u)=>{const g=p.EXTENT/u.tileSize;return{u_matrix:m,u_camera_to_center_distance:o.cameraToCenterDistance,u_extrude_scale:[o.pixelsToGLUnits[0]/g,o.pixelsToGLUnits[1]/g]}},Uu=(m,o,u=1)=>({u_matrix:m,u_color:o,u_overlay:0,u_overlay_scale:u}),ju=(m,o,u,g)=>({u_matrix:m,u_extrude_scale:sn(o,1,u),u_intensity:g}),zr=(m,o,u,g,v,b)=>{const C=m.transform,M=C.calculatePixelsToTileUnitsMatrix(o),k={u_matrix:Wi(m,o,u,v),u_pixels_to_tile_units:M,u_device_pixel_ratio:p.exported.devicePixelRatio,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(ho(u)){const R=rr(o,m.transform);k.u_texsize=o.lineAtlasTexture.size,k.u_scale=[R,g.fromScale,g.toScale],k.u_mix=g.t}return k},nr=(m,o,u,g,v)=>{const b=m.transform,C=rr(o,b);return{u_matrix:Wi(m,o,u,v),u_texsize:o.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:p.exported.devicePixelRatio,u_image:0,u_scale:[C,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function rr(m,o){return 1/sn(m,1,o.tileZoom)}function Wi(m,o,u,g){return m.translatePosMatrix(g||o.tileID.projMatrix,o,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}function ho(m){const o=m.paint.get("line-dasharray").value;return o.value||"constant"!==o.kind}const ei=(m,o,u,g,v,b)=>{return{u_matrix:m,u_tl_parent:o,u_scale_parent:u,u_fade_t:g.mix,u_opacity:g.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(M=v.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(C=v.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:ua(v.paint.get("raster-hue-rotate")),u_perspective_transform:b};var C,M};function ua(m){m*=Math.PI/180;const o=Math.sin(m),u=Math.cos(m);return[(2*u+1)/3,(-Math.sqrt(3)*o-u+1)/3,(Math.sqrt(3)*o-u+1)/3]}const Ka=(m,o,u,g,v,b,C,M,k,R,L,B,V,Z)=>{const H=v.transform;return{u_is_size_zoom_constant:+("constant"===m||"source"===m),u_is_size_feature_constant:+("constant"===m||"camera"===m),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_pitch:H.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:H.width/H.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:C,u_coord_matrix:M,u_is_text:+k,u_pitch_with_map:+g,u_texsize:R,u_tile_id:L,u_zoom_transition:B,u_inv_rot_matrix:V,u_merc_center:Z,u_texture:0}},es=(m,o,u,g,v,b,C,M,k,R,L,B,V,Z,H)=>{const{cameraToCenterDistance:W,_pitch:ae}=v.transform;return p.extend(Ka(m,o,u,g,v,b,C,M,k,R,B,V,Z,H),{u_gamma_scale:g?W*Math.cos(v.terrain?0:ae):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+L})},ks=(m,o,u,g,v,b,C,M,k,R,L,B,V,Z)=>p.extend(es(m,o,u,g,v,b,C,M,!0,k,!0,L,B,V,Z),{u_texsize_icon:R,u_texture_icon:1}),Ut=(m,o,u)=>({u_matrix:m,u_opacity:o,u_color:u}),xr=(m,o,u,g,v,b)=>p.extend(function(C,M,k,R){const L=k.imageManager.getPattern(C.from.toString()),B=k.imageManager.getPattern(C.to.toString()),{width:V,height:Z}=k.imageManager.getPixelSize(),H=Math.pow(2,R.tileID.overscaledZ),W=R.tileSize*Math.pow(2,k.transform.tileZoom)/H,ae=W*(R.tileID.canonical.x+R.tileID.wrap*H),G=W*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[V,Z],u_mix:M.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/sn(R,1,k.transform.tileZoom),u_pixel_coord_upper:[ae>>16,G>>16],u_pixel_coord_lower:[65535&ae,65535&G]}}(g,b,u,v),{u_matrix:m,u_opacity:o}),td={fillExtrusion:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_lightpos:new p.Uniform3f(m,o.u_lightpos),u_lightintensity:new p.Uniform1f(m,o.u_lightintensity),u_lightcolor:new p.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new p.Uniform1f(m,o.u_vertical_gradient),u_opacity:new p.Uniform1f(m,o.u_opacity)}),fillExtrusionPattern:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_lightpos:new p.Uniform3f(m,o.u_lightpos),u_lightintensity:new p.Uniform1f(m,o.u_lightintensity),u_lightcolor:new p.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new p.Uniform1f(m,o.u_vertical_gradient),u_height_factor:new p.Uniform1f(m,o.u_height_factor),u_image:new p.Uniform1i(m,o.u_image),u_texsize:new p.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new p.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new p.Uniform3f(m,o.u_scale),u_fade:new p.Uniform1f(m,o.u_fade),u_opacity:new p.Uniform1f(m,o.u_opacity)}),fill:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix)}),fillPattern:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_image:new p.Uniform1i(m,o.u_image),u_texsize:new p.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new p.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new p.Uniform3f(m,o.u_scale),u_fade:new p.Uniform1f(m,o.u_fade)}),fillOutline:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_world:new p.Uniform2f(m,o.u_world)}),fillOutlinePattern:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_world:new p.Uniform2f(m,o.u_world),u_image:new p.Uniform1i(m,o.u_image),u_texsize:new p.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new p.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new p.Uniform3f(m,o.u_scale),u_fade:new p.Uniform1f(m,o.u_fade)}),circle:(m,o)=>({u_camera_to_center_distance:new p.Uniform1f(m,o.u_camera_to_center_distance),u_extrude_scale:new p.UniformMatrix2f(m,o.u_extrude_scale),u_device_pixel_ratio:new p.Uniform1f(m,o.u_device_pixel_ratio),u_matrix:new p.UniformMatrix4f(m,o.u_matrix)}),collisionBox:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_camera_to_center_distance:new p.Uniform1f(m,o.u_camera_to_center_distance),u_extrude_scale:new p.Uniform2f(m,o.u_extrude_scale)}),collisionCircle:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_inv_matrix:new p.UniformMatrix4f(m,o.u_inv_matrix),u_camera_to_center_distance:new p.Uniform1f(m,o.u_camera_to_center_distance),u_viewport_size:new p.Uniform2f(m,o.u_viewport_size)}),debug:(m,o)=>({u_color:new p.UniformColor(m,o.u_color),u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_overlay:new p.Uniform1i(m,o.u_overlay),u_overlay_scale:new p.Uniform1f(m,o.u_overlay_scale)}),clippingMask:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix)}),heatmap:(m,o)=>({u_extrude_scale:new p.Uniform1f(m,o.u_extrude_scale),u_intensity:new p.Uniform1f(m,o.u_intensity),u_matrix:new p.UniformMatrix4f(m,o.u_matrix)}),heatmapTexture:(m,o)=>({u_image:new p.Uniform1i(m,o.u_image),u_color_ramp:new p.Uniform1i(m,o.u_color_ramp),u_opacity:new p.Uniform1f(m,o.u_opacity)}),hillshade:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_image:new p.Uniform1i(m,o.u_image),u_latrange:new p.Uniform2f(m,o.u_latrange),u_light:new p.Uniform2f(m,o.u_light),u_shadow:new p.UniformColor(m,o.u_shadow),u_highlight:new p.UniformColor(m,o.u_highlight),u_accent:new p.UniformColor(m,o.u_accent)}),hillshadePrepare:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_image:new p.Uniform1i(m,o.u_image),u_dimension:new p.Uniform2f(m,o.u_dimension),u_zoom:new p.Uniform1f(m,o.u_zoom),u_unpack:new p.Uniform4f(m,o.u_unpack)}),line:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_pixels_to_tile_units:new p.UniformMatrix2f(m,o.u_pixels_to_tile_units),u_device_pixel_ratio:new p.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(m,o.u_units_to_pixels),u_dash_image:new p.Uniform1i(m,o.u_dash_image),u_gradient_image:new p.Uniform1i(m,o.u_gradient_image),u_image_height:new p.Uniform1f(m,o.u_image_height),u_texsize:new p.Uniform2f(m,o.u_texsize),u_scale:new p.Uniform3f(m,o.u_scale),u_mix:new p.Uniform1f(m,o.u_mix),u_alpha_discard_threshold:new p.Uniform1f(m,o.u_alpha_discard_threshold)}),linePattern:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_texsize:new p.Uniform2f(m,o.u_texsize),u_pixels_to_tile_units:new p.UniformMatrix2f(m,o.u_pixels_to_tile_units),u_device_pixel_ratio:new p.Uniform1f(m,o.u_device_pixel_ratio),u_image:new p.Uniform1i(m,o.u_image),u_units_to_pixels:new p.Uniform2f(m,o.u_units_to_pixels),u_scale:new p.Uniform3f(m,o.u_scale),u_fade:new p.Uniform1f(m,o.u_fade),u_alpha_discard_threshold:new p.Uniform1f(m,o.u_alpha_discard_threshold)}),raster:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_tl_parent:new p.Uniform2f(m,o.u_tl_parent),u_scale_parent:new p.Uniform1f(m,o.u_scale_parent),u_fade_t:new p.Uniform1f(m,o.u_fade_t),u_opacity:new p.Uniform1f(m,o.u_opacity),u_image0:new p.Uniform1i(m,o.u_image0),u_image1:new p.Uniform1i(m,o.u_image1),u_brightness_low:new p.Uniform1f(m,o.u_brightness_low),u_brightness_high:new p.Uniform1f(m,o.u_brightness_high),u_saturation_factor:new p.Uniform1f(m,o.u_saturation_factor),u_contrast_factor:new p.Uniform1f(m,o.u_contrast_factor),u_spin_weights:new p.Uniform3f(m,o.u_spin_weights),u_perspective_transform:new p.Uniform2f(m,o.u_perspective_transform)}),symbolIcon:(m,o)=>({u_is_size_zoom_constant:new p.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new p.Uniform1f(m,o.u_size_t),u_size:new p.Uniform1f(m,o.u_size),u_camera_to_center_distance:new p.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new p.Uniform1f(m,o.u_pitch),u_rotate_symbol:new p.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new p.Uniform1f(m,o.u_fade_change),u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new p.Uniform1i(m,o.u_is_text),u_pitch_with_map:new p.Uniform1i(m,o.u_pitch_with_map),u_texsize:new p.Uniform2f(m,o.u_texsize),u_tile_id:new p.Uniform3f(m,o.u_tile_id),u_zoom_transition:new p.Uniform1f(m,o.u_zoom_transition),u_inv_rot_matrix:new p.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new p.Uniform2f(m,o.u_merc_center),u_texture:new p.Uniform1i(m,o.u_texture)}),symbolSDF:(m,o)=>({u_is_size_zoom_constant:new p.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new p.Uniform1f(m,o.u_size_t),u_size:new p.Uniform1f(m,o.u_size),u_camera_to_center_distance:new p.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new p.Uniform1f(m,o.u_pitch),u_rotate_symbol:new p.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new p.Uniform1f(m,o.u_fade_change),u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new p.Uniform1i(m,o.u_is_text),u_pitch_with_map:new p.Uniform1i(m,o.u_pitch_with_map),u_texsize:new p.Uniform2f(m,o.u_texsize),u_texture:new p.Uniform1i(m,o.u_texture),u_gamma_scale:new p.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(m,o.u_device_pixel_ratio),u_tile_id:new p.Uniform3f(m,o.u_tile_id),u_zoom_transition:new p.Uniform1f(m,o.u_zoom_transition),u_inv_rot_matrix:new p.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new p.Uniform2f(m,o.u_merc_center),u_is_halo:new p.Uniform1i(m,o.u_is_halo)}),symbolTextAndIcon:(m,o)=>({u_is_size_zoom_constant:new p.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new p.Uniform1f(m,o.u_size_t),u_size:new p.Uniform1f(m,o.u_size),u_camera_to_center_distance:new p.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new p.Uniform1f(m,o.u_pitch),u_rotate_symbol:new p.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new p.Uniform1f(m,o.u_fade_change),u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new p.Uniform1i(m,o.u_is_text),u_pitch_with_map:new p.Uniform1i(m,o.u_pitch_with_map),u_texsize:new p.Uniform2f(m,o.u_texsize),u_texsize_icon:new p.Uniform2f(m,o.u_texsize_icon),u_texture:new p.Uniform1i(m,o.u_texture),u_texture_icon:new p.Uniform1i(m,o.u_texture_icon),u_gamma_scale:new p.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(m,o.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(m,o.u_is_halo)}),background:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_opacity:new p.Uniform1f(m,o.u_opacity),u_color:new p.UniformColor(m,o.u_color)}),backgroundPattern:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_opacity:new p.Uniform1f(m,o.u_opacity),u_image:new p.Uniform1i(m,o.u_image),u_pattern_tl_a:new p.Uniform2f(m,o.u_pattern_tl_a),u_pattern_br_a:new p.Uniform2f(m,o.u_pattern_br_a),u_pattern_tl_b:new p.Uniform2f(m,o.u_pattern_tl_b),u_pattern_br_b:new p.Uniform2f(m,o.u_pattern_br_b),u_texsize:new p.Uniform2f(m,o.u_texsize),u_mix:new p.Uniform1f(m,o.u_mix),u_pattern_size_a:new p.Uniform2f(m,o.u_pattern_size_a),u_pattern_size_b:new p.Uniform2f(m,o.u_pattern_size_b),u_scale_a:new p.Uniform1f(m,o.u_scale_a),u_scale_b:new p.Uniform1f(m,o.u_scale_b),u_pixel_coord_upper:new p.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(m,o.u_pixel_coord_lower),u_tile_units_to_pixels:new p.Uniform1f(m,o.u_tile_units_to_pixels)}),terrainRaster:sa,terrainDepth:sa,skybox:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_sun_direction:new p.Uniform3f(m,o.u_sun_direction),u_cubemap:new p.Uniform1i(m,o.u_cubemap),u_opacity:new p.Uniform1f(m,o.u_opacity),u_temporal_offset:new p.Uniform1f(m,o.u_temporal_offset)}),skyboxGradient:(m,o)=>({u_matrix:new p.UniformMatrix4f(m,o.u_matrix),u_color_ramp:new p.Uniform1i(m,o.u_color_ramp),u_center_direction:new p.Uniform3f(m,o.u_center_direction),u_radius:new p.Uniform1f(m,o.u_radius),u_opacity:new p.Uniform1f(m,o.u_opacity),u_temporal_offset:new p.Uniform1f(m,o.u_temporal_offset)}),skyboxCapture:(m,o)=>({u_matrix_3f:new p.UniformMatrix3f(m,o.u_matrix_3f),u_sun_direction:new p.Uniform3f(m,o.u_sun_direction),u_sun_intensity:new p.Uniform1f(m,o.u_sun_intensity),u_color_tint_r:new p.Uniform4f(m,o.u_color_tint_r),u_color_tint_m:new p.Uniform4f(m,o.u_color_tint_m),u_luminance:new p.Uniform1f(m,o.u_luminance)}),globeRaster:(m,o)=>({u_proj_matrix:new p.UniformMatrix4f(m,o.u_proj_matrix),u_globe_matrix:new p.UniformMatrix4f(m,o.u_globe_matrix),u_merc_matrix:new p.UniformMatrix4f(m,o.u_merc_matrix),u_zoom_transition:new p.Uniform1f(m,o.u_zoom_transition),u_merc_center:new p.Uniform2f(m,o.u_merc_center),u_image0:new p.Uniform1i(m,o.u_image0)}),globeAtmosphere:(m,o)=>({u_center:new p.Uniform2f(m,o.u_center),u_radius:new p.Uniform1f(m,o.u_radius),u_screen_size:new p.Uniform2f(m,o.u_screen_size),u_pixel_ratio:new p.Uniform1f(m,o.u_pixel_ratio),u_opacity:new p.Uniform1f(m,o.u_opacity),u_fadeout_range:new p.Uniform1f(m,o.u_fadeout_range),u_start_color:new p.Uniform3f(m,o.u_start_color),u_end_color:new p.Uniform3f(m,o.u_end_color)})};let Vr;function nt(m,o,u,g,v,b,C){const M=m.context,k=M.gl,R=m.useProgram("collisionBox"),L=[];let B=0,V=0;for(let ee=0;ee<g.length;ee++){const ne=g[ee],ie=o.getTile(ne),le=ie.getBucket(u);if(!le)continue;let _e=ne.projMatrix;0===v[0]&&0===v[1]||(_e=m.translatePosMatrix(ne.projMatrix,ie,v,b));const xe=C?le.textCollisionBox:le.iconCollisionBox,qe=le.collisionCircleArray;if(qe.length>0){const Oe=p.create(),Le=_e;p.mul(Oe,le.placementInvProjMatrix,m.transform.glCoordMatrix),p.mul(Oe,Oe,le.placementViewportMatrix),L.push({circleArray:qe,circleOffset:V,transform:Le,invTransform:Oe}),B+=qe.length/4,V=B}xe&&(m.terrain&&m.terrain.setupElevationDraw(ie,R),R.draw(M,k.LINES,p.DepthMode.disabled,p.StencilMode.disabled,m.colorModeForRenderPass(),p.CullFaceMode.disabled,Ro(_e,m.transform,ie),u.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,null,m.transform.zoom,null,xe.collisionVertexBuffer,xe.collisionVertexBufferExt))}if(!C||!L.length)return;const Z=m.useProgram("collisionCircle"),H=new p.StructArrayLayout2f1f2i16;H.resize(4*B),H._trim();let W=0;for(const ee of L)for(let ne=0;ne<ee.circleArray.length/4;ne++){const ie=4*ne,le=ee.circleArray[ie+0],_e=ee.circleArray[ie+1],xe=ee.circleArray[ie+2],qe=ee.circleArray[ie+3];H.emplace(W++,le,_e,xe,qe,0),H.emplace(W++,le,_e,xe,qe,1),H.emplace(W++,le,_e,xe,qe,2),H.emplace(W++,le,_e,xe,qe,3)}(!Vr||Vr.length<2*B)&&(Vr=function(ee){const ne=2*ee,ie=new p.StructArrayLayout3ui6;ie.resize(ne),ie._trim();for(let le=0;le<ne;le++){const _e=6*le;ie.uint16[_e+0]=4*le+0,ie.uint16[_e+1]=4*le+1,ie.uint16[_e+2]=4*le+2,ie.uint16[_e+3]=4*le+2,ie.uint16[_e+4]=4*le+3,ie.uint16[_e+5]=4*le+0}return ie}(B));const ae=M.createIndexBuffer(Vr,!0),G=M.createVertexBuffer(H,p.collisionCircleLayout.members,!0);for(const ee of L){const ne={u_matrix:ee.transform,u_inv_matrix:ee.invTransform,u_camera_to_center_distance:(re=m.transform).cameraToCenterDistance,u_viewport_size:[re.width,re.height]};Z.draw(M,k.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,m.colorModeForRenderPass(),p.CullFaceMode.disabled,ne,u.id,G,ae,p.SegmentVector.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,m.transform.zoom,null,null,null)}var re;G.destroy(),ae.destroy()}const Ft=p.identity(new Float32Array(16));function Nn(m,o,u,g,v,b){const{horizontalAlign:C,verticalAlign:M}=p.getAnchorAlignment(m),k=-(C-.5)*o,R=-(M-.5)*u,L=p.evaluateVariableOffset(m,g);return new p.pointGeometry((k/v+L[0])*b,(R/v+L[1])*b)}function zi(m,o,u,g,v,b,C,M,k,R,L,B){const V=m.text.placedSymbolArray,Z=m.text.dynamicLayoutVertexArray,H=m.icon.dynamicLayoutVertexArray,W={},ae=M.projMatrix,G=b.elevation,re=G?G.getAtTileOffsetFunc(M,B):ee=>[0,0,0];Z.clear();for(let ee=0;ee<V.length;ee++){const ne=V.get(ee),ie=m.allowVerticalPlacement&&!ne.placedOrientation,le=ne.hidden||!ne.crossTileID||ie?null:g[ne.crossTileID];if(le){const _e=new p.pointGeometry(ne.tileAnchorX,ne.tileAnchorY),xe=re(_e),qe=hn(_e,u?ae:C,xe[2]),Oe=Io(b.cameraToCenterDistance,qe.signedDistanceFromCamera);let Le=v.evaluateSizeForFeature(m.textSizeData,R,ne)*Oe/p.ONE_EM;u&&(Le*=m.tilePixelRatio/k);const{width:be,height:ve,anchor:ke,textOffset:Se,textScale:rt}=le,dt=Nn(ke,be,ve,Se,rt,Le),At=u?hn(_e.add(dt),C,xe[2]).point:qe.point.add(o?dt.rotate(-b.angle):dt),He=m.allowVerticalPlacement&&ne.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let ut=0;ut<ne.numGlyphs;ut++)p.addDynamicAttributes(Z,At,He);L&&ne.associatedIconIndex>=0&&(W[ne.associatedIconIndex]={shiftedAnchor:At,angle:He})}else vt(ne.numGlyphs,Z)}if(L){H.clear();const ee=m.icon.placedSymbolArray;for(let ne=0;ne<ee.length;ne++){const ie=ee.get(ne);if(ie.hidden)vt(ie.numGlyphs,H);else{const le=W[ne];if(le)for(let _e=0;_e<ie.numGlyphs;_e++)p.addDynamicAttributes(H,le.shiftedAnchor,le.angle);else vt(ie.numGlyphs,H)}}m.icon.dynamicLayoutVertexBuffer.updateData(H)}m.text.dynamicLayoutVertexBuffer.updateData(Z)}function ha(m,o,u){return u.iconsInText&&o?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function ir(m,o,u,g,v,b,C,M,k,R,L,B){const V=m.context,Z=V.gl,H=m.transform,W=H.projection.createTileTransform(H,H.worldSize),ae="map"===M,G="map"===k,re=ae&&"point"!==u.layout.get("symbol-placement"),ee=ae&&!G&&!re,ne=void 0!==u.layout.get("symbol-sort-key").constantOr(1);let ie=!1;const le=m.depthModeForSublayer(0,p.DepthMode.ReadOnly),_e=[p.mercatorXfromLng(H.center.lng),p.mercatorYfromLat(H.center.lat)],xe=u.layout.get("text-variable-anchor"),qe="globe"===H.projection.name,Oe=qe?p.globeToMercatorTransition(H.zoom):0,Le=[],be=[];m.terrain&&G&&be.push("PITCH_WITH_MAP_TERRAIN"),qe&&be.push("PROJECTION_GLOBE_VIEW"),re&&be.push("PROJECTED_POS_ON_VIEWPORT");for(const ve of g){const ke=o.getTile(ve),Se=ke.getBucket(u);if(!Se||Se.projection!==H.projection.name)continue;const rt=v?Se.text:Se.icon;if(!rt||Se.fullyClipped||!rt.segments.get().length)continue;const dt=rt.programConfigurations.get(u.id),At=v||Se.sdfIcons,He=v?Se.textSizeData:Se.iconSizeData,ut=G||0!==H.pitch,yt=m.useProgram(ha(At,v,Se),dt,be),mn=p.evaluateSizeForZoom(He,H.zoom),Dn=[ve.canonical.x,ve.canonical.y,1<<ve.canonical.z];let bt,Bt,Mn,or,Gr=[0,0],ii=null;if(v){if(Bt=ke.glyphAtlasTexture,Mn=Z.LINEAR,bt=ke.glyphAtlasTexture.size,Se.iconsInText){Gr=ke.imageAtlasTexture.size,ii=ke.imageAtlasTexture;const dr="composite"===He.kind||"camera"===He.kind;or=ut||m.options.rotating||m.options.zooming||dr?Z.LINEAR:Z.NEAREST}}else{const dr=1!==u.layout.get("icon-size").constantOr(0)||Se.iconsNeedLinear;Bt=ke.imageAtlasTexture,Mn=At||m.options.rotating||m.options.zooming||dr||ut?Z.LINEAR:Z.NEAREST,bt=ke.imageAtlasTexture.size}const Yi=m.transform.calculatePixelsToTileUnitsMatrix(ke),Ht=Ms(ve.projMatrix,ke.tileID.canonical,G,ae,m.transform,Yi),gt=m.terrain&&G&&re?p.invert(new Float32Array(16),Ht):Ft,jt=Ko(ve.projMatrix,ke.tileID.canonical,G,ae,m.transform,Yi),Pn=xe&&Se.hasTextData(),oi="none"!==u.layout.get("icon-text-fit")&&Pn&&Se.hasIconData();if(re){const dr=H.elevation,ss=dr?dr.getAtTileOffsetFunc(ve,W):mo=>[0,0,0];Jh(Se,ve.projMatrix,m,v,Ht,jt,G,R,ss,ve)}const wn=m.translatePosMatrix(ve.projMatrix,ke,b,C),Ji=re||v&&xe||oi?Ft:Ht,ol=m.translatePosMatrix(jt,ke,b,C,!0),si=At&&0!==u.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1);let Ea;const it=W.createInversionMatrix(ve.toUnwrapped());Ea=At?Se.iconsInText?ks(He.kind,mn,ee,G,m,wn,Ji,ol,bt,Gr,Dn,Oe,it,_e):es(He.kind,mn,ee,G,m,wn,Ji,ol,v,bt,!0,Dn,Oe,it,_e):Ka(He.kind,mn,ee,G,m,wn,Ji,ol,v,bt,Dn,Oe,it,_e);const ht={program:yt,buffers:rt,uniformValues:Ea,atlasTexture:Bt,atlasTextureIcon:ii,atlasInterpolation:Mn,atlasInterpolationIcon:or,isSDF:At,hasHalo:si,tile:ke,labelPlaneMatrixInv:gt};if(ne&&Se.canOverlap){ie=!0;const dr=rt.segments.get();for(const ss of dr)Le.push({segments:new p.SegmentVector([ss]),sortKey:ss.sortKey,state:ht})}else Le.push({segments:rt.segments,sortKey:0,state:ht})}ie&&Le.sort((ve,ke)=>ve.sortKey-ke.sortKey);for(const ve of Le){const ke=ve.state;if(m.terrain&&m.terrain.setupElevationDraw(ke.tile,ke.program,{useDepthForOcclusion:!qe,labelPlaneMatrixInv:ke.labelPlaneMatrixInv}),V.activeTexture.set(Z.TEXTURE0),ke.atlasTexture.bind(ke.atlasInterpolation,Z.CLAMP_TO_EDGE),ke.atlasTextureIcon&&(V.activeTexture.set(Z.TEXTURE1),ke.atlasTextureIcon&&ke.atlasTextureIcon.bind(ke.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),ke.isSDF){const Se=ke.uniformValues;ke.hasHalo&&(Se.u_is_halo=1,Lo(ke.buffers,ve.segments,u,m,ke.program,le,L,B,Se)),Se.u_is_halo=0}Lo(ke.buffers,ve.segments,u,m,ke.program,le,L,B,ke.uniformValues)}}function Lo(m,o,u,g,v,b,C,M,k){const R=g.context;v.draw(R,R.gl.TRIANGLES,b,C,M,p.CullFaceMode.disabled,k,u.id,m.layoutVertexBuffer,m.indexBuffer,o,u.paint,g.transform.zoom,m.programConfigurations.get(u.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Gn(m,o,u,g,v,b,C){const M=m.context.gl,k=u.paint.get("fill-pattern"),R=k&&k.constantOr(1),L=u.getCrossfadeParameters();let B,V,Z,H,W;C?(V=R&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=M.LINES):(V=R?"fillPattern":"fill",B=M.TRIANGLES);for(const ae of g){const G=o.getTile(ae);if(R&&!G.patternsLoaded())continue;const re=G.getBucket(u);if(!re)continue;m.prepareDrawTile(ae);const ee=re.programConfigurations.get(u.id),ne=m.useProgram(V,ee);R&&(m.context.activeTexture.set(M.TEXTURE0),G.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),ee.updatePaintBuffers(L));const ie=k.constantOr(null);if(ie&&G.imageAtlas){const _e=G.imageAtlas,xe=_e.patternPositions[ie.to.toString()],qe=_e.patternPositions[ie.from.toString()];xe&&qe&&ee.setConstantPatternPositions(xe,qe)}const le=m.translatePosMatrix(ae.projMatrix,G,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(C){H=re.indexBuffer2,W=re.segments2;const _e=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];Z="fillOutlinePattern"===V&&R?Nu(le,m,L,G,_e):Op(le,_e)}else H=re.indexBuffer,W=re.segments,Z=R?Fi(le,m,L,G):Qh(le);m.prepareDrawProgram(m.context,ne,ae.toUnwrapped()),ne.draw(m.context,B,v,m.stencilModeForClipping(ae),b,p.CullFaceMode.disabled,Z,u.id,re.layoutVertexBuffer,H,W,u.paint,m.transform.zoom,ee)}}function ts(m,o,u,g,v,b,C){const M=m.context,k=M.gl,R=u.paint.get("fill-extrusion-pattern"),L=R.constantOr(1),B=u.getCrossfadeParameters(),V=u.paint.get("fill-extrusion-opacity");for(const Z of g){const H=o.getTile(Z),W=H.getBucket(u);if(!W)continue;const ae=W.programConfigurations.get(u.id),G=m.useProgram(L?"fillExtrusionPattern":"fillExtrusion",ae);if(m.terrain){const le=m.terrain;if(!W.enableTerrain)continue;if(le.setupElevationDraw(H,G,{useMeterToDem:!0}),da(M,o,Z,W,u,le),!W.centroidVertexBuffer){const _e=G.attributes.a_centroid_pos;void 0!==_e&&k.vertexAttrib2f(_e,0,0)}}L&&(m.context.activeTexture.set(k.TEXTURE0),H.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ae.updatePaintBuffers(B));const re=R.constantOr(null);if(re&&H.imageAtlas){const le=H.imageAtlas,_e=le.patternPositions[re.to.toString()],xe=le.patternPositions[re.from.toString()];_e&&xe&&ae.setConstantPatternPositions(_e,xe)}const ee=m.translatePosMatrix(Z.projMatrix,H,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),ne=u.paint.get("fill-extrusion-vertical-gradient"),ie=L?ca(ee,m,ne,V,Z,B,H):ko(ee,m,ne,V);m.prepareDrawProgram(M,G,Z.toUnwrapped()),G.draw(M,M.gl.TRIANGLES,v,b,C,p.CullFaceMode.backCCW,ie,u.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,u.paint,m.transform.zoom,ae,m.terrain?W.centroidVertexBuffer:null)}}function da(m,o,u,g,v,b){const C=[G=>{let re=G.canonical.x-1,ee=G.wrap;return re<0&&(re=(1<<G.canonical.z)-1,ee--),new p.OverscaledTileID(G.overscaledZ,ee,G.canonical.z,re,G.canonical.y)},G=>{let re=G.canonical.x+1,ee=G.wrap;return re===1<<G.canonical.z&&(re=0,ee++),new p.OverscaledTileID(G.overscaledZ,ee,G.canonical.z,re,G.canonical.y)},G=>new p.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,(0===G.canonical.y?1<<G.canonical.z:G.canonical.y)-1),G=>new p.OverscaledTileID(G.overscaledZ,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y===(1<<G.canonical.z)-1?0:G.canonical.y+1)],M=G=>{const re=o.getSource().maxzoom,ee=_e=>{const xe=o.getTileByID(_e);if(xe&&xe.hasData())return xe.getBucket(v)};let ne,ie,le;return(G.overscaledZ===G.canonical.z||G.overscaledZ>=re)&&(ne=ee(G.key)),G.overscaledZ>=re&&(ie=ee(G.calculateScaledKey(G.overscaledZ+1))),G.overscaledZ>re&&(le=ee(G.calculateScaledKey(G.overscaledZ-1))),ne||ie||le},k=[0,0,0],R=(G,re)=>(k[0]=Math.min(G.min.y,re.min.y),k[1]=Math.max(G.max.y,re.max.y),k[2]=p.EXTENT-re.min.x>G.max.x?re.min.x-p.EXTENT:G.max.x,k),L=(G,re)=>(k[0]=Math.min(G.min.x,re.min.x),k[1]=Math.max(G.max.x,re.max.x),k[2]=p.EXTENT-re.min.y>G.max.y?re.min.y-p.EXTENT:G.max.y,k),B=[(G,re)=>R(G,re),(G,re)=>R(re,G),(G,re)=>L(G,re),(G,re)=>L(re,G)],V=new p.pointGeometry(0,0);let Z,H,W;const ae=(G,re,ee,ne,ie)=>{const le=[[ne?ee:G,ne?G:ee,0],[ne?ee:re,ne?re:ee,0]],_e=ie<0?p.EXTENT+ie:ie,xe=[ne?_e:(G+re)/2,ne?(G+re)/2:_e,0];return 0===ee&&ie<0||0!==ee&&ie>0?b.getForTilePoints(W,[xe],!0,H):le.push(xe),b.getForTilePoints(u,le,!0,Z),Math.max(le[0][2],le[1][2],xe[2])/b.exaggeration()};for(let G=0;G<4;G++){const re=g.borders[G];if(0===re.length&&(g.borderDone[G]=!0),g.borderDone[G])continue;const ee=W=C[G](u),ne=M(ee);if(!(ne&&ne.enableTerrain&&(H=b.findDEMTileFor(ee),H&&H.dem)))continue;if(!Z){const xe=b.findDEMTileFor(u);if(!xe||!xe.dem)return;Z=xe}const ie=(G<2?1:5)-G,le=ne.borders[ie];let _e=0;for(let xe=0;xe<re.length;xe++){const qe=g.featuresOnBorder[re[xe]],Oe=qe.borders[G];let Le;for(;_e<le.length&&(Le=ne.featuresOnBorder[le[_e]],!(Le.borders[ie][1]>Oe[0]+3));)ne.borderDone[ie]||ne.encodeCentroid(void 0,Le,!1),_e++;if(Le&&_e<le.length){const be=_e;let ve=0;for(;!(Le.borders[ie][0]>Oe[1]-3)&&(ve++,++_e!==le.length);)Le=ne.featuresOnBorder[le[_e]];if(Le=ne.featuresOnBorder[le[be]],qe.intersectsCount()>1||Le.intersectsCount()>1||1!==ve){1!==ve&&(_e=be),g.encodeCentroid(void 0,qe,!1),ne.borderDone[ie]||ne.encodeCentroid(void 0,Le,!1);continue}const ke=B[G](qe,Le),Se=G%2?p.EXTENT-1:0;V.x=ae(ke[0],Math.min(p.EXTENT-1,ke[1]),Se,G<2,ke[2]),V.y=0,g.encodeCentroid(V,qe,!1),ne.borderDone[ie]||ne.encodeCentroid(V,Le,!1)}else g.encodeCentroid(void 0,qe,!1)}g.borderDone[G]=g.needsCentroidUpdate=!0,ne.borderDone[ie]||(ne.borderDone[ie]=ne.needsCentroidUpdate=!0)}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&0!==g.centroidVertexArray.length)&&g.uploadCentroid(m)}const Pt=new p.Color(1,0,0,1),Uc=new p.Color(0,1,0,1),Oo=new p.Color(0,0,1,1),pa=new p.Color(1,0,1,1),fa=new p.Color(0,1,1,1);function Rn(m,o,u,g){Xi(m,0,o+u/2,m.transform.width,u,g)}function Rs(m,o,u,g){Xi(m,o-u/2,0,u,m.transform.height,g)}function Xi(m,o,u,g,v,b){const C=m.context,M=C.gl;M.enable(M.SCISSOR_TEST),M.scissor(o*p.exported.devicePixelRatio,u*p.exported.devicePixelRatio,g*p.exported.devicePixelRatio,v*p.exported.devicePixelRatio),C.clear({color:b}),M.disable(M.SCISSOR_TEST)}function yi(m,o,u){const g=m.context,v=g.gl,b=u.projMatrix,C=m.useProgram("debug"),M=o.getTileByID(u.key);m.terrain&&m.terrain.setupElevationDraw(M,C);const k=p.DepthMode.disabled,R=p.StencilMode.disabled,L=m.colorModeForRenderPass(),B="$debug";g.activeTexture.set(v.TEXTURE0),m.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),M._makeDebugTileBoundsBuffers(m.context,m.transform.projection);const V=M._tileDebugBuffer||m.debugBuffer,Z=M._tileDebugIndexBuffer||m.debugIndexBuffer,H=M._tileDebugSegments||m.debugSegments;C.draw(g,v.LINE_STRIP,k,R,L,p.CullFaceMode.disabled,Uu(b,p.Color.red),B,V,Z,H);const W=M.latestRawTileData,ae=Math.floor((W&&W.byteLength||0)/1024),G=o.getTile(u).tileSize,re=512/Math.min(G,512)*(u.overscaledZ/m.transform.zoom)*.5;let ee=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(ee+=` => ${u.overscaledZ}`),function(ne,ie){ne.initDebugOverlayCanvas();const le=ne.debugOverlayCanvas,_e=ne.context.gl,xe=ne.debugOverlayCanvas.getContext("2d");xe.clearRect(0,0,le.width,le.height),xe.shadowColor="white",xe.shadowBlur=2,xe.lineWidth=1.5,xe.strokeStyle="white",xe.textBaseline="top",xe.font="bold 36px Open Sans, sans-serif",xe.fillText(ie,5,5),xe.strokeText(ie,5,5),ne.debugOverlayTexture.update(le),ne.debugOverlayTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}(m,`${ee} ${ae}kb`),C.draw(g,v.TRIANGLES,k,R,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,Uu(b,p.Color.transparent,re),B,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments)}const An=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Vu}=An;function po(m,o,u,g){m.emplaceBack(o,u,g)}class Bi{constructor(o){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,po(this.vertexArray,-1,-1,1),po(this.vertexArray,1,-1,1),po(this.vertexArray,-1,1,1),po(this.vertexArray,1,1,1),po(this.vertexArray,-1,-1,-1),po(this.vertexArray,1,-1,-1),po(this.vertexArray,-1,1,-1),po(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Vu),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function Mr(m,o,u,g,v,b){const C=m.gl,M=o.paint.get("sky-atmosphere-color"),k=o.paint.get("sky-atmosphere-halo-color"),R=o.paint.get("sky-atmosphere-sun-intensity"),L={u_matrix_3f:p.fromMat4([],g),u_sun_direction:v,u_sun_intensity:R,u_color_tint_r:[(H=M).r,H.g,H.b,H.a],u_color_tint_m:[(W=k).r,W.g,W.b,W.a],u_luminance:5e-5};var H,W;C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+b,o.skyboxTexture,0),u.draw(m,C.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,L,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const ma={symbol:function(m,o,u,g,v){if("translucent"!==m.renderPass)return;const b=p.StencilMode.disabled,C=m.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(M,k,R,L,B,V,Z){const H=k.transform,W="map"===B,ae="map"===V,G=H.projection.createTileTransform(H,H.worldSize);for(const re of M){const ee=L.getTile(re),ne=ee.getBucket(R);if(!ne||ne.projection!==H.projection.name||!ne.text||!ne.text.segments.get().length)continue;const ie=p.evaluateSizeForZoom(ne.textSizeData,H.zoom),le=k.transform.calculatePixelsToTileUnitsMatrix(ee),_e=Ms(re.projMatrix,ee.tileID.canonical,ae,W,k.transform,le),xe="none"!==R.layout.get("icon-text-fit")&&ne.hasIconData();if(ie){const qe=Math.pow(2,H.zoom-ee.tileID.overscaledZ);zi(ne,W,ae,Z,p.symbolSize,H,_e,re,qe,ie,xe,G)}}}(g,m,u,o,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),v),0!==u.paint.get("icon-opacity").constantOr(1)&&ir(m,o,u,g,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),b,C),0!==u.paint.get("text-opacity").constantOr(1)&&ir(m,o,u,g,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),b,C),o.map.showCollisionBoxes&&(nt(m,o,u,g,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),nt(m,o,u,g,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(m,o,u,g){if("translucent"!==m.renderPass)return;const v=u.paint.get("circle-opacity"),b=u.paint.get("circle-stroke-width"),C=u.paint.get("circle-stroke-opacity"),M=void 0!==u.layout.get("circle-sort-key").constantOr(1);if(0===v.constantOr(1)&&(0===b.constantOr(1)||0===C.constantOr(1)))return;const k=m.context,R=k.gl,L=m.depthModeForSublayer(0,p.DepthMode.ReadOnly),B=p.StencilMode.disabled,V=m.colorModeForRenderPass(),Z=[];for(let W=0;W<g.length;W++){const ae=g[W],G=o.getTile(ae),re=G.getBucket(u);if(!re)continue;const ee=re.programConfigurations.get(u.id),ne=Nc(u),ie={programConfiguration:ee,program:m.useProgram("circle",ee,ne),layoutVertexBuffer:re.layoutVertexBuffer,indexBuffer:re.indexBuffer,uniformValues:ed(m,ae,G,u),tile:G};if(M){const le=re.segments.get();for(const _e of le)Z.push({segments:new p.SegmentVector([_e]),sortKey:_e.sortKey,state:ie})}else Z.push({segments:re.segments,sortKey:0,state:ie})}M&&Z.sort((W,ae)=>W.sortKey-ae.sortKey);const H={useDepthForOcclusion:"globe"!==m.transform.projection.name};for(const W of Z){const{programConfiguration:ae,program:G,layoutVertexBuffer:re,indexBuffer:ee,uniformValues:ne,tile:ie}=W.state,le=W.segments;m.terrain&&m.terrain.setupElevationDraw(ie,G,H),m.prepareDrawProgram(k,G,ie.tileID.toUnwrapped()),G.draw(k,R.TRIANGLES,L,B,V,p.CullFaceMode.disabled,ne,u.id,re,ee,le,u.paint,m.transform.zoom,ae)}},heatmap:function(m,o,u,g){if(0!==u.paint.get("heatmap-opacity"))if("offscreen"===m.renderPass){const v=m.context,b=v.gl,C=p.StencilMode.disabled,M=new p.ColorMode([b.ONE,b.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(k,R,L){const B=k.gl;k.activeTexture.set(B.TEXTURE1),k.viewport.set([0,0,R.width/4,R.height/4]);let V=L.heatmapFbo;if(V)B.bindTexture(B.TEXTURE_2D,V.colorAttachment.get()),k.bindFramebuffer.set(V.framebuffer);else{const Z=B.createTexture();B.bindTexture(B.TEXTURE_2D,Z),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR),V=L.heatmapFbo=k.createFramebuffer(R.width/4,R.height/4,!1),function(H,W,ae,G){const re=H.gl;re.texImage2D(re.TEXTURE_2D,0,re.RGBA,W.width/4,W.height/4,0,re.RGBA,H.extRenderToTextureHalfFloat?H.extTextureHalfFloat.HALF_FLOAT_OES:re.UNSIGNED_BYTE,null),G.colorAttachment.set(ae)}(k,R,Z,V)}})(v,m,u),v.clear({color:p.Color.transparent});for(let k=0;k<g.length;k++){const R=g[k];if(o.hasRenderableParent(R))continue;const L=o.getTile(R),B=L.getBucket(u);if(!B)continue;const V=B.programConfigurations.get(u.id),Z=m.useProgram("heatmap",V),{zoom:H}=m.transform;m.terrain&&m.terrain.setupElevationDraw(L,Z),m.prepareDrawProgram(v,Z,R.toUnwrapped()),Z.draw(v,b.TRIANGLES,p.DepthMode.disabled,C,M,p.CullFaceMode.disabled,ju(R.projMatrix,L,H,u.paint.get("heatmap-intensity")),u.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,u.paint,m.transform.zoom,V)}v.viewport.set([0,0,m.width,m.height])}else"translucent"===m.renderPass&&(m.context.setColorMode(m.colorModeForRenderPass()),function(v,b){const C=v.context,M=C.gl,k=b.heatmapFbo;if(!k)return;C.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,k.colorAttachment.get()),C.activeTexture.set(M.TEXTURE1);let R=b.colorRampTexture;R||(R=b.colorRampTexture=new p.Texture(C,b.colorRamp,M.RGBA)),R.bind(M.LINEAR,M.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(C,M.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,v.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:b.paint.get("heatmap-opacity")},b.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,b.paint,v.transform.zoom)}(m,u))},line:function(m,o,u,g){if("translucent"!==m.renderPass)return;const v=u.paint.get("line-opacity"),b=u.paint.get("line-width");if(0===v.constantOr(1)||0===b.constantOr(1))return;const C=m.depthModeForSublayer(0,p.DepthMode.ReadOnly),M=m.colorModeForRenderPass(),k=u.paint.get("line-dasharray"),R=k.constantOr(1),L=u.layout.get("line-cap"),B=u.paint.get("line-pattern"),V=B.constantOr(1),Z=u.paint.get("line-gradient"),H=u.getCrossfadeParameters(),W=V?"linePattern":"line",ae=m.context,G=ae.gl,re=(ne=>{const ie=[];ho(ne)&&ie.push("RENDER_LINE_DASH"),ne.paint.get("line-gradient")&&ie.push("RENDER_LINE_GRADIENT");const le=ne.paint.get("line-pattern").constantOr(1),_e=1!==ne.paint.get("line-opacity").constantOr(1);return!le&&_e&&ie.push("RENDER_LINE_ALPHA_DISCARD"),ie})(u);let ee=re.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(ee=!1);for(const ne of g){const ie=o.getTile(ne);if(V&&!ie.patternsLoaded())continue;const le=ie.getBucket(u);if(!le)continue;m.prepareDrawTile(ne);const _e=le.programConfigurations.get(u.id),xe=m.useProgram(W,_e,re),qe=B.constantOr(null);if(qe&&ie.imageAtlas){const Se=ie.imageAtlas,rt=Se.patternPositions[qe.to.toString()],dt=Se.patternPositions[qe.from.toString()];rt&&dt&&_e.setConstantPatternPositions(rt,dt)}const Oe=k.constantOr(null),Le=L.constantOr(null);if(!V&&Oe&&Le&&ie.lineAtlas){const Se=ie.lineAtlas,rt=Se.getDash(Oe.to,Le),dt=Se.getDash(Oe.from,Le);rt&&dt&&_e.setConstantPatternPositions(rt,dt)}const be=m.terrain?ne.projMatrix:null,ve=V?nr(m,ie,u,H,be):zr(m,ie,u,H,be,le.lineClipsArray.length);if(Z){const Se=le.gradients[u.id];let rt=Se.texture;if(u.gradientVersion!==Se.version){let dt=256;if(u.stepInterpolant){const At=o.getSource().maxzoom,He=ne.canonical.z===At?Math.ceil(1<<m.transform.maxZoom-ne.canonical.z):1;dt=p.clamp(p.nextPowerOfTwo(le.maxLineLength/p.EXTENT*1024*He),256,ae.maxTextureSize)}Se.gradient=p.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:dt,image:Se.gradient||void 0,clips:le.lineClipsArray}),Se.texture?Se.texture.update(Se.gradient):Se.texture=new p.Texture(ae,Se.gradient,G.RGBA),Se.version=u.gradientVersion,rt=Se.texture}ae.activeTexture.set(G.TEXTURE1),rt.bind(u.stepInterpolant?G.NEAREST:G.LINEAR,G.CLAMP_TO_EDGE)}R&&(ae.activeTexture.set(G.TEXTURE0),ie.lineAtlasTexture.bind(G.LINEAR,G.REPEAT),_e.updatePaintBuffers(H)),V&&(ae.activeTexture.set(G.TEXTURE0),ie.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),_e.updatePaintBuffers(H)),m.prepareDrawProgram(ae,xe,ne.toUnwrapped());const ke=Se=>{xe.draw(ae,G.TRIANGLES,C,Se,M,p.CullFaceMode.disabled,ve,u.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,u.paint,m.transform.zoom,_e,le.layoutVertexBuffer2)};if(ee){const Se=m.stencilModeForClipping(ne).ref;0===Se&&m.terrain&&ae.clear({stencil:0});const rt={func:G.EQUAL,mask:255};ve.u_alpha_discard_threshold=.8,ke(new p.StencilMode(rt,Se,255,G.KEEP,G.KEEP,G.INVERT)),ve.u_alpha_discard_threshold=0,ke(new p.StencilMode(rt,Se,255,G.KEEP,G.KEEP,G.KEEP))}else ke(m.stencilModeForClipping(ne))}ee&&(m.resetStencilClippingMasks(),m.terrain&&ae.clear({stencil:0}))},fill:function(m,o,u,g){const v=u.paint.get("fill-color"),b=u.paint.get("fill-opacity");if(0===b.constantOr(1))return;const C=m.colorModeForRenderPass(),M=u.paint.get("fill-pattern"),k=m.opaquePassEnabledForLayer()&&!M.constantOr(1)&&1===v.constantOr(p.Color.transparent).a&&1===b.constantOr(0)?"opaque":"translucent";if(m.renderPass===k){const R=m.depthModeForSublayer(1,"opaque"===m.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);Gn(m,o,u,g,R,C,!1)}if("translucent"===m.renderPass&&u.paint.get("fill-antialias")){const R=m.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);Gn(m,o,u,g,R,C,!0)}},"fill-extrusion":function(m,o,u,g){const v=u.paint.get("fill-extrusion-opacity");if(0!==v&&"translucent"===m.renderPass){const b=new p.DepthMode(m.context.gl.LEQUAL,p.DepthMode.ReadWrite,m.depthRangeFor3D);if(1!==v||u.paint.get("fill-extrusion-pattern").constantOr(1))ts(m,o,u,g,b,p.StencilMode.disabled,p.ColorMode.disabled),ts(m,o,u,g,b,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{const C=m.colorModeForRenderPass();ts(m,o,u,g,b,p.StencilMode.disabled,C)}}},hillshade:function(m,o,u,g){if("offscreen"!==m.renderPass&&"translucent"!==m.renderPass)return;const v=m.context,b=m.depthModeForSublayer(0,p.DepthMode.ReadOnly),C=m.colorModeForRenderPass(),M=m.terrain&&m.terrain.renderingToTexture,[k,R]="translucent"!==m.renderPass||M?[{},g]:m.stencilConfigForOverlap(g);for(const L of R){const B=o.getTile(L);if(B.needsHillshadePrepare&&"offscreen"===m.renderPass)Qr(m,B,u,b,p.StencilMode.disabled,C);else if("translucent"===m.renderPass){const V=M&&m.terrain?m.terrain.stencilModeForRTTOverlap(L):k[L.overscaledZ];zu(m,L,B,u,b,V,C)}}v.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,o,u,g,v,b){if("translucent"!==m.renderPass||0===u.paint.get("raster-opacity")||!g.length)return;const C=m.context,M=C.gl,k=o.getSource(),R=m.useProgram("raster"),L=m.colorModeForRenderPass(),B=m.terrain&&m.terrain.renderingToTexture,[V,Z]=k instanceof So||B?[{},g]:m.stencilConfigForOverlap(g),H=Z[Z.length-1].overscaledZ,W=!m.options.moving;for(const ae of Z){const G=B?p.DepthMode.disabled:m.depthModeForSublayer(ae.overscaledZ-H,1===u.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,M.LESS),re=ae.toUnwrapped(),ee=o.getTile(ae);if(B&&(!ee||!ee.hasData()))continue;const ne=B?ae.projMatrix:m.transform.calculateProjMatrix(re,W),ie=m.terrain&&B?m.terrain.stencilModeForRTTOverlap(ae):V[ae.overscaledZ],le=b?0:u.paint.get("raster-fade-duration");ee.registerFadeDuration(le);const _e=o.findLoadedParent(ae,0),xe=Rp(ee,_e,o,m.transform,le);let qe,Oe;m.terrain&&m.terrain.prepareDrawTile(ae);const Le="nearest"===u.paint.get("raster-resampling")?M.NEAREST:M.LINEAR;C.activeTexture.set(M.TEXTURE0),ee.texture.bind(Le,M.CLAMP_TO_EDGE),C.activeTexture.set(M.TEXTURE1),_e?(_e.texture.bind(Le,M.CLAMP_TO_EDGE),qe=Math.pow(2,_e.tileID.overscaledZ-ee.tileID.overscaledZ),Oe=[ee.tileID.canonical.x*qe%1,ee.tileID.canonical.y*qe%1]):ee.texture.bind(Le,M.CLAMP_TO_EDGE);const be=ei(ne,Oe||[0,0],qe||1,xe,u,k instanceof So?k.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(C,R,re),k instanceof So)R.draw(C,M.TRIANGLES,G,p.StencilMode.disabled,L,p.CullFaceMode.disabled,be,u.id,k.boundsBuffer,m.quadTriangleIndexBuffer,k.boundsSegments);else{const{tileBoundsBuffer:ve,tileBoundsIndexBuffer:ke,tileBoundsSegments:Se}=m.getTileBoundsBuffers(ee);R.draw(C,M.TRIANGLES,G,ie,L,p.CullFaceMode.disabled,be,u.id,ve,ke,Se)}}m.resetStencilClippingMasks()},background:function(m,o,u,g){const v=u.paint.get("background-color"),b=u.paint.get("background-opacity");if(0===b)return;const C=m.context,M=C.gl,k=m.transform,R=k.tileSize,L=u.paint.get("background-pattern");if(m.isPatternMissing(L))return;const B=!L&&1===v.a&&1===b&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==B)return;const V=p.StencilMode.disabled,Z=m.depthModeForSublayer(0,"opaque"===B?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),H=m.colorModeForRenderPass(),W=m.useProgram(L?"backgroundPattern":"background");let ae,G=g;G||(ae=m.getBackgroundTiles(),G=Object.values(ae).map(ee=>ee.tileID)),L&&(C.activeTexture.set(M.TEXTURE0),m.imageManager.bind(m.context));const re=u.getCrossfadeParameters();for(const ee of G){const ne=ee.toUnwrapped(),ie=g?ee.projMatrix:m.transform.calculateProjMatrix(ne);m.prepareDrawTile(ee);const le=o?o.getTile(ee):ae?ae[ee.key]:new p.Tile(ee,R,k.zoom,m),_e=L?xr(ie,b,m,L,{tileID:ee,tileSize:R},re):Ut(ie,b,v);m.prepareDrawProgram(C,W,ne);const{tileBoundsBuffer:xe,tileBoundsIndexBuffer:qe,tileBoundsSegments:Oe}=m.getTileBoundsBuffers(le);W.draw(C,M.TRIANGLES,Z,V,H,p.CullFaceMode.disabled,_e,u.id,xe,qe,Oe)}},sky:function(m,o,u){const g=m.transform,v="mercator"===g.projection.name||"globe"===g.projection.name?1:p.smoothstep(7,8,g.zoom),b=u.paint.get("sky-opacity")*v;if(0===b)return;const C=m.context,M=u.paint.get("sky-type"),k=new p.DepthMode(C.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),R=m.frameCounter/1e3%1;"atmosphere"===M?"offscreen"===m.renderPass?u.needsSkyboxCapture(m)&&(function(L,B,V,Z){const H=L.context,W=H.gl;let ae=B.skyboxFbo;if(!ae){ae=B.skyboxFbo=H.createFramebuffer(32,32,!1),B.skyboxGeometry=new Bi(H),B.skyboxTexture=H.gl.createTexture(),W.bindTexture(W.TEXTURE_CUBE_MAP,B.skyboxTexture),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,W.LINEAR);for(let ne=0;ne<6;++ne)W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,W.RGBA,32,32,0,W.RGBA,W.UNSIGNED_BYTE,null)}H.bindFramebuffer.set(ae.framebuffer),H.viewport.set([0,0,32,32]);const G=B.getCenter(L,!0),re=L.useProgram("skyboxCapture"),ee=new Float64Array(16);p.identity(ee),p.rotateY(ee,ee,.5*-Math.PI),Mr(H,B,re,ee,G,0),p.identity(ee),p.rotateY(ee,ee,.5*Math.PI),Mr(H,B,re,ee,G,1),p.identity(ee),p.rotateX(ee,ee,.5*-Math.PI),Mr(H,B,re,ee,G,2),p.identity(ee),p.rotateX(ee,ee,.5*Math.PI),Mr(H,B,re,ee,G,3),p.identity(ee),Mr(H,B,re,ee,G,4),p.identity(ee),p.rotateY(ee,ee,Math.PI),Mr(H,B,re,ee,G,5),H.viewport.set([0,0,L.width,L.height])}(m,u),u.markSkyboxValid(m)):"sky"===m.renderPass&&function(L,B,V,Z,H){const W=L.context,ae=W.gl,G=L.transform,re=L.useProgram("skybox");W.activeTexture.set(ae.TEXTURE0),ae.bindTexture(ae.TEXTURE_CUBE_MAP,B.skyboxTexture);const ee={u_matrix:G.skyboxMatrix,u_sun_direction:B.getCenter(L,!1),u_cubemap:0,u_opacity:Z,u_temporal_offset:H};L.prepareDrawProgram(W,re),re.draw(W,ae.TRIANGLES,V,p.StencilMode.disabled,L.colorModeForRenderPass(),p.CullFaceMode.backCW,ee,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(m,u,k,b,R):"gradient"===M&&"sky"===m.renderPass&&function(L,B,V,Z,H){const W=L.context,ae=W.gl,G=L.transform,re=L.useProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new Bi(W)),W.activeTexture.set(ae.TEXTURE0);let ee=B.colorRampTexture;ee||(ee=B.colorRampTexture=new p.Texture(W,B.colorRamp,ae.RGBA)),ee.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);const ne=(ie=G.skyboxMatrix,le=B.getCenter(L,!1),_e=B.paint.get("sky-gradient-radius"),xe=Z,qe=H,{u_matrix:ie,u_color_ramp:0,u_center_direction:le,u_radius:p.degToRad(_e),u_opacity:xe,u_temporal_offset:qe});var ie,le,_e,xe,qe;L.prepareDrawProgram(W,re),re.draw(W,ae.TRIANGLES,V,p.StencilMode.disabled,L.colorModeForRenderPass(),p.CullFaceMode.backCW,ne,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(m,u,k,b,R)},debug:function(m,o,u){for(let g=0;g<u.length;g++)yi(m,o,u[g])},custom:function(m,o,u){const g=m.context,v=u.implementation;if(m.transform.projection.unsupportedLayers&&m.transform.projection.unsupportedLayers.includes("custom"))p.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===m.renderPass){const b=v.prerender;b&&(m.setCustomLayerDefaults(),g.setColorMode(m.colorModeForRenderPass()),b.call(v,g.gl,m.transform.customLayerMatrix()),g.setDirty(),m.setBaseState())}else if("translucent"===m.renderPass){m.setCustomLayerDefaults(),g.setColorMode(m.colorModeForRenderPass()),g.setStencilMode(p.StencilMode.disabled);const b="3d"===v.renderingMode?new p.DepthMode(m.context.gl.LEQUAL,p.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,p.DepthMode.ReadOnly);g.setDepthMode(b),v.render(g.gl,m.transform.customLayerMatrix()),g.setDirty(),m.setBaseState(),g.bindFramebuffer.set(null)}}};class Zl{constructor(o,u){this.context=new Ri(o),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Tt,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(o,u){const g=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new uo(this,o));const v=this._terrain;this.transform.elevation=g?v:null,v.update(o,this.transform,u)}_updateFog(o){const u=o.fog;if(!u||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,v]=u.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);const b=g+.78*(v-g);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,u){if(this.width=o*p.exported.devicePixelRatio,this.height=u*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._layers[g].resize()}setup(){const o=this.context,u=new p.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(p.EXTENT,0),u.emplaceBack(0,p.EXTENT),u.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(u,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const g=new p.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(p.EXTENT,0),g.emplaceBack(0,p.EXTENT),g.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=o.createVertexBuffer(g,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const v=new p.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(v,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const b=new p.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(p.EXTENT,0,p.EXTENT,0),b.emplaceBack(0,p.EXTENT,0,p.EXTENT),b.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=o.createVertexBuffer(b,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const C=new p.StructArrayLayout3ui6;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(C);const M=new p.StructArrayLayout1ui2;for(const R of[0,1,3,2,0])M.emplaceBack(R);this.debugIndexBuffer=o.createIndexBuffer(M),this.emptyTexture=new p.Texture(o,{width:1,height:1,data:new Uint8Array([0,0,0,0])},o.gl.RGBA),this.identityMat=p.create();const k=this.context.gl;this.stencilClearMode=new p.StencilMode({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(p.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context,u=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(o,u.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,Kt(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,u,g){if(!u||this.currentStencilSource===u.id||!o.isTileClipped()||!g||0===g.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const k of g)if(void 0===this._tileClippingMaskIDs[k.key]){M=!0;break}if(!M)return}this.currentStencilSource=u.id;const v=this.context,b=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(p.ColorMode.disabled),v.setDepthMode(p.DepthMode.disabled);const C=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of g){const k=u.getTile(M),R=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:B,tileBoundsSegments:V}=this.getTileBoundsBuffers(k);C.draw(v,b.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:b.ALWAYS,mask:0},R,255,b.KEEP,b.KEEP,b.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,Kt(M.projMatrix),"$clipping",L,B,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,u=this.context.gl;return new p.StencilMode({func:u.NOTEQUAL,mask:255},o,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const u=this.context.gl;return new p.StencilMode({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(o){const u=this.context.gl,g=o.sort((C,M)=>M.overscaledZ-C.overscaledZ),v=g[g.length-1].overscaledZ,b=g[0].overscaledZ-v+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const C={};for(let M=0;M<b;M++)C[M+v]=new p.StencilMode({func:u.GEQUAL,mask:255},M+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=b,[C,g]}return[{[v]:p.StencilMode.disabled},g]}colorModeForRenderPass(){const o=this.context.gl;if(this._showOverdrawInspector){const u=1/8;return new p.ColorMode([o.CONSTANT_COLOR,o.ONE],new p.Color(u,u,u,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(o,u,g){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new p.DepthMode(g||this.context.gl.LEQUAL,u,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,u){this.style=o,this.options=u,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const g=this.style.order,v=this.style._sourceCaches;for(const R in v){const L=v[R];L.used&&L.prepare(this.context)}const b={},C={},M={};for(const R in v){const L=v[R];b[R]=L.getVisibleCoordinates(),C[R]=b[R].slice().reverse(),M[R]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<g.length;R++)if(this.style._layers[g[R]].is3D()){this.opaquePassCutoff=R;break}if(this.terrain&&(this.terrain.updateTileBinding(M),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const R of g){const L=this.style._layers[R],B=o._getLayerSourceCache(L);if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;const V=B?C[B.id]:void 0;("custom"===L.type||L.isSky()||V&&V.length)&&this.renderLayer(this,B,L,V)}this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let k=p.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(k=this.style.fog.properties.get("color")),this.context.clear({color:u.showOverdrawInspector?p.Color.black:k,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[g[this.currentLayer]],L=o._getLayerSourceCache(R);if(R.isSky())continue;const B=L?C[L.id]:void 0;this._renderTileClippingMasks(R,L,B),this.renderLayer(this,L,R,B)}if(this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const R=this.style._layers[g[this.currentLayer]],L=o._getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,L,R,L?C[L.id]:void 0)}for("globe"===this.transform.projection.name&&function(R){const L=R.context,B=L.gl,V=R.transform,Z=new p.DepthMode(B.LEQUAL,p.DepthMode.ReadOnly,[0,1]),H=R.useProgram("globeAtmosphere"),W=V._camera.getWorldToCamera(V.worldSize,1),ae=V._camera.getCameraToClipPerspective(V._fov,V.width/V.height,V._nearZ,V._farZ),G=p.mul([],W,p.calculateGlobeMatrix(V,V.worldSize)),re=p.mul([],V.labelPlaneMatrix,ae),ee=p.transformMat4([],[0,0,0],G),ne=p.add([],ee,[V.worldSize/Math.PI/2,0,0]),ie=p.transformMat4([],ee,re),le=p.transformMat4([],ne,re),_e=p.length(p.sub([],le,ie)),xe=1-p.globeToMercatorTransition(V.zoom),qe={u_center:ie,u_radius:_e,u_screen_size:[V.width,V.height],u_pixel_ratio:p.exported.devicePixelRatio,u_opacity:xe,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};R.prepareDrawProgram(L,H);const Oe=R.globeSharedBuffers;Oe&&H.draw(L,B.TRIANGLES,Z,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,qe,"skybox",Oe.atmosphereVertexBuffer,Oe.atmosphereIndexBuffer,Oe.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;){const R=this.style._layers[g[this.currentLayer]],L=o._getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const B=L?("symbol"===R.type?M:C)[L.id]:void 0;this._renderTileClippingMasks(R,L,L?b[L.id]:void 0),this.renderLayer(this,L,R,B),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let R=null;p.values(this.style._layers).forEach(L=>{const B=o._getLayerSourceCache(L);B&&!L.isHidden(this.transform.zoom)&&(!R||R.getSource().maxzoom<B.getSource().maxzoom)&&(R=B)}),R&&this.options.showTileBoundaries&&ma.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const L=R.transform.padding;Rn(R,R.transform.height-(L.top||0),3,Pt),Rn(R,L.bottom||0,3,Uc),Rs(R,L.left||0,3,Oo),Rs(R,R.transform.width-(L.right||0),3,pa);const B=R.transform.centerPoint;var V,Z,H,W;Xi(V=R,(Z=B.x)-1,(H=R.transform.height-B.y)-10,2,20,W=fa),Xi(V,Z-10,H-1,20,2,W)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(o,u,g,v){g.isHidden(this.transform.zoom)||("background"===g.type||"sky"===g.type||"custom"===g.type||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(g.type)||ma[g.type](o,u,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let g=this.gpuTimers[o.id];g||(g=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),g.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,g.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const u={};for(const g in o){const v=o[g],b=this.context.extTimerQuery,C=b.getQueryObjectEXT(v.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(v.query),u[g]=C}return u}translatePosMatrix(o,u,g,v,b){if(!g[0]&&!g[1])return o;const C=b?"map"===v?this.transform.angle:0:"viewport"===v?-this.transform.angle:0;if(C){const R=Math.sin(C),L=Math.cos(C);g=[g[0]*L-g[1]*R,g[0]*R+g[1]*L]}const M=[b?g[0]:sn(u,g[0],this.transform.zoom),b?g[1]:sn(u,g[1],this.transform.zoom),0],k=new Float32Array(16);return p.translate(k,o,M),k}saveTileTexture(o){const u=this._tileTextures[o.size[0]];u?u.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const u=this._tileTextures[o];return u&&u.length>0?u.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const u=this.imageManager.getPattern(o.from.toString()),g=this.imageManager.getPattern(o.to.toString());return!u||!g}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,u=this.style&&this.style.fog,g=[];return this.terrain&&!this.terrain.renderingToTexture&&g.push("TERRAIN"),u&&!o&&0!==u.getOpacity(this.transform.pitch)&&g.push("FOG"),o&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}useProgram(o,u,g){this.cache=this.cache||{};const v=g||[],b=this.currentGlobalDefines().concat(v),C=la.cacheKey(o,b,u);return this.cache[C]||(this.cache[C]=new la(this.context,o,ql[o],u,td[o],b)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(o){this.terrain&&this.terrain.prepareDrawTile(o)}prepareDrawProgram(o,u,g){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const b=v.getOpacity(this.transform.pitch);0!==b&&u.setFogUniformValues(o,((C,M,k,R)=>{const L=M.properties.get("color"),B=C.frameCounter/1e3%1,V=[L.r/L.a,L.g/L.a,L.b/L.a,R];return{u_fog_matrix:k?C.transform.calculateFogTileMatrix(k):C.identityMat,u_fog_range:M.getFovAdjustedRange(C.transform._fov),u_fog_color:V,u_fog_horizon_blend:M.properties.get("horizon-blend"),u_fog_temporal_offset:B}})(this,v,g,b))}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const o=this.context.gl,u=o.createTexture();return o.bindTexture(o.TEXTURE_2D,u),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&0!==o.getOpacity(this.transform.pitch)}getBackgroundTiles(){const o=this._backgroundTiles,u=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const v of g)u[v.key]=o[v.key]||new p.Tile(v,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}}class ga{constructor(o=0,u=0,g=0,v=0){if(isNaN(o)||o<0||isNaN(u)||u<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=u,this.left=g,this.right=v}interpolate(o,u,g){return null!=u.top&&null!=o.top&&(this.top=p.number(o.top,u.top,g)),null!=u.bottom&&null!=o.bottom&&(this.bottom=p.number(o.bottom,u.bottom,g)),null!=u.left&&null!=o.left&&(this.left=p.number(o.left,u.left,g)),null!=u.right&&null!=o.right&&(this.right=p.number(o.right,u.right,g)),this}getCenter(o,u){const g=p.clamp((this.left+o-this.right)/2,0,o),v=p.clamp((this.top+u-this.bottom)/2,0,u);return new p.pointGeometry(g,v)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new ga(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Sr(m,o){const u=p.getColumn(m,3);p.fromQuat(m,o),p.setColumn(m,3,u)}function nd(m,o){p.setColumn(m,3,[o[0],o[1],o[2],1])}function rd(m,o){const u=p.identity$1([]);return p.rotateZ$1(u,u,-o),p.rotateX$1(u,u,-m),u}function $u(m,o){const u=[m[0],m[1],0],g=[o[0],o[1],0];if(p.length(u)>=1e-15){const C=p.normalize([],u);p.scale$2(g,C,p.dot(g,C)),o[0]=g[0],o[1]=g[1]}const v=p.cross([],o,m);if(p.len(v)<1e-15)return null;const b=Math.atan2(-v[1],v[0]);return rd(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),b)}class id{constructor(o,u){this.position=o,this.orientation=u}get position(){return this._position}set position(o){this._position=this._renderWorldCopies?function(u){if(!u)return;const g=Array.isArray(u)?new p.MercatorCoordinate(u[0],u[1],u[2]):u;return g.x=p.wrap(g.x,0,1),g}(o):o}lookAtPoint(o,u){if(this.orientation=null,!this.position)return;const g=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(o)):0,v=this.position,b=p.MercatorCoordinate.fromLngLat(o,g),C=[b.x-v.x,b.y-v.y,b.z-v.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=$u(C,u)}setPitchBearing(o,u){this.orientation=rd(p.degToRad(o),p.degToRad(-u))}}class od{constructor(o,u){this._transform=p.identity([]),this._orientation=p.identity$1([]),u&&(this._orientation=u,Sr(this._transform,this._orientation)),o&&nd(this._transform,o)}get mercatorPosition(){const o=this.position;return new p.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=p.getColumn(this._transform,3);return[o[0],o[1],o[2]]}set position(o){nd(this._transform,o)}get orientation(){return this._orientation}set orientation(o){this._orientation=o,Sr(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,u){this._orientation=rd(o,u),Sr(this._transform,this._orientation)}forward(){const o=p.getColumn(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=p.getColumn(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=p.getColumn(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,u){const g=new Float64Array(16);return p.invert(g,this.getWorldToCamera(o,u)),g}getWorldToCameraPosition(o,u,g){const v=this.position;p.scale$2(v,v,-o);const b=new Float64Array(16);return p.fromScaling(b,[g,g,g]),p.translate(b,b,v),b[10]*=u,b}getWorldToCamera(o,u){const g=new Float64Array(16),v=new Float64Array(4),b=this.position;return p.conjugate(v,this._orientation),p.scale$2(b,b,-o),p.fromQuat(g,v),p.translate(g,g,b),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=u,g[9]*=u,g[10]*=u,g[11]*=u,g}getCameraToClipPerspective(o,u,g,v){const b=new Float64Array(16);return p.perspective(b,o,u,g,v),b}getDistanceToElevation(o){const u=0===o?0:p.mercatorZfromAltitude(o,this.position[1]),g=this.forward();return(u-this.position[2])/g[2]}clone(){return new od([...this.position],[...this.orientation])}}function Fp(m,o){const u=Hu(m),g=function(b,C,M,k,R){const L=new p.LngLat(M.lng-180*Fo,M.lat),B=new p.LngLat(M.lng+180*Fo,M.lat),V=b.project(L.lng,L.lat),Z=b.project(B.lng,B.lat),H=-Math.atan2(Z.y-V.y,Z.x-V.x),W=p.MercatorCoordinate.fromLngLat(M);W.y=p.clamp(W.y,-.999975,.999975);const ae=W.toLngLat(),G=b.project(ae.lng,ae.lat),re=p.MercatorCoordinate.fromLngLat(ae);re.x+=Fo;const ee=re.toLngLat(),ne=b.project(ee.lng,ee.lat),ie=ad(ne.x-G.x,ne.y-G.y,H),le=p.MercatorCoordinate.fromLngLat(ae);le.y+=Fo;const _e=le.toLngLat(),xe=b.project(_e.lng,_e.lat),qe=ad(xe.x-G.x,xe.y-G.y,H),Oe=Math.abs(ie.x)/Math.abs(qe.y),Le=p.identity([]);p.rotateZ(Le,Le,-H*(1-(R?0:k)));const be=p.identity([]);return p.scale(be,be,[1,1-(1-Oe)*k,1]),be[4]=-qe.x/qe.y*k,p.rotateZ(be,be,H),p.multiply$1(be,Le,be),be}(m.projection,0,m.center,u,o),v=Gu(m);return p.scale(g,g,[v,v,1]),g}function Gu(m){const o=m.projection,u=Hu(m),g=sd(o,m.center),v=sd(o,p.LngLat.convert(o.center));return Math.pow(2,g*u+(1-u)*v)}function Hu(m){const o=m.projection.range;if(!o)return 0;const u=Math.max(m.width,m.height),g=Math.log(u/1024)/Math.LN2;return p.smoothstep(o[0]+g,o[1]+g,m.zoom)}const Fo=1/4e4;function sd(m,o){const u=p.clamp(o.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),g=new p.LngLat(o.lng-180*Fo,u),v=new p.LngLat(o.lng+180*Fo,u),b=m.project(g.lng,u),C=m.project(v.lng,u),M=p.MercatorCoordinate.fromLngLat(g),k=p.MercatorCoordinate.fromLngLat(v),R=C.x-b.x,L=C.y-b.y,B=k.x-M.x,V=k.y-M.y,Z=Math.sqrt((B*B+V*V)/(R*R+L*L));return Math.log(Z)/Math.LN2}function ad(m,o,u){const g=Math.cos(u),v=Math.sin(u);return{x:m*g-o*v,y:m*v+o*g}}class jc{constructor(o,u,g,v,b){this.tileSize=512,this._renderWorldCopies=void 0===b||b,this._minZoom=o||0,this._maxZoom=u||22,this._minPitch=null==g?0:g,this._maxPitch=null==v?60:v,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ga,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new od,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const o=new jc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.setProjection(this.getProjection()),o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o.tileSize=this.tileSize,o.setMaxBounds(this.getMaxBounds()),o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._cameraZoom=this._cameraZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,o?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(o){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),o&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(o){null==o&&(o={name:"mercator"}),this.projectionOptions=o;const u=this.projection?this.getProjection():void 0;return this.projection=p.getProjection(o),!wt(u,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(o){void 0===o?o=!0:null===o&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.pointGeometry(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const u=-o*Math.PI/180;var g,v,b,C,M,k,R,L,B,V;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(g=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g),v=this.rotationMatrix,C=this.angle,M=(b=this.rotationMatrix)[0],k=b[1],R=b[2],L=b[3],B=Math.sin(C),V=Math.cos(C),v[0]=M*V+R*B,v[1]=k*V+L*B,v[2]=M*-B+R*V,v[3]=k*-B+L*V)}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const u=p.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(o){const u=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===o?(this._cameraZoom=null,!1):(this._centerAltitude=o,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let v=0,b=0;for(let C=0;C<u.length;C++){const M=new p.pointGeometry(u[C][0]*this.width,g+u[C][1]*(this.height-g)),k=o.pointCoordinate(M);if(!k)continue;const R=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);v+=k[3]*R,b+=R}return 0===b?NaN:v/b}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const o=this._cameraZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*u,v=this._mercatorZfromZoom(o),b=this._mercatorZfromZoom(this._maxZoom),C=Math.max(v-g,b);this._setZoom(this._zoomFromMercatorZ(C))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let g;g=o.z<this._camera.position[2]?[u.x,u.y,u.z]:[o.x,o.y,o.z];const v=p.length(p.sub([],this._camera.position,g));return p.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let u=!1;if(o.orientation&&!p.exactEquals(o.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(o.orientation)),o.position){const g=[o.position.x,o.position.y,o.position.z];p.exactEquals$1(g,this._camera.position)||(this._setCameraPosition(g),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,u=new id;return u.position=new p.MercatorCoordinate(o[0],o[1],o[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(o){if(!p.length$1(o))return!1;p.normalize$1(o,o);const u=p.transformQuat([],[0,0,-1],o),g=p.transformQuat([],[0,-1,0],o);if(g[2]<0)return!1;const v=$u(u,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(o){const u=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;o[2]=p.clamp(o[2],v/g,v/u),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,u,g){this._unmodified=!1,this._edgeInsets.interpolate(o,u,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const u=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(o){const u=[new p.UnwrappedTileID(0,o)];if(this.renderWorldCopies){const g=this.pointCoordinate(new p.pointGeometry(0,0)),v=this.pointCoordinate(new p.pointGeometry(this.width,0)),b=this.pointCoordinate(new p.pointGeometry(this.width,this.height)),C=this.pointCoordinate(new p.pointGeometry(0,this.height)),M=Math.floor(Math.min(g.x,v.x,b.x,C.x)),k=Math.floor(Math.max(g.x,v.x,b.x,C.x)),R=1;for(let L=M-R;L<=k+R;L++)0!==L&&u.push(new p.UnwrappedTileID(L,o))}return u}coveringTiles(o){let u=this.coveringZoomLevel(o);const g=u,v=this.elevation&&!o.isTerrainDEM,b="mercator"===this.projection.name;if(void 0!==o.minzoom&&u<o.minzoom)return[];void 0!==o.maxzoom&&u>o.maxzoom&&(u=o.maxzoom);const C=this.locationCoordinate(this.center),M=1<<u,k=[M*C.x,M*C.y,0],R=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,"globe"!==this.projection.name),L=this.pointCoordinate(this.getCameraPoint()),B=M*p.mercatorZfromAltitude(1,this.center.lat),V=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),Z=[M*L.x,M*L.y,V],H=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),W=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?u:0,ae=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,G=o.isTerrainDEM?-ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,re=this.projection.isReprojectedInTileSpace?Gu(this):1,ee=ve=>{const ke=1/4e4,Se=new p.MercatorCoordinate(ve.x+ke,ve.y,ve.z),rt=new p.MercatorCoordinate(ve.x,ve.y+ke,ve.z),dt=ve.toLngLat(),At=Se.toLngLat(),He=rt.toLngLat(),ut=this.locationCoordinate(dt),yt=this.locationCoordinate(At),mn=this.locationCoordinate(He),Dn=Math.hypot(yt.x-ut.x,yt.y-ut.y),bt=Math.hypot(mn.x-ut.x,mn.y-ut.y);return Math.sqrt(Dn*bt)*re/ke},ne=ve=>{const ke=ae,Se=G;return{aabb:p.tileAABB(this,M,0,0,0,ve,Se,ke,this.projection),zoom:0,x:0,y:0,minZ:Se,maxZ:ke,wrap:ve,fullyVisible:!1}},ie=[];let le=[];const _e=u,xe=o.reparseOverscaled?g:u,qe=ve=>ve*ve,Oe=qe((V-this._centerAltitude)*B),Le=ve=>{if(!this._elevation||!ve.tileID||!b)return;const ke=this._elevation.getMinMaxForTile(ve.tileID),Se=ve.aabb;ke?(Se.min[2]=ke.min,Se.max[2]=ke.max,Se.center[2]=(Se.min[2]+Se.max[2])/2):(ve.shouldSplit=be(ve),ve.shouldSplit||(Se.min[2]=Se.max[2]=Se.center[2]=this._centerAltitude))},be=ve=>{if(ve.zoom<W)return!0;if(ve.zoom===_e)return!1;if(null!=ve.shouldSplit)return ve.shouldSplit;const ke=ve.aabb.distanceX(Z),Se=ve.aabb.distanceY(Z);let rt=Oe;v&&(rt=qe(ve.aabb.distanceZ(Z)*B));let dt=1;if(this.projection.isReprojectedInTileSpace&&g<=5){const He=Math.pow(2,ve.zoom),ut=ee(new p.MercatorCoordinate((ve.x+.5)/He,(ve.y+.5)/He));dt=ut>.85?1:ut}const At=ke*ke+Se*Se+rt;return At<qe((1<<_e-ve.zoom)*H*dt*((He,ut)=>{if(ut*qe(.707)<He)return 1;const yt=Math.sqrt(ut/He);return yt/(1.4144271570014144+(Math.pow(1.1,yt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(rt,Oe),At))};if(this.renderWorldCopies)for(let ve=1;ve<=3;ve++)ie.push(ne(-ve)),ie.push(ne(ve));for(ie.push(ne(0));ie.length>0;){const ve=ie.pop(),ke=ve.x,Se=ve.y;let rt=ve.fullyVisible;if(!rt){const dt=ve.aabb.intersects(R);if(0===dt)continue;rt=2===dt}if(ve.zoom!==_e&&be(ve))for(let dt=0;dt<4;dt++){const At=(ke<<1)+dt%2,He=(Se<<1)+(dt>>1),ut={aabb:b?ve.aabb.quadrant(dt):p.tileAABB(this,M,ve.zoom+1,At,He,ve.wrap,ve.minZ,ve.maxZ,this.projection),zoom:ve.zoom+1,x:At,y:He,wrap:ve.wrap,fullyVisible:rt,tileID:void 0,shouldSplit:void 0,minZ:ve.minZ,maxZ:ve.maxZ};v&&(ut.tileID=new p.OverscaledTileID(ve.zoom+1===_e?xe:ve.zoom+1,ve.wrap,ve.zoom+1,At,He),Le(ut)),ie.push(ut)}else{const dt=ve.zoom===_e?xe:ve.zoom;if(o.minzoom&&o.minzoom>dt)continue;const At=k[0]-(.5+ke+(ve.wrap<<ve.zoom))*(1<<u-ve.zoom),He=k[1]-.5-Se,ut=ve.tileID?ve.tileID:new p.OverscaledTileID(dt,ve.wrap,ve.zoom,ke,Se);le.push({tileID:ut,distanceSq:At*At+He*He})}}if(this.fogCullDistSq){const ve=this.fogCullDistSq,ke=this.horizonLineFromTop();le=le.filter(Se=>{const rt=[0,0,0,1],dt=[p.EXTENT,p.EXTENT,0,1],At=this.calculateFogTileMatrix(Se.tileID.toUnwrapped());p.transformMat4$1(rt,rt,At),p.transformMat4$1(dt,dt,At);const He=p.getAABBPointSquareDist(rt,dt);if(0===He)return!0;let ut=!1;const yt=this._elevation;if(yt&&He>ve&&0!==ke){const mn=this.calculateProjMatrix(Se.tileID.toUnwrapped());let Dn;o.isTerrainDEM||(Dn=yt.getMinMaxForTile(Se.tileID)),Dn||(Dn={min:G,max:ae});const bt=p.furthestTileCorner(this.rotation),Bt=[bt[0]*p.EXTENT,bt[1]*p.EXTENT,Dn.max];p.transformMat4(Bt,Bt,mn),ut=(1-Bt[1])*this.height*.5<ke}return He<ve||ut})}return le.sort((ve,ke)=>ve.distanceSq-ke.distanceSq).map(ve=>ve.tileID)}resize(o,u){this.width=o,this.height=u,this.pixelsToGLUnits=[2/o,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const u=p.clamp(o.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),g=this.projection.project(o.lng,u);return new p.pointGeometry(g.x*this.worldSize,g.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(o,u){const g=this.pointCoordinate(u),v=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(o);this.setLocation(new p.MercatorCoordinate(b.x-(g.x-v.x),b.y-(g.y-v.y)))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this._coordinatePoint(this.locationCoordinate(o),!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,u){const g=u?p.mercatorZfromAltitude(u,o.lat):void 0,v=this.projection.project(o.lng,o.lat);return new p.MercatorCoordinate(v.x,v.y,g)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,u){const g=null!=u?u:this._centerAltitude,v=[o.x,o.y,0,1],b=[o.x,o.y,1,1];p.transformMat4$1(v,v,this.pixelMatrixInverse),p.transformMat4$1(b,b,this.pixelMatrixInverse);const C=b[3];p.scale$1(v,v,1/v[3]),p.scale$1(b,b,1/C);const M=v[2],k=b[2];return{p0:v,p1:b,t:M===k?0:(g-M)/(k-M)}}screenPointToMercatorRay(o){const u=[o.x,o.y,0,1],g=[o.x,o.y,1,1];return p.transformMat4$1(u,u,this.pixelMatrixInverse),p.transformMat4$1(g,g,this.pixelMatrixInverse),p.scale$1(u,u,1/u[3]),p.scale$1(g,g,1/g[3]),u[2]=p.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,g[2]=p.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,p.scale$1(u,u,1/this.worldSize),p.scale$1(g,g,1/this.worldSize),new p.Ray([u[0],u[1],u[2]],p.normalize([],p.sub([],g,u)))}rayIntersectionCoordinate(o){const{p0:u,p1:g,t:v}=o,b=p.mercatorZfromAltitude(u[2],this._center.lat),C=p.mercatorZfromAltitude(g[2],this._center.lat);return new p.MercatorCoordinate(p.number(u[0],g[0],v)/this.worldSize,p.number(u[1],g[1],v)/this.worldSize,p.number(b,C,v))}pointCoordinate(o,u=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(o.x,o.y,u)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);const u=this.elevation;let g=this.elevation.pointCoordinate(o);if(g)return new p.MercatorCoordinate(g[0],g[1],g[2]);let v=0,b=this.horizonLineFromTop();if(o.y>b)return this.pointCoordinate(o);const C=.02*b,M=o.clone();for(let k=0;k<10&&b-v>C;k++){M.y=p.number(v,b,.66);const R=u.pointCoordinate(M);R?(b=M.y,g=R):v=M.y}return g?new p.MercatorCoordinate(g[0],g[1],g[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){if(this.elevation)return!this.elevation.pointCoordinate(o);{const u=this.horizonLineFromTop();return o.y<u}}_coordinatePoint(o,u){const g=u&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,v=[o.x*this.worldSize,o.y*this.worldSize,g+o.toAltitude(),1];return p.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new p.pointGeometry(v[0]/v[3],v[1]/v[3]):new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(o,u){const g=new p.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),v=new p.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),b=new p.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),C=new p.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let M=this.pointCoordinate(g,o),k=this.pointCoordinate(v,o);const R=this.pointCoordinate(b,u),L=this.pointCoordinate(C,u),B=(V,Z)=>(Z.y-V.y)/(Z.x-V.x);return M.y>1&&k.y>=0?M=new p.MercatorCoordinate((1-L.y)/B(L,M)+L.x,1):M.y<0&&k.y<=1&&(M=new p.MercatorCoordinate(-L.y/B(L,M)+L.x,0)),k.y>1&&M.y>=0?k=new p.MercatorCoordinate((1-R.y)/B(R,k)+R.x,1):k.y<0&&M.y<=1&&(k=new p.MercatorCoordinate(-R.y/B(R,k)+R.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(L)).extend(this.coordinateLocation(R))}_getBounds3D(){const o=this.elevation;if(!o.visibleDemTiles.length)return this._getBounds(0,0);const u=o.visibleDemTiles.reduce((g,v)=>{if(v.dem){const b=v.dem.tree;g.min=Math.min(g.min,b.minimums[0]),g.max=Math.max(g.max,b.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBounds(u.min*o.exaggeration(),u.max*o.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(o=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,g=this.height/2-u*(1-this._horizonShift);return o?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,u){return this.projection.createTileTransform(this,u).createTileMatrix(o)}calculateDistanceTileData(o){const u=o.key,g=this._distanceTileDataCache;if(g[u])return g[u];const v=o.canonical,b=1/this.height,C=this.cameraWorldSize/this.zoomScale(v.z),M=(v.x+Math.pow(2,v.z)*o.wrap)*C,k=v.y*C,R=this.point,L=this.angle,B=Math.sin(-L),V=-Math.cos(-L);return g[u]={bearing:[B,V],center:[(R.x-M)*b,(R.y-k)*b],scale:C/p.EXTENT*b},g[u]}calculateFogTileMatrix(o){const u=o.key,g=this._fogTileMatrixCache;if(g[u])return g[u];const v=this.calculatePosMatrix(o,this.cameraWorldSize);return p.multiply$1(v,this.worldToFogMatrix,v),g[u]=new Float32Array(v),g[u]}calculateProjMatrix(o,u=!1){const g=o.key,v=u?this._alignedProjMatrixCache:this._projMatrixCache;if(v[g])return v[g];const b=this.calculatePosMatrix(o,this.worldSize);return p.multiply$1(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.alignedProjMatrix:this.projMatrix,b),v[g]=new Float32Array(b),v[g]}calculatePixelsToTileUnitsMatrix(o){const u=o.tileID.key,g=this._pixelsToTileUnitsCache;if(g[u])return g[u];const v=function(b,C){const{scale:M}=b.tileTransform,k=M*p.EXTENT/(b.tileSize*Math.pow(2,C.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return R=new Float32Array(4),V=(L=C.inverseAdjustmentMatrix)[1],Z=L[2],H=L[3],ae=(B=[k,k])[1],R[0]=L[0]*(W=B[0]),R[1]=V*W,R[2]=Z*ae,R[3]=H*ae,R;var R,L,B,V,Z,H,W,ae}(o,this);return g[u]=v,g[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const u=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),v=this._camera.forward(),b=p.mercatorZfromAltitude(1,this._center.lat);g[2]/=b,v[2]/=b,p.normalize(v,v);const C=o.raycast(g,v,o.exaggeration());if(C){const M=p.scaleAndAdd([],g,v,C),k=new p.MercatorCoordinate(M[0],M[1],p.mercatorZfromAltitude(M[2],p.latFromMercatorY(M[1]))),R=(k.z+p.length([k.x-g[0],k.y-g[1],k.z-g[2]*b]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(R),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const u=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),v=o.getAtPointOrZero(new p.MercatorCoordinate(...g)),b=this._minimumHeightOverTerrain()*Math.cos(p.degToRad(this._maxPitch)),C=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*v;if(C<b){const M=this.locationCoordinate(this._center,this._centerAltitude),k=[M.x-g[0],M.y-g[1],M.z-g[2]],R=p.length(k);k[2]-=(b-C)/this._projectionScaler;const L=p.length(k);if(0===L)return;p.scale$2(k,k,R/L*this._projectionScaler),this._camera.position=[M.x-k[0],M.y-k[1],M.z*this._projectionScaler-k[2]],this._camera.orientation=$u(k,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const B=this.center;return B.lat=p.clamp(B.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(B.lng=p.clamp(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const o=this._unmodified,{x:u,y:g}=this.point;let v=0,b=u,C=g;const M=this.width/2,k=this.height/2,R=this.worldMinY*this.scale,L=this.worldMaxY*this.scale;if(g-k<R&&(C=R+k),g+k>L&&(C=L-k),L-R<this.height&&(v=Math.max(v,this.height/(L-R)),C=(L+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,V=this.worldMaxX*this.scale,Z=this.worldSize/2-(B+V)/2;b=(u+Z+this.worldSize)%this.worldSize-Z,b-M<B&&(b=B+M),b+M>V&&(b=V-M),V-B<this.width&&(v=Math.max(v,this.width/(V-B)),b=(V+B)/2)}b===u&&C===g||(this.center=this.unproject(new p.pointGeometry(b,C))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCameraAltitude(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this._fov/2,u=this.centerOffset,g=this.pixelsPerMeter;this._projectionScaler=g/(p.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(o)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?g:1),b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);b[8]=2*-u.x/this.width,b[9]=2*u.y/this.height;let C=p.mul([],b,v);if(this.projection.isReprojectedInTileSpace){const ne=this.locationCoordinate(this.center),ie=p.identity([]);p.translate(ie,ie,[ne.x*this.worldSize,ne.y*this.worldSize,0]),p.multiply$1(ie,ie,Fp(this)),p.translate(ie,ie,[-ne.x*this.worldSize,-ne.y*this.worldSize,0]),p.multiply$1(C,C,ie),this.inverseAdjustmentMatrix=function(le){const _e=Fp(le,!0);return Je([],[_e[0],_e[1],_e[4],_e[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],C,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=C,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const M=new Float32Array(16);p.identity(M),p.scale(M,M,[1,-1,1]),p.rotateX(M,M,this._pitch),p.rotateZ(M,M,this.angle);const k=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),R=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-u.x/this.width,k[9]=2*(u.y+R)/this.height,this.skyboxMatrix=p.multiply$1(M,k,M);const L=this.point,B=L.x,V=L.y,Z=this.width%2/2,H=this.height%2/2,W=Math.cos(this.angle),ae=Math.sin(this.angle),G=B-Math.round(B)+W*Z+ae*H,re=V-Math.round(V)+W*H+ae*Z,ee=new Float64Array(C);if(p.translate(ee,ee,[G>.5?G-1:G,re>.5?re-1:re,0]),this.alignedProjMatrix=ee,C=p.create(),p.scale(C,C,[this.width/2,-this.height/2,1]),p.translate(C,C,[1,-1,0]),this.labelPlaneMatrix=C,C=p.create(),p.scale(C,C,[1,-1,1]),p.translate(C,C,[-1,-1,0]),p.scale(C,C,[2/this.width,2/this.height,1]),this.glCoordMatrix=C,this.pixelMatrix=p.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},C=p.invert(new Float64Array(16),this.pixelMatrix),!C)throw new Error("failed to invert matrix");this.pixelMatrixInverse=C,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSize,u=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height,b=[o,o,u];p.scale$2(b,b,v),p.scale$2(g,g,-1),p.multiply$2(g,g,b);const C=p.create();p.translate(C,C,g),p.scale(C,C,b),this.mercatorFogMatrix=C,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,u,v)}_computeCameraPosition(o){const u=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,b=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*u-o/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*b,v.y/this.worldSize-g[1]*b,o/this.worldSize*this._centerAltitude-g[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=o[2];let v=1;g>0&&(v=Math.min((u-this._camera.position[2])/g,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,o,v),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,u=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),b=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,C=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),M=Math.max((o[2]-b)/Math.cos(g),C),k=this._zoomFromMercatorZ(M);p.scaleAndAdd(o,o,u,M),this._pitch=p.clamp(g,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(v,-Math.PI,Math.PI),this._setZoom(p.clamp(k,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new p.MercatorCoordinate(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(o,u){const g=Math.min(o.x,u.x),v=Math.max(o.x,u.x),b=Math.min(o.y,u.y),C=Math.max(o.y,u.y);if(b<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const M=[new p.pointGeometry(g,b),new p.pointGeometry(v,C),new p.pointGeometry(g,C),new p.pointGeometry(v,b)],k=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const L of M){const B=this.pointRayIntersection(L);if(B.t<0)return!0;const V=this.rayIntersectionCoordinate(B);if(V.x<k||V.y<0||V.x>R||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.pointGeometry(0,0),new p.pointGeometry(this.width,this.height))}zoomDeltaToMovement(o,u){const g=p.length(p.sub([],this._camera.position,o)),v=this._zoomFromMercatorZ(g)+u;return g-this._mercatorZfromZoom(v)}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.pointGeometry(0,o))}}function _a(m,o){let u=!1,g=null;const v=()=>{g=null,u&&(m(),g=setTimeout(v,o),u=!1)};return()=>(u=!0,g||v(),g)}class zp{constructor(o){this._hashName=o&&encodeURIComponent(o),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=_a(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,p.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return p.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const u=this._map.getCenter(),g=Math.round(100*this._map.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,v),C=Math.round(u.lng*b)/b,M=Math.round(u.lat*b)/b,k=this._map.getBearing(),R=this._map.getPitch();let L="";if(L+=o?`/${C}/${M}/${g}`:`${g}/${M}/${C}`,(k||R)&&(L+="/"+Math.round(10*k)/10),R&&(L+=`/${Math.round(R)}`),this._hashName){const B=this._hashName;let V=!1;const Z=p.window.location.hash.slice(1).split("&").map(H=>{const W=H.split("=")[0];return W===B?(V=!0,`${W}=${L}`):H}).filter(H=>H);return V||Z.push(`${B}=${L}`),`#${Z.join("&")}`}return`#${L}`}_getCurrentHash(){const o=p.window.location.hash.replace("#","");if(this._hashName){let u;return o.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(u=g)}),(u&&u[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._getCurrentHash();if(o.length>=3&&!o.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,o)}}const Ls={linearity:.3,easing:p.bezier(0,0,.3,1)},Wl=p.extend({deceleration:2500,maxSpeed:1400},Ls),Bp=p.extend({deceleration:20,maxSpeed:1400},Ls),ld=p.extend({deceleration:1e3,maxSpeed:360},Ls),rn=p.extend({deceleration:1e3,maxSpeed:90},Ls);class Ya{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,u=p.exported.now();for(;o.length>0&&u-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new p.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)u.zoom+=b.zoomDelta||0,u.bearing+=b.bearingDelta||0,u.pitch+=b.pitchDelta||0,b.panDelta&&u.pan._add(b.panDelta),b.around&&(u.around=b.around),b.pinchAround&&(u.pinchAround=b.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(u.pan.mag()){const b=Vc(u.pan.mag(),g,p.extend({},Wl,o||{}));v.offset=u.pan.mult(b.amount/u.pan.mag()),v.center=this._map.transform.center,qu(v,b)}if(u.zoom){const b=Vc(u.zoom,g,Bp);v.zoom=this._map.transform.zoom+b.amount,qu(v,b)}if(u.bearing){const b=Vc(u.bearing,g,ld);v.bearing=this._map.transform.bearing+p.clamp(b.amount,-179,179),qu(v,b)}if(u.pitch){const b=Vc(u.pitch,g,rn);v.pitch=this._map.transform.pitch+b.amount,qu(v,b)}if(v.zoom||v.bearing){const b=void 0===u.pinchAround?u.around:u.pinchAround;v.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),p.extend(v,{noMoveStart:!0})}}function qu(m,o){(!m.duration||m.duration<o.duration)&&(m.duration=o.duration,m.easing=o.easing)}function Vc(m,o,u){const{maxSpeed:g,linearity:v,deceleration:b}=u,C=p.clamp(m*v/(o/1e3),-g,g),M=Math.abs(C)/(b*v);return{easing:u.easing,duration:1e3*M,amount:C*(M/2)}}class $r extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,g,v={}){const b=Pe.mousePos(u.getCanvasContainer(),g),C=u.unproject(b);super(o,p.extend({point:b,lngLat:C,originalEvent:g},v)),this._defaultPrevented=!1,this.target=u}}class zo extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,g){const v="touchend"===o?g.changedTouches:g.touches,b=Pe.touchPos(u.getCanvasContainer(),v),C=b.map(k=>u.unproject(k)),M=b.reduce((k,R,L,B)=>k.add(R.div(B.length)),new p.pointGeometry(0,0));super(o,{points:b,point:M,lngLats:C,lngLat:u.unproject(M),originalEvent:g}),this._defaultPrevented=!1}}class Np extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,g){super(o,{originalEvent:g}),this._defaultPrevented=!1}}class Os{constructor(o,u){this._map=o,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new Np(o.type,this._map,o))}mousedown(o,u){return this._mousedownPos=u,this._firePreventable(new $r(o.type,this._map,o))}mouseup(o){this._map.fire(new $r(o.type,this._map,o))}preclick(o){const u=p.extend({},o);u.type="preclick",this._map.fire(new $r(u.type,this._map,u))}click(o,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(o),this._map.fire(new $r(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new $r(o.type,this._map,o))}mouseover(o){this._map.fire(new $r(o.type,this._map,o))}mouseout(o){this._map.fire(new $r(o.type,this._map,o))}touchstart(o){return this._firePreventable(new zo(o.type,this._map,o))}touchmove(o){this._map.fire(new zo(o.type,this._map,o))}touchend(o){this._map.fire(new zo(o.type,this._map,o))}touchcancel(o){this._map.fire(new zo(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cd{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(o){this._map.fire(new $r(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $r("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new $r(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zu{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,u){this.isEnabled()&&o.shiftKey&&0===o.button&&(Pe.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(o,u){if(!this._active)return;const g=u;if(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=g,this._box||(this._box=Pe.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const b=Math.min(v.x,g.x),C=Math.max(v.x,g.x),M=Math.min(v.y,g.y),k=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${M}px)`,this._box.style.width=C-b+"px",this._box.style.height=k-M+"px")})}mouseupWindow(o,u){if(!this._active||0!==o.button)return;const g=this._startPos,v=u;if(this.reset(),Pe.suppressClick(),g.x!==v.x||g.y!==v.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:b=>b.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&27===o.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Pe.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,u){return this._map.fire(new p.Event(o,{originalEvent:u}))}}function Ja(m,o){const u={};for(let g=0;g<m.length;g++)u[m[g].identifier]=o[g];return u}class Qa{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,u,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=o.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){const b=new p.pointGeometry(0,0);for(const C of v)b._add(C);return b.div(v.length)}(u),this.touches=Ja(g,u)))}touchmove(o,u,g){if(this.aborted||!this.centroid)return;const v=Ja(g,u);for(const b in this.touches){const C=this.touches[b],M=v[b];(!M||M.dist(C)>30)&&(this.aborted=!0)}}touchend(o,u,g){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),0===g.length){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class el{constructor(o){this.singleTap=new Qa(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,u,g){this.singleTap.touchstart(o,u,g)}touchmove(o,u,g){this.singleTap.touchmove(o,u,g)}touchend(o,u,g){const v=this.singleTap.touchend(o,u,g);if(v){const b=o.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(v)<30;if(b&&C||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Wu{constructor(){this._zoomIn=new el({numTouches:1,numTaps:2}),this._zoomOut=new el({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,u,g){this._zoomIn.touchstart(o,u,g),this._zoomOut.touchstart(o,u,g)}touchmove(o,u,g){this._zoomIn.touchmove(o,u,g),this._zoomOut.touchmove(o,u,g)}touchend(o,u,g){const v=this._zoomIn.touchend(o,u,g),b=this._zoomOut.touchend(o,u,g);return v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(v)},{originalEvent:o})}):b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(b)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const $c={0:1,2:2};class tl{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(o,u){return!1}_move(o,u){return{}}mousedown(o,u){if(this._lastPoint)return;const g=Pe.mouseButton(o);this._correctButton(o,g)&&(this._lastPoint=u,this._eventButton=g)}mousemoveWindow(o,u){const g=this._lastPoint;if(g)if(o.preventDefault(),function(v,b){const C=$c[b];return void 0===v.buttons||(v.buttons&C)!==C}(o,this._eventButton))this.reset();else if(this._moved||!(u.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(g,u)}mouseupWindow(o){this._lastPoint&&Pe.mouseButton(o)===this._eventButton&&(this._moved&&Pe.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ti extends tl{mousedown(o,u){super.mousedown(o,u),this._lastPoint&&(this._active=!0)}_correctButton(o,u){return 0===u&&!o.ctrlKey}_move(o,u){return{around:u,panDelta:u.sub(o)}}}class vi extends tl{_correctButton(o,u){return 0===u&&o.ctrlKey||2===u}_move(o,u){const g=.8*(u.x-o.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(o){o.preventDefault()}}class Xu extends tl{_correctButton(o,u){return 0===u&&o.ctrlKey||2===u}_move(o,u){const g=-.5*(u.y-o.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(o){o.preventDefault()}}class Gc{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.pointGeometry(0,0)}touchstart(o,u,g){return this._calculateTransform(o,u,g)}touchmove(o,u,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===g.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.preventDefault(),this._calculateTransform(o,u,g)}}touchend(o,u,g){this._calculateTransform(o,u,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,u,g){g.length>0&&(this._active=!0);const v=Ja(g,u),b=new p.pointGeometry(0,0),C=new p.pointGeometry(0,0);let M=0;for(const R in v){const L=v[R],B=this._touches[R];B&&(b._add(L),C._add(L.sub(B)),M++,v[R]=L)}if(this._touches=v,M<this._minTouches||!C.mag())return;const k=C.div(M);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(M),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Pe.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Hc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(o){}_move(o,u,g){return{}}touchstart(o,u,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([u[0],u[1]]))}touchmove(o,u,g){if(!this._firstTwoTouches)return;o.preventDefault();const[v,b]=this._firstTwoTouches,C=ns(g,u,v),M=ns(g,u,b);if(!C||!M)return;const k=this._aroundCenter?null:C.add(M).div(2);return this._move([C,M],k,o)}touchend(o,u,g){if(!this._firstTwoTouches)return;const[v,b]=this._firstTwoTouches,C=ns(g,u,v),M=ns(g,u,b);C&&M||(this._active&&Pe.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ns(m,o,u){for(let g=0;g<m.length;g++)if(m[g].identifier===u)return o[g]}function Xl(m,o){return Math.log(m/o)/Math.LN2}class qc extends Hc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,u){const g=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Xl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xl(this._distance,g),pinchAround:u}}}function nl(m,o){return 180*m.angleWith(o)/Math.PI}class Ku extends Hc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,u){const g=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:nl(this._vector,g),pinchAround:u}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const u=25/(Math.PI*this._minDiameter)*360,g=nl(o,this._startVector);return Math.abs(g)<u}}function Un(m){return Math.abs(m.y)>Math.abs(m.x)}class Yu extends Hc{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(o){this._lastPoints=o,Un(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,u,g){const v=o[0].sub(this._lastPoints[0]),b=o[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&g.touches.length<3)&&(this._valid=this.gestureBeginsVertically(v,b,g.timeStamp),this._valid))return this._lastPoints=o,this._active=!0,{pitchDelta:(v.y+b.y)/2*-.5}}gestureBeginsVertically(o,u,g){if(void 0!==this._valid)return this._valid;const v=o.mag()>=2,b=u.mag()>=2;if(!v&&!b)return;if(!v||!b)return void 0===this._firstMove&&(this._firstMove=g),g-this._firstMove<100&&void 0;const C=o.y>0==u.y>0;return Un(o)&&Un(u)&&C}}const rl={panStep:100,bearingStep:15,pitchStep:10};class hr{constructor(){const o=rl;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let u=0,g=0,v=0,b=0,C=0;switch(o.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:o.shiftKey?g=-1:(o.preventDefault(),b=-1);break;case 39:o.shiftKey?g=1:(o.preventDefault(),b=1);break;case 38:o.shiftKey?v=1:(o.preventDefault(),C=-1);break;case 40:o.shiftKey?v=-1:(o.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:M=>{const k=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:Up,zoom:u?Math.round(k)+u*(o.shiftKey?2:1):k,bearing:M.getBearing()+g*this._bearingStep,pitch:M.getPitch()+v*this._pitchStep,offset:[-b*this._panStep,-C*this._panStep],center:M.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Up(m){return m*(2-m)}const ud=4.000244140625;class ya{constructor(o,u){this._map=o,this._el=o.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=o.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const g=p.exported.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,0!==u&&u%ud==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(v*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),o.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=o,this._delta-=u,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=Pe.mousePos(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform,u=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(0!==this._delta){const k="wheel"===this._type&&Math.abs(this._delta)>ud?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&0!==R&&(R=1/R);const L=u(),B=Math.pow(2,L),V="number"==typeof this._targetZoom?o.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(V*R))),"wheel"===this._type&&(this._startZoom=u(),this._easing=this._smoothOutEasing(200)),this._delta=0}const g="number"==typeof this._targetZoom?this._targetZoom:u(),v=this._startZoom,b=this._easing;let C,M=!1;if("wheel"===this._type&&v&&b){const k=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),R=b(k);C=p.number(v,g,R),k<1?this._frameId||(this._frameId=!0):M=!0}else C=g,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:C-u(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let u=p.ease;if(this._prevEase){const g=this._prevEase,v=(p.exported.now()-g.start)/g.duration,b=g.easing(v+.01)-g.easing(v),C=.27/Math.sqrt(b*b+1e-4)*.01,M=Math.sqrt(.0729-C*C);u=p.bezier(C,M,.25,1)}return this._prevEase={start:p.exported.now(),duration:o,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Pe.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!p.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class xi{constructor(o,u){this._clickZoom=o,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,u){return o.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(o.shiftKey?-1:1),around:g.unproject(u)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zc{constructor(){this._tap=new el({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(o,u,g){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=u[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(o,u,g))}touchmove(o,u,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const v=u[0],b=v.y-this._swipePoint.y;return this._swipePoint=v,o.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(o,u,g)}touchend(o,u,g){this._tapTime?this._swipePoint&&0===g.length&&this.reset():this._tap.touchend(o,u,g)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rs{constructor(o,u,g){this._el=o,this._mousePan=u,this._touchPan=g}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ni{constructor(o,u,g){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=u,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ju{constructor(o,u,g,v){this._el=o,this._touchZoom=u,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const va=m=>m.zoom||m.drag||m.pitch||m.rotate;class dd extends p.Event{}class is{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,u){const g=p.sub([],u,o);this.radius=p.length(g[2]<0?p.div([],g,this.constants):[g[0],g[1],0])}projectRay(o){p.div(o,o,this.constants),p.normalize(o,o),p.mul$1(o,o,this.constants);const u=p.scale$2([],o,this.radius);if(u[2]>0){const g=p.scale$2([],[0,0,1],p.dot(u,[0,0,1])),v=p.scale$2([],p.normalize([],[u[0],u[1],0]),this.radius),b=p.add([],u,p.scale$2([],p.sub([],p.add([],v,g),u),2));u[0]=b[0],u[1]=b[1]}return u}}function il(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Fs{constructor(o,u){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ya(o),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new is,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),p.bindAll(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[v,b,C]of this._listeners)v.addEventListener(b,v===p.window.document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[o,u,g]of this._listeners)o.removeEventListener(u,o===p.window.document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(o){const u=this._map,g=u.getCanvasContainer();this._add("mapEvent",new Os(u,o));const v=u.boxZoom=new Zu(u,o);this._add("boxZoom",v);const b=new Wu,C=new hd;u.doubleClickZoom=new xi(C,b),this._add("tapZoom",b),this._add("clickZoom",C);const M=new Zc;this._add("tapDragZoom",M);const k=u.touchPitch=new Yu(u);this._add("touchPitch",k);const R=new vi(o),L=new Xu(o);u.dragRotate=new ni(o,R,L),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const B=new ti(o),V=new Gc(u,o);u.dragPan=new rs(g,B,V),this._add("mousePan",B),this._add("touchPan",V,["touchZoom","touchRotate"]);const Z=new Ku,H=new qc;u.touchZoomRotate=new Ju(g,H,Z,M),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),this._add("blockableMapEvent",new cd(u));const W=u.scrollZoom=new ya(u,this);this._add("scrollZoom",W,["mousePan"]);const ae=u.keyboard=new hr;this._add("keyboard",ae);for(const G of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[G]&&u[G].enable(o[G])}_add(o,u,g){this._handlers.push({handlerName:o,handler:u,allowed:g}),this._handlersById[o]=u}stop(o){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(va(this._eventsInProgress))||this.isZooming()}_blockedByActive(o,u,g){for(const v in o)if(v!==g&&(!u||u.indexOf(v)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const u=[];for(const g of o)this._el.contains(g.target)&&u.push(g);return u}handleEvent(o,u){this._updatingCamera=!0;const g="renderFrame"===o.type,v=g?void 0:o,b={needsRenderFrame:!1},C={},M={},k=o.touches?this._getMapTouches(o.touches):void 0,R=k?Pe.touchPos(this._el,k):g?void 0:Pe.mousePos(this._el,o);for(const{handlerName:V,handler:Z,allowed:H}of this._handlers){if(!Z.isEnabled())continue;let W;this._blockedByActive(M,H,V)?Z.reset():Z[u||o.type]&&(W=Z[u||o.type](o,R,k),this.mergeHandlerResult(b,C,W,V,v),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||Z.isActive())&&(M[V]=Z)}const L={};for(const V in this._previousActiveHandlers)M[V]||(L[V]=v);this._previousActiveHandlers=M,(Object.keys(L).length||il(b))&&(this._changes.push([b,C,L]),this._triggerRenderFrame()),(Object.keys(M).length||il(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=b;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(o,u,g,v,b){if(!g)return;p.extend(o,g);const C={handlerName:v,originalEvent:g.originalEvent||b};void 0!==g.zoomDelta&&(u.zoom=C),void 0!==g.panDelta&&(u.drag=C),void 0!==g.pitchDelta&&(u.pitch=C),void 0!==g.bearingDelta&&(u.rotate=C)}_applyChanges(){const o={},u={},g={};for(const[v,b,C]of this._changes)v.panDelta&&(o.panDelta=(o.panDelta||new p.pointGeometry(0,0))._add(v.panDelta)),v.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+v.pitchDelta),void 0!==v.around&&(o.around=v.around),void 0!==v.aroundCoord&&(o.aroundCoord=v.aroundCoord),void 0!==v.pinchAround&&(o.pinchAround=v.pinchAround),v.noInertia&&(o.noInertia=v.noInertia),p.extend(u,b),p.extend(g,C);this._updateMapTransform(o,u,g),this._changes=[]}_updateMapTransform(o,u,g){const v=this._map,b=v.transform,C=re=>[re.x,re.y,re.z];if((re=>{const ee=this._eventsInProgress.drag;return ee&&!this._handlersById[ee.handlerName].isActive()})()&&!il(o)){const re=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",re!==b.zoom&&this._map._update(!0)}if(!il(o))return this._fireEvents(u,g,!0);let{panDelta:M,zoomDelta:k,bearingDelta:R,pitchDelta:L,around:B,aroundCoord:V,pinchAround:Z}=o;void 0!==Z&&(B=Z),(re=>u.drag&&!this._eventsInProgress.drag)()&&B&&(this._dragOrigin=C(b.pointCoordinate3D(B)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",v._stop(!0),B=B||v.transform.centerPoint,R&&(b.bearing+=R),L&&(b.pitch+=L),b._updateCameraState();const H=[0,0,0];if(M){const re=b.pointCoordinate(B),ee=b.pointCoordinate(B.sub(M));re&&ee&&(H[0]=ee.x-re.x,H[1]=ee.y-re.y)}const W=b.zoom,ae=[0,0,0];if(k){const re=C(V||b.pointCoordinate3D(B)),ee={dir:p.normalize([],p.sub([],re,b._camera.position))};if(ee.dir[2]<0){const ne=b.zoomDeltaToMovement(re,k);p.scale$2(ae,ee.dir,ne)}}const G=p.add(H,H,ae);b._translateCameraConstrained(G),k&&Math.abs(b.zoom-W)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(u,g,!0)}_fireEvents(o,u,g){const v=va(this._eventsInProgress),b=va(o),C={};for(const L in o){const{originalEvent:B}=o[L];this._eventsInProgress[L]||(C[`${L}start`]=B),this._eventsInProgress[L]=o[L]}!v&&b&&this._fireEvent("movestart",b.originalEvent);for(const L in C)this._fireEvent(L,C[L]);b&&this._fireEvent("move",b.originalEvent);for(const L in o){const{originalEvent:B}=o[L];this._fireEvent(L,B)}const M={};let k;for(const L in this._eventsInProgress){const{handlerName:B,originalEvent:V}=this._eventsInProgress[L];this._handlersById[B].isActive()||(delete this._eventsInProgress[L],k=u[B]||V,M[`${L}end`]=k)}for(const L in M)this._fireEvent(L,M[L]);const R=va(this._eventsInProgress);if(g&&(v||b)&&!R){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=V=>0!==V&&-this._bearingSnap<V&&V<this._bearingSnap;L?(B(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:k})):(this._map.fire(new p.Event("moveend",{originalEvent:k})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,u){this._map.fire(new p.Event(o,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new dd("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Ct="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class jp extends p.Evented{constructor(o,u){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=u.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,u){return this.jumpTo({center:o},u)}panBy(o,u,g){return o=p.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,p.extend({offset:o},u),g)}panTo(o,u,g){return this.easeTo(p.extend({center:o},u),g)}getZoom(){return this.transform.zoom}setZoom(o,u){return this.jumpTo({zoom:o},u),this}zoomTo(o,u,g){return this.easeTo(p.extend({zoom:o},u),g)}zoomIn(o,u){return this.zoomTo(this.getZoom()+1,o,u),this}zoomOut(o,u){return this.zoomTo(this.getZoom()-1,o,u),this}getBearing(){return this.transform.bearing}setBearing(o,u){return this.jumpTo({bearing:o},u),this}getPadding(){return this.transform.padding}setPadding(o,u){return this.jumpTo({padding:o},u),this}rotateTo(o,u,g){return this.easeTo(p.extend({bearing:o},u),g)}resetNorth(o,u){return this.rotateTo(0,p.extend({duration:1e3},o),u),this}resetNorthPitch(o,u){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},o),u),this}snapToNorth(o,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,u):this}getPitch(){return this.transform.pitch}setPitch(o,u){return this.jumpTo({pitch:o},u),this}cameraForBounds(o,u){o=p.LngLatBounds.convert(o);const g=u&&u.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),g,u)}_extendCameraOptions(o){const u={top:0,bottom:0,right:0,left:0};if("number"==typeof(o=p.extend({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding){const g=o.padding;o.padding={top:g,bottom:g,right:g,left:g}}return o.padding=p.extend(u,o.padding),o}_cameraForBoxAndBearing(o,u,g,v){const b=this._extendCameraOptions(v),C=this.transform,M=C.padding,k=C.project(p.LngLat.convert(o)),R=C.project(p.LngLat.convert(u)),L=k.rotate(-p.degToRad(g)),B=R.rotate(-p.degToRad(g)),V=new p.pointGeometry(Math.max(L.x,B.x),Math.max(L.y,B.y)),Z=new p.pointGeometry(Math.min(L.x,B.x),Math.min(L.y,B.y)),H=V.sub(Z),W=(C.width-(M.left+M.right+b.padding.left+b.padding.right))/H.x,ae=(C.height-(M.top+M.bottom+b.padding.top+b.padding.bottom))/H.y;if(ae<0||W<0)return void p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const G=Math.min(C.scaleZoom(C.scale*Math.min(W,ae)),b.maxZoom),re="number"==typeof b.offset.x?new p.pointGeometry(b.offset.x,b.offset.y):p.pointGeometry.convert(b.offset),ee=new p.pointGeometry((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(g*Math.PI/180),ne=re.add(ee).mult(C.scale/C.zoomScale(G));return{center:C.unproject(k.add(R).div(2).sub(ne)),zoom:G,bearing:g}}_cameraForBox(o,u,g,v,b){const C=this._extendCameraOptions(b);g=g||0,v=v||0,o=p.LngLat.convert(o),u=p.LngLat.convert(u);const M=this.transform.clone();M.padding=C.padding;const k=this.getFreeCameraOptions(),R=new p.LngLat(.5*(o.lng+u.lng),.5*(o.lat+u.lat)),L=.5*(g+v);if(M._camera.position[2]<p.mercatorZfromAltitude(L,R.lat))return void p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");k.lookAtPoint(R),M.setFreeCameraOptions(k);const B=p.MercatorCoordinate.fromLngLat(o),V=p.MercatorCoordinate.fromLngLat(u),Z=M.pointRayIntersection(M.centerPoint,L),H=[(W=M.rayIntersectionCoordinate(Z)).x,W.y,W.z];var W;const ae=M.screenPointToMercatorRay(M.centerPoint),G="globe"!==M.projection.name;let re,ee=0;do{const ne=Math.floor(M.zoom),ie=1<<ne,le=Math.min(ie*B.x,ie*V.x),_e=Math.min(ie*B.y,ie*V.y),xe=Math.max(ie*B.x,ie*V.x),qe=Math.max(ie*B.y,ie*V.y),Oe=new p.Aabb([le,_e,g],[xe,qe,v]),Le=p.Frustum.fromInvProjectionMatrix(M.invProjMatrix,M.worldSize,ne,G);if(2!==Oe.intersects(Le)){re&&(M._camera.position=p.scaleAndAdd([],M._camera.position,ae.dir,-re),M._updateStateFromCamera());break}const be=p.sub([],M._camera.position,H);re=.5*p.length(be),M._camera.position=p.scaleAndAdd([],M._camera.position,ae.dir,re);try{M._updateStateFromCamera()}catch(ve){return void p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ee<10);return{center:M.center,zoom:M.zoom,bearing:M.bearing,pitch:M.pitch}}fitBounds(o,u,g){return this._fitInternal(this.cameraForBounds(o,u),u,g)}_raycastElevationBox(o,u){const g=this.transform.elevation;if(!g)return;const v=new p.pointGeometry(o.x,u.y),b=new p.pointGeometry(u.x,o.y),C=g.pointCoordinate(o);if(!C)return;const M=g.pointCoordinate(u);if(!M)return;const k=g.pointCoordinate(v);if(!k)return;const R=g.pointCoordinate(b);if(!R)return;const L=new p.MercatorCoordinate(C[0],C[1]).toLngLat(),B=new p.MercatorCoordinate(M[0],M[1]).toLngLat(),V=new p.MercatorCoordinate(k[0],k[1]).toLngLat(),Z=new p.MercatorCoordinate(R[0],R[1]).toLngLat(),H=Math.min(L.lng,Math.min(B.lng,Math.min(V.lng,Z.lng))),W=Math.min(L.lat,Math.min(B.lat,Math.min(V.lat,Z.lat))),ae=Math.max(L.lng,Math.max(B.lng,Math.max(V.lng,Z.lng))),G=Math.max(L.lat,Math.max(B.lat,Math.max(V.lat,Z.lat))),re=Math.min(C[3],Math.min(M[3],Math.min(k[3],R[3]))),ee=Math.max(C[3],Math.max(M[3],Math.max(k[3],R[3])));return{minLngLat:new p.LngLat(H,W),maxLngLat:new p.LngLat(ae,G),minAltitude:re,maxAltitude:ee}}fitScreenCoordinates(o,u,g,v,b){let C,M,k,R;const L=p.pointGeometry.convert(o),B=p.pointGeometry.convert(u),V=this._raycastElevationBox(L,B);if(V)C=V.minLngLat,M=V.maxLngLat,k=V.minAltitude,R=V.maxAltitude;else{if(this.transform.anyCornerOffEdge(L,B))return this;C=this.transform.pointLocation(L),M=this.transform.pointLocation(B)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(p.pointGeometry.convert(o)),this.transform.pointLocation(p.pointGeometry.convert(u)),g,v):this._cameraForBox(C,M,k,R,v),v,b)}_fitInternal(o,u,g){return o?(delete(u=p.extend(o,u)).padding,u.linear?this.easeTo(u,g):this.flyTo(u,g)):this}jumpTo(o,u){this.stop();const g=o.preloadOnly?this.transform.clone():this.transform;let v=!1,b=!1,C=!1;return"zoom"in o&&g.zoom!==+o.zoom&&(v=!0,g.zoom=+o.zoom),void 0!==o.center&&(g.center=p.LngLat.convert(o.center)),"bearing"in o&&g.bearing!==+o.bearing&&(b=!0,g.bearing=+o.bearing),"pitch"in o&&g.pitch!==+o.pitch&&(C=!0,g.pitch=+o.pitch),null==o.padding||g.isPaddingEqual(o.padding)||(g.padding=o.padding),o.preloadOnly?(this._preloadTiles(g),this):(this.fire(new p.Event("movestart",u)).fire(new p.Event("move",u)),v&&this.fire(new p.Event("zoomstart",u)).fire(new p.Event("zoom",u)).fire(new p.Event("zoomend",u)),b&&this.fire(new p.Event("rotatestart",u)).fire(new p.Event("rotate",u)).fire(new p.Event("rotateend",u)),C&&this.fire(new p.Event("pitchstart",u)).fire(new p.Event("pitch",u)).fire(new p.Event("pitchend",u)),this.fire(new p.Event("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(Ct),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,u){const g=this.transform;if(!g.projection.supportsFreeCamera)return void p.warnOnce(Ct);this.stop();const v=g.zoom,b=g.pitch,C=g.bearing;g.setFreeCameraOptions(o);const M=v!==g.zoom,k=b!==g.pitch,R=C!==g.bearing;return this.fire(new p.Event("movestart",u)).fire(new p.Event("move",u)),M&&this.fire(new p.Event("zoomstart",u)).fire(new p.Event("zoom",u)).fire(new p.Event("zoomend",u)),R&&this.fire(new p.Event("rotatestart",u)).fire(new p.Event("rotate",u)).fire(new p.Event("rotateend",u)),k&&this.fire(new p.Event("pitchstart",u)).fire(new p.Event("pitch",u)).fire(new p.Event("pitchend",u)),this.fire(new p.Event("moveend",u)),this}easeTo(o,u){this._stop(!1,o.easeId),(!1===(o=p.extend({offset:[0,0],duration:500,easing:p.ease},o)).animate||!o.essential&&p.exported.prefersReducedMotion)&&(o.duration=0);const g=this.transform,v=this.getZoom(),b=this.getBearing(),C=this.getPitch(),M=this.getPadding(),k="zoom"in o?+o.zoom:v,R="bearing"in o?this._normalizeBearing(o.bearing,b):b,L="pitch"in o?+o.pitch:C,B="padding"in o?o.padding:g.padding,V=p.pointGeometry.convert(o.offset);let Z=g.centerPoint.add(V);const H="globe"===g.projection.name?g.pointCoordinate(Z).toLngLat():g.pointLocation(Z),W=p.LngLat.convert(o.center||H);this._normalizeCenter(W);const ae=g.project(H),G=g.project(W).sub(ae),re=g.zoomScale(k-v);let ee,ne;o.around&&(ee=p.LngLat.convert(o.around),ne=g.locationPoint(ee));const ie=this._zooming||k!==v,le=this._rotating||b!==R,_e=this._pitching||L!==C,xe=!g.isPaddingEqual(B),qe=Le=>be=>{if(ie&&(Le.zoom=p.number(v,k,be)),le&&(Le.bearing=p.number(b,R,be)),_e&&(Le.pitch=p.number(C,L,be)),xe&&(Le.interpolatePadding(M,B,be),Z=Le.centerPoint.add(V)),ee)Le.setLocationAtPoint(ee,ne);else{const ve=Le.zoomScale(Le.zoom-v),ke=k>v?Math.min(2,re):Math.max(.5,re),Se=Math.pow(ke,1-be),rt=Le.unproject(ae.add(G.mult(be*Se)).mult(ve));Le.setLocationAtPoint(Le.renderWorldCopies?rt.wrap():rt,Z)}return o.preloadOnly||this._fireMoveEvents(u),Le};if(o.preloadOnly){const Le=this._emulate(qe,o.duration,g);return this._preloadTiles(Le),this}const Oe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ie,this._rotating=le,this._pitching=_e,this._padding=xe,this._easeId=o.easeId,this._prepareEase(u,o.noMoveStart,Oe),this._ease(qe(g),Le=>{g.recenterOnTerrain(),this._afterEase(u,Le)},o),this}_prepareEase(o,u,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",u||g.moving||this.fire(new p.Event("movestart",o)),this._zooming&&!g.zooming&&this.fire(new p.Event("zoomstart",o)),this._rotating&&!g.rotating&&this.fire(new p.Event("rotatestart",o)),this._pitching&&!g.pitching&&this.fire(new p.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new p.Event("move",o)),this._zooming&&this.fire(new p.Event("zoom",o)),this._rotating&&this.fire(new p.Event("rotate",o)),this._pitching&&this.fire(new p.Event("pitch",o))}_afterEase(o,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId,this.transform.cameraElevationReference="ground";const g=this._zooming,v=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new p.Event("zoomend",o)),v&&this.fire(new p.Event("rotateend",o)),b&&this.fire(new p.Event("pitchend",o)),this.fire(new p.Event("moveend",o))}flyTo(o,u){if(!o.essential&&p.exported.prefersReducedMotion){const He=p.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(He,u)}this.stop(),o=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},o);const g=this.transform,v=this.getZoom(),b=this.getBearing(),C=this.getPitch(),M=this.getPadding(),k="zoom"in o?p.clamp(+o.zoom,g.minZoom,g.maxZoom):v,R="bearing"in o?this._normalizeBearing(o.bearing,b):b,L="pitch"in o?+o.pitch:C,B="padding"in o?o.padding:g.padding,V=g.zoomScale(k-v),Z=p.pointGeometry.convert(o.offset);let H=g.centerPoint.add(Z);const W=g.pointLocation(H),ae=p.LngLat.convert(o.center||W);this._normalizeCenter(ae);const G=g.project(W),re=g.project(ae).sub(G);let ee=o.curve;const ne=Math.max(g.width,g.height),ie=ne/V,le=re.mag();if("minZoom"in o){const He=p.clamp(Math.min(o.minZoom,v,k),g.minZoom,g.maxZoom),ut=ne/g.zoomScale(He-v);ee=Math.sqrt(ut/le*2)}const _e=ee*ee;function xe(He){const ut=(ie*ie-ne*ne+(He?-1:1)*_e*_e*le*le)/(2*(He?ie:ne)*_e*le);return Math.log(Math.sqrt(ut*ut+1)-ut)}function qe(He){return(Math.exp(He)-Math.exp(-He))/2}function Oe(He){return(Math.exp(He)+Math.exp(-He))/2}const Le=xe(0);let be=function(He){return Oe(Le)/Oe(Le+ee*He)},ve=function(He){return ne*((Oe(Le)*(qe(ut=Le+ee*He)/Oe(ut))-qe(Le))/_e)/le;var ut},ke=(xe(1)-Le)/ee;if(Math.abs(le)<1e-6||!isFinite(ke)){if(Math.abs(ne-ie)<1e-6)return this.easeTo(o,u);const He=ie<ne?-1:1;ke=Math.abs(Math.log(ie/ne))/ee,ve=function(){return 0},be=function(ut){return Math.exp(He*ee*ut)}}o.duration="duration"in o?+o.duration:1e3*ke/("screenSpeed"in o?+o.screenSpeed/ee:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const Se=b!==R,rt=L!==C,dt=!g.isPaddingEqual(B),At=He=>ut=>{const yt=ut*ke,mn=1/be(yt);He.zoom=1===ut?k:v+He.scaleZoom(mn),Se&&(He.bearing=p.number(b,R,ut)),rt&&(He.pitch=p.number(C,L,ut)),dt&&(He.interpolatePadding(M,B,ut),H=He.centerPoint.add(Z));const Dn=1===ut?ae:He.unproject(G.add(re.mult(ve(yt))).mult(mn));return He.setLocationAtPoint(He.renderWorldCopies?Dn.wrap():Dn,H),He._updateCenterElevation(),o.preloadOnly||this._fireMoveEvents(u),He};if(o.preloadOnly){const He=this._emulate(At,o.duration,g);return this._preloadTiles(He),this}return this._zooming=!0,this._rotating=Se,this._pitching=rt,this._padding=dt,this._prepareEase(u,!1),this._ease(At(g),()=>this._afterEase(u),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,u)}if(!o){const g=this.handlers;g&&g.stop(!1)}return this}_ease(o,u,g){!1===g.animate||0===g.duration?(o(1),u()):(this._easeStart=p.exported.now(),this._easeOptions=g,this._onEaseFrame=o,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,u){o=p.wrap(o,-180,180);const g=Math.abs(o-u);return Math.abs(o-360-u)<g&&(o-=360),Math.abs(o+360-u)<g&&(o+=360),o}_normalizeCenter(o){const u=this.transform;if(!u.renderWorldCopies||u.maxBounds)return;const g=o.lng-u.center.lng;o.lng+=g>180?-360:g<-180?360:0}_emulate(o,u,g){const v=Math.ceil(15*u/1e3),b=[],C=o(g.clone());for(let M=0;M<=v;M++){const k=C(M/v);b.push(k.clone())}return b}}class Qu{constructor(o={}){this.options=o,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const u=this.options&&this.options.compact;return this._map=o,this._container=Pe.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Pe.create("button","mapboxgl-ctrl-attrib-button",this._container),Pe.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Pe.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===u&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,u){const g=this._map._getUIString(`AttributionControl.${u}`);o.setAttribute("aria-label",g),o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(o){const g=u.reduce((v,b,C)=>(b.value&&(v+=`${b.key}=${b.value}${C<u.length-1?"&":""}`),v),"?");o.href=`${p.config.FEEDBACK_URL}/${g}${this._map._hash?this._map._hash.getHashString(!0):""}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||"metadata"!==o.sourceDataType&&"visibility"!==o.sourceDataType&&"style"!==o.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const u=this._map.style._sourceCaches;for(const v in u){const b=u[v];if(b.used){const C=b.getSource();C.attribution&&o.indexOf(C.attribution)<0&&o.push(C.attribution)}}o.sort((v,b)=>v.length-b.length),o=o.filter((v,b)=>{for(let C=b+1;C<o.length;C++)if(o[C].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const g=o.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,o.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class eh{constructor(){p.bindAll(["_updateLogo"],this),p.bindAll(["_updateCompact"],this)}onAdd(o){this._map=o,this._container=Pe.create("div","mapboxgl-ctrl");const u=Pe.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&"metadata"!==o.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(0===Object.entries(o).length)return!0;for(const u in o){const g=o[u].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const u=o[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class th{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const u=++this._id;return this._queue.push({callback:o,id:u,cancelled:!1}),u}remove(o){const u=this._currentlyRunning,g=u?this._queue.concat(u):this._queue;for(const v of g)if(v.id===o)return void(v.cancelled=!0)}run(o=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const g of u)if(!g.cancelled&&(g.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Wc(m,o,u){if(m=new p.LngLat(m.lng,m.lat),o){const g=new p.LngLat(m.lng-360,m.lat),v=new p.LngLat(m.lng+360,m.lat),b=360*Math.ceil(Math.abs(m.lng-u.center.lng)/360),C=u.locationPoint(m).distSqr(o),M=o.x<0||o.y<0||o.x>u.width||o.y>u.height;u.locationPoint(g).distSqr(o)<C&&(M||Math.abs(g.lng-u.center.lng)<b)?m=g:u.locationPoint(v).distSqr(o)<C&&(M||Math.abs(v.lng-u.center.lng)<b)&&(m=v)}for(;Math.abs(m.lng-u.center.lng)>180;){const g=u.locationPoint(m);if(g.x>=0&&g.y>=0&&g.x<=u.width&&g.y<=u.height)break;m.lng>u.center.lng?m.lng-=360:m.lng+=360}return m}const Ir={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class nh extends p.Evented{constructor(o,u){if(super(),(o instanceof p.window.HTMLElement||u)&&(o=p.extend({element:o},u)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&"auto"!==o.pitchAlignment?o.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),o&&o.element)this._element=o.element,this._offset=p.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=Pe.create("div");const v=41,b=27,C=Pe.createSVG("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),M=Pe.createSVG("radialGradient",{id:"shadowGradient"},Pe.createSVG("defs",{},C));Pe.createSVG("stop",{offset:"10%","stop-opacity":.4},M),Pe.createSVG("stop",{offset:"100%","stop-opacity":.05},M),Pe.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),Pe.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),Pe.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),Pe.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=p.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const g=this._element.classList;for(const v in Ir)g.remove(`mapboxgl-marker-anchor-${v}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=p.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const u=38.1,g=13.5,v=Math.sqrt(Math.pow(g,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-u],"bottom-left":[v,-1*(u-g+v)],"bottom-right":[-v,-1*(u-g+v)],left:[g,-1*(u-g)],right:[-g,-1*(u-g)]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const u=o.code,g=o.charCode||o.keyCode;"Space"!==u&&"Enter"!==u&&32!==g&&13!==g||this.togglePopup()}_onMapClick(o){const u=o.originalEvent.target,g=this._element;this._popup&&(u===g||g.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const o=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(o))return void this._clearFadeTimer();const u=this._map.unproject(o);let g=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const b=this._map.getFreeCameraOptions();if(b.position){const C=b.position.toLngLat();g=C.distanceTo(u)<.9*C.distanceTo(this._lngLat)}}const v=(1-this._map._queryFogOpacity(u))*(g?.2:1);this._element.style.opacity=`${v}`,this._popup&&this._popup._setOpacity(`${v}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(o){const u=this._map.transform;return!!o&&o.x>=0&&o.x<u.width&&o.y>=0&&o.y<u.height}_updateDOM(){const o=this._pos||new p.pointGeometry(0,0),u=this._calculatePitch(),g=this._calculateRotation();this._element.style.transform=`${Ir[this._anchor]} translate(${o.x}px, ${o.y}px) rotateX(${u}deg) rotateZ(${g}deg)`}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(o){p.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=Wc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),!0===o?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const o=this._map.transform,u=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&u._rotate(o.angle),"map"===this._pitchAlignment&&(u.y*=Math.cos(o._pitch)),u}getOffset(){return this._offset}setOffset(o){return this._offset=p.pointGeometry.convert(o),this._update(),this}_onMove(o){if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&"auto"!==o?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Ne{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const u=p.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,u,g){this._start=this.getValue(u),this._end=o,this._startTime=u,this._endTime=u+g}}const on={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:fo,HTMLElement:Hn,ImageBitmap:xa}=p.window,Kl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Ki(m){m.parentNode&&m.parentNode.removeChild(m)}const rh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Xc{constructor(o,u,g=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new vi({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,g&&(this.mousePitch=new Xu({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(o,u){this.mouseRotate.mousedown(o,u),this.mousePitch&&this.mousePitch.mousedown(o,u),Pe.disableDrag()}move(o,u){const g=this.map,v=this.mouseRotate.mousemoveWindow(o,u);if(v&&v.bearingDelta&&g.setBearing(g.getBearing()+v.bearingDelta),this.mousePitch){const b=this.mousePitch.mousemoveWindow(o,u);b&&b.pitchDelta&&g.setPitch(g.getPitch()+b.pitchDelta)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Pe.enableDrag(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(p.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),Pe.mousePos(this.element,o)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,Pe.mousePos(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){1!==o.targetTouches.length?this.reset():(this._startPos=this._lastPos=Pe.touchPos(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){1!==o.targetTouches.length?this.reset():(this._lastPos=Pe.touchPos(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){0===o.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Kc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let ri,zs=0,os=!1;const br={maxWidth:100,unit:"metric"};function Ye(m,o,u){const g=u&&u.maxWidth||100,v=m._containerHeight/2,b=m.unproject([0,v]),C=m.unproject([g,v]),M=b.distanceTo(C);if(u&&"imperial"===u.unit){const k=3.2808*M;k>5280?ba(o,g,k/5280,m._getUIString("ScaleControl.Miles"),m):ba(o,g,k,m._getUIString("ScaleControl.Feet"),m)}else u&&"nautical"===u.unit?ba(o,g,M/1852,m._getUIString("ScaleControl.NauticalMiles"),m):M>=1e3?ba(o,g,M/1e3,m._getUIString("ScaleControl.Kilometers"),m):ba(o,g,M,m._getUIString("ScaleControl.Meters"),m)}function ba(m,o,u,g,v){const b=function(M){const k=Math.pow(10,`${Math.floor(M)}`.length-1);let R=M/k;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(L){const B=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*B)/B}(R),k*R}(u),C=b/u;v._requestDomTask(()=>{m.style.width=o*C+"px",m.innerHTML=`${b}&nbsp;${g}`})}const wa={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ni=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Bs={version:p.version,supported:Yn,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends jp{constructor(m){if(null!=(m=p.extend({},Kl,m)).minZoom&&null!=m.maxZoom&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=m.minPitch&&null!=m.maxPitch&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=m.minPitch&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=m.maxPitch&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new jc(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._renderTaskQueue=new th,this._domRenderTaskQueue=new th,this._controls=[],this._markers=[],this._mapId=p.uniqueId(),this._locale=p.extend({},on,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Ne(0),this._requestManager=new p.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,"string"==typeof m.container){if(this._container=p.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof Hn))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Fs(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new zp("string"==typeof m.hash&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,p.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new Qu({customAttribution:m.customAttribution})),this._logoControl=new eh,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update("style"===o.dataType),this.fire(new p.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new p.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(m,o){if(void 0===o&&(o=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=m.onAdd(this);this._controls.push(m);const g=this._controlPositions[o];return-1!==o.indexOf("bottom")?g.insertBefore(u,g.firstChild):g.appendChild(u),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(m);return o>-1&&this._controls.splice(o,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new p.Event("movestart",m)).fire(new p.Event("move",m)),this.fire(new p.Event("resize",m)),o&&this.fire(new p.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(p.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=null==m?-2:m)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=null==m?22:m)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=null==m?0:m)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=null==m?85:m)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}getProjection(){return this.transform.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),"string"==typeof m&&(m={name:m}),this._runtimeProjection=m,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(m){return this.transform.locationPoint3D(p.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(p.pointGeometry.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(m,o,u){if("mouseenter"===m||"mouseover"===m){let g=!1;const v=C=>{const M=o.filter(R=>this.getLayer(R)),k=M.length?this.queryRenderedFeatures(C.point,{layers:M}):[];k.length?g||(g=!0,u.call(this,new $r(m,this,C.originalEvent,{features:k}))):g=!1},b=()=>{g=!1};return{layers:new Set(o),listener:u,delegates:{mousemove:v,mouseout:b}}}if("mouseleave"===m||"mouseout"===m){let g=!1;const v=C=>{const M=o.filter(k=>this.getLayer(k));(M.length?this.queryRenderedFeatures(C.point,{layers:M}):[]).length?g=!0:g&&(g=!1,u.call(this,new $r(m,this,C.originalEvent)))},b=C=>{g&&(g=!1,u.call(this,new $r(m,this,C.originalEvent)))};return{layers:new Set(o),listener:u,delegates:{mousemove:v,mouseout:b}}}{const g=v=>{const b=o.filter(M=>this.getLayer(M)),C=b.length?this.queryRenderedFeatures(v.point,{layers:b}):[];C.length&&(v.features=C,u.call(this,v),delete v.features)};return{layers:new Set(o),listener:u,delegates:{[m]:g}}}}on(m,o,u){if(void 0===u)return super.on(m,o);Array.isArray(o)||(o=[o]);const g=this._createDelegatedListener(m,o,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(const v in g.delegates)this.on(v,g.delegates[v]);return this}once(m,o,u){if(void 0===u)return super.once(m,o);Array.isArray(o)||(o=[o]);const g=this._createDelegatedListener(m,o,u);for(const v in g.delegates)this.once(v,g.delegates[v]);return this}off(m,o,u){if(void 0===u)return super.off(m,o);o=new Set(Array.isArray(o)?o:[o]);const g=(b,C)=>{if(b.size!==C.size)return!1;for(const M of b)if(!C.has(M))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[m]:void 0;return v&&(b=>{for(let C=0;C<b.length;C++){const M=b[C];if(M.listener===u&&g(M.layers,o)){for(const k in M.delegates)this.off(k,M.delegates[k]);return b.splice(C,1),this}}})(v),this}queryRenderedFeatures(m,o){return this.style?(void 0!==o||void 0===m||m instanceof p.pointGeometry||Array.isArray(m)||(o=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(m,o){return this.style.querySourceFeatures(m,o)}queryTerrainElevation(m,o){const u=this.transform.elevation;return u?(o=p.extend({},{exaggerated:!0},o),u.getAtPoint(p.MercatorCoordinate.fromLngLat(m),null,o.exaggerated)):null}setStyle(m,o){return!1!==(o=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(m,o))}_getUIString(m){const o=this._locale[m];if(null==o)throw new Error(`Missing UI string '${m}'`);return o}_updateStyle(m,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),m&&(this.style=new _i(this,o||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof m?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new _i(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,o){if("string"==typeof m){const u=this._requestManager.normalizeStyleURL(m),g=this._requestManager.transformRequest(u,p.ResourceType.Style);p.getJSON(g,(v,b)=>{v?this.fire(new p.ErrorEvent(v)):b&&this._updateDiff(b,o)})}else"object"==typeof m&&this._updateDiff(m,o)}_updateDiff(m,o){try{this.style.setState(m)&&this._update(!0)}catch(u){p.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(m,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():p.warnOnce("There is no style added to the map.")}addSource(m,o){return this._lazyInitEmptyStyle(),this.style.addSource(m,o),this._update(!0)}isSourceLoaded(m){const o=this.style&&this.style._getSourceCaches(m);if(0!==o.length)return o.every(u=>u.loaded());this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${m}'`)))}areTilesLoaded(){const m=this.style&&this.style._sourceCaches;for(const o in m){const u=m[o]._tiles;for(const g in u){const v=u[g];if("loaded"!==v.state&&"errored"!==v.state)return!1}}return!0}addSourceType(m,o,u){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,o,u)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,o,{pixelRatio:u=1,sdf:g=!1,stretchX:v,stretchY:b,content:C}={}){if(this._lazyInitEmptyStyle(),o instanceof fo||xa&&o instanceof xa){const{width:M,height:k,data:R}=p.exported.getImageData(o);this.style.addImage(m,{data:new p.RGBAImage({width:M,height:k},R),pixelRatio:u,stretchX:v,stretchY:b,content:C,sdf:g,version:0})}else{if(void 0===o.width||void 0===o.height)return this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:k,data:R}=o,L=o;this.style.addImage(m,{data:new p.RGBAImage({width:M,height:k},new Uint8Array(R)),pixelRatio:u,stretchX:v,stretchY:b,content:C,sdf:g,version:0,userImage:L}),L.onAdd&&L.onAdd(this,m)}}}updateImage(m,o){const u=this.style.getImage(m);if(!u)return this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=o instanceof fo||xa&&o instanceof xa?p.exported.getImageData(o):o,{width:v,height:b,data:C}=g;return void 0===v||void 0===b?this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):v!==u.data.width||b!==u.data.height?this.fire(new p.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(u.data.replace(C,!(o instanceof fo||xa&&o instanceof xa)),void this.style.updateImage(m,u))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,o){p.getImage(this._requestManager.transformRequest(m,p.ResourceType.Image),(u,g)=>{o(u,g instanceof fo?p.exported.getImageData(g):g)})}listImages(){return this.style.listImages()}addLayer(m,o){return this._lazyInitEmptyStyle(),this.style.addLayer(m,o),this._update(!0)}moveLayer(m,o){return this.style.moveLayer(m,o),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,o,u){return this.style.setLayerZoomRange(m,o,u),this._update(!0)}setFilter(m,o,u={}){return this.style.setFilter(m,o,u),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,o,u,g={}){return this.style.setPaintProperty(m,o,u,g),this._update(!0)}getPaintProperty(m,o){return this.style.getPaintProperty(m,o)}setLayoutProperty(m,o,u,g={}){return this.style.setLayoutProperty(m,o,u,g),this._update(!0)}getLayoutProperty(m,o){return this.style.getLayoutProperty(m,o)}setLight(m,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){"globe"===this.transform.projection.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(m),this.transform):0}setFeatureState(m,o){return this.style.setFeatureState(m,o),this._update()}removeFeatureState(m,o){return this.style.removeFeatureState(m,o),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let u,g=this._container;for(;g&&!u;){const v=p.window.getComputedStyle(g).transform;v&&"none"!==v&&(u=v.match(/matrix.*\((.+)\)/)[1].split(", ")),g=g.parentElement}u?(this._containerWidth=u[0]&&"0"!==u[0]?Math.abs(m/u[0]):m,this._containerHeight=u[3]&&"0"!==u[3]?Math.abs(o/u[3]):o):(this._containerWidth=m,this._containerHeight=o)}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=Pe.create("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=Pe.create("div","mapboxgl-canvas-container",m);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=Pe.create("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=Pe.create("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=Pe.create("div",`mapboxgl-ctrl-${v}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,o){const u=p.exported.devicePixelRatio||1;this._canvas.width=u*Math.ceil(m),this._canvas.height=u*Math.ceil(o),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${o}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const o=this._markers.indexOf(m);-1!==o&&this._markers.splice(o,1)}_setupPainter(){const m=p.extend({},Yn.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);o?(p.storeAuthState(o,!0),this.painter=new Zl(o,this.transform),this.on("data",u=>{"source"===u.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(o)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let o;const u=this.painter.context.extTimerQuery,g=p.exported.now();this.listens("gpu-timing-frame")&&(o=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,o));let v=this._updateAverageElevation(g);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjection();let b=!1;const C=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,R=this.transform.pitch,L=p.exported.now();this.style.zoomHistory.update(k,L);const B=new p.EvaluationParameters(k,{now:L,fadeDuration:C,pitch:R,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),V=B.crossFadingFactor();1===V&&V===this._crossFadingFactor||(b=!0,this._crossFadingFactor=V),this.style.update(B)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,C,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||b)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const k=p.exported.now()-g;u.endQueryEXT(u.TIME_ELAPSED_EXT,o),setTimeout(()=>{const R=u.getQueryObjectEXT(o,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(o),this.fire(new p.Event("gpu-timing-frame",{cpuTime:k,gpuTime:R}))},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(k);this.fire(new p.Event("gpu-timing-layer",{layerTimes:R}))},50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(M||this._repaint)this.triggerRepaint();else{const k=!this.isMoving()&&this.loaded();if(k&&(v=this._updateAverageElevation(g,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const m of this._markers)m._update()}_updateAverageElevation(m,o=!1){const u=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&u(0);if((o||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const g=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();isNaN(v)?v=0:this._averageElevationLastSampledAt=m;const b=Math.abs(g-v);if(b>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(v),u(v);this._averageElevation.easeTo(v,m,300)}else if(b>1e-4)return this._averageElevation.jumpTo(v),u(v)}return!!this._averageElevation.isEasing(m)&&u(this._averageElevation.getValue(m))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===p.AUTH_ERR_MSG||401===m.status)){const o=this.painter.context.gl;p.storeAuthState(o,!1),this._logoControl instanceof eh&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const u=this.painter.context.gl,g=u.createFramebuffer();function v(b){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,b,0);const C=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,C),C}return u.bindFramebuffer(u.FRAMEBUFFER,g),this._canvasPixelComparison(v(m),o.canvasCopies.map(v),o.timeStamps)}_canvasPixelComparison(m,o,u){let g=u[1]-u[0];const v=m.length/4;for(let b=0;b<o.length;b++){const C=o[b];let M=0;for(let k=0;k<C.length;k+=4)C[k]===m[k]&&C[k+1]===m[k+1]&&C[k+2]===m[k+2]&&C[k+3]===m[k+3]&&(M+=1);g+=(u[b+2]-u[b+1])*(1-M/v)}return g}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),Ki(this._canvasContainer),Ki(this._controlContainer),Ki(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=p.exported.frame(o=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(o)}))}_preloadTiles(m){const o=this.style&&Object.values(this.style._sourceCaches)||[];return p.asyncAll(o,(u,g)=>u._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,o){p.setCacheLimits(m,o)}get version(){return p.version}},NavigationControl:class{constructor(m){this.options=p.extend({},rh,m),this._container=Pe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),Pe.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),Pe.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=Pe.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const m=this._map.getZoom(),o=m===this._map.getMaxZoom(),u=m===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const m=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=m)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Xc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,o){const u=Pe.create("button",m,this._container);return u.type="button",u.addEventListener("click",o),u}_setButtonTitle(m,o){const u=this._map._getUIString(`NavigationControl.${o}`);m.setAttribute("aria-label",u),m.firstElementChild&&m.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends p.Evented{constructor(m){super(),this.options=p.extend({},Kc,m),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=_a(this._updateMarkerRotation,20)}onAdd(m){var o;return this._map=m,this._container=Pe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,void 0!==ri?o(ri):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(u=>{ri="denied"!==u.state,o(ri)}):(ri=!!p.window.navigator.geolocation,o(ri)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,zs=0,os=!1}_isOutOfMapMaxBounds(m){const o=this._map.getMaxBounds(),u=m.coords;return o&&(u.longitude<o.getWest()||u.longitude>o.getEast()||u.latitude<o.getSouth()||u.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(m),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",m)),this._finish()}}_updateCamera(m){const o=new p.LngLat(m.coords.longitude,m.coords.latitude),u=m.coords.accuracy,g=this._map.getBearing(),v=p.extend({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(u),v,{geolocateSource:!0})}_updateMarker(m){if(m){const o=new p.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._containerHeight/2,o=this._map.unproject([0,m]),u=this._map.unproject([100,m]),g=o.distanceTo(u)/100,v=Math.ceil(2*this._accuracy/g);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(1===m.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===m.code&&os)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=Pe.create("button","mapboxgl-ctrl-geolocate",this._container),Pe.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===m){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Pe.create("div","mapboxgl-user-location"),this._dotElement.appendChild(Pe.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Pe.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new nh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Pe.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new nh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||"ACTIVE_LOCK"!==this._watchState||o.originalEvent&&"resize"===o.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:!0===m.absolute&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":zs--,os=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),zs++,zs>1?(m={maximumAge:6e5,timeout:0},os=!0):(m=this.options.positionOptions,os=!1),this._geolocationWatchID=p.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else p.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(o=>{"granted"===o&&m()}).catch(console.error):m()}_clearWatch(){p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Qu,ScaleControl:class{constructor(m){this.options=p.extend({},br,m),p.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Ye(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=Pe.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,Ye(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof p.window.HTMLElement?this._container=m.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=Pe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=Pe.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Pe.create("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden",!0),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(m){super(),this.options=p.extend(Object.create(wa),m),p.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=p.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(p.window.document.createTextNode(m))}setHTML(m){const o=p.window.document.createDocumentFragment(),u=p.window.document.createElement("body");let g;for(u.innerHTML=m;g=u.firstChild,g;)o.appendChild(g);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Pe.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._container&&this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._container&&this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let o;return this._classList.delete(m)?o=!1:(this._classList.add(m),o=!0),this._container&&this._updateClassList(),o}_createCloseButton(){this.options.closeButton&&(this._closeButton=Pe.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(m){this._update(m.point)}_onMouseMove(m){this._update(m.point)}_onDrag(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const o=this._pos,u=this._container.offsetWidth,g=this._container.offsetHeight;let v;return v=o.y+m.bottom.y<g?["top"]:o.y>this._map.transform.height-g?["bottom"]:[],o.x<u/2?v.push("left"):o.x>this._map.transform.width-u/2&&v.push("right"),0===v.length?"bottom":v.join("-")}_updateClassList(){const m=[...this._classList];m.push("mapboxgl-popup"),this._anchor&&m.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&m.push("mapboxgl-popup-track-pointer"),this._container.className=m.join(" ")}_update(m){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=Pe.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Pe.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Wc(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||m){const o=this._pos=this._trackPointer&&m?m:this._map.project(this._lngLat),u=function(b){if(b||(b=new p.pointGeometry(0,0)),"number"==typeof b){const C=Math.round(Math.sqrt(.5*Math.pow(b,2)));return{center:new p.pointGeometry(0,0),top:new p.pointGeometry(0,b),"top-left":new p.pointGeometry(C,C),"top-right":new p.pointGeometry(-C,C),bottom:new p.pointGeometry(0,-b),"bottom-left":new p.pointGeometry(C,-C),"bottom-right":new p.pointGeometry(-C,-C),left:new p.pointGeometry(b,0),right:new p.pointGeometry(-b,0)}}if(b instanceof p.pointGeometry||Array.isArray(b)){const C=p.pointGeometry.convert(b);return{center:C,top:C,"top-left":C,"top-right":C,bottom:C,"bottom-left":C,"bottom-right":C,left:C,right:C}}return{center:p.pointGeometry.convert(b.center||[0,0]),top:p.pointGeometry.convert(b.top||[0,0]),"top-left":p.pointGeometry.convert(b["top-left"]||[0,0]),"top-right":p.pointGeometry.convert(b["top-right"]||[0,0]),bottom:p.pointGeometry.convert(b.bottom||[0,0]),"bottom-left":p.pointGeometry.convert(b["bottom-left"]||[0,0]),"bottom-right":p.pointGeometry.convert(b["bottom-right"]||[0,0]),left:p.pointGeometry.convert(b.left||[0,0]),right:p.pointGeometry.convert(b.right||[0,0])}}(this.options.offset),g=this._anchor=this._getAnchor(u),v=o.add(u[g]).round();this._map._requestDomTask(()=>{this._container&&g&&(this._container.style.transform=`${Ir[g]} translate(${v.x}px,${v.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Ni);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._content&&(this._content.style.opacity=m),this._tip&&(this._tip.style.opacity=m)}},Marker:nh,Style:_i,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.pointGeometry,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:id,Evented:p.Evented,config:p.config,prewarm:function(){ue().acquire(se)},clearPrewarmedResources:function(){const m=de;m&&(m.isPreloaded()&&1===m.numActive()?(m.release(se),de=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(m){p.config.ACCESS_TOKEN=m},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(m){p.config.API_URL=m},get workerCount(){return me.workerCount},set workerCount(m){me.workerCount=m},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){p.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){p.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return Bs}),$n}()}},Mp=>{Mp(Mp.s=476)}]);